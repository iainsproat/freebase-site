
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(b){function h(){if(b.browser.msie){var a=b(document).height(),e=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,20>a-e?e:a]}return[b(document).width(),b(document).height()]}function g(a){if(a)return a.call(b.mask)}b.tools=b.tools||{version:"@VERSION"};var f;f=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var c,a,e,d,o;b.mask={load:function(i,j){if(e)return this;"string"==typeof i&&(i={color:i});i=i||d;d=i=b.extend(b.extend({},f.conf),i);c=b("#"+i.maskId);c.length||(c=b("<div/>").attr("id",i.maskId),b("body").append(c));var k=h();c.css({position:"absolute",top:0,left:0,width:k[0],height:k[1],display:"none",opacity:i.startOpacity,zIndex:i.zIndex});i.color&&c.css("backgroundColor",i.color);if(!1===g(i.onBeforeLoad))return this;i.closeOnEsc&&b(document).bind("keydown.mask",function(a){a.keyCode==
27&&b.mask.close(a)});i.closeOnClick&&c.bind("click.mask",function(a){b.mask.close(a)});b(window).bind("resize.mask",function(){b.mask.fit()});j&&j.length&&(o=j.eq(0).css("zIndex"),b.each(j,function(){var a=b(this);/relative|absolute|fixed/i.test(a.css("position"))||a.css("position","relative")}),a=j.css({zIndex:Math.max(i.zIndex+1,"auto"==o?0:o)}));c.css({display:"block"}).fadeTo(i.loadSpeed,i.opacity,function(){b.mask.fit();g(i.onLoad)});e=!0;return this},close:function(){if(e){if(!1===g(d.onBeforeClose))return this;
c.fadeOut(d.closeSpeed,function(){g(d.onClose);a&&a.css({zIndex:o})});b(document).unbind("keydown.mask");c.unbind("click.mask");b(window).unbind("resize.mask");e=!1}return this},fit:function(){if(e){var a=h();c.css({width:a[0],height:a[1]})}},getMask:function(){return c},isLoaded:function(){return e},getConf:function(){return d},getExposed:function(){return a}};b.fn.mask=function(a){b.mask.load(a);return this};b.fn.expose=function(a){b.mask.load(a,this);return this}})(jQuery);
(function(b){function h(c,a){var e=this,d=c.add(e),h=b(window),i,j,k,m=b.tools.expose&&(a.mask||a.expose),n=Math.random().toString().slice(10);m&&("string"==typeof m&&(m={color:m}),m.closeOnClick=m.closeOnEsc=!1);var l=a.target||c.attr("rel");j=l?b(l):c;if(!j.length)throw"Could not find Overlay: "+l;c&&-1==c.index(j)&&c.click(function(a){e.load(a);return a.preventDefault()});b.extend(e,{load:function(c){if(e.isOpened())return e;var i=f[a.effect];if(!i)throw'Overlay: cannot find effect : "'+a.effect+
'"';a.oneInstance&&b.each(g,function(){this.close(c)});c=c||b.Event();c.type="onBeforeLoad";d.trigger(c);if(c.isDefaultPrevented())return e;k=true;m&&b(j).expose(m);var l=a.top,p=a.left,s=j.outerWidth({margin:true}),q=j.outerHeight({margin:true});typeof l=="string"&&(l=l=="center"?Math.max((h.height()-q)/2,0):parseInt(l,10)/100*h.height());p=="center"&&(p=Math.max((h.width()-s)/2,0));i[0].call(e,{top:l,left:p},function(){if(k){c.type="onLoad";d.trigger(c)}});if(m&&a.closeOnClick)b.mask.getMask().one("click",
e.close);a.closeOnClick&&b(document).bind("click."+n,function(a){b(a.target).parents(j).length||e.close(a)});a.closeOnEsc&&b(document).bind("keydown."+n,function(a){a.keyCode==27&&e.close(a)});return e},close:function(c){if(!e.isOpened())return e;c=c||b.Event();c.type="onBeforeClose";d.trigger(c);if(!c.isDefaultPrevented()){k=false;f[a.effect][1].call(e,function(){c.type="onClose";d.trigger(c)});b(document).unbind("click."+n).unbind("keydown."+n);m&&b.mask.close();return e}},getOverlay:function(){return j},
getTrigger:function(){return c},getClosers:function(){return i},isOpened:function(){return k},getConf:function(){return a}});b.each(["onBeforeLoad","onStart","onLoad","onBeforeClose","onClose"],function(c,d){b.isFunction(a[d])&&b(e).bind(d,a[d]);e[d]=function(a){b(e).bind(d,a);return e}});i=j.find(a.close||".close");!i.length&&!a.close&&(i=b('<a class="close"></a>'),j.prepend(i));i.click(function(a){e.close(a)});a.load&&e.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(b,
a,e){f[b]=[a,e]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||6<b.browser.version,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var g=[],f={};b.tools.overlay.addEffect("default",function(c,a){var e=this.getConf(),d=b(window);e.fixed||(c.top+=d.scrollTop(),c.left+=d.scrollLeft());c.position=e.fixed?"fixed":"absolute";this.getOverlay().css(c).fadeIn(e.speed,a)},function(b){this.getOverlay().fadeOut(this.getConf().closeSpeed,
b)});b.fn.overlay=function(c){var a=this.data("overlay");if(a)return a;b.isFunction(c)&&(c={onBeforeLoad:c});c=b.extend(!0,{},b.tools.overlay.conf,c);this.each(function(){a=new h(b(this),c);g.push(a);b(this).data("overlay",a)});return c.api?a:this}})(jQuery);
(function(b){var h="undefined"!=typeof window.innerWidth?function(){return{w:window.innerWidth,h:window.innerHeight}}:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}};window.kbs=
function(g){b(".kbs.current",g).removeClass("current");var f=b(".domain-section:first",g),c=b(".domain-section:last",g),a=this.scroll_to=function(a){var e=b(document).scrollTop();b(document).height();var d=h().h,d=e+d,c=a.offset().top,a=c+a.height();c<e?b(document).scrollTop(c):a>d&&b(document).scrollTop(e+(a-d))},e=this.get_current=function(){return b(".kbs.current:first",g)},d=this.set_next=function(t,b,d){t=t||e();b.length&&(t.removeClass("current"),b.addClass("current"),d||a(b))},o=this.next_domain=
function(a){var b=e(),c=i(b);c&&(c=c.find(".kbs:first"),d(b,c,a))},i=this._next_domain=function(a){if(!a||!a.length)return b(".domain-section:first",g);a=a.closest(".domain-section");return!a.length||a[0]===c[0]?f:a.next(".domain-section")},j=this.prev_domain=function(){var a=e(),b=k(a);b&&(b=b.find(".kbs:first"),d(a,b))},k=this._prev_domain=function(a){if(!a||!a.length)return b(".domain-section:last",g);var e=a.closest(".domain-section");return a.closest(".property-section").length||a.closest(".type-section").length?
e:!e.length||e[0]===f[0]?c:e.prev(".domain-section")},m=this.next_type=function(){var a=e(),b=n(a);b&&(b=b.find(".kbs:first"),d(a,b))},n=this._next_type=function(a){if(!a||!a.length)return b(".type-section:first",g);var e=a.closest(".domain-section"),a=a.closest(".type-section"),a=a.length?a.next(".type-section"):e.find(".type-section:first");if(!a||!a.length){var d=i(e);if(d)for(;d.get(0)!==e.get(0);){a=d.find(".type-section:first");if(a.length)break;d=i(d)}}return a},l=this.prev_type=function(){var a=
e(),b=r(a);b&&(b=b.find(".kbs:first"),d(a,b))},r=this._prev_type=function(a){if(!a||!a.length)return b(".type-section:last",g);var e=a.closest(".domain-section"),d=a.closest(".type-section");if(a.closest(".property-section").length)return d;var c;d.length&&(c=d.prev(".type-section"));if(!c||!c.length)if(a=k(e))for(;a.get(0)!==e.get(0);){c=a.find(".type-section:last");if(c.length)break;a=k(a)}return c},u=this.next_prop=function(){var a=e(),b=v(a);b&&(b=b.find(".kbs:first"),d(a,b))},v=this._next_prop=
function(a){if(!a||!a.length)return b(".property-section:first",g);var e=a.closest(".domain-section"),d=a.closest(".type-section"),c=a.closest(".property-section"),e=c.length?c.next(".property-section"):d.length?d.find(".property-section:first"):e.find(".property-section:first");if(!e||!e.length)if(a=n(a))for(;a.get(0)!==d.get(0);){e=a.find(".property-section:first");if(e.length)break;null==d.get(0)&&(d=a);a=n(a)}return e},p=this.prev_prop=function(){var a=e(),b=s(a);b&&(b=b.find(".kbs:first"),d(a,
b))},s=this._prev_prop=function(a){if(!a||!a.length)return b(".property-section:last",g);var e=a.closest(".domain-section"),d=a.closest(".type-section"),c=a.closest(".property-section");if(a.closest(".data-section").length)return c;var f;c.length&&(f=c.prev(".property-section"));if(!f||!f.length)if(l=d.length?r(d):r(e))for(;l.get(0)!==d.get(0);){f=l.find(".property-section:last");if(f.length)break;null==d.get(0)&&(d=l);l=r(l)}return f};this.next=function(){var a=e();if(a&&a.length){var c=this._next(a);
if(c){d(a,c);return}}a=b(".kbs:visible:first",g);d(a,a)};this._next=function(a){if(!a||!a.length)return b(".domain-section:first .kbs:first",g);var e=a.closest(".domain-section"),d=a.closest(".type-section"),h=a.closest(".property-section");if(a.closest(".data-section").length){a=a.next(".kbs");if(a.length)return a;a=h.next(".property-section").find(".kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else if(h.length){a=h.find(".data-section:first .kbs:first");if(a.length)return a;
a=h.next(".property-section").find(".kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else if(d.length){a=d.find(".property-section:first .kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else a=e.find(".type-section:first .kbs:first");return a.length?a:e.get(0)===c.get(0)?f.find(".kbs:first"):e.next(".domain-section").find(".kbs:first")};this.prev=function(){var a=e(),b=this._prev(a);b&&d(a,b)};this._prev=function(a){if(!a||!a.length)return a=
b(".data-section:last .kbs:last",g),a.length||(a=b(".property-section:last .kbs:first",g)),a.length||(a=b(".type-section:last .kbs:first",g)),a.length||(a=b(".domain-section:last .kbs:first",g)),a;var e=a.closest(".domain-section"),d=a.closest(".type-section"),h=a.closest(".property-section");return a.closest(".data-section").length?(a=a.prev(".kbs"),a.length?a:h.find(".kbs:first")):h.length?(a=h.prev(".property-section").find(".kbs:last"),a.length?a:d.find(".kbs:first")):d.length?(a=d.prev(".type-section").find(".kbs:last"),
a.length?a:e.find(".kbs:first")):e.get(0)===f.get(0)?c.find(".kbs:last"):e.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var q=this;b(document).unbind(".kbs").bind("keydown.kbs",function(a){var e=a.target;if(e==document.body||e==document||e==window||e==b("html")[0])e=a.keyCode,68===e?a.shiftKey?j():o():84===e?a.shiftKey?l():m():80===e?a.shiftKey?p():u():74===e?q.next():75===e?q.prev():69===e&&q.edit()})}})(jQuery);
(function(b,h){var g=window.propbox={init:function(f,c){c=b.extend({lang:"/lang/en"},c);if(!c.base_ajax_url)throw Error("base_ajax_url required in propbox options");if(!c.base_static_url)throw Error("base_static_url required in propbox options");if(!c.id)throw Error("topic id required in propbox options");if(!c.lang)throw Error("lang required in propbox options");g.options=c;g.kbs=new h(f);b(".kbs",f).live("click",function(){var a=g.kbs.get_current();g.kbs.set_next(a,b(this),!0)}).live("edit",function(){var a=
b(this).find(".headmenu:first").data("submenu");a&&b("li:first a:first",a).click()});g.init_menus(f);b.tablesorter&&b(".data-table").addClass("table-sortable").tablesorter()},init_menus:function(f,c){f=b(f||document);c&&b(".nicemenu",f).nicemenu();var a;a=f&&f.is(".hover-row")?f:b(".hover-row",f);a.hover(g.row_menu_hoverover,g.row_menu_hoverout);a.dblclick(function(){var a=b(".nicemenu .default-action",this);a.length||(a=b(".nicemenu:first .submenu:first a:first",this));var d=a.attr("href");d&&("#"==
d||0==d.indexOf("javascript:void(0)"))&&b(a).click()});b(".nicemenu .headmenu",f).add(b(".nicemenu .default-action",f)).click("click",function(){if(g.kbs){var a=g.kbs.get_current();a&&g.kbs.set_next(a,b(this).parents(".kbs:first"),!0)}return!1})},row_menu_hoverover:function(){b(this).addClass("row-hover")},row_menu_hoverout:function(){b(this).removeClass("row-hover")},get_script:function(f,c){var a=g.get_script.cache;a||(a=g.get_script.cache={});var e=a[f];e?1===e.state?e.callbacks.push(c):4===e.state&&
c():(e=a[f]={state:0,callbacks:[c]},b.ajax({url:g.options.base_static_url+f,dataType:"script",cache:!0,beforeSend:function(){e.state=1},success:function(){e.state=4;b.each(e.callbacks,function(a,e){e()})},error:function(){e.state=-1}}))},prop_edit:function(f,c){var a=b(f).parents(".property-section");a.length||(a=b(f).parents(".submenu").data("headmenu").parents(".property-section"));a=a.find(".data-section .data-row:first:visible .nicemenu:first .headmenu");a.length?a.data("submenu").find("a:first").click():
g.prop_add(f,c);return!1},prop_add:function(f,c){var a=b(f).parents(".property-section");a.length||(a=b(f).parents(".submenu").data("headmenu").parents(".property-section"));g.get_script("/propbox-edit.mf.js",function(){g.edit.prop_add_begin(a,c)});return!1},value_edit:function(f){var c=b(f).parents(".submenu").data("headmenu").parents(".data-row:first"),a=c.parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.value_edit_begin(a,c)});return!1},value_delete:function(f){var c=
b(f).parents(".submenu").data("headmenu").parents(".data-row:first"),a=c.parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.value_delete_begin(a,c)});return!1},remove_type:function(f){var f=b(f),c=f.parents(".type-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.remove_type_begin(f,c)});return!1},add_type:function(f,c,a){var f=b(f),e=f.parents(".type-section"),d=g.options.incompatible_types;d?d.search(g.options.id,c,a,{compatible:function(){g.add_type_submit(f,
e)},incompatible:d.overlay_incompatible_callback({onConfirm:function(){g.add_type_submit(f,e)}})}):g.add_type_submit(f,e);return!1},add_type_submit:function(b,c){g.get_script("/propbox-edit.mf.js",function(){g.edit.add_type_submit(b,c)})},add_has_no_value:function(f){var c=b(f).parents(".submenu").data("headmenu").parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.add_has_no_value(c)});return!1},add_has_value:function(f){var c=b(f).parents(".submenu").data("headmenu").parents(".property-section");
g.get_script("/propbox-edit.mf.js",function(){g.edit.add_has_value(c)});return!1},remove_has_no_value:function(f){var c=b(f).parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.remove_has_no_value(c)});return!1},remove_has_value:function(f){var c=b(f).parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.remove_has_value(c)});return!1},more:function(f,c,a){var e=b(f).parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.more(e,
c,a,function(){b.tablesorter&&e.find("table").addClass("table-sortable").tablesorter()})})}}})(jQuery,window.kbs);
(function(b,h,g){h.infinitescroll=function(a,e,b){this.element=h(b);this._create(a,e)};h.infinitescroll.defaults={loading:{finished:g,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:g},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,currPage:1},callback:g,debug:!1,behavior:g,binder:h(b),nextSelector:"div.navigation a:first",
navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:g,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:g,path:g};h.infinitescroll.prototype={_binding:function(a){var e=this,b=e.options;if(b.behavior&&this["_binding_"+b.behavior]!==g)this["_binding_"+b.behavior].call(this);else{if("bind"!==a&&"unbind"!==a)return this._debug("Binding value  "+a+" not valid"),!1;if("unbind"==a)this.options.binder.unbind("smartscroll.infscr."+
e.options.infid);else this.options.binder[a]("smartscroll.infscr."+e.options.infid,function(){e.scroll()});this._debug("Binding",a)}},_create:function(a,b){if(!this._validate(a))return!1;var d=this.options=h.extend(!0,{},h.infinitescroll.defaults,a),c=h(d.nextSelector).attr("href");d.contentSelector=d.contentSelector||this.element;d.loading.selector=d.loading.selector||d.contentSelector;c?(d.path=this._determinepath(c),d.loading.msg=h('<div id="infscr-loading"><img alt="Loading..." src="'+d.loading.img+
'" /><div>'+d.loading.msgText+"</div></div>"),(new Image).src=d.loading.img,d.pixelsFromNavToBottom=h(document).height()-h(d.navSelector).offset().top,d.loading.start=d.loading.start||function(){h(d.navSelector).hide();d.loading.msg.appendTo(d.loading.selector).show(d.loading.speed,function(){beginAjax(d)})},d.loading.finished=d.loading.finished||function(){d.loading.msg.fadeOut("normal")},d.callback=function(a,c){d.behavior&&a["_callback_"+d.behavior]!==g&&a["_callback_"+d.behavior].call(h(d.contentSelector)[0],
c);b&&b.call(h(d.contentSelector)[0],c)},this._setup()):this._debug("Navigation selector not found")},_debug:function(){if(this.options.debug)return b.console&&console.log.call(console,arguments)},_determinepath:function(a){var b=this.options;if(b.behavior&&this["_determinepath_"+b.behavior]!==g)this["_determinepath_"+b.behavior].call(this,a);else{if(b.pathParse)return this._debug("pathParse manual"),"function"===typeof b.pathParse?b.pathParse():b.pathParse;if(a.match(/^(.*?)\b2\b(.*?$)/))a=a.match(/^(.*?)\b2\b(.*?$)/).slice(1);
else if(a.match(/^(.*?)2(.*?$)/)){if(a.match(/^(.*?page=)2(\/.*|$)/))return a=a.match(/^(.*?page=)2(\/.*|$)/).slice(1);a=a.match(/^(.*?)2(.*?$)/).slice(1)}else{if(a.match(/^(.*?page=)1(\/.*|$)/))return a=a.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");b.state.isInvalidPage=!0}this._debug("determinePath",
a);return a}},_error:function(a){var b=this.options;b.behavior&&this["_error_"+b.behavior]!==g?this["_error_"+b.behavior].call(this,a):("destroy"!==a&&"end"!==a&&(a="unknown"),this._debug("Error",a),"end"==a&&this._showdonemsg(),b.state.isDone=!0,b.state.currPage=1,b.state.isPaused=!1,this._binding("unbind"))},_loadcallback:function(a,e){var d=this.options,c=this.options.callback,f=d.state.isDone?"done":!d.appendCallback?"no-append":"append";if(d.behavior&&this["_loadcallback_"+d.behavior]!==g)this["_loadcallback_"+
d.behavior].call(this,a,e);else{switch(f){case "done":return this._showdonemsg(),!1;case "no-append":"html"==d.dataType&&(e=h("<div>"+e+"</div>").find(d.itemSelector));break;case "append":var j=a.children();if(0==j.length)return this._error("end");for(f=document.createDocumentFragment();a[0].firstChild;)f.appendChild(a[0].firstChild);this._debug("contentSelector",h(d.contentSelector)[0]);h(d.contentSelector)[0].appendChild(f);e=j.get()}d.loading.finished.call(h(d.contentSelector)[0],d);d.animate&&
(f=h(b).scrollTop()+h("#infscr-loading").height()+d.extraScrollPx+"px",h("html,body").animate({scrollTop:f},800,function(){d.state.isDuringAjax=!1}));d.animate||(d.state.isDuringAjax=!1);c(this,e)}},_nearbottom:function(){var a=this.options,e=0+h(document).height()-a.binder.scrollTop()-h(b).height();if(a.behavior&&this["_nearbottom_"+a.behavior]!==g)this["_nearbottom_"+a.behavior].call(this);else return this._debug("math:",e,a.pixelsFromNavToBottom),e-a.bufferPx<a.pixelsFromNavToBottom},_pausing:function(a){var b=
this.options;if(b.behavior&&this["_pausing_"+b.behavior]!==g)this["_pausing_"+b.behavior].call(this,a);else{"pause"!==a&&("resume"!==a&&null!==a)&&this._debug("Invalid argument. Toggling pause value instead");switch(a&&("pause"==a||"resume"==a)?a:"toggle"){case "pause":b.state.isPaused=!0;break;case "resume":b.state.isPaused=!1;break;case "toggle":b.state.isPaused=!b.state.isPaused}this._debug("Paused",b.state.isPaused);return!1}},_setup:function(){var a=this.options;if(a.behavior&&this["_setup_"+
a.behavior]!==g)this["_setup_"+a.behavior].call(this);else return this._binding("bind"),!1},_showdonemsg:function(){var a=this.options;a.behavior&&this["_showdonemsg_"+a.behavior]!==g?this["_showdonemsg_"+a.behavior].call(this):(a.loading.msg.find("img").hide().parent().find("div").html(a.loading.finishedMsg).animate({opacity:1},2E3,function(){h(this).parent().fadeOut("normal")}),a.errorCallback.call(h(a.contentSelector)[0],"done"))},_validate:function(a){for(var b in a)return b.indexOf&&-1<b.indexOf("Selector")&&
0===h(a[b]).length?(this._debug("Your "+b+" found no elements."),!1):!0},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=!0;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(a){var b=this,d=b.options,c=this._determinepath(c),f,j,k,m,a=a||null;beginAjax=function(a){a.state.currPage++;b._debug("heading into ajax",c);f=h(a.contentSelector).is("table")?h("<tbody/>"):h("<div/>");
j=c.join(a.state.currPage);k="html"==a.dataType||"json"==a.dataType?a.dataType:"html+callback";a.appendCallback&&"html"==a.dataType&&(k+="+callback");switch(k){case "html+callback":b._debug("Using HTML via .load() method");f.load(j+" "+a.itemSelector,null,function(a){b._loadcallback(f,a)});break;case "html":case "json":b._debug("Using "+k.toUpperCase()+" via $.ajax() method"),h.ajax({url:j,dataType:a.dataType,complete:function(a,c){(m="undefined"!==typeof a.isResolved?a.isResolved():"success"===c||
"notmodified"===c)?b._loadcallback(f,a.responseText):b._error("end")}})}};if(d.behavior&&this["retrieve_"+d.behavior]!==g)this["retrieve_"+d.behavior].call(this,a);else{if(d.state.isDestroyed)return this._debug("Instance is destroyed"),!1;d.state.isDuringAjax=!0;d.loading.start.call(h(d.contentSelector)[0],d)}},scroll:function(){var a=this.options,b=a.state;a.behavior&&this["scroll_"+a.behavior]!==g?this["scroll_"+a.behavior].call(this):!b.isDuringAjax&&!b.isInvalidPage&&!b.isDone&&!b.isDestroyed&&
!b.isPaused&&this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(a){h.isPlainObject(a)&&(this.options=h.extend(!0,this.options,a))}};h.fn.infinitescroll=function(a,b){switch(typeof a){case "string":var c=Array.prototype.slice.call(arguments,1);this.each(function(){var b=h.data(this,"infinitescroll");if(!b||!h.isFunction(b[a])||"_"===a.charAt(0))return!1;b[a].apply(b,c)});break;case "object":this.each(function(){var c=h.data(this,
"infinitescroll");c?c.update(a):h.data(this,"infinitescroll",new h.infinitescroll(a,b,this))})}return this};var f=h.event,c;f.special.smartscroll={setup:function(){h(this).bind("scroll",f.special.smartscroll.handler)},teardown:function(){h(this).unbind("scroll",f.special.smartscroll.handler)},handler:function(a,b){var d=this,f=arguments;a.type="smartscroll";c&&clearTimeout(c);c=setTimeout(function(){h.event.handle.apply(d,f)},"execAsap"===b?0:100)}};h.fn.smartscroll=function(a){return a?this.bind("smartscroll",
a):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);
(function(b,h){var g=h.collection={init_infinitescroll:function(){var f=b("#infinitescroll"),c=f.attr("data-next");if(c&&"false"!==c){var a=b("#infinitescroll-next");f.infinitescroll({loading:{msgText:"Fetching more topics",img:h.h.static_url("lib/template/img/horizontal-loader.gif")},nextSelector:"#infinitescroll-next",navSelector:"#infinitescroll-next",dataType:"json",pathParse:function(){return[a[0].href+"&"+b.param({cursor:f.attr("data-next")})+"&page=",""]},appendCallback:!1},function(a){var a=
JSON.parse(a),c=a.result.cursor,a=b(a.result.html);g.init_menus(a);g.load_blurbs(a);f.append(a);c?f.attr("data-next",c):b(window).unbind(".infscr")});setTimeout(function(){b(window).trigger("scroll")})}},init_menus:function(f,c){f=b(f||document);c&&b(".nicemenu",f).nicemenu();(f&&f.is(".data-row")?f:b(".data-row",f)).hover(g.row_menu_hoverover,g.row_menu_hoverout);b(".nicemenu .headmenu",f).add(b(".nicemenu .default-action",f))},load_blurbs:function(f){b(".load-blurb",f).each(function(c,a){var e=
[h.acre.freebase.googleapis_url,"/text",b(a).attr("data-id"),"?key=",h.acre.freebase.api_key].join("");b.getJSON(e,function(c){c=c.result.split(/\s+/);b(a).text(c.slice(0,30).join(" "))})})},row_menu_hoverover:function(){var f=b(this);g.row_menu_hoverover.timeout=setTimeout(function(){f.addClass("row-hover")},300)},row_menu_hoverout:function(){clearTimeout(g.row_menu_hoverover.timeout);b(this).removeClass("row-hover")},row_edit:function(f){var c=b(f).parents(".submenu").data("headmenu").parents(".data-row:first");
h.get_script(h.h.ajax_url("lib/collection/collection-edit.mf.js"),function(){g.edit.row_edit_begin(c)});return!1},init:function(){g.init_infinitescroll();g.init_menus();g.load_blurbs();return g}};g.init()})(jQuery,window.freebase);
