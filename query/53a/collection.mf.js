
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(d){function j(){if(d.browser.msie){var k=d(document).height(),m=d(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,k-m<20?m:k]}return[d(document).width(),d(document).height()]}function g(k){if(k)return k.call(d.mask)}d.tools=d.tools||{version:"@VERSION"};var i;i=d.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var h,a,c,e,n;d.mask={load:function(k,m){if(c)return this;if(typeof k=="string")k={color:k};k=k||e;e=k=d.extend(d.extend({},i.conf),k);h=d("#"+k.maskId);if(!h.length){h=d("<div/>").attr("id",k.maskId);d("body").append(h)}var t=j();h.css({position:"absolute",top:0,left:0,width:t[0],height:t[1],display:"none",opacity:k.startOpacity,zIndex:k.zIndex});k.color&&h.css("backgroundColor",k.color);if(g(k.onBeforeLoad)===false)return this;k.closeOnEsc&&d(document).bind("keydown.mask",function(q){q.keyCode==
27&&d.mask.close(q)});k.closeOnClick&&h.bind("click.mask",function(q){d.mask.close(q)});d(window).bind("resize.mask",function(){d.mask.fit()});if(m&&m.length){n=m.eq(0).css("zIndex");d.each(m,function(){var q=d(this);/relative|absolute|fixed/i.test(q.css("position"))||q.css("position","relative")});a=m.css({zIndex:Math.max(k.zIndex+1,n=="auto"?0:n)})}h.css({display:"block"}).fadeTo(k.loadSpeed,k.opacity,function(){d.mask.fit();g(k.onLoad)});c=true;return this},close:function(){if(c){if(g(e.onBeforeClose)===
false)return this;h.fadeOut(e.closeSpeed,function(){g(e.onClose);a&&a.css({zIndex:n})});d(document).unbind("keydown.mask");h.unbind("click.mask");d(window).unbind("resize.mask");c=false}return this},fit:function(){if(c){var k=j();h.css({width:k[0],height:k[1]})}},getMask:function(){return h},isLoaded:function(){return c},getConf:function(){return e},getExposed:function(){return a}};d.fn.mask=function(k){d.mask.load(k);return this};d.fn.expose=function(k){d.mask.load(k,this);return this}})(jQuery);
(function(d){function j(h,a){var c=this,e=h.add(c),n=d(window),k,m,t,q=d.tools.expose&&(a.mask||a.expose),r=Math.random().toString().slice(10);if(q){if(typeof q=="string")q={color:q};q.closeOnClick=q.closeOnEsc=false}var s=a.target||h.attr("rel");m=s?d(s):h;if(!m.length)throw"Could not find Overlay: "+s;h&&h.index(m)==-1&&h.click(function(o){c.load(o);return o.preventDefault()});d.extend(c,{load:function(o){if(c.isOpened())return c;var u=i[a.effect];if(!u)throw'Overlay: cannot find effect : "'+a.effect+
'"';a.oneInstance&&d.each(g,function(){this.close(o)});o=o||d.Event();o.type="onBeforeLoad";e.trigger(o);if(o.isDefaultPrevented())return c;t=true;q&&d(m).expose(q);var v=a.top,x=a.left,z=m.outerWidth({margin:true}),y=m.outerHeight({margin:true});if(typeof v=="string")v=v=="center"?Math.max((n.height()-y)/2,0):parseInt(v,10)/100*n.height();if(x=="center")x=Math.max((n.width()-z)/2,0);u[0].call(c,{top:v,left:x},function(){if(t){o.type="onLoad";e.trigger(o)}});q&&a.closeOnClick&&d.mask.getMask().one("click",
c.close);a.closeOnClick&&d(document).bind("click."+r,function(b){d(b.target).parents(m).length||c.close(b)});a.closeOnEsc&&d(document).bind("keydown."+r,function(b){b.keyCode==27&&c.close(b)});return c},close:function(o){if(!c.isOpened())return c;o=o||d.Event();o.type="onBeforeClose";e.trigger(o);if(!o.isDefaultPrevented()){t=false;i[a.effect][1].call(c,function(){o.type="onClose";e.trigger(o)});d(document).unbind("click."+r).unbind("keydown."+r);q&&d.mask.close();return c}},getOverlay:function(){return m},
getTrigger:function(){return h},getClosers:function(){return k},isOpened:function(){return t},getConf:function(){return a}});d.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(o,u){d.isFunction(a[u])&&d(c).bind(u,a[u]);c[u]=function(v){d(c).bind(u,v);return c}});k=m.find(a.close||".close");if(!k.length&&!a.close){k=d('<a class="close"></a>');m.prepend(k)}k.click(function(o){c.close(o)});a.load&&c.load()}d.tools=d.tools||{version:"@VERSION"};d.tools.overlay={addEffect:function(h,
a,c){i[h]=[a,c]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!d.browser.msie||d.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var g=[],i={};d.tools.overlay.addEffect("default",function(h,a){var c=this.getConf(),e=d(window);if(!c.fixed){h.top+=e.scrollTop();h.left+=e.scrollLeft()}h.position=c.fixed?"fixed":"absolute";this.getOverlay().css(h).fadeIn(c.speed,a)},function(h){this.getOverlay().fadeOut(this.getConf().closeSpeed,
h)});d.fn.overlay=function(h){var a=this.data("overlay");if(a)return a;if(d.isFunction(h))h={onBeforeLoad:h};h=d.extend(true,{},d.tools.overlay.conf,h);this.each(function(){a=new j(d(this),h);g.push(a);d(this).data("overlay",a)});return h.api?a:this}})(jQuery);
(function(d){var j=function(){return typeof window.innerWidth!="undefined"?function(){return{w:window.innerWidth,h:window.innerHeight}}:typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}}}();
window.kbs=function(g){d(".kbs.current",g).removeClass("current");var i=d(".domain-section:first",g),h=d(".domain-section:last",g),a=this.scroll_to=function(b){var f=d(document).scrollTop();d(document).height();var l=j().h;l=f+l;var p=b.offset().top;b=p+b.height();if(p<f)d(document).scrollTop(p);else b>l&&d(document).scrollTop(f+(b-l))},c=this.get_current=function(){return d(".kbs.current:first",g)},e=this.set_next=function(b,f,l){b=b||c();if(f.length){b.removeClass("current");f.addClass("current");
l||a(f)}},n=this.next_domain=function(b){var f=c(),l=k(f);if(l){l=l.find(".kbs:first");e(f,l,b)}},k=this._next_domain=function(b){if(!(b&&b.length))return d(".domain-section:first",g);b=b.closest(".domain-section");return!b.length||b[0]===h[0]?i:b.next(".domain-section")},m=this.prev_domain=function(){var b=c(),f=t(b);if(f){f=f.find(".kbs:first");e(b,f)}},t=this._prev_domain=function(b){if(!(b&&b.length))return d(".domain-section:last",g);var f=b.closest(".domain-section");if(b.closest(".property-section").length||
b.closest(".type-section").length)return f;return!f.length||f[0]===i[0]?h:f.prev(".domain-section")},q=this.next_type=function(){var b=c(),f=r(b);if(f){f=f.find(".kbs:first");e(b,f)}},r=this._next_type=function(b){if(!(b&&b.length))return d(".type-section:first",g);var f=b.closest(".domain-section");b=b.closest(".type-section");b=b.length?b.next(".type-section"):f.find(".type-section:first");if(!(b&&b.length)){var l=k(f);if(l)for(;l.get(0)!==f.get(0);){b=l.find(".type-section:first");if(b.length)break;
l=k(l)}}return b},s=this.prev_type=function(){var b=c(),f=o(b);if(f){f=f.find(".kbs:first");e(b,f)}},o=this._prev_type=function(b){if(!(b&&b.length))return d(".type-section:last",g);var f=b.closest(".domain-section"),l=b.closest(".type-section");if(b.closest(".property-section").length)return l;var p;if(l.length)p=l.prev(".type-section");if(!(p&&p.length))if(b=t(f))for(;b.get(0)!==f.get(0);){p=b.find(".type-section:last");if(p.length)break;b=t(b)}return p},u=this.next_prop=function(){var b=c(),f=
v(b);if(f){f=f.find(".kbs:first");e(b,f)}},v=this._next_prop=function(b){if(!(b&&b.length))return d(".property-section:first",g);var f=b.closest(".domain-section"),l=b.closest(".type-section"),p=b.closest(".property-section");f=p.length?p.next(".property-section"):l.length?l.find(".property-section:first"):f.find(".property-section:first");if(!(f&&f.length))if(b=r(b))for(;b.get(0)!==l.get(0);){f=b.find(".property-section:first");if(f.length)break;if(l.get(0)==null)l=b;b=r(b)}return f},x=this.prev_prop=
function(){var b=c(),f=z(b);if(f){f=f.find(".kbs:first");e(b,f)}},z=this._prev_prop=function(b){if(!(b&&b.length))return d(".property-section:last",g);var f=b.closest(".domain-section"),l=b.closest(".type-section"),p=b.closest(".property-section");if(b.closest(".data-section").length)return p;var w;if(p.length)w=p.prev(".property-section");if(!(w&&w.length))if(s=l.length?o(l):o(f))for(;s.get(0)!==l.get(0);){w=s.find(".property-section:last");if(w.length)break;if(l.get(0)==null)l=s;s=o(s)}return w};
this.next=function(){var b=c(),f=this._next(b);f&&e(b,f)};this._next=function(b){if(!(b&&b.length))return d(".domain-section:first .kbs:first",g);var f=b.closest(".domain-section"),l=b.closest(".type-section"),p=b.closest(".property-section");if(b.closest(".data-section").length){b=b.next(".kbs");if(b.length)return b;b=p.next(".property-section").find(".kbs:first");if(b.length)return b;b=l.next(".type-section").find(".kbs:first")}else if(p.length){b=p.find(".data-section:first .kbs:first");if(b.length)return b;
b=p.next(".property-section").find(".kbs:first");if(b.length)return b;b=l.next(".type-section").find(".kbs:first")}else if(l.length){b=l.find(".property-section:first .kbs:first");if(b.length)return b;b=l.next(".type-section").find(".kbs:first")}else b=f.find(".type-section:first .kbs:first");if(b.length)return b;return f.get(0)===h.get(0)?i.find(".kbs:first"):f.next(".domain-section").find(".kbs:first")};this.prev=function(){var b=c(),f=this._prev(b);f&&e(b,f)};this._prev=function(b){if(!(b&&b.length)){b=
d(".data-section:last .kbs:last",g);b.length||(b=d(".property-section:last .kbs:first",g));b.length||(b=d(".type-section:last .kbs:first",g));b.length||(b=d(".domain-section:last .kbs:first",g));return b}var f=b.closest(".domain-section"),l=b.closest(".type-section"),p=b.closest(".property-section");if(b.closest(".data-section").length){b=b.prev(".kbs");if(b.length)return b;return p.find(".kbs:first")}else if(p.length){b=p.prev(".property-section").find(".kbs:last");if(b.length)return b;return l.find(".kbs:first")}else if(l.length){b=
l.prev(".type-section").find(".kbs:last");if(b.length)return b;return f.find(".kbs:first")}else return f.get(0)===i.get(0)?h.find(".kbs:last"):f.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var y=this;d(document).unbind(".kbs").bind("keydown.kbs",function(b){var f=b.target;if(f==document.body||f==document||f==window||f==d("html")[0]){f=b.keyCode;if(f===68)b.shiftKey?m():n();else if(f===84)b.shiftKey?s():q();else if(f===80)b.shiftKey?x():u();else if(f===
74)y.next();else if(f===75)y.prev();else f===69&&y.edit()}})}})(jQuery);
(function(d,j){var g=window.propbox={init:function(i,h){h=d.extend({lang:"/lang/en"},h);if(!h.base_ajax_url)throw new Error("base_ajax_url required in propbox options");if(!h.base_static_url)throw new Error("base_static_url required in propbox options");if(!h.id)throw new Error("topic id required in propbox options");if(!h.lang)throw new Error("lang required in propbox options");g.options=h;g.kbs=new j(i);g.kbs.set_next(g.kbs.get_current(),d(".kbs:visible:first",i,true));d(".kbs",i).live("click",
function(){var a=g.kbs.get_current();g.kbs.set_next(a,d(this),true)}).live("edit",function(){var a=d(this).find(".headmenu:first").data("submenu");a&&d("li:first a:first",a).click()});g.init_menus(i)},init_menus:function(i,h){i=d(i||document);h&&d(".nicemenu",i).nicemenu();(i&&i.is(".data-row")?i:d(".data-row",i)).hover(g.row_menu_hoverover,g.row_menu_hoverout);d(".nicemenu .headmenu",i).add(d(".nicemenu .default-action",i)).click("click",function(){if(g.kbs){var a=g.kbs.get_current();a&&g.kbs.set_next(a,
d(this).parents(".kbs:first"),true)}return false})},row_menu_hoverover:function(){var i=d(this);g.row_menu_hoverover.timeout=setTimeout(function(){i.addClass("row-hover")},300)},row_menu_hoverout:function(){clearTimeout(g.row_menu_hoverover.timeout);d(this).removeClass("row-hover")},get_script:function(i,h){var a=g.get_script.cache;if(!a)a=g.get_script.cache={};var c=a[i];if(c)if(c.state===1)c.callbacks.push(h);else c.state===4&&h();else{c=a[i]={state:0,callbacks:[h]};d.ajax({url:g.options.base_static_url+
i,dataType:"script",beforeSend:function(){c.state=1},success:function(){c.state=4;d.each(c.callbacks,function(e,n){n()})},error:function(){c.state=-1}})}},prop_edit:function(i,h){var a=d(i).parents(".submenu").data("headmenu").parents(".property-section").find(".data-section .data-row:first:visible .nicemenu:first .headmenu:first a");a.length?a.click():g.prop_add(i,h);return false},prop_add:function(i,h){var a=d(i).parents(".submenu").data("headmenu").parents(".property-section");g.get_script("/propbox-edit.mf.js",
function(){g.edit.prop_add_begin(a,h)});return false},value_edit:function(i){var h=d(i).parents(".submenu").data("headmenu").parents(".data-row:first"),a=h.parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.value_edit_begin(a,h)});return false},value_delete:function(i){var h=d(i).parents(".submenu").data("headmenu").parents(".data-row:first"),a=h.parents(".property-section");g.get_script("/propbox-edit.mf.js",function(){g.edit.value_delete_begin(a,h)});return false},
close_message:function(i){d(i).parents(".row-msg:first").remove();return false}}})(jQuery,window.kbs);
(function(d,j,g){j.infinitescroll=function(a,c,e){this.element=j(e);this._create(a,c)};j.infinitescroll.defaults={loading:{finished:g,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:g},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,currPage:1},callback:g,debug:false,behavior:g,binder:j(d),
nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:g,dataType:"html",appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:g,path:g};j.infinitescroll.prototype={_binding:function(a){var c=this,e=c.options;if(e.behavior&&this["_binding_"+e.behavior]!==g)this["_binding_"+e.behavior].call(this);else{if(a!=="bind"&&a!=="unbind"){this._debug("Binding value  "+a+" not valid");
return false}a=="unbind"?this.options.binder.unbind("smartscroll.infscr."+c.options.infid):this.options.binder[a]("smartscroll.infscr."+c.options.infid,function(){c.scroll()});this._debug("Binding",a)}},_create:function(a,c){if(!this._validate(a))return false;var e=this.options=j.extend(true,{},j.infinitescroll.defaults,a),n=j(e.nextSelector).attr("href");e.contentSelector=e.contentSelector||this.element;e.loading.selector=e.loading.selector||e.contentSelector;if(n){e.path=this._determinepath(n);
e.loading.msg=j('<div id="infscr-loading"><img alt="Loading..." src="'+e.loading.img+'" /><div>'+e.loading.msgText+"</div></div>");(new Image).src=e.loading.img;e.pixelsFromNavToBottom=j(document).height()-j(e.navSelector).offset().top;e.loading.start=e.loading.start||function(){j(e.navSelector).hide();e.loading.msg.appendTo(e.loading.selector).show(e.loading.speed,function(){beginAjax(e)})};e.loading.finished=e.loading.finished||function(){e.loading.msg.fadeOut("normal")};e.callback=function(k,m){e.behavior&&
k["_callback_"+e.behavior]!==g&&k["_callback_"+e.behavior].call(j(e.contentSelector)[0],m);c&&c.call(j(e.contentSelector)[0],m)};this._setup()}else this._debug("Navigation selector not found")},_debug:function(){if(this.options.debug)return d.console&&console.log.call(console,arguments)},_determinepath:function(a){var c=this.options;if(c.behavior&&this["_determinepath_"+c.behavior]!==g)this["_determinepath_"+c.behavior].call(this,a);else{if(c.pathParse){this._debug("pathParse manual");if(typeof c.pathParse===
"function")return c.pathParse();return c.pathParse}else if(a.match(/^(.*?)\b2\b(.*?$)/))a=a.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(a.match(/^(.*?)2(.*?$)/)){if(a.match(/^(.*?page=)2(\/.*|$)/))return a=a.match(/^(.*?page=)2(\/.*|$)/).slice(1);a=a.match(/^(.*?)2(.*?$)/).slice(1)}else if(a.match(/^(.*?page=)1(\/.*|$)/))return a=a.match(/^(.*?page=)1(\/.*|$)/).slice(1);else{this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");
c.state.isInvalidPage=true}this._debug("determinePath",a);return a}},_error:function(a){var c=this.options;if(c.behavior&&this["_error_"+c.behavior]!==g)this["_error_"+c.behavior].call(this,a);else{if(a!=="destroy"&&a!=="end")a="unknown";this._debug("Error",a);a=="end"&&this._showdonemsg();c.state.isDone=true;c.state.currPage=1;c.state.isPaused=false;this._binding("unbind")}},_loadcallback:function(a,c){var e=this.options,n=this.options.callback,k=e.state.isDone?"done":!e.appendCallback?"no-append":
"append";if(e.behavior&&this["_loadcallback_"+e.behavior]!==g)this["_loadcallback_"+e.behavior].call(this,a,c);else{switch(k){case "done":this._showdonemsg();return false;case "no-append":if(e.dataType=="html"){c="<div>"+c+"</div>";c=j(c).find(e.itemSelector)}break;case "append":var m=a.children();if(m.length==0)return this._error("end");for(k=document.createDocumentFragment();a[0].firstChild;)k.appendChild(a[0].firstChild);this._debug("contentSelector",j(e.contentSelector)[0]);j(e.contentSelector)[0].appendChild(k);
c=m.get();break}e.loading.finished.call(j(e.contentSelector)[0],e);if(e.animate){k=j(d).scrollTop()+j("#infscr-loading").height()+e.extraScrollPx+"px";j("html,body").animate({scrollTop:k},800,function(){e.state.isDuringAjax=false})}if(!e.animate)e.state.isDuringAjax=false;n(this,c)}},_nearbottom:function(){var a=this.options,c=0+j(document).height()-a.binder.scrollTop()-j(d).height();if(a.behavior&&this["_nearbottom_"+a.behavior]!==g)this["_nearbottom_"+a.behavior].call(this);else{this._debug("math:",
c,a.pixelsFromNavToBottom);return c-a.bufferPx<a.pixelsFromNavToBottom}},_pausing:function(a){var c=this.options;if(c.behavior&&this["_pausing_"+c.behavior]!==g)this["_pausing_"+c.behavior].call(this,a);else{a!=="pause"&&a!=="resume"&&a!==null&&this._debug("Invalid argument. Toggling pause value instead");switch(a&&(a=="pause"||a=="resume")?a:"toggle"){case "pause":c.state.isPaused=true;break;case "resume":c.state.isPaused=false;break;case "toggle":c.state.isPaused=!c.state.isPaused;break}this._debug("Paused",
c.state.isPaused);return false}},_setup:function(){var a=this.options;if(a.behavior&&this["_setup_"+a.behavior]!==g)this["_setup_"+a.behavior].call(this);else{this._binding("bind");return false}},_showdonemsg:function(){var a=this.options;if(a.behavior&&this["_showdonemsg_"+a.behavior]!==g)this["_showdonemsg_"+a.behavior].call(this);else{a.loading.msg.find("img").hide().parent().find("div").html(a.loading.finishedMsg).animate({opacity:1},2E3,function(){j(this).parent().fadeOut("normal")});a.errorCallback.call(j(a.contentSelector)[0],
"done")}},_validate:function(a){for(var c in a){if(c.indexOf&&c.indexOf("Selector")>-1&&j(a[c]).length===0){this._debug("Your "+c+" found no elements.");return false}return true}},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=true;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(a){var c=this,e=c.options,n=this._determinepath(n),k,m,t,q;a=a||null;beginAjax=function(r){r.state.currPage++;
c._debug("heading into ajax",n);k=j(r.contentSelector).is("table")?j("<tbody/>"):j("<div/>");m=n.join(r.state.currPage);t=r.dataType=="html"||r.dataType=="json"?r.dataType:"html+callback";if(r.appendCallback&&r.dataType=="html")t+="+callback";switch(t){case "html+callback":c._debug("Using HTML via .load() method");k.load(m+" "+r.itemSelector,null,function(s){c._loadcallback(k,s)});break;case "html":case "json":c._debug("Using "+t.toUpperCase()+" via $.ajax() method");j.ajax({url:m,dataType:r.dataType,
complete:function(s,o){(q=typeof s.isResolved!=="undefined"?s.isResolved():o==="success"||o==="notmodified")?c._loadcallback(k,s.responseText):c._error("end")}});break}};if(e.behavior&&this["retrieve_"+e.behavior]!==g)this["retrieve_"+e.behavior].call(this,a);else{if(e.state.isDestroyed){this._debug("Instance is destroyed");return false}e.state.isDuringAjax=true;e.loading.start.call(j(e.contentSelector)[0],e)}},scroll:function(){var a=this.options,c=a.state;if(a.behavior&&this["scroll_"+a.behavior]!==
g)this["scroll_"+a.behavior].call(this);else c.isDuringAjax||c.isInvalidPage||c.isDone||c.isDestroyed||c.isPaused||this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(a){if(j.isPlainObject(a))this.options=j.extend(true,this.options,a)}};j.fn.infinitescroll=function(a,c){switch(typeof a){case "string":var e=Array.prototype.slice.call(arguments,1);this.each(function(){var n=j.data(this,"infinitescroll");if(!n)return false;
if(!j.isFunction(n[a])||a.charAt(0)==="_")return false;n[a].apply(n,e)});break;case "object":this.each(function(){var n=j.data(this,"infinitescroll");n?n.update(a):j.data(this,"infinitescroll",new j.infinitescroll(a,c,this))});break}return this};var i=j.event,h;i.special.smartscroll={setup:function(){j(this).bind("scroll",i.special.smartscroll.handler)},teardown:function(){j(this).unbind("scroll",i.special.smartscroll.handler)},handler:function(a,c){var e=this,n=arguments;a.type="smartscroll";h&&
clearTimeout(h);h=setTimeout(function(){j.event.handle.apply(e,n)},c==="execAsap"?0:100)}};j.fn.smartscroll=function(a){return a?this.bind("smartscroll",a):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);
(function(d,j){var g=j.collection={init_infinitescroll:function(){var i=d("#infinitescroll"),h=i.attr("data-next");if(!(!h||h==="false")){var a=d("#infinitescroll-next");i.infinitescroll({loading:{msgText:"Fetching more topics",img:j.h.static_url("lib/template/img/horizontal-loader.gif")},nextSelector:"#infinitescroll-next",navSelector:"#infinitescroll-next",dataType:"json",pathParse:function(){return[a[0].href+"&"+d.param({cursor:i.attr("data-next")})+"&page=",""]},appendCallback:false},function(c){c=
JSON.parse(c);var e=c.result.cursor;c=d(c.result.html);g.init_menus(c);g.load_blurbs(c);i.append(c);e?i.attr("data-next",e):d(window).unbind(".infscr")});setTimeout(function(){d(window).trigger("scroll")})}},init_menus:function(i,h){i=d(i||document);h&&d(".nicemenu",i).nicemenu();(i&&i.is(".data-row")?i:d(".data-row",i)).hover(g.row_menu_hoverover,g.row_menu_hoverout);d(".nicemenu .headmenu",i).add(d(".nicemenu .default-action",i))},load_blurbs:function(i){d(".load-blurb",i).each(function(h,a){var c=
[j.acre.freebase.googleapis_url,"/text",d(a).attr("data-id"),"?key=",j.acre.freebase.api_key].join("");d.getJSON(c,function(e){e=e.result.split(/\s+/);d(a).text(e.slice(0,30).join(" "))})})},row_menu_hoverover:function(){var i=d(this);g.row_menu_hoverover.timeout=setTimeout(function(){i.addClass("row-hover")},300)},row_menu_hoverout:function(){clearTimeout(g.row_menu_hoverover.timeout);d(this).removeClass("row-hover")},row_edit:function(i){var h=d(i).parents(".submenu").data("headmenu").parents(".data-row:first");
j.get_script(j.h.ajax_url("lib/collection/collection-edit.mf.js"),function(){g.edit.row_edit_begin(h)});return false},init:function(){g.init_infinitescroll();g.init_menus();g.load_blurbs();return g}};g.init()})(jQuery,window.freebase);
