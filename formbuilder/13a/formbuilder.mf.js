
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(b){function i(){c();b(this).parents(".headmenu").data("submenu").find("a:first").click();return!1}function e(a,g){var f=b(this),e=f.data("submenu");if(!e.is(".submenu-valid")){var j=f.offset(),h=f.outerHeight(),h=j.top+h;e.is(".center")?(f=f.outerWidth(),j=j.left+f/2-e.outerWidth()/2):e.is(".right")?(f=f.outerWidth(),j=j.left+f-e.outerWidth()):j=j.left;j={display:"none",position:"absolute",top:h,left:j};g.overlay&&(j.zIndex=g.overlay.css("zIndex"));e.css(j);b(document.body).append(e);e.addClass(".submenu-valid")}e.is(":visible")?
c(e):(c(),e.fadeIn());return!1}function c(a){(a||b(".submenu:visible")).fadeOut()}b.factory("nicemenu",{init:function(){var a=this.options;b(".headmenu",this.element).each(function(){var c=b(this),f=c.next(".submenu");c.data("submenu",f);f.data("headmenu",c);b(".default-action",c).click(i);c.click(function(b){return e.apply(this,[b,a])})});b(".submenu",this.element).click(function(){c(b(this));b(this).fadeOut()})}});b(document).click(function(){c()}).bind("scroll resize",function(){c();b(".submenu-valid").each(function(){b(this).removeClass("submenu-valid")})})})(jQuery);
(function(b){function i(){if(b.browser.msie){var a=b(document).height(),e=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,20>a-e?e:a]}return[b(document).width(),b(document).height()]}function e(a){if(a)return a.call(b.mask)}b.tools=b.tools||{version:"@VERSION"};var c;c=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var a,g,f,k,j;b.mask={load:function(h,p){if(f)return this;"string"==typeof h&&(h={color:h});h=h||k;k=h=b.extend(b.extend({},c.conf),h);a=b("#"+h.maskId);a.length||(a=b("<div/>").attr("id",h.maskId),b("body").append(a));var n=i();a.css({position:"absolute",top:0,left:0,width:n[0],height:n[1],display:"none",opacity:h.startOpacity,zIndex:h.zIndex});h.color&&a.css("backgroundColor",h.color);if(!1===e(h.onBeforeLoad))return this;h.closeOnEsc&&b(document).bind("keydown.mask",function(a){a.keyCode==
27&&b.mask.close(a)});h.closeOnClick&&a.bind("click.mask",function(a){b.mask.close(a)});b(window).bind("resize.mask",function(){b.mask.fit()});p&&p.length&&(j=p.eq(0).css("zIndex"),b.each(p,function(){var a=b(this);/relative|absolute|fixed/i.test(a.css("position"))||a.css("position","relative")}),g=p.css({zIndex:Math.max(h.zIndex+1,"auto"==j?0:j)}));a.css({display:"block"}).fadeTo(h.loadSpeed,h.opacity,function(){b.mask.fit();e(h.onLoad)});f=!0;return this},close:function(){if(f){if(!1===e(k.onBeforeClose))return this;
a.fadeOut(k.closeSpeed,function(){e(k.onClose);g&&g.css({zIndex:j})});b(document).unbind("keydown.mask");a.unbind("click.mask");b(window).unbind("resize.mask");f=!1}return this},fit:function(){if(f){var b=i();a.css({width:b[0],height:b[1]})}},getMask:function(){return a},isLoaded:function(){return f},getConf:function(){return k},getExposed:function(){return g}};b.fn.mask=function(a){b.mask.load(a);return this};b.fn.expose=function(a){b.mask.load(a,this);return this}})(jQuery);
(function(b){function i(a,g){var f=this,k=a.add(f),j=b(window),h,i,n,m=b.tools.expose&&(g.mask||g.expose),o=Math.random().toString().slice(10);m&&("string"==typeof m&&(m={color:m}),m.closeOnClick=m.closeOnEsc=!1);var l=g.target||a.attr("rel");i=l?b(l):a;if(!i.length)throw"Could not find Overlay: "+l;a&&-1==a.index(i)&&a.click(function(b){f.load(b);return b.preventDefault()});b.extend(f,{load:function(a){if(f.isOpened())return f;var h=c[g.effect];if(!h)throw'Overlay: cannot find effect : "'+g.effect+
'"';g.oneInstance&&b.each(e,function(){this.close(a)});a=a||b.Event();a.type="onBeforeLoad";k.trigger(a);if(a.isDefaultPrevented())return f;n=true;m&&b(i).expose(m);var l=g.top,q=g.left,t=i.outerWidth({margin:true}),r=i.outerHeight({margin:true});typeof l=="string"&&(l=l=="center"?Math.max((j.height()-r)/2,0):parseInt(l,10)/100*j.height());q=="center"&&(q=Math.max((j.width()-t)/2,0));h[0].call(f,{top:l,left:q},function(){if(n){a.type="onLoad";k.trigger(a)}});if(m&&g.closeOnClick)b.mask.getMask().one("click",
f.close);g.closeOnClick&&b(document).bind("click."+o,function(d){b(d.target).parents(i).length||f.close(d)});g.closeOnEsc&&b(document).bind("keydown."+o,function(d){d.keyCode==27&&f.close(d)});return f},close:function(a){if(!f.isOpened())return f;a=a||b.Event();a.type="onBeforeClose";k.trigger(a);if(!a.isDefaultPrevented()){n=false;c[g.effect][1].call(f,function(){a.type="onClose";k.trigger(a)});b(document).unbind("click."+o).unbind("keydown."+o);m&&b.mask.close();return f}},getOverlay:function(){return i},
getTrigger:function(){return a},getClosers:function(){return h},isOpened:function(){return n},getConf:function(){return g}});b.each(["onBeforeLoad","onStart","onLoad","onBeforeClose","onClose"],function(a,e){b.isFunction(g[e])&&b(f).bind(e,g[e]);f[e]=function(a){b(f).bind(e,a);return f}});h=i.find(g.close||".close");!h.length&&!g.close&&(h=b('<a class="close"></a>'),i.prepend(h));h.click(function(b){f.close(b)});g.load&&f.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(b,
e,f){c[b]=[e,f]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||6<b.browser.version,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var e=[],c={};b.tools.overlay.addEffect("default",function(a,e){var c=this.getConf(),i=b(window);c.fixed||(a.top+=i.scrollTop(),a.left+=i.scrollLeft());a.position=c.fixed?"fixed":"absolute";this.getOverlay().css(a).fadeIn(c.speed,e)},function(b){this.getOverlay().fadeOut(this.getConf().closeSpeed,
b)});b.fn.overlay=function(a){var c=this.data("overlay");if(c)return c;b.isFunction(a)&&(a={onBeforeLoad:a});a=b.extend(!0,{},b.tools.overlay.conf,a);this.each(function(){c=new i(b(this),a);e.push(c);b(this).data("overlay",c)});return a.api?c:this}})(jQuery);
(function(b){var i="undefined"!=typeof window.innerWidth?function(){return{w:window.innerWidth,h:window.innerHeight}}:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}};window.kbs=
function(e){b(".kbs.current",e).removeClass("current");var c=b(".domain-section:first",e),a=b(".domain-section:last",e),g=this.scroll_to=function(d){var a=b(document).scrollTop();b(document).height();var e=i().h,e=a+e,c=d.offset().top,d=c+d.height();c<a?b(document).scrollTop(c):d>e&&b(document).scrollTop(a+(d-e))},f=this.get_current=function(){return b(".kbs.current:first",e)},k=this.set_next=function(d,b,a){d=d||f();b.length&&(d.removeClass("current"),b.addClass("current"),a||g(b))},j=this.next_domain=
function(d){var b=f(),a=h(b);a&&(a=a.find(".kbs:first"),k(b,a,d))},h=this._next_domain=function(d){if(!d||!d.length)return b(".domain-section:first",e);d=d.closest(".domain-section");return!d.length||d[0]===a[0]?c:d.next(".domain-section")},p=this.prev_domain=function(){var d=f(),b=n(d);b&&(b=b.find(".kbs:first"),k(d,b))},n=this._prev_domain=function(d){if(!d||!d.length)return b(".domain-section:last",e);var f=d.closest(".domain-section");return d.closest(".property-section").length||d.closest(".type-section").length?
f:!f.length||f[0]===c[0]?a:f.prev(".domain-section")},m=this.next_type=function(){var b=f(),a=o(b);a&&(a=a.find(".kbs:first"),k(b,a))},o=this._next_type=function(d){if(!d||!d.length)return b(".type-section:first",e);var a=d.closest(".domain-section"),d=d.closest(".type-section"),d=d.length?d.next(".type-section"):a.find(".type-section:first");if(!d||!d.length){var c=h(a);if(c)for(;c.get(0)!==a.get(0);){d=c.find(".type-section:first");if(d.length)break;c=h(c)}}return d},l=this.prev_type=function(){var b=
f(),a=s(b);a&&(a=a.find(".kbs:first"),k(b,a))},s=this._prev_type=function(d){if(!d||!d.length)return b(".type-section:last",e);var a=d.closest(".domain-section"),c=d.closest(".type-section");if(d.closest(".property-section").length)return c;var f;c.length&&(f=c.prev(".type-section"));if(!f||!f.length)if(d=n(a))for(;d.get(0)!==a.get(0);){f=d.find(".type-section:last");if(f.length)break;d=n(d)}return f},u=this.next_prop=function(){var b=f(),a=v(b);a&&(a=a.find(".kbs:first"),k(b,a))},v=this._next_prop=
function(a){if(!a||!a.length)return b(".property-section:first",e);var c=a.closest(".domain-section"),f=a.closest(".type-section"),g=a.closest(".property-section"),c=g.length?g.next(".property-section"):f.length?f.find(".property-section:first"):c.find(".property-section:first");if(!c||!c.length)if(a=o(a))for(;a.get(0)!==f.get(0);){c=a.find(".property-section:first");if(c.length)break;null==f.get(0)&&(f=a);a=o(a)}return c},q=this.prev_prop=function(){var a=f(),b=t(a);b&&(b=b.find(".kbs:first"),k(a,
b))},t=this._prev_prop=function(a){if(!a||!a.length)return b(".property-section:last",e);var c=a.closest(".domain-section"),f=a.closest(".type-section"),g=a.closest(".property-section");if(a.closest(".data-section").length)return g;var h;g.length&&(h=g.prev(".property-section"));if(!h||!h.length)if(l=f.length?s(f):s(c))for(;l.get(0)!==f.get(0);){h=l.find(".property-section:last");if(h.length)break;null==f.get(0)&&(f=l);l=s(l)}return h};this.next=function(){var a=f(),b=this._next(a);b&&k(a,b)};this._next=
function(d){if(!d||!d.length)return b(".domain-section:first .kbs:first",e);var f=d.closest(".domain-section"),g=d.closest(".type-section"),h=d.closest(".property-section");if(d.closest(".data-section").length){d=d.next(".kbs");if(d.length)return d;d=h.next(".property-section").find(".kbs:first");if(d.length)return d;d=g.next(".type-section").find(".kbs:first")}else if(h.length){d=h.find(".data-section:first .kbs:first");if(d.length)return d;d=h.next(".property-section").find(".kbs:first");if(d.length)return d;
d=g.next(".type-section").find(".kbs:first")}else if(g.length){d=g.find(".property-section:first .kbs:first");if(d.length)return d;d=g.next(".type-section").find(".kbs:first")}else d=f.find(".type-section:first .kbs:first");return d.length?d:f.get(0)===a.get(0)?c.find(".kbs:first"):f.next(".domain-section").find(".kbs:first")};this.prev=function(){var a=f(),b=this._prev(a);b&&k(a,b)};this._prev=function(d){if(!d||!d.length)return d=b(".data-section:last .kbs:last",e),d.length||(d=b(".property-section:last .kbs:first",
e)),d.length||(d=b(".type-section:last .kbs:first",e)),d.length||(d=b(".domain-section:last .kbs:first",e)),d;var f=d.closest(".domain-section"),g=d.closest(".type-section"),h=d.closest(".property-section");return d.closest(".data-section").length?(d=d.prev(".kbs"),d.length?d:h.find(".kbs:first")):h.length?(d=h.prev(".property-section").find(".kbs:last"),d.length?d:g.find(".kbs:first")):g.length?(d=g.prev(".type-section").find(".kbs:last"),d.length?d:f.find(".kbs:first")):f.get(0)===c.get(0)?a.find(".kbs:last"):
f.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var r=this;b(document).unbind(".kbs").bind("keydown.kbs",function(a){var c=a.target;if(c==document.body||c==document||c==window||c==b("html")[0])c=a.keyCode,68===c?a.shiftKey?p():j():84===c?a.shiftKey?l():m():80===c?a.shiftKey?q():u():74===c?r.next():75===c?r.prev():69===c&&r.edit()})}})(jQuery);
(function(b,i){var e=window.propbox={init:function(c,a){a=b.extend({lang:"/lang/en"},a);if(!a.base_ajax_url)throw Error("base_ajax_url required in propbox options");if(!a.base_static_url)throw Error("base_static_url required in propbox options");if(!a.id)throw Error("topic id required in propbox options");if(!a.lang)throw Error("lang required in propbox options");e.options=a;e.kbs=new i(c);e.kbs.set_next(e.kbs.get_current(),b(".kbs:visible:first",c,!0));b(".kbs",c).live("click",function(){var a=e.kbs.get_current();
e.kbs.set_next(a,b(this),!0)}).live("edit",function(){var a=b(this).find(".headmenu:first").data("submenu");a&&b("li:first a:first",a).click()});e.init_menus(c)},init_menus:function(c,a){c=b(c||document);a&&b(".nicemenu",c).nicemenu();(c&&c.is(".data-row")?c:b(".data-row",c)).hover(e.row_menu_hoverover,e.row_menu_hoverout);b(".nicemenu .headmenu",c).add(b(".nicemenu .default-action",c)).click("click",function(){if(e.kbs){var a=e.kbs.get_current();a&&e.kbs.set_next(a,b(this).parents(".kbs:first"),
!0)}return!1})},row_menu_hoverover:function(){var c=b(this);e.row_menu_hoverover.timeout=setTimeout(function(){c.addClass("row-hover")},300)},row_menu_hoverout:function(){clearTimeout(e.row_menu_hoverover.timeout);b(this).removeClass("row-hover")},get_script:function(c,a){var g=e.get_script.cache;g||(g=e.get_script.cache={});var f=g[c];f?1===f.state?f.callbacks.push(a):4===f.state&&a():(f=g[c]={state:0,callbacks:[a]},b.ajax({url:e.options.base_static_url+c,dataType:"script",beforeSend:function(){f.state=
1},success:function(){f.state=4;b.each(f.callbacks,function(a,b){b()})},error:function(){f.state=-1}}))},prop_edit:function(c,a){var g=b(c).parents(".submenu").data("headmenu").parents(".property-section").find(".data-section .data-row:first:visible .nicemenu:first .headmenu:first a");g.length?g.click():e.prop_add(c,a);return!1},prop_add:function(c,a){var g=b(c).parents(".submenu").data("headmenu").parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.prop_add_begin(g,
a)});return!1},value_edit:function(c){var a=b(c).parents(".submenu").data("headmenu").parents(".data-row:first"),g=a.parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.value_edit_begin(g,a)});return!1},value_delete:function(c){var a=b(c).parents(".submenu").data("headmenu").parents(".data-row:first"),g=a.parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.value_delete_begin(g,a)});return!1},remove_type:function(c){var c=b(c),a=c.parents(".type-section");
e.get_script("/propbox-edit.mf.js",function(){e.edit.remove_type_submit(c,a)});return!1},add_type:function(c,a,g){var c=b(c),f=c.parents(".type-section"),i=e.options.incompatible_types;i?i.search(e.options.id,a,g,{compatible:function(){e.add_type_submit(c,f)},incompatible:i.overlay_incompatible_callback({onConfirm:function(){e.add_type_submit(c,f)}})}):e.add_type_submit(c,f);return!1},add_type_submit:function(b,a){e.get_script("/propbox-edit.mf.js",function(){e.edit.add_type_submit(b,a)})},add_has_no_value:function(c){var a=
b(c).parents(".submenu").data("headmenu").parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.add_has_no_value(a)});return!1},add_has_value:function(c){var a=b(c).parents(".submenu").data("headmenu").parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.add_has_value(a)});return!1},remove_has_no_value:function(c){var a=b(c).parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.remove_has_no_value(a)});return!1},
remove_has_value:function(c){var a=b(c).parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.remove_has_value(a)});return!1},more:function(c,a,g){var f=b(c).parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.more(f,a,g)})}}})(jQuery,window.kbs);
(function(b,i,e){var c=i.formbuilder={init:function(){i.c.header&&b("#header").fadeIn();b(".nicemenu").nicemenu();e.init(null,{id:i.c.id,base_ajax_url:i.h.ajax_url("lib/propbox"),base_static_url:i.h.static_url("lib/propbox"),lang:i.lang||"/lang/en",suggest_impl:i.suggest_options,incompatible_types:i.incompatible_types});b(window).bind("fb.user.signedin",function(a,c){b("#signedin > a:first").text(c.name)})}};b(c.init)})(jQuery,window.freebase,window.propbox);
