
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
var CodeMirrorConfig=window.CodeMirrorConfig||{},CodeMirror=function(){function b(a,b){for(var d in b)a.hasOwnProperty(d)||(a[d]=b[d])}function a(a,b){var d=document.createElement("DIV"),c=document.createElement("DIV");d.style.position="absolute";d.style.height="100%";if(d.style.setExpression)try{d.style.setExpression("height","this.previousSibling.offsetHeight + 'px'")}catch(e){}d.style.top="0px";d.style.left="0px";d.style.overflow="hidden";a.appendChild(d);c.className="CodeMirror-line-numbers";
d.appendChild(c);c.innerHTML="<div>"+b+"</div>";return d}function d(a){"string"==typeof a.parserfile&&(a.parserfile=[a.parserfile]);"string"==typeof a.basefiles&&(a.basefiles=[a.basefiles]);"string"==typeof a.stylesheet&&(a.stylesheet=[a.stylesheet]);var b=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>'];b.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>');for(var d=a.stylesheet,c=0;c<d.length;c++)b.push('<link rel="stylesheet" type="text/css" href="'+
d[c]+'"/>');d=a.basefiles.concat(a.parserfile);for(c=0;c<d.length;c++){var e=d[c];/^https?:/.test(e)||(e=a.path+e);b.push('<script type="text/javascript" src="'+e+(a.noScriptCaching?"?nocache="+(new Date).getTime().toString(16):"")+'"><\/script>')}b.push('</head><body style="border-width: 0;" class="editbox" spellcheck="'+(a.disableSpellcheck?"false":"true")+'"></body></html>');return b.join("")}function c(c,g){this.options=g=g||{};b(g,CodeMirrorConfig);g.dumbTabs?g.tabMode="spaces":g.normalTab&&
(g.tabMode="default");var h=this.frame=document.createElement("IFRAME");g.iframeClass&&(h.className=g.iframeClass);h.frameBorder=0;h.style.border="0";h.style.width="100%";h.style.height="100%";h.style.display="block";var j=this.wrapping=document.createElement("DIV");j.style.position="relative";j.className="CodeMirror-wrapping";j.style.width=g.width;j.style.height="dynamic"==g.height?g.minHeight+"px":g.height;var k=this.textareaHack=document.createElement("TEXTAREA");j.appendChild(k);k.style.position=
"absolute";k.style.left="-10000px";k.style.width="10px";h.CodeMirror=this;g.domain&&e?(this.html=d(g),h.src="javascript:(function(){document.open();"+(g.domain?'document.domain="'+g.domain+'";':"")+"document.write(window.frameElement.CodeMirror.html);document.close();})()"):h.src="javascript:;";c.appendChild?c.appendChild(j):c(j);j.appendChild(h);g.lineNumbers&&(this.lineNumbers=a(j,g.firstLineNumber));this.win=h.contentWindow;if(!g.domain||!e)this.win.document.open(),this.win.document.write(d(g)),
this.win.document.close()}b(CodeMirrorConfig,{stylesheet:[],path:"",parserfile:[],basefiles:"util.js stringstream.js select.js undo.js editor.js tokenize.js".split(" "),iframeClass:null,passDelay:200,passTime:50,lineNumberDelay:200,lineNumberTime:50,continuousScanning:!1,saveFunction:null,onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:!0,textWrapping:!0,readOnly:!1,width:"",height:"300px",minHeight:100,autoMatchParens:!1,parserConfig:null,tabMode:"indent",enterMode:"indent",electricChars:!0,
reindentOnLoad:!1,activeTokens:null,cursorActivity:null,lineNumbers:!1,firstLineNumber:1,indentUnit:2,domain:null,noScriptCaching:!1});var e=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);c.prototype={init:function(){this.options.initCallback&&this.options.initCallback(this);this.options.lineNumbers&&this.activateLineNumbers();this.options.reindentOnLoad&&this.reindent();"dynamic"==this.options.height&&this.setDynamicHeight()},getCode:function(){return this.editor.getCode()},
setCode:function(a){this.editor.importCode(a)},selection:function(){this.focusIfIE();return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.focusIfIE();this.editor.reindentSelection(null)},focusIfIE:function(){this.win.select.ie_selection&&this.focus()},focus:function(){this.win.focus();this.editor.selectionSnapshot&&this.win.select.setBookmark(this.win.document.body,this.editor.selectionSnapshot)},replaceSelection:function(a){this.focus();
this.editor.replaceSelection(a);return!0},replaceChars:function(a,b,d){this.editor.replaceChars(a,b,d)},getSearchCursor:function(a,b,d){return this.editor.getSearchCursor(a,b,d)},undo:function(){this.editor.history.undo()},redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(a,b){this.editor.grabKeys(a,b)},ungrabKeys:function(){this.editor.ungrabKeys()},setParser:function(a,
b){this.editor.setParser(a,b)},setSpellcheck:function(a){this.win.document.body.spellcheck=a},setStylesheet:function(a){"string"===typeof a&&(a=[a]);for(var b={},d={},c=this.win.document.getElementsByTagName("link"),e=0,l;l=c[e];e++)if(-1!==l.rel.indexOf("stylesheet"))for(var n=0;n<a.length;n++){var m=a[n];l.href.substring(l.href.length-m.length)===m&&(b[l.href]=!0,d[m]=!0)}for(e=0;l=c[e];e++)-1!==l.rel.indexOf("stylesheet")&&(l.disabled=!(l.href in b));for(n=0;n<a.length;n++)m=a[n],m in d||(l=this.win.document.createElement("link"),
l.rel="stylesheet",l.type="text/css",l.href=m,this.win.document.getElementsByTagName("head")[0].appendChild(l))},setTextWrapping:function(a){a!=this.options.textWrapping&&(this.win.document.body.style.whiteSpace=a?"":"nowrap",this.options.textWrapping=a,this.lineNumbers&&(this.setLineNumbers(!1),this.setLineNumbers(!0)))},setIndentUnit:function(a){this.win.indentUnit=a},setUndoDepth:function(a){this.editor.history.maxDepth=a},setTabMode:function(a){this.options.tabMode=a},setEnterMode:function(a){this.options.enterMode=
a},setLineNumbers:function(b){b&&!this.lineNumbers?(this.lineNumbers=a(this.wrapping,this.options.firstLineNumber),this.activateLineNumbers()):!b&&this.lineNumbers&&(this.wrapping.removeChild(this.lineNumbers),this.wrapping.style.paddingLeft="",this.lineNumbers=null)},cursorPosition:function(a){this.focusIfIE();return this.editor.cursorPosition(a)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(a){return this.editor.nextLine(a)},
prevLine:function(a){return this.editor.prevLine(a)},lineContent:function(a){return this.editor.lineContent(a)},setLineContent:function(a,b){this.editor.setLineContent(a,b)},removeLine:function(a){this.editor.removeLine(a)},insertIntoLine:function(a,b,d){this.editor.insertIntoLine(a,b,d)},selectLines:function(a,b,d,c){this.win.focus();this.editor.selectLines(a,b,d,c)},nthLine:function(a){for(var b=this.firstLine();1<a&&!1!==b;a--)b=this.nextLine(b);return b},lineNumber:function(a){for(var b=0;!1!==
a;)b++,a=this.prevLine(a);return b},jumpToLine:function(a){"number"==typeof a&&(a=this.nthLine(a));this.selectLines(a,0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorLine())},cursorLine:function(){return this.cursorPosition().line},cursorCoords:function(a){return this.editor.cursorCoords(a)},activateLineNumbers:function(){function a(){if(0!=l.offsetWidth){for(var b=l;b.parentNode;b=b.parentNode);if(!o.parentNode||b!=document||!n.Editor){try{u()}catch(d){}clearInterval(t)}else o.offsetWidth!=
s&&(s=o.offsetWidth,l.parentNode.style.paddingLeft=s+"px")}}function b(){o.scrollTop=q.scrollTop||m.documentElement.scrollTop||0}function d(a){var b=p.firstChild.offsetHeight;if(0!=b)for(var c=50+Math.max(q.offsetHeight,Math.max(l.offsetHeight,q.scrollHeight||0)),b=Math.ceil(c/b),c=p.childNodes.length;c<=b;c++){var f=document.createElement("DIV");f.appendChild(document.createTextNode(a?String(c+r.options.firstLineNumber):"\u00a0"));p.appendChild(f)}}function c(){function a(){d(!0);b()}r.updateNumbers=
a;var f=n.addEventHandler(n,"scroll",b,!0),e=n.addEventHandler(n,"resize",a,!0);u=function(){f();e();r.updateNumbers==a&&(r.updateNumbers=null)};a()}function e(){function a(b,d){l||(l=p.appendChild(document.createElement("DIV")));A&&A(l,d,b);t.push(l);t.push(b);s=l.offsetHeight+l.offsetTop;l=l.nextSibling}function c(){for(var a=0;a<t.length;a+=2)t[a].innerHTML=t[a+1];t=[]}function f(){if(p.parentNode&&p.parentNode==r.lineNumbers){for(var d=(new Date).getTime()+r.options.lineNumberTime;k;){for(a(o++,
k.previousSibling);k&&!n.isBR(k);k=k.nextSibling)for(var e=k.offsetTop+k.offsetHeight;p.offsetHeight&&e-3>s;)a("&nbsp;");k&&(k=k.nextSibling);if((new Date).getTime()>d){c();w=setTimeout(f,r.options.lineNumberDelay);return}}for(;l;)a(o++);c();b()}}function j(a){b();d(a);k=q.firstChild;l=p.firstChild;s=0;o=r.options.firstLineNumber;f()}function m(){w&&clearTimeout(w);r.editor.allClean()?j():w=setTimeout(m,200)}var k,l,o,s,t=[],A=r.options.styleNumbers;j(!0);var w=null;r.updateNumbers=m;var B=n.addEventHandler(n,
"scroll",b,!0),C=n.addEventHandler(n,"resize",m,!0);u=function(){w&&clearTimeout(w);r.updateNumbers==m&&(r.updateNumbers=null);B();C()}}var l=this.frame,n=l.contentWindow,m=n.document,q=m.body,o=this.lineNumbers,p=o.firstChild,r=this,s=null,u=function(){};a();var t=setInterval(a,500);(this.options.textWrapping||this.options.styleNumbers?e:c)()},setDynamicHeight:function(){function a(){for(var d=0,f=e.lastChild,h;f&&c.isBR(f);)f.hackBR||d++,f=f.previousSibling;f?(l=f.offsetHeight,h=f.offsetTop+(1+
d)*l):l&&(h=d*l);h&&(b.wrapping.style.height=Math.max(m+h,b.options.minHeight)+"px")}var b=this,d=b.options.cursorActivity,c=b.win,e=c.document.body,l=null,n=null,m=2*b.frame.offsetTop;e.style.overflowY="hidden";c.document.documentElement.style.overflowY="hidden";this.frame.scrolling="no";setTimeout(a,300);b.options.cursorActivity=function(b){d&&d(b);clearTimeout(n);n=setTimeout(a,100)}}};c.InvalidLineHandle={toString:function(){return"CodeMirror.InvalidLineHandle"}};c.replace=function(a){"string"==
typeof a&&(a=document.getElementById(a));return function(b){a.parentNode.replaceChild(b,a)}};c.fromTextArea=function(a,b){"string"==typeof a&&(a=document.getElementById(a));b=b||{};a.style.width&&null==b.width&&(b.width=a.style.width);a.style.height&&null==b.height&&(b.height=a.style.height);null==b.content&&(b.content=a.value);if(a.form){var d=function(){a.value=l.getCode()};"function"==typeof a.form.addEventListener?a.form.addEventListener("submit",d,!1):a.form.attachEvent("onsubmit",d);var e=a.form.submit,
k=function(){d();a.form.submit=e;a.form.submit();a.form.submit=k};a.form.submit=k}a.style.display="none";var l=new c(function(b){a.nextSibling?a.parentNode.insertBefore(b,a.nextSibling):a.parentNode.appendChild(b)},b);l.toTextArea=function(){d();a.parentNode.removeChild(l.wrapping);a.style.display="";if(a.form){a.form.submit=e;typeof a.form.removeEventListener=="function"?a.form.removeEventListener("submit",d,false):a.form.detachEvent("onsubmit",d)}};return l};c.isProbablySupported=function(){var a;
return window.opera?9.52<=Number(window.opera.version()):/Apple Computer, Inc/.test(navigator.vendor)&&(a=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./))?3<=Number(a[1]):document.selection&&window.ActiveXObject&&(a=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/))?6<=Number(a[1]):(a=navigator.userAgent.match(/gecko\/(\d{8})/i))?20050901<=Number(a[1]):(a=navigator.userAgent.match(/AppleWebKit\/(\d+)/))?525<=Number(a[1]):null};return c}();
(function(){var b=window.mjt,a=window.mjt={};a.noConflict=function(){window.mjt=b;return a};a.NAME="mjt";a.VERSION="0.9.3";a.LICENSE="========================================================================\nCopyright (c) 2007-2009, Metaweb Technologies, Inc.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY METAWEB TECHNOLOGIES ``AS IS'' AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE ARE DISCLAIMED. IN NO EVENT SHALL METAWEB TECHNOLOGIES BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\nWHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\nOR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN\nIF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n========================================================================\n"})();
var JSON=JSON||{};
(function(){function b(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(b,c){var e,h,q,o,p=f,r,s=c[b];s&&("object"===typeof s&&"function"===typeof s.toJSON)&&(s=s.toJSON(b));"function"===typeof j&&(s=j.call(c,b,s));switch(typeof s){case "string":return a(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);case "object":if(!s)return"null";
f+=g;r=[];if("[object Array]"===Object.prototype.toString.apply(s)){o=s.length;for(e=0;e<o;e+=1)r[e]=d(e,s)||"null";q=0===r.length?"[]":f?"[\n"+f+r.join(",\n"+f)+"\n"+p+"]":"["+r.join(",")+"]";f=p;return q}if(j&&"object"===typeof j){o=j.length;for(e=0;e<o;e+=1)h=j[e],"string"===typeof h&&(q=d(h,s))&&r.push(a(h)+(f?": ":":")+q)}else for(h in s)Object.hasOwnProperty.call(s,h)&&(q=d(h,s))&&r.push(a(h)+(f?": ":":")+q);q=0===r.length?"{}":f?"{\n"+f+r.join(",\n"+f)+"\n"+p+"}":"{"+r.join(",")+"}";f=p;return q}}
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.valueOf()?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var e;g=f="";if(typeof c==="number")for(e=0;e<c;e=e+1)g=g+" ";else typeof c==="string"&&(g=c);if((j=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return d("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function d(a,c){var e,f,g=a[c];if(g&&typeof g==="object")for(e in g)if(Object.hasOwnProperty.call(g,
e)){f=d(g,e);f!==void 0?g[e]=f:delete g[e]}return b.call(a,c,g)}var e;c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){e=eval("("+a+")");return typeof b==="function"?d({"":e},""):e}throw new SyntaxError("JSON.parse");})})();
(function(b){"undefined"==typeof b.services&&(b.services={});b.debug=0;var a={};b.uniqueid=function(b){var d=a[b];typeof d!=="number"&&(d=1);a[b]=d+1;return b+"_"+d};var d=function(a,d){var c=document.createElement("div"),e,k;e=document.createElement("h3");e.style.backgroundColor="#fff0f0";e.appendChild(document.createTextNode(a));c.appendChild(e);for(var l=0;l<d.length;l++){var n=d[l];if(n instanceof Array){e=document.createElement("div");e.innerHTML=b.flatten_markup(n)}else{e=document.createElement("pre");
if(typeof n=="string")k=n;else try{k=JSON.stringify(n)}catch(m){k=""+n}k=k.replace(/\r?\n/g,"\r\n");e.appendChild(document.createTextNode(k))}c.appendChild(e)}(e=document.getElementById("mjt_debug_output"))||(e=document.getElementsByTagName("body")[0]);e&&e.appendChild(c)},c=function(a){return Array.prototype.slice.apply(a).join(" ")};if("object"!=typeof console||"undefined"==typeof console.log)if("undefined"!=typeof document)b.error=function(){d("error",arguments);return""},b.warn=function(){d("warning",
arguments);return""},b.log=function(){return""},b.note=function(){return""},b.openlog=function(){return""},b.closelog=function(){return""},b.assert=function(){return""};else{if("undefined"!=typeof Packages){var e=java.lang.System.err;b.error=function(){e.println("error: "+c(arguments));return""};b.warn=function(){e.println("error: "+c(arguments));return""};b.log=function(){e.println("log: "+c(arguments));return""};b.note=function(){e.println("note: "+c(arguments));return""};b.openlog=function(){return""};
b.closelog=function(){return""};b.assert=function(){return""}}}else"function"==typeof console.debug?(b.error=function(){console.error.apply(console,arguments);return""},b.warn=function(){console.warn.apply(console,arguments);return""},b.log=function(){console.log.apply(console,arguments);return""},b.note=function(){b.debug&&console.info.apply(console,arguments);return""},b.openlog="undefined"!=typeof console.group?function(){b.debug&&console.group.apply(console,arguments)}:b.log,b.closelog="undefined"!=
typeof console.groupEnd?function(){b.debug&&console.groupEnd.apply(console,arguments);return""}:function(){return""},b.assert=function(a){if(!a){console.error.apply(console,arguments);throw Error("assertion failed");}return""}):(b.error=function(){console.log("error: "+c(arguments));return""},b.warn=function(){console.log("warning: "+c(arguments));return""},b.log=function(){return""},b.note=function(){return""},b.openlog=function(){return""},b.closelog=function(){return""},b.assert=function(){return""});
b.formquote=function(a){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(a)?a:encodeURIComponent(a).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g")};b.formencode=function(a){var d=[],c="",e,k,l,n=[];for(e in a)n.push(e);n.sort();for(l in n){e=n[l];k=a[e];if(typeof k!="undefined"){k instanceof Array||(k=[k]);for(var m=0;m<k.length;m++){var q=k[m];d.push(c);c="&";d.push(b.formquote(e));d.push("=");d.push(b.formquote(q))}}}return d.join("")};
b.formdecode=function(a){if(typeof a=="undefined"||a===null)return{};a=a.replace(/^\s*/m,"").replace(/\s+$/m,"");if(a=="")return{};for(var d={},a=a.split("&"),c=0;c<a.length;c++){var e=a[c].indexOf("=");if(e<1)b.log('bad uri query argument, missing "=": ',a[c]);else{var k=[a[c].substring(0,e),a[c].substring(e+1)],e=decodeURIComponent(k[0].replace(/\+/g," ")),k=decodeURIComponent(k[1].replace(/\+/g," "));e in d?d[e]instanceof Array?d[e].push(k):d[e]=[d[e],k]:d[e]=k}}return d};b.form_url=function(a,
d){return!d||!b.formencode(d)?a:a+"?"+b.formencode(d)};b.htmlencode=function(a){typeof a!="string"&&(a=""+a);return a.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")};b.label_package=function(a){var d=window;if(a){for(var c=a.split(".");c.length;)d=d[c.shift()];if(typeof d=="function")d=d.prototype;(typeof d=="object"||typeof d=="function")&&d!==null?d._package_name=a:b.log("missing package",a)}for(var e in d){c=d[e];if(b&&b.Task&&c&&typeof c!="string"&&
!c.nodeName&&c.constructor!=Array&&/function/i.test(c+"")&&typeof c.prototype=="object"&&c.prototype instanceof b.Task)c.prototype._task_class=a+"."+e}}})(mjt);
(function(b){var a=["safe_constructor_token"],d=function(a){return!!a&&"string"!=typeof a&&!a.nodeName&&a.constructor!=Array&&/function/i.test(a+"")},c=function(a){var b=[];if("array"!=typeof a)for(var d=0,c=a.length;d<c;d++)b.push(a[d]);else b=a.slice(0);return b};b.thunk=function(a,d){return b.vthunk(arguments)};b.vthunk=function(){var a,f,g;f=arguments[0];g="object"==typeof f&&"number"==typeof f.length?c(f):c(arguments);f=g.shift();"string"==typeof f?(a=g.shift(),d(a[f])||b.warn("mjt.thunk:",f,
"is not a method of",a)):(a=null,d(f)||b.error("mjt.thunk:",f,"is not a function"));var h=arguments.callee._next_thunk_id||1;arguments.callee._next_thunk_id=h+1;var j=function(){var a=arguments.callee,e=a.bound_args.concat(c(arguments)),f=a.bound_this===null?this:a.bound_this,g=a.bound_func;typeof g=="string"&&(g=f[g]);d(g)||b.error("mjt.thunk: bad function",a,a.bound_func,f);return g.apply(f,e)};j.bound_this=a;j.bound_func=f;j.bound_args=g;j.thunk_id=h;return j};b.vcall=function(a){var d=c(arguments).slice(1);
return b.vthunk(a).apply(this,d)};b.vapply=function(a,d){return b.vthunk(a).apply(this,d)};b.Task=function(){if(1!==arguments.length||arguments[0]!==a)throw b.error("new mjt.Task() is illegal"),Error("don't call mjt.Task()");};b.Task.prototype.toString=function(){return"["+this._task_id+"]"};b.Task.prototype.toMarkup=function(){return'<span class="mjt_task">task '+this._task_id+":"+this.state+"</span>"};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?
function(a){return a.__proto__}:function(a){return a.constructor.prototype});b.define_task=function(d,f){var g=function(){var b,d=c(arguments);if(this instanceof arguments.callee){if(d.length!==1||d[0]!==a)throw Error("Task class should not be invoked with new ()");}else{b=new arguments.callee(a);b._factory=this;for(var e=[],f=arguments.callee;f!==void 0;f=f.__super)e.push(f);for(;e.length;){f=e.pop();f.prototype.hasOwnProperty("init")&&f.prototype.init.apply(b,d)}typeof arguments.callee._auto_enqueue!=
"undefined"&&b.enqueue();return b}};if(!d)d=b.Task;g.prototype=new d(a);g.prototype.constructor=g;g.__super=d;g.prototype.parameters=f||[];return g};b.Task._default_timeout=1E4;b.Task.pending=null;b.Task._on_pending_empty=[];b.Task.add_pending=function(a){if(this.pending==null)this.pending={};this.pending[a._task_id]=a};b.Task.delete_pending=function(a){if(this.pending!==null&&a._task_id in this.pending){delete this.pending[a._task_id];for(var b in this.pending)return;for(this.pending=null;this.pending==
null&&this._on_pending_empty.length;)this._on_pending_empty.shift().ready()}};b.Task.prototype.init=function(){b.assert(typeof this.state==="undefined");this.state="init";this._onready=[];this._onerror=[];this._timeout=null;this._prereqs={};this._task_id=b.uniqueid(this._task_class?this._task_class:"task");b.Task.add_pending(this);for(var a=0;a<this.parameters.length;a++){var d=this.parameters[a];this[d.name]=typeof arguments[a]!="undefined"?arguments[a]:d["default"]}return this};b.Task.prototype.set_timeout=
function(a){if(typeof a==="undefined")a=b.Task._default_timeout;this._timeout!==null&&b.error("timeout already set");if(typeof setTimeout!="undefined")this._timeout=setTimeout(b.thunk("timeout",this),a);return this};b.Task.prototype.clear_timeout=function(){this._timeout!==null&&clearTimeout(this._timeout);this._timeout=null;return this};b.Task.prototype.require=function(a){if(this.state!=="init")throw Error("task.enqueue() already called - too late for .require()");if(a.state=="ready"||this.state==
"error")return this;if(a.state=="error")return this._prereq_error(a);this._prereqs[a._task_id]=a;a.onready("_prereq_ready",this,a).onerror("_prereq_error",this,a);return this};b.Task.prototype.enqueue=function(){if(this.state!="init")return this;this.state="wait";b.Task.debug&&b.openlog(this,".enqueue()");try{for(var a in this._prereqs)this._prereqs[a].enqueue();return this._prereqs_check()}finally{b.closelog()}};b.Task.prototype._prereqs_check=function(){if(this._prereqs===null)return this;for(var a in this._prereqs)return this;
if(this.state=="init")return this;this._prereqs=null;this.request();return this};b.Task.prototype.request=function(){return this.ready()};b.Task.prototype._prereq_ready=function(a){if(this._prereqs===null)return this;delete this._prereqs[a._task_id];return this._prereqs_check()};b.Task.prototype._prereq_error=function(a){if(this._prereqs===null)return this;this._prereqs=null;a=a.messages[0];return this.error(a.code,a.message,a.text)};b.Task.prototype.onready=function(a){this.state=="ready"?b.vcall(arguments,
this.result):this._onready instanceof Array&&this._onready.push(b.vthunk(arguments));return this};b.Task.prototype.onerror=function(a){this.state=="error"?b.vcall(arguments,this.messages[0].code,this.messages[0].message,this.messages[0].text):this._onerror instanceof Array&&this._onerror.push(b.vthunk(arguments));return this};b.Task.prototype.ondone=function(a){this.onready.apply(this,arguments);this.onerror.apply(this,arguments);return this};b.Task.prototype._state_notify=function(a,d,c){if(!b.Task.debug){for(var h=
0;h<d.length;h++){var j=d[h];j.apply(this,c)}return this}for(h=0;h<d.length;h++){j=d[h];typeof j.bound_func!=="undefined"?b.openlog(this,".on"+a," -> "+j.bound_this+".",j.bound_func,j.bound_args,j):b.openlog(this,".on"+a,j);try{j.apply(this,c)}finally{b.closelog()}}return this};b.Task.prototype.ready=function(a){if(this._prereqs!==null)for(var d in this._prereqs)if(typeof this._prereqs[d]!="undefined"){b.error("task.ready() called with remaining prereqs",this);throw Error("task.ready() called with remaining prereqs");
}if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw Error('task.ready() called in bad state "'+this.state+'", should be "wait"');this._onerror=null;this.clear_timeout();this.state="ready";d=this._onready;this._onready=null;this.result=a;b.Task.delete_pending(this);this._state_notify("ready",d,[a]);return this};b.Task.prototype._error=function(a,d){this._onready=this._prereqs=null;this.clear_timeout();var c=this._onerror;this._onerror=null;if(this.state=="init"){this._prereqs=
null;this.state="wait"}if(this.state!=="wait")throw Error('task.error() called in bad state "'+this.state+'". Error was '+a[0].message);this.state="error";this.messages=a;this._error_chain=d;var h=[a[0].code,a[0].message,a[0].text,this];b.Task.delete_pending(this);this._state_notify("error",c,h);return this};b.Task.prototype.error=function(a,b,d){return this._error([{code:a,message:b,text:typeof d!=="undefined"?d:""}])};b.Task.prototype.error_nest=function(a){return this._error(a.messages,a)};b.Task.prototype.timeout=
function(){this._timeout=null;return this.error("/user/mjt/messages/task_timeout","task timed out - possible unreachable server?")};b.Succeed=b.define_task(null,[{name:"succeed_result","default":null}]);b.Succeed.prototype.request=function(){return this.ready(this.succeed_result)};b.Fail=b.define_task(null,[{name:"fail_code","default":"mjt_fail"},{name:"fail_message","default":"error signaled using mjt.Fail"},{name:"fail_full","default":""}]);b.Fail.prototype.request=function(){return this.error(this.fail_code,
this.fail_message,this.fail_full)};b.Delay=b.define_task(null,[{name:"delay"}]);b.Delay.prototype.request=function(){var a=this;setTimeout(function(){a.ready(null)},this.delay)};b.NoPendingTasks=b.define_task();b.NoPendingTasks.prototype.init=function(){b.Task._on_pending_empty.push(this);b.Task.delete_pending(this)};b.NoPendingTasks.prototype.request=function(){}})(mjt);
(function(b){b.PagerSlice=b.define_task(null,[{name:"pager"},{name:"start"},{name:"count"}]);b.PagerSlice.prototype.init=function(){for(var a=this.chunks=this.pager.slice_chunks(this.start,this.count),b=0;b<a.length;b++)this.require(a[b]);return this.enqueue()};b.PagerSlice.prototype.request=function(){for(var a=this.chunks,b=[],c=0;c<a.length;c++){var e=a[c],f=this.start-e.start;if(!(0>f)){var g=f+this.count;f+g>e.count&&(g=e.count-f);0>=g||(b=0==f&&g==e.count?b.concat(e.result):b.concat(e.result.slice(f,
g)))}}return this.ready(b)};b.Pager=function(a){this.chunks=[];this.chunks_waiting=0;this.add_chunk(a)};b.Pager.prototype._next_chunk=function(a){a=this.chunks[this.chunks.length-1].next(a);this.add_chunk(a);return a};b.Pager.prototype.add_chunk=function(a){a.enqueue();this.chunks_waiting++;a.onready("chunk_ready",this).onerror("chunk_error",this);this.chunks.push(a);return this};b.Pager.prototype.chunk_ready=function(){this.chunks_waiting--};b.Pager.prototype.chunk_error=function(){this.chunks_waiting--};
b.Pager.prototype.slice_chunks=function(a,b){for(var c=[],e=a+b,f=this.chunks,g=0,h=0;h<f.length;h++){var j=this.chunks[h];!(j.start>=e)&&!(j.start+j.end<=a)&&(c.push(j),g=j.start+j.count)}e>g&&c.push(this._next_chunk(e-g));return c};b.Pager.prototype.slicetask=function(a,d){return b.PagerSlice(this,a,d)};b.Pager.prototype.slice=function(a,b,c,e){this.slicetask(a,b).onready(c).onerror(e)}})(mjt);
(function(b){b.dynamic_script=function(a,b,c){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";"string"==typeof a&&(f.id=a);"undefined"!==typeof b&&(f.src=b);if("undefined"!==typeof c){if(/WebKit|Khtml/i.test(navigator.userAgent))throw Error("safari doesnt evaluate dynamic script text");f.text=c}e.appendChild(f);return f};b.dynamic_iframe=function(a,b){var c=document.createElement("iframe");"string"==typeof a&&(c.id=a);c.style.display="none";
c.className="mjt_dynamic";c.setAttribute("src",b);return c};b.AsyncScript=b.define_task(null,[{name:"url"}]);b.AsyncScript.prototype.request=function(){var a=this,d=b.dynamic_script(null,this.url);if(/WebKit|Khtml/i.test(navigator.userAgent)){var c=b.dynamic_iframe();c.onload=function(){a.ready(null)};document.getElementsByTagName("body")[0].appendChild(c)}else d.onreadystatechange=function(){/complete|loaded/.test(d.readyState)&&a.ready(null)},d.onload=function(){a.ready(null)}};b.AsyncIframe=b.define_task(null,
[{name:"url"}]);b.AsyncIframe.prototype.request=function(){function a(){var a=c.contentWindow||c.contentDocument;return a.document?a.document:a}this.domid=b.uniqueid("mjt_iframe");this.iframe=b.dynamic_iframe(this.domid,this.url);var d=this,c=this.iframe;c.onload=function(){d.ready(a(c))};c.onreadystatechange=function(){"complete"==c.readyState&&d.ready(a(c))};document.getElementsByTagName("body")[0].appendChild(c)}})(mjt);
(function(b){var a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];b.crc32=function(b,c){"undefined"==typeof c&&(c=0);for(var e=0,c=c^-1,f=0,g=b.length;f<g;f++)e=(c^b.charCodeAt(f))&255,c=c>>>8^a[e];return c^-1};b.hash=function(a){return(b.crc32(a)+2147483648).toString(16).toUpperCase()}})(mjt);
(function(b){b.JsonP=b.define_task();b.JsonP._cb={};b.JsonP._cache={};b.JsonP.flush_cache=function(){b.JsonP._cache={}};b.JsonP.prototype.init=function(){this._cbid=this.url=null;return this};b.JsonP.prototype.generate_callback_id=function(a){if("undefined"==typeof a)return this._cbid=b.uniqueid("cb"),this;this._cbid="c"+b.hash(this.url);if("undefined"==typeof b.JsonP._cb[this._cbid])return this;b.log("info: repeated jsonp url hash",this._cbid,this.url);this._cbid=b.uniqueid("cb");return this};b.JsonP.prototype.install=
function(){b.JsonP._cache[this.url]=this;this.generate_callback_id(this.url);var a=this.callback_param+"=mjt.JsonP._cb."+this._cbid,d=/\?/.test(this.url)?"&":"?";this.cburl=this.url+d+a;var c=this;this._f=function(a){delete b.JsonP._cb[c._cbid];c.ready(a)};b.JsonP._cb[this._cbid]=this._f;this.onerror(function(a,d){function g(){b.log("JSONP already completed with ",a,":",d);delete b.JsonP._cb[c._cbid]}g._stale_jsonp_timed_out=new Date;b.JsonP._cb[c._cbid]=g});return this._send_request()};b.JsonP.prototype.request=
function(){if(!this.url)throw Error("jsonp.url should be set, not "+this.url);if("undefined"==typeof b.JsonP._cache[this.url])return this.install();var a=b.JsonP._cache[this.url];return!("undefined"==typeof a.cache_controller||null===a.cache_controller||a.cache_controller.is_fresh(a))?(delete b.JsonP._cache[this.url],this.install()):a.onready("ready",this).onerror("error",this)};b.JsonP.prototype._send_request=function(){b.dynamic_script(void 0,this.cburl);return this};b.JsonP.prototype.jsonp_request_form=
function(a,d,c){(d="string"==typeof d?d:b.formencode(d))&&(a+="?"+d);this.url=a;"undefined"===typeof acre&&2083<a.length&&(b.warn("mjt.JsonP: Warning: Adding a SCRIPT tag with a url of "+a.length+" chars. This is too long for Internet Explorer 7"),b.log(a));this.callback_param=c;return this.enqueue()}})(mjt);
(function(b){b.Xhr=b.define_task(null,[{name:"method"},{name:"url"},{name:"content_type","default":null},{name:"body","default":null},{name:"headers","default":null}]);b.Xhr.prototype.init=function(){var a;if("undefined"!=typeof XMLHttpRequest)a=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)a=new ActiveXObject("MSXML2.XmlHttp");else return this.error("no XMLHttpRequest found");null===this.headers&&(this.headers={});this.xhr=a;return this};b.Xhr.prototype.request=function(){var a=this,
b=this.xhr;b.onreadystatechange=function(){if(4!=b.readyState)return a;b.onreadystatechange=function(){};return"2"==(""+b.status).charAt(0)?a.ready(b):a.error("/googleapis/http/status/"+b.status,b.statusText,b.responseText)};b.open(this.method,this.url,!0);null!==this.content_type&&b.setRequestHeader("Content-Type",this.content_type);b.setRequestHeader("X-Requested-With","XMLHttpRequest");for(header in this.headers)b.setRequestHeader(header,this.headers[header]);null===this.body?b.send(""):(b.send(this.body),
this.body=null);return this};b.XhrFormPost=function(a,d,c){d=b.formencode(d);return b.Xhr("POST",a,"application/x-www-form-urlencoded",d,c)}})(mjt);
(function(b){function a(){var a=b.freebase.readCookie("fb-dateline");this.is_fresh=function(){var c=b.freebase.readCookie("fb-dateline");return a==c}}"undefined"==typeof b.freebase&&(b.freebase={});b.freebase.default_service_url="http://www.freebase.com";b.freebase.set_service_url=function(a){var c;typeof window!="undefined"&&(c=window.location.protocol+"//"+window.location.host);typeof acre!="undefined"&&(c=acre.environ.server_protocol+"//"+acre.environ.host);b.freebase.service_url=a;b.freebase.xhr_ok=
b.freebase.service_url==c?true:false;if(typeof b.freebase.SchemaCache!="undefined")this.schema_cache=new this.SchemaCache(this)};b.freebase.set_service_url(b.freebase.default_service_url);b.freebase.FreebaseJsonPTask=b.define_task();b.freebase.FreebaseJsonPTask.prototype.init=function(){this.jsonp=b.JsonP();if(typeof b.freebase.readCookie!="undefined")this.jsonp.cache_controller=new a};b.freebase.FreebaseJsonPTask.prototype.service_request=function(a,c){var e=b.freebase.service_url;if(typeof this.service_url!=
"undefined"&&this.service_url)e=this.service_url;this.jsonp.set_timeout().jsonp_request_form(e+a,c,"callback").onready("handle_envelope",this).onerror("handle_error_jsonp",this);return this};b.freebase.FreebaseJsonPTask.prototype.handle_envelope=function(a){if(a.code!="/api/status/ok"){a=a.messages[0];return this.error(a.code,a.message,a)}return this.response(a)};b.freebase.FreebaseJsonPTask.prototype.handle_error_jsonp=function(){this.error.apply(this,arguments)};b.freebase.FreebaseJsonPTask.prototype.request=
function(){b.error("must override BaseTask.request()")};b.freebase.FreebaseJsonPTask.prototype.response=function(){b.error("must override BaseTask.response()")};b.freebase.MqlRead=b.define_task(b.freebase.FreebaseJsonPTask,[{name:"query"},{name:"qenv","default":{}}]);b.freebase.MqlRead.prototype.build_envelope=function(){var a={escape:false},b;for(b in this.qenv)a[b]=this.qenv[b];a.query=this.query;if(this.query instanceof Array){if(typeof a.cursor=="undefined"){a.cursor=true;this.start=0}this.requested_count=
this.query[0].limit||100}return a};b.freebase.MqlRead.prototype.request=function(){var a=this.build_envelope(),a=JSON.stringify(a);return this.service_request("/api/service/mqlread",{query:a})};b.freebase.MqlRead.prototype.response=function(a){if(a.result===null)return this.error("/user/mjt/messages/empty_result","no results found");if(typeof a.cursor==="string")this.next_cursor=a.cursor;if(a.result instanceof Array){this.count=a.result.length;this.more_available=false;if(this.count>=this.requested_count&&
this.next_cursor!=false)this.more_available=true}return this.ready(a.result)};b.freebase.MqlRead.prototype.next=function(a){if(this.state!=="ready")throw Error("MqlRead.next(): bad state "+this.state);if(!this.more_available){b.warn("paging .next(): no more items",this);return null}var c=this.query[0],e={},f;for(f in c)c.hasOwnProperty(f)&&(e[f]=c[f]);if(typeof a!="undefined")e.limit=a;a=b.freebase.MqlRead([e],{cursor:this.next_cursor});a.start=this.start+this.count;return a};b.freebase.MqlReadMultiple=
b.define_task(b.freebase.FreebaseJsonPTask);b.freebase.MqlReadMultiple.prototype.init=function(){this.reads={}};b.freebase.MqlReadMultiple.prototype.request=function(){var a={},b;for(b in this.reads)a[b]=this.reads[b].build_envelope();a=JSON.stringify(a);return this.service_request("/api/service/mqlread",{queries:a})};b.freebase.MqlReadMultiple.prototype.mqlread=function(a,b){this.reads[a]=b;return this};b.freebase.MqlReadMultiple.prototype.response=function(a){for(var b in this.reads)this.reads[b].handle_envelope(a[b]);
return this.ready(a.result)};b.freebase.TransGet=b.define_task(b.freebase.FreebaseJsonPTask,[{name:"id"},{name:"trans_type","default":"raw"},{name:"values","default":null}]);b.freebase.TransGet.prototype.request=function(){if(this.values===null)this.values={};return this.service_request("/api/trans/"+this.trans_type+this.id,this.values)};b.freebase.TransGet.prototype.response=function(a){a.result.media_type=a.result.media_type.replace(/^\/media_type\//,"");if(typeof a.result.text_encoding=="string")a.result.text_encoding=
a.result.text_encoding.replace(/^\/media_type\/text_encoding\//,"");return this.ready(a.result)};b.freebase.Touch=b.define_task(b.freebase.FreebaseJsonPTask,[{name:"service_url","default":null}]);b.freebase.Touch.prototype.request=function(){this.jsonp.cache_controller={is_fresh:function(){return false}};return this.service_request("/api/service/touch")};b.freebase.Touch.prototype.response=function(){return this.ready(null)}})(mjt);
(function(b){b.freebase.date_from_iso=function(a){if("undefined"==typeof a||null===a)a=NaN;else{var d=new Date(0,0),a=a.toString(),a=-1==a.indexOf("T")?a.split(" "):a.split("T");var c=a[0],e=c.match(/^(-?[0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/);if(e){var f=e[4],g=e[6],h=e[8],c=e[10],j=e[12]||1;d.setFullYear(e[1]);h?(d.setMonth(0),d.setDate(Number(h))):c?(d.setMonth(0),d.setDate(1),e=d.getDay()||7,c=Number(j)+7*Number(c),4>=e?d.setDate(c+1-e):d.setDate(c+
8-e)):(f&&(d.setDate(1),d.setMonth(f-1)),g&&d.setDate(g))}else b.log("invalid date string: "+c),d=NaN;2==a.length&&((c=a[1],a=c.match(/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/),e=0,a&&("Z"!=a[0]&&(e=60*Number(a[3])+Number(a[5]||0),"-"!=a[2]&&(e*=-1)),e-=d.getTimezoneOffset(),c=c.substr(0,c.length-a[0].length)),a=c.match(/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/))?(c=Number(a[3]||0),j=a[5]||0,f=a[7]?1E3*Number("0."+a[7]):0,d.setHours(a[1]),d.setMinutes(c),d.setSeconds(j),d.setMilliseconds(f),
0!==e&&d.setTime(d.getTime()+6E4*e)):(b.log("invalid time string: "+c),d=NaN));a=d}return a};b.freebase.date_to_iso=function(a){var b=a,c=a=void 0;a||(a=6);if(c)var e=c.match(/([-+])([0-9]{2}):([0-9]{2})/),f=60*Number(e[2])+Number(e[3]),f=f*("-"==e[1]?-1:1),b=new Date(Number(Number(b)+6E4*f));else c="Z";e=function(a){return(10>a?"0":"")+a};f=""+b.getUTCFullYear();1<a&&(f+="-"+e(b.getUTCMonth()+1));2<a&&(f+="-"+e(b.getUTCDate()));3<a&&(f+="T"+e(b.getUTCHours())+":"+e(b.getUTCMinutes()));5<a?(b=Number(b.getUTCSeconds()+
"."+(100>b.getUTCMilliseconds()?"0":"")+e(b.getUTCMilliseconds())),f+=":"+e(b)):4<a&&(f+=":"+e(b.getUTCSeconds()));3<a&&(f+=c);return f}})(mjt);
(function(b){b.freebase.imgurl=function(a,d,c,e,f){var g={};"undefined"!==typeof d&&(g.maxwidth=d);"undefined"!==typeof c&&(g.maxheight=c);"undefined"!==typeof e&&(g.mode=e);"undefined"!==typeof e&&(g.errorid=f);return b.form_url(this.service_url+"/api/trans/image_thumb"+b.formquote(a),g)};b.freebase.extend_query=function(a,b){"undefined"==typeof b&&(b={});if("undefined"==typeof a)throw Error("extend_query: MQL query is undefined");for(var c in b){for(var e=b[c],f=c.split("."),g=f.pop(),h=a instanceof
Array?a[0]:a,j=0;j<f.length;j++){var k=f[j];if("object"!=typeof h[k]||null===h[k])h[k]={};h=h[k];if(h instanceof Array){0==h.length&&(h=[{}]);if(1<h.length)throw Error("extend_query: path "+JSON.stringify(c)+" references an array with more than one element");h=h[0]}}if(null===h||"object"!=typeof h)throw Error("extend_query: path "+JSON.stringify(c)+" does not exist in query");h[g]=e}return a}})(mjt);
(function(b){var a=/^[A-Za-z0-9][A-Za-z0-9_-]*$/,d=RegExp("([^A-Za-z0-9_-])","g");b.freebase.mqlkey_quote=function(b){if(a.exec(b))return b;var e=function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();2==c.length&&(c="00"+c);return"$"+c};x=b.replace(d,e);if("-"==x.charAt(0)||"_"==x.charAt(0))x=e(x,x.charAt(0))+x.substr(1);return x};b.freebase.mqlkey_unquote=function(a){return a=a.replace(/\$([0-9A-Fa-f]{4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))})}})(mjt);
(function(b,a){a.readCookie=function(a){if("undefined"!=typeof acre)return"undefined"==typeof acre.environ.cookies[a]?"":acre.environ.cookies[a].value;if("undefined"==typeof document)return"";var b="",a=a+"=";if(0<document.cookie.length){var e=document.cookie.indexOf(a);-1!=e&&(e+=a.length,a=document.cookie.indexOf(";",e),-1==a&&(a=document.cookie.length),b=document.cookie.substring(e,a))}return b};a.parse_metaweb_cookies=function(){function d(a,b){var c=a.indexOf("|"+b+"_");if(-1!=c){var c=c+2+b.length,
d=a.indexOf("|",c);if(-1!=d)return decodeURIComponent(a.substr(c,d-c))}return null}b.freebase.freebase_user=null;var c=a.readCookie("metaweb-user-info");if(0==c.indexOf("A|")){var e={type:"/type/user"};e.id=d(c,"p");e.guid=d(c,"g");e.name=d(c,"u");e.id||(e.id=e.guid);b.freebase.freebase_user=e}};a.parse_metaweb_cookies();a.FreebaseXhrTask=b.define_task(null);a.FreebaseXhrTask.prototype.init=function(){};a.FreebaseXhrTask.prototype.xhr_request=function(d,c,e,f){c=a.service_url+c;this.xhr=b.Xhr(d,c,
e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};a.FreebaseXhrTask.prototype.xhr_form_post=function(d,c){d=a.service_url+d;this.xhr=b.XhrFormPost(d,c).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};a.FreebaseXhrTask.prototype.request=function(){};a.FreebaseXhrTask.prototype.xhr_ready=function(a){var b=a.getResponseHeader("content-type"),b=b?b.replace(/;.*$/,""):"";if(!b.match(/^(application\/json|text\/javascript|text\/plain)$/))return this.error("/user/mjt/messages/json_response_expected",
"status: "+a.status+", content-type: "+b,a.responseText);this.envelope=a=JSON.parse(a.responseText);return a.error||"/api/status/ok"!==a.code?(b=a.error?a.error.errors[0]:a.messages[0],this.error(a.error?"/api/status/error":a.code,b.message,b)):this.ready(a.result)};a.FreebaseXhrTask.prototype.xhr_error=function(a,b,e,f){a=null;try{return a=JSON.parse(f),b=a.error?"/api/status/error":a.code,f=a.error?a.error.errors[0]:a.messages[0],this.error(b,f.message,f)}catch(g){return this.error(b,e,f)}};a.TransUnsafe=
b.define_task(null,[{name:"id"}]);a.TransUnsafe.prototype.xhr_request=function(d,c,e,f){c=a.service_url+c;this.xhr=b.Xhr(d,c,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};a.TransUnsafe.prototype.xhr_ready=function(a){var b=a.getResponseHeader("content-type");this.content_type=b?b.replace(/;.*$/,""):"";this.responseText=a.responseText;return this.ready()};a.TransUnsafe.prototype.xhr_error=function(a,b,e,f){return this.error(b,e,f)};a.TransUnsafe.prototype.request=
function(){return this.xhr_request("GET","/api/trans/unsafe"+this.id)};a.MqlWrite=b.define_task(a.FreebaseXhrTask,[{name:"query"},{name:"qenv","default":{}}]);a.MqlWrite.prototype.request=function(){var a={query:this.query},b;for(b in this.qenv)a[b]=this.qenv[b];a=JSON.stringify(a);return this.xhr_form_post("/api/service/mqlwrite",{query:a})};a.FlushCache=b.define_task(a.FreebaseXhrTask);a.FlushCache.prototype.request=function(){return this.xhr_request("POST","/api/service/touch")};a.FlushCache.prototype.xhr_ready=
function(){return this.ready(null)};a.Upload=b.define_task(a.FreebaseXhrTask,[{name:"content_type"},{name:"body"},{name:"values"}]);a.Upload.prototype.request=function(){var a="/api/service/upload",c=b.formencode(this.values);c&&(a+="?"+c);return this.xhr_request("POST",a,this.content_type,this.body)};a.Signin=b.define_task(a.FreebaseXhrTask,[{name:"username"},{name:"password"},{name:"domain","default":null},{name:"options","default":{}}]);a.Signin.prototype.request=function(){if("undefined"==typeof this.username)return this.xhr_form_post("/api/account/logout",
{});var a={username:this.username,password:this.password};null!==this.domain&&(a.domain=this.domain);for(var b in this.options)a[b]=this.options[b];return this.xhr_form_post("/api/account/login",a).ondone("clear_password",this)};a.Signin.prototype.clear_password=function(){delete this.password;return this}})(mjt,mjt.freebase);
(function(b){b.bless=function(a){return new b.Markup(a)};b.MarkupList=function(){for(var a=0;a<arguments.length;a++)this[a]=arguments[a]};b.Markup=function(a){this.html=a};b.Markup.prototype.toMarkup=function(){return this.html};var a=function(a,b,d){d.push('<span style="outline-style:solid;color:red;">');b?(d.push(b),d.push("</span>")):(d.push("bad markup element, type ["),d.push(typeof a),d.push("]</span>"))},d=function(c,e){switch(typeof c){case "object":if(null===c)a(c,"[null]",e);else if(c instanceof
b.MarkupList)for(var f=0;f in c;f++)d(c[f],e);else"function"===typeof c.toMarkupList?d(c.toMarkupList(),e):"function"===typeof c.toMarkup?e.push(c.toMarkup()):"function"===typeof c.toString?e.push(b.htmlencode(c.toString())):a(c,"[object]",e);break;case "undefined":a(c,"[undefined]",e);break;case "string":e.push(b.htmlencode(c));break;case "boolean":e.push(String(c));break;case "number":e.push(String(c));break;case "function":a(c,"[function]",e)}return e};b.flatten_markup=function(a){return d(a,[]).join("")};
b.make_attr_safe=function(a){return b.bless(b.flatten_markup(a).replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;"))}})(mjt);
(function(b){b.error_html=function(a,d,c){var e=[];if(d&&a.lineNumber){var f=a.lineNumber,d=d.split("\n");0>f&&(f=0);f>=d.length&&(f=d.length-1);var g=f-10;0>g&&(g=0);var h=[];for(e.push(b.bless(["\n<pre>"]));g<f;g++)h.push(d[g]);e.push(h.join("\n"));e.push(b.bless(['</pre>\n<pre style="color:red">']));e.push(d[f]+"\n");e.push(b.bless(["</pre>\n<pre>"]));h=[];for(g=f+1;g<d.length;g++)h.push(d[g]);e.push(h.join("\n"));e.push(b.bless(["</pre>\n"]))}a=[b.bless(['<div class="mjt_error"']),c?[b.bless([' id="']),
c,b.bless(['"'])]:[],b.bless([">"]),a.name,": ",a.message,e,b.bless(["</div>\n"])];return a=a.concat(e)};b.Codeblock=function(a,b){this.name=a;this.codestr=b;this.baseline=this.basefile=null};b.Codeblock.prototype.handle_exception=function(a,b){if("undefined"==typeof b.mjt_error){var c=!1;"undefined"!=typeof b.sourceURL&&(b.fileName=b.sourceURL);"undefined"!=typeof b.line&&(c=!0,b.lineNumber=b.line);b.mjt_error=b instanceof Error?{fileName:b.fileName,lineNumber:b.lineNumber,name:b.name,message:b.message,
stack:b.stack,rhinoException:b.rhinoException}:{name:"Unknown exception",fileName:"",message:""+b};if(this.basefile||c)if("string"==typeof b.stack){if(c=this.basefile.replace(/(\W)/g,"\\$1")+":(\\d+)\n",c=RegExp(c),c=c.exec(b.stack))c=parseInt(c[1])-this.baseline,0<c&&this.log_error_context(a,b,c)}else if(b.fileName==this.basefile||c)c=c?b.lineNumber-1:b.lineNumber-this.baseline,0<c&&(b.mjt_error.lineNumber=c,b.mjt_error.fileName="<generated code>",this.log_error_context(a,b,c))}};b.Codeblock.prototype.log_error_context=
function(a,d,c){for(var e=this.extract_context(this.codestr,c,5),c="---"+c+"--\>  ",f=[],g=0;g<c.length;g++)f.push(" ");f=f.join("");e=[f,e.prev_lines.join("\n"+f),"\n",c,e.the_line,"\n",f,e.next_lines.join("\n"+f)].join("");b.error("error",a,"\n    "+d.name+": "+d.message+"\n",e)};b.Codeblock.prototype.extract_context=function(a,b,c){a=a.split("\n");0>b&&(b=0);b>=a.length&&(b=a.length-1);var e=b-c;0>e&&(e=0);var f=[];for(line=e;line<b;line++)f.push(a[line]);var e=a[b],g=[];for(line=b+1;line<a.length&&
line<b+c;line++)g.push(a[line]);return{prev_lines:f,the_line:e,next_lines:g}};b.Codeblock.prototype.evaluate=function(){var a=(new Date).getTime(),d=[this.codestr],d=["var __mjt_eval = (function(){",this.codestr,"})(); __mjt_eval;\n"],d=d.join("");b.debug&&b.log("evaluating code "+this.name,{click_me:"view code",codestr:d});var c;if("undefined"==typeof window||"undefined"==typeof window.navigator.appName)c=eval(d);else{try{null()}catch(e){this.baseline=e.lineNumber+2,this.basefile=e.fileName}try{c=
eval(d)}catch(f){throw this.handle_exception("evaluating codeblock "+this.name,f),f;}}a=(new Date).getTime()-a;b.note("evaluated code in ",a,"msec, ",d.length,"chars, got ",typeof c);return c}})(mjt);
(function(b){b._eventcb={};b.kws=function(){for(var a={},b=0;b<arguments.length;b+=2)a[arguments[b]]=arguments[b+1];return a};b.foreach=function(a,b,c){var e,f;if("string"==typeof b||b instanceof Array||"object"==typeof jQuery&&b instanceof jQuery){f=b.length;for(e=0;e<f;e++)c.apply(a,[e,b[e]])}else if("object"===typeof b)if("undefined"!=typeof document&&"undefined"!=typeof b.item&&b.item===document.childNodes.item){f=b.length;for(e=0;e<f;e++)c.apply(a,[e,b.item(e)])}else for(e in b)b.hasOwnProperty(e)&&
c.apply(a,[e,b[e]])};b.ondomready=function(a,d){var c=b._ondomready_queue;null===b._ondomready_timer&&(b._ondomready_timer=setTimeout(b._ondomready_run,20));c.push(a);c.push(d)};b._ondomready_queue=[];b._ondomready_timer=null;b._ondomready_run=function(){b._ondomready_timer=null;var a=b._ondomready_queue;for(b._ondomready_queue=[];a.length;){var d=a.shift(),c=a.shift();d.apply(c)}};b.cleanup_noquote=function(a,d){var c=b.flatten_markup(a),c=c.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&amp;/g,"&");"undefined"!=typeof d&&(c=c.replace(RegExp("</("+d+"\\s*)>","ig"),"<\\/$1>"));return b.bless(c)};b.ref=function(a){a=['<a href="view?name=',b.formquote(a),'">',b.htmlencode(a),"</a>"].join("");return new b.Markup(a)};b.TemplateCall=function(a){this.raw_tfunc=a;delete this._markup};b.TemplateCall.prototype.toMarkupList=function(){return this._markup};b.TemplateCall.prototype.toMarkup=function(){return b.flatten_markup(this._markup)};b.TemplateCall.prototype.redisplay=function(){var a=
new this.this_tfunc;a.prev_tcall=this;a.subst_id=this.subst_id;a.render(this.targs).display();return a};b.TemplateCall.prototype.display=function(a){if("undefined"!=typeof acre)return this;"undefined"!=typeof a&&(this.subst_id=a);a=this.subst_id;if("string"==typeof a){var d=document.getElementById(a);if(d)a=d;else return b.note("no element with id "+a),null}"IFRAME"==a.nodeName&&(a=a.contentWindow||a.contentDocument,a.document&&(a=a.document),a=a.getElementsByTagName("body")[0]);if(!a)return this;
"undefined"!=typeof this._markup&&b.replace_html(a,this);return this};b.TemplateCall.prototype.render=function(a){"undefined"!=typeof a&&(this.targs=a);a=this.raw_tfunc;if("undefined"==typeof window||"undefined"==typeof window.navigator.appName)return this._markup=a.apply(this,this.targs),this;try{this._markup=a.apply(this,this.targs)}catch(d){d.tcall=this;a=this.tpackage._codeblock;if(null===a)throw d;a.handle_exception("applying tfunc "+this.signature,d);var a=[],c;for(c in this.tasks){var e=this.tasks[c];
"object"===typeof e&&null!==e?a.push(c+":"+e.state):a.push(c+":"+typeof e)}this._markup=new b.MarkupList(b.bless("<h3>error applying "),this.signature," to id=",this.subst_id,b.bless("</h3>"),"states:[",a.join(" "),"]");throw d;}return this};b.TemplateCall.prototype.mktask=function(a,b){this.tasks[a]=b;var c=this;"init"==b.state&&b.enqueue();return b.ondone(function(){c.render().display()})};b.tfunc_factory=function(a,d,c,e){var f=function(){var a=arguments.callee;if(this instanceof a)this.tasks=
{},this.defs=this.exports={},"function"==typeof b.deprecate&&b.deprecate(this,"defs",".exports");else{for(var c=new a,d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];e=c.signature.replace(/\(.*\)$/,"");c.subst_id=a.prototype.has_tasks?b.uniqueid("tcall__"+e):null;c.render(d);return c}};f.prototype=new b.TemplateCall(d);f.prototype.signature=a;f.prototype.tpackage=c;f.prototype.has_tasks=e;f.prototype.source_microdata=d.source_microdata;return f.prototype.this_tfunc=f}})(mjt);
(function(b){b.TemplatePackage=function(){this.namespace=this._template_fragments=this.output_mode=this.debug_locs=this._codeblock=this._compiled=this._template_strings=this.source=null};b.TemplatePackage.prototype.runtime={_break_token:b._break_token,_continue_token:b._continue_token,bless:b.bless,cleanup_noquote:b.cleanup_noquote,foreach:b.foreach,htmlencode:b.htmlencode,make_attr_safe:b.make_attr_safe,new_markuplist:function(){return new b.MarkupList},ondomready:b.ondomready,ref:b.ref,tfunc_factory:b.tfunc_factory,
uniqueid:b.uniqueid};b.TemplatePackage.prototype.init_from_json=function(a){"undefined"!=typeof a.file&&(this.source=a.file);"undefined"!=typeof a.stringtable&&(this._template_strings=a.stringtable);this._codeblock=null;"string"==typeof a.code?this._codeblock=new b.Codeblock(this.source,a.code):"function"==typeof a.code&&(this._compiled=a.code);"undefined"!=typeof a.debug_locs&&(this.debug_locs=a.debug_locs);"undefined"!=typeof a.output_mode&&(this.output_mode=a.output_mode);return this};b.TemplatePackage.prototype.init_from_js=
function(a){var b=a.def;this.init_from_json(a.info);this._compiled=b;return this};b.TemplatePackage.prototype.get_metadata=function(){return{file:this.source,stringtable:this._template_strings,debug_locs:this.debug_locs,output_mode:this.output_mode}};b.TemplatePackage.prototype.toJSON=function(){var a=this.get_metadata();null===this._codeblock?(b.warn("TemplatePackage.toJSON: complete source code unavailable",this.source),a.code=this._compiled):a.code=this._codeblock.codestr;return JSON.stringify(a)};
b.TemplatePackage.prototype.toJS=function(){var a=null;null===this._codeblock?(b.warn("TemplatePackage.toJS: complete source code unavailable",this.source),a=this._compiled):a="(function () {"+this._codeblock.codestr+"})()";return["{def: ",a,",\ninfo:",JSON.stringify(this.get_metadata()),"}\n"].join("")};b.TemplatePackage.prototype.lookup_line=function(a){return!(debug_locs instanceof Array)||a>=this.debug_locs.length?null:this.debug_locs[a-1]};b.TemplatePackage.prototype.compile_document=function(a,
d){(new Date).getTime();"undefined"==typeof d&&(d=new b.TemplateCompiler);d.compile_top(a,"rawmain()");(new Date).getTime();return this.init_from_json({source:this.source,stringtable:d.strings,code:d.codestr+"; return rawmain;",debug_locs:d.debug_locs,output_mode:d.output_mode})};b.TemplatePackage.prototype.load_document=function(a,b){this.source+="#"+a.id;this.compile_document(a);return this.load(b)};b.TemplatePackage.prototype.toplevel=function(a){null===this.namespace&&this.load(a);return this.namespace};
b.TemplatePackage.prototype.toString=function(){null===this.namespace&&this.load(targs);return b.flatten_markup(this.namespace._main.prototype.tpackage.tcall)};b.TemplatePackage.prototype.load=function(a){this._template_fragments=[];for(var d=0;d<this._template_strings.length;d++)this._template_fragments[d]=b.bless(this._template_strings[d]);null===this._compiled&&(null===this._codeblock?b.error("TemplatePackage has no code",this.source):this._compiled=this._codeblock.evaluate());"undefined"==typeof a&&
(a=[]);this._args=a;a=b.tfunc_factory("_main()",this._compiled,this,!1,!0);d=new a;d.render(this._args);this.tcall=d;d.pkg=this;"undefined"!=typeof this._compiled.doc_content_type&&(d.doc_content_type=this._compiled.doc_content_type);if("undefined"!=typeof d.exports._main)throw Error("_main() is illegal as a template function name");this.namespace=d.exports;this.namespace._main=a;if("undefined"!=typeof d.exports.main)throw Error("main() is illegal as a template function name");this.namespace.main=
a;"function"==typeof b.deprecate&&b.deprecate(this.namespace,"main","._main");return this}})(mjt);
(function(b){b.run=function(a,d,c){var e;"undefined"==typeof b.app&&(b.app=new b.App);if(0==arguments.length){var f=new b.TemplatePackage;return b.run_page(f)}if(null===typeof a)throw Error("mjt.run: null target");"string"==typeof a?(e=a,a=document.getElementById(e)):"object"==typeof a&&(""==a.id&&(a.id=b.uniqueid("run_target")),e=a.id);if(1==arguments.length)return f=new b.TemplatePackage,f.source=window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+e,b.run_element(f,a,
c);if("function"!==typeof d)throw b.error("invalid template function",d,arguments),Error("mjt.run: invalid args");f=new d;f.subst_id=e;f.render(c).display();return f.exports};b.run_page=function(a){var d=[],c;for(c=document.getElementsByTagName("head")[0].firstChild;null!==c;c=c.nextSibling)1==c.nodeType&&d.push(c);for(var e=0;e<d.length;e++)switch(c=d[e],c.nodeName){case "TITLE":a.title=c.innerHTML;break;case "META":switch(c.name){case "description":a.summary=c.content;break;case "author":a.author=
c.content;break;case "content-language":a.language=c.content;break;case "x-mjt-id":a.id=c.content}}d=b.Succeed();a.source=window.location.protocol+"//"+window.location.host+window.location.pathname;var f=document.createElement("div");c=document.getElementsByTagName("body")[0];for(e=c.firstChild;null!==e;){var g=e,e=e.nextSibling;"IFRAME"===g.nodeName&&"mjt_dynamic"===g.className||(c.removeChild(g),f.appendChild(g))}f.id=b.uniqueid("mjt_body");f.style.display="none";c.appendChild(f);"none"==c.style.display&&
(c.style.display="");d.enqueue().onready(function(){b.run_element(a,f,[])});return a.namespace};b.run_element=function(a,b,c){a.load_document(b,c);a.tcall.subst_id=b.id;a.tcall.display();return a.tcall.exports};b.load_element=function(a){var d="string"==typeof a?document.getElementById(a):a,c=new b.TemplatePackage;c.source=window.location.protocol+"//"+window.location.host+window.location.pathname;"string"==typeof a&&(c.source+="#"+a);c.load_document(d,[]);return c};b.load_from_iframe=function(a){var d=
new b.TemplatePackage;d.source=window.location.protocol+"//"+window.location.host+window.location.pathname;var c=a;"string"==typeof a&&(c=document.getElementById(a));if("IFRAME"!=c.nodeName)return b.error("called mjt.load_from_iframe on node tag",c.nodeName),null;a=c.contentWindow||c.contentDocument;a.document&&(a=a.document);c=a.getElementsByTagName("body")[0];d.load_document(c,[]);return d.namespace};b.load_string=function(a){var d=document.createElement("div");d.innerHTML=a;return b.load_element(d)};
b.replace_html=function(a,d){var c=document.createElement("div"),e=b.flatten_markup(d);c.innerHTML=e;if(null===a.parentNode)b.warn("attempt to replace html that has already been replaced?");else if(e=c.firstChild,null===e)b.warn("bad html in replace_innerhtml");else if(e.nextSibling&&(b.warn("template output should have a single toplevel node"),e=c),a.parentNode.replaceChild(e,a),e.style&&"none"==e.style.display)e.style.display=""}})(mjt);
(function(b){b.Scope=function(a,b,c){this.template=a;b||(b=null);this.parent=b;c||(c="[unnamed]");this.decl=c;this.tasks={};this.toplevel=!1;this.microdata={items:{},item:null,stack:[],lastvalue:null};null!==b&&(this.microdata.items=b.microdata.items)};b.TemplateCompiler=function(){this.strings=[];this.codestr=null;this.debug_locs=[];this.compiler_dt=this.source_loc=null;this._markup=[];this._code=[];this.next_unique_id={};this.debug=b.debug;this.browser_dom="undefined"!=typeof navigator;this.browser_target=
!0;this.document_content_type=this.output_prefix=null;this.set_output_mode("html");this.mjtns_re=/^(?:mjt\.|mjt:|acre:)(.+)$/;this._ie_attribute_bs=this.browser_dom&&/MSIE/.test(navigator.userAgent)};b.TemplateCompiler.prototype.set_output_mode=function(a){this.output_mode=a;this.empty_tags={};this.boolean_attrs={};this.preserve_space_tags={};this.noescape_tags={};switch(a){case "text":break;case "xml":break;case "html":this.empty_tags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,
isindex:1,link:1,meta:1,param:1};this.boolean_attrs={selected:1,checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1};this.preserve_space_tags={pre:1,textarea:1};this.noescape_tags={script:1,style:1};break;default:throw Error('set_output_mode: unknown mode "'+a+'"');}};b.TemplateCompiler.prototype.compile_top=function(a,d){this.scope=new b.Scope(this,null,"[toplevel]");this.scope.toplevel=!0;this.scope.toplevel_def=d;this.compile_node(a);this.codestr=
this._code.join("");this._markup=this._code=null;if(""==this.codestr)throw Error("template compiled with no output");};b.TemplateCompiler.prototype.uniqueid=function(a){var b=this.next_unique_id[a];"number"!==typeof b&&(b=1);this.next_unique_id[a]=b+1;return a+"_"+b};b.TemplateCompiler.prototype._ampRE=/\&/g;b.TemplateCompiler.prototype._ltRE=/\</g;b.TemplateCompiler.prototype._gtRE=/\>/g;b.TemplateCompiler.prototype.htmlencode=function(a){return a.replace(this._ampRE,"&amp;").replace(this._ltRE,
"&lt;").replace(this._gtRE,"&gt;")};b.TemplateCompiler.prototype.jsencode=function(a){return JSON.stringify([a]).replace(/^[^"]*/,"").replace(/[^"]*$/,"")};b.TemplateCompiler.prototype.flush_markup=function(a){if(0==this._markup.length)return-1;var b=this._markup.join("");this._markup=[];var c=this.strings.length;this.strings[c]=b;this.debug?(a=b.replace(/\r?\n/gm,"\n                                                  // "),b="__m[__n++]=__ts["+c+"];",50>b.length&&(b+="                                                  ".substr(b.length)),
this.emit(b,"// ",a,"\n")):a||this.emit("__m[__n++]=__ts[",c,"];\n");return c};b.TemplateCompiler.prototype.emit=function(){this._markup.length&&this.flush_markup();for(var a=0;a<arguments.length;a++)for(var b=(""+arguments[a]).split("\n"),c=0;c<b.length;c++)0<c&&(this._code.push("\n"),this.debug_locs.push(this.source_loc)),this._code.push(b[c])};b.TemplateCompiler.prototype.emitln=function(){this.emit.apply(this,arguments);this.emit("\n")};b.TemplateCompiler.prototype.markup=function(){for(var a=
0;a<arguments.length;a++)this._markup.push(arguments[a])};b.TemplateCompiler.prototype.warn=function(a){this.markup('<span style="outline-style:solid;color:red;">',this.htmlencode(a),"</span>")};b.TemplateCompiler.prototype.compile_task=function(a,d){if(null===d.firstChild||3!=d.firstChild.nodeType||null!==d.firstChild.nextSibling)throw Error("mjt.task="+a+" declaration may only contain text");var c=d.firstChild.nodeValue;c.match(/;\s*$/)&&(b.warn("mjt.task=",a,"definition should not end with a semicolon"),
c=c.replace(/;\s*$/,""));this.browser_dom&&c.match(/\/\/ /)&&b.warn('"//" comments in mjt.task=',a,"definition will fail on IE6");this.emitln("var ",a," = this.tasks && this.tasks.",a,";");this.emitln("if (!",a,") { ",a,' = this.mktask("',a,'", (\n',c,")); }");this.scope.has_tasks=!0};b.TemplateCompiler.prototype.compile_text=function(a,b,c,e,f){var g=/[^A-Za-z0-9_.]/gm,h=/\}/gm,j=/\]/gm,k={has_subs:!1,next_node_leading_ws:null};"undefined"==typeof b&&(b=!1);"undefined"==typeof c&&(c=!1);"undefined"==
typeof e&&(e=!1);"undefined"==typeof f&&(f=!1);var l,n,m=a.length,q=0,o=a.indexOf("$",q);if(-1==o){l=a.split("\n").length-1;c&&(a=a.replace(/^\s+/m,""));e&&(a=a.replace(/\s+$/m,""));if(b=/\n\s*$/.exec(a))k.next_node_leading_ws=b[0],a=a.substr(0,b.index);this.markup(this.htmlencode(a));this.source_loc+=l;return k}for(;0<=o;){n=a.substring(q,o);l=n.split("\n").length-1;0==q&&c&&(n=n.replace(/^\s+/m,""));this.markup(this.htmlencode(n));this.source_loc+=l;o++;if(o>=m)return this.warn("premature end of $ substitution in "+
this.jsencode(a)),k;switch(a.charAt(o)){case "$":if(f){this.markup("$");break}o++;this.markup("$");break;case "(":this.markup("$");break;case "{":h.lastIndex=o+1;l=h.exec(a);if(null===l)return this.warn("missing close after ${ in "+this.jsencode(a)),k;n=a.substring(o+1,h.lastIndex-1);o=h.lastIndex;if(/\{/.test(n))throw Error('template compiler: "{" and "}" are forbidden inside "${...}"');b?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",n,");"):this.emitln("__m[__n++]=(",n,");");k.has_subs=
!0;this.source_loc+=n.split("\n").length-1;break;case "[":if(f){this.markup("$");break}if(b)throw Error('template compiler: "$[...]" is illegal in an attribute');j.lastIndex=o+1;l=j.exec(a);if(null===l)return this.warn("missing close after $[ in "+this.jsencode(a)),k;n=a.substring(o+1,j.lastIndex-1);o=j.lastIndex;if(/\[/.test(n))throw Error('template compiler: "[" and "]" are forbidden inside "$[...]"');this.emitln("__m[__n++]=__pkg.runtime.ref(",this.jsencode(n),");");k.has_subs=!0;this.source_loc+=
n.split("\n").length-1;break;default:if(f){this.markup("$");break}g.lastIndex=o;l=g.exec(a);if(null===l)n=a.substring(o),o=m;else if(l.index>o)n=a.substring(o,l.index),o=l.index;else return this.warn("unknown character following $ in "+this.jsencode(a)),k;b?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",n,");"):this.emitln("__m[__n++]=",n,";");k.has_subs=!0}q=o;o=a.indexOf("$",q)}if(0<=q&&q<m){n=a.substring(q);l=n.split("\n").length-1;e&&(n=n.replace(/\s+$/m,""));if(b=/\n\s*$/.exec(n))k.next_node_leading_ws=
b[0],n=n.substr(0,b.index);this.markup(this.htmlencode(n));this.source_loc+=l}return k};b.TemplateCompiler.prototype.compile_onevent_attr=function(a,b){var c=this.uniqueid(a+"_cb");this.emitln("var ",c,' = __pkg.runtime.uniqueid("',a,'");');this.emitln("mjt._eventcb[",c,"] = function (event) {");this.emit(b);this.emitln("}");return"return mjt._eventcb.${"+c+"}.apply(this, [event])"};b.TemplateCompiler.prototype.get_attributes=function(a,d,c){for(var e=this.mjtns_re.exec(a.nodeName),f=null,g=a.attributes,
h=0;h<g.length;h++){var j=g[h];if(j.specified){var k=j.nodeName,l=this.mjtns_re.exec(k);if(l)c[l[1]]=j.nodeValue;else if(e&&-1==k.indexOf(":")){if("undefined"!=typeof c[k])throw Error("template compiler: ambiguous template attribute: both "+k+" and "+j.nodeName+" are specified");c[k]=j.nodeValue}else if("src"==k)f=j.nodeValue;else{l={name:k};"undefined"!=typeof j.nodeValue&&(l.value=j.nodeValue);if(this.browser_dom){"on"==k.substr(0,2)&&b.warn(k,'="..."',"will break on IE6, use","mjt."+k);if(this._ie_attribute_bs)if("style"==
k)l.value=""+a.style.cssText;else if("CHECKED"==k)l.value="1";else if(j=a.getAttribute(k,2))l.value=j;"number"==typeof l.value&&(l.value=""+l.value)}d.push(l)}}}this.browser_dom&&(this._ie_attribute_bs&&"INPUT"==a.nodeName)&&(l={name:"value",value:a.value},d.push(l));"undefined"!=typeof c.src?d.push({name:"src",value:c.src}):null!==f&&d.push({name:"src",value:f})};b.TemplateCompiler.prototype.compile_choose=function(a,d){var c="init";d?(this.emitln("switch (",d,") {"),c="dispatch_init"):b.log('choose="" is deprecated, use if...elif...else instead');
for(var e=a.firstChild;null!=e;){var f=e.nextSibling,g=e.nodeType;if(3==g)e.nodeValue.match(/[^ \t\r\n]/)&&b.warn("only whitespace text is allowed in mjt.choose, found",'"'+e.nodeValue+'"');else if(1==g){var g=c,h={};this.get_attributes(e,[],h);var j=!1;if("undefined"!=typeof h.when)j=!1;else if("undefined"!=typeof h.otherwise)j=!0;else{b.warn("all elements inside mjt.choose must have a mjt.when= or mjt.otherwise= attribute");break}"init"==c?j?(this.emitln("{"),g="closed"):(this.emitln("if (",h.when,
") {"),g="open"):"open"==c?j?(this.emitln("} else {"),g="closed"):(this.emitln("} else if (",h.when,") {"),g="open"):c.match(/^dispatch/)&&("dispatch_init"!=c&&this.emitln("break;"),j?this.emitln("default:"):(this.emit("case "),this.emit(this.jsencode(h.when)),this.emitln(":")),g="dispatch");this.compile_node(e,{choose_state:"in_choose"});c=g}e=f}""==d?this.emitln("}"):("dispatch_init"!=c&&this.emitln("break;"),this.emitln("};"))};b.TemplateCompiler.prototype.compile_def=function(a){var d=a.match(/^([^(]+)\(([^)]*)\)$/);
if(d){var c=d[1],d=d[2];this.debug&&this.emitln("// mjt.def=",a);this.emitln("var ",c," = function (",d,") {");this.scope=new b.Scope(this,this.scope,a)}else b.warn("bad mjt.def=",a,": must contain an argument list")};b.TemplateCompiler.prototype.complete_def=function(){this.scope=this.scope.parent;this.scope.toplevel&&"text"==this.output_mode?this.emitln("return __pkg.runtime.cleanup_noquote(__m);"):this.emitln("return __m;");this.emitln("};")};b.TemplateCompiler.prototype.generate_open_tag=function(a,
d,c,e){this.markup("<",a);for(var f={},g=0;g<d.length;g++){var h=d[g];"function"==typeof h.value?b.warn("ignoring function-valued attr",a,h.name,h.value):f[h.name]=h.value}"id"in f&&(e=!1);if(c){a=this.uniqueid("dattrs");g=this.uniqueid("sattrs");this.emitln("var ",a," = (",c,");");this.emitln("var ",g," = {};");for(g=0;g<d.length;g++)c=d[g].name,f=d[g].value,this.emit("if (!(",this.jsencode(c)," in ",a,")) {"),c in this.boolean_attrs?this.markup(" ",c):(this.markup(" ",c,'="'),this.compile_text(f,
!0),this.markup('"')),this.emitln(" }");e&&this.emitln('if (this.subst_id && !("id" in ',a,")) ",a,".id=this.subst_id;");d=this.uniqueid("di");this.emitln("for (var ",d," in ",a,") {");this.emitln("__m[__n++]=' ' + "+d+";");this.emitln("__m[__n++]=__pkg.runtime.bless('=\"');");this.emitln("__m[__n++]=__pkg.runtime.htmlencode(''+"+a+"["+d+"]);");this.emitln("__m[__n++]=__pkg.runtime.bless('\"');");this.emitln("}")}else{for(g=0;g<d.length;g++)h=d[g],this.markup(" ",h.name,'="'),this.compile_text(h.value,
!0),this.markup('"');e&&this.emitln("if (this.subst_id) { __m[__n++]=__pkg.runtime.bless(' id=\"' + this.subst_id + '\"'); }")}};b.TemplateCompiler.prototype.compile_node=function(a,d){"undefined"==typeof d&&(d={});var c="none";"undefined"!=typeof d.choose_state&&(c=d.choose_state);if("undefined"!=typeof a.getUserData)try{var e=a.getUserData("lineNumber");null!==e&&("string"==typeof e&&(e=parseInt(e)),this.source_loc=e)}catch(f){this.source_loc=null}e=null;switch(a.nodeType){case 1:this.compile_element(a,
c,d.leading_ws);break;case 2:break;case 3:e=this.compile_text(a.nodeValue,!1,d.trim_leading_ws,d.trim_trailing_ws).next_node_leading_ws;break;case 4:d.leading_ws&&this.markup(d.leading_ws);this.compile_text(a.nodeValue,!1);break;case 5:d.leading_ws&&this.markup(d.leading_ws);this.markup("&"+a.nodeName+";");break;case 6:b.warn("template compiler: skipping dom node type",a.nodeType);break;case 7:b.warn("template compiler: got <? ?>",a.nodeName,a.nodeValue);break;case 8:d.leading_ws&&this.markup(d.leading_ws);
"text"!=this.output_mode&&this.markup("<\!--"+a.nodeValue+"--\>");break;case 9:b.warn("template compiler: skipping dom node type",a.nodeType);break;case 10:d.leading_ws&&this.markup(d.leading_ws);this.markup("<!DOCTYPE "+a.nodeName+' PUBLIC "'+a.publicId+'" "'+a.systemId+'">');b.warn("ignoring DOCTYPE",a.nodeName,a.nodeValue);break;case 11:b.warn("template compiler: skipping dom node type",a.nodeType);break;case 12:b.warn("template compiler: skipping dom node type",a.nodeType);break;default:b.warn("template compiler: unknown dom node type",
a.nodeType)}return e};b.TemplateCompiler.prototype.compile_element=function(a,d,c){var e=[],f=!0,g=a.nodeName,h=g.toLowerCase(),j={},k=[];this.get_attributes(a,k,j);var l={};for(ai=0;ai<k.length;ai++){var n=k[ai];l[n.name]=n}if(this.scope.toplevel){if("undefined"!=typeof j.def)throw Error('template compiler: def="'+j.def+'" illegal at top element');j.def=this.scope.toplevel_def}"text"==this.output_mode&&(j.strip="1");var m=this.mjtns_re.exec(a.nodeName);if(m)switch(m[1]){case "script":j.script=j.script||
"";break;case "none":b.warn("<mjt:none> is deprecated, use <mjt:block> instead");j.strip="1";break;case "block":j.strip="1";break;case "task":"string"==typeof j["var"]?j.task=j["var"]:b.error("mjt:task requires var= or mjt:var= attribute");break;case "doc":this.scope.toplevel||b.error("mjt:doc is only legal as the toplevel tag");j.strip="1";this.document_content_type="undefined"!=typeof j.type?j.type:"text/html";if("undefined"!=typeof j["xml-pi"])if("true"==j["xml-pi"]||"1"==j["xml-pi"])this.output_prefix=
'<?xml version="1.0" encoding="utf-8" ?>\n';else if("false"==j["xml-pi"]||"0"==j["xml-pi"])this.output_prefix=null;"text/html"==this.document_content_type?this.set_output_mode("html"):/^text\//.test(this.document_content_type)?this.set_output_mode("text"):(/^application\/.*xml$/.test(this.document_content_type),this.set_output_mode("xml"));break;default:b.error("ignoring unknown mjt tag",g)}var m=null,q=!1;"undefined"!=typeof j.trim&&(q=!0);null!==a.firstChild&&(m=function(a){var a=a.firstChild,b=
{};if(q)b.trim_leading_ws=true;for(;a!=null;){var c=a.nextSibling;if(q&&c===null)b.trim_trailing_ws=true;b.leading_ws=this.compile_node(a,b);b.trim_leading_ws=false;b.trim_trailing_ws=false;a=c}return b.leading_ws});if(!("script"==h&&this.browser_dom))if(h in this.noescape_tags&&(m=function(a){a=a.firstChild;if(a!==null)if(a.nodeType!=3||a.nextSibling)b.warn("<"+g+"> tag should contain only text");else if(a.nodeValue.match(RegExp("</"+g)))b.warn("illegal content for HTML script tag, removed");else{this.emitln(" __m[__n++]=(function () {");
this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");a=this.compile_text(a.nodeValue,false,false,false,true);this.emitln("return __pkg.runtime.cleanup_noquote(__m, "+this.jsencode(h)+");");this.emitln("})();");return a.next_node_leading_ws}}),"undefined"!=typeof j.task)this.compile_task(j.task,a);else{"undefined"!=typeof j.def&&("undefined"!=typeof k.id&&b.warn("mjt.def=",j.def,'must not have an id="..." attribute'),this.compile_def(j.def,a),this.scope.parent.toplevel?(this.emitln("var __pkg = this.tpackage;"),
this.emitln("var exports = this.exports;"),this.emitln("var __ts=__pkg._template_fragments;"),this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;"),null!=this.output_prefix&&this.markup(this.output_prefix)):this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;"),e.push(function(){var a=this.scope;a.has_tasks&&(!f||typeof j.strip!="undefined")&&b.error("can't strip toplevel tag of mjt.def=\""+j.def+'" tag because it contains tasks');this.complete_def();var c=j.def.replace(/\(.*/,"");this.scope.toplevel&&
this.document_content_type!=null&&this.emitln(c,".doc_content_type = ",this.jsencode(this.document_content_type),";");this.scope.toplevel||this.emitln(c," = __pkg.runtime.tfunc_factory(",this.jsencode(j.def),", ",c,", ","__pkg",", ",a.has_tasks,", ",false,");");this.scope.parent&&this.scope.parent.toplevel&&this.emitln("exports.",c," = ",c,";");typeof a.microdata!="undefined"&&this.emitln(c,".source_microdata = ",JSON.stringify(a.microdata.lastvalue),";")}));"undefined"!=typeof j.when&&(this.flush_markup(),
"in_choose"!=d&&b.warn("unexpected mjt.when, in choice state",d),e.push(function(){this.flush_markup()}));"undefined"!=typeof j.otherwise&&(this.flush_markup(),"in_choose"!=d&&b.warn("unexpected mjt.otherwise, in choice state ",d),e.push(function(){this.flush_markup()}));var o={meta:"content",audio:"src",embed:"src",iframe:"src",img:"src",source:"src",video:"src",a:"href",area:"href",link:"href",object:"data",time:"datetime"},p=this.scope.microdata;if(p&&"undefined"!=typeof j.itemprop){"itemprop"in
l||k.push({name:"itemprop",value:j.itemprop});if(null===p.item)throw Error("got mjt.itemprop= without containing mjt.item=");if("undefined"!=typeof j["for"])throw Error(g+' element has both acre:itemprop= and mjt.for="" attributes');d="itemvalue["+this.jsencode(j.itemprop)+"]";j["for"]="itemindex,itemvalue in ((typeof "+d+' == "object" && '+d+" !== null && "+d+" instanceof Array) ? "+d+" : ["+d+"])";h in o?(d=o[h],d in l||k.push({name:d,value:"$itemvalue"})):null===a.firstChild&&(j.content="itemvalue");
e.push(function(){var b=j.itemprop;if(h in o){var c=o[h];p.item[b]=c in k?k[c]:null}else p.item[b]=a.firstChild===null?null:p.lastvalue})}if("undefined"!=typeof j["for"]){var r=/^(\w+)(\s*,\s*(\w+))?\s+in\s+(.+)$/.exec(j["for"]);if(r){var d=r[1],n=r[3],r=r[4],s;n?(s=d,d=n):s=this.uniqueid(d+"_index");this.emitln("__pkg.runtime.foreach(this, (",r,"), function (",s,", ",d,") {");var u=this.uniqueid("once");this.emitln("var ",u," = 1;");this.emitln("while (",u,") {");e.push(function(){this.emitln(u,
"--;");this.emitln("} /* while once */");this.emitln("return ",u," ? __pkg.runtime._break_token :  __pkg.runtime._continue_token;");this.emitln("}); /* foreach */")})}else"("==j["for"].charAt(0)?(this.emitln("for ",j["for"]," {"),e.push(function(){this.emitln("}")})):b.warn("bad mjt.for= syntax")}"undefined"!=typeof j["if"]&&(this.emitln("if (",j["if"],") {"),e.push(function(){this.emitln("}")}));if("undefined"!=typeof j.elif){if(!/^\s*$/.exec(this._markup.join("")))throw Error('only whitespace is permitted between if="" and elif=""');
this._markup=[];this.emitln("else if (",j.elif,") {");e.push(function(){this.emitln("}")})}if("undefined"!=typeof j["else"]){if(!/^\s*$/.exec(this._markup.join("")))throw Error('only whitespace is permitted between if="" and else=""');this._markup=[];this.emitln("else {");e.push(function(){this.emitln("}")})}if("undefined"!=typeof j.script){m=!1;switch(j.script){case "":break;case "1":break;case "ondomready":m=!0;break;default:b.warn("reserved mjtattrs.script= value:",j.script)}m&&this.emitln("__pkg.runtime.ondomready(function () {");
if(d=a.firstChild)if(3!=d.nodeType||d.nextSibling)b.warn("the mjt.script element can only contain javascript text, not HTML.  perhaps you need to quote '<', '>', or '&' (this is unlike a <script> tag!)");else{d=d?d.nodeValue:"";d.match(/\/\/ /)&&this.browser_dom&&b.warn('"//" comments in mjt.script= definition will fail on IE6');d=d.split("\n");for(n=0;n<d.length;n++)this.emitln(d[n]),this.source_loc++}m&&this.emitln("}, this);");f=!1;m=null}"undefined"!=typeof j.choose&&(this.flush_markup(),m=function(a){this.compile_choose(a,
j.choose)});"undefined"!=typeof j.replace&&(f=!1,m=function(){this.emitln("__m[__n++]=(",j.replace,");")});"undefined"!=typeof j.content&&(m=function(){this.emitln("__m[__n++]=(",j.content,");")});for(var t in j)"on"==t.substr(0,2)&&(this.browser_target?(n={name:t,value:this.compile_onevent_attr(t,j[t])},k.push(n)):b.warn("mjt:onevent= attributes only make sense if targeting a browser"));this.debug&&(this.browser_dom&&"undefined"!=typeof j.def)&&k.push({name:"mjt_template",value:j.def});p&&"undefined"!=
typeof j.item&&("item"in l||k.push({name:"item",value:j.item}),p.stack.push(p.item),"id"in l?(d=l.id.value,p.item=d in p.items?p.items[d]:p.items[d]={}):p.item={},""!=j.item&&(p.item.__type=j.item),this.emitln("var item = itemvalue;"),e.push(function(){p.lastvalue=p.item;p.item=p.stack.pop()}));p&&"undefined"!=typeof j.itemfor&&("itemfor"in l||k.push({name:"itemfor",value:j.itemfor}),p.stack.push(p.item),"undefined"==typeof p.items[j.itemfor]&&(p.items[j.itemfor]={}),p.item=p.items[j.itemfor],e.push(function(){p.lastvalue=
p.item;p.item=p.stack.pop()}));l="undefined"!=typeof j.strip?j.strip:null;t=null;"1"==l&&(f=!1);f&&(d="undefined"!=typeof j.attrs?j.attrs:null,null!==l&&(t=this.uniqueid("strip"),this.emitln("var ",t," = (",l,");"),this.emitln("if (!",t,") {")),c&&"undefined"===typeof j.def&&this.markup(c),"undefined"!=typeof j.def?this.generate_open_tag(g,k,d,!0):this.generate_open_tag(g,k,d,!1),null===m&&"xml"==this.output_mode?this.markup("/>"):this.markup(">"),null!==l&&this.emitln("}"));if(null!==m)if(h in this.empty_tags)b.warn('tag "'+
g+'" must be empty, content ignored');else var v=m.apply(this,[a]);f&&!(null===m&&"xml"==this.output_mode)&&!(h in this.empty_tags)&&(t?(this.emitln("if (!",t,") {"),"undefined"!==typeof v&&this.markup(v),this.markup("</",g,">"),this.emitln("}")):("undefined"!==typeof v&&this.markup(v),this.markup("</",g,">")));for(c=e.length-1;0<=c;c--)e[c].apply(this,[])}}})(mjt);
(function(b){b.App=function(a){"undefined"==typeof a&&(a={});this.state=null;this.yui_history_id="mjtapp";this.argschema={"mjt.server":{key:"mjt.server",statekey:"service_url",validator:b.validators.service_host},"mjt.debug":{key:"mjt.debug",statekey:"debug",validator:b.validators.flag}};for(var d in a)this.argschema[d]=a[d];this._onstatechange={};this.init()};b.App.prototype.init=function(){this.init_state();b.service_url=this.state.service_url;b.freebase.set_service_url(this.state.service_url);
b.debug=this.state.debug;b.Task.debug=this.state.debug;b.urlquery=this.state;return this};b.App.prototype.onstatechange=function(a){var d=b.uniqueid("statecb");this._onstatechange[d]=b.vthunk(arguments);return this};b.App.prototype.refresh=function(){for(var a in this._onstatechange)this._onstatechange[a].apply(this,[]);return this};b.App.prototype._handle_onhistory=function(a){b.log("yui setting state",a,typeof this.state);null===a?(a=YAHOO.util.History.getCurrentState(this.yui_history_id),b.log("yui history onLoadEvent:",
a)):b.log("yui history state:",a);this.state=rison.decode_object(a);this.refresh()};b.App.prototype.init_state=function(){var a;"undefined"!=typeof window&&(a=window.location.search);"undefined"!=typeof acre&&(a=acre.environ.query_string);this.state="string"==typeof a&&0<a.length&&"?"==a.charAt(0)?this.decode_uristate(a.substr(1)):this.decode_uristate("");if("undefined"===typeof YAHOO||!YAHOO.util.History)return this;a=YAHOO.util.History;var d=a.getBookmarkedState(this.yui_history_id);d||(d=rison.encode_object(this.state));
b.log("yui history initial state",d);a.register(this.yui_history_id,d,b.vthunk("_handle_onhistory",this));a.onLoadEvent.subscribe(b.vthunk("_handle_onhistory",this,null));a.initialize("yui-history-iframe","yui-history-field");return this};b.App.prototype.mark_history=function(){if(null!==this.yui_history_id){var a=rison.encode_object(this.state);YAHOO.util.History.navigate(this.yui_history_id,a)}};b.Validator=function(){};b.Validator.prototype.encode=function(a){return a==this.default_value?void 0:
this.encodestr(a)};b.Validator.prototype.decode=function(a){return"undefined"==typeof a?this.default_value:this.decodestr(a)};b.validators={};b.validators.flag=new b.Validator;b.validators.flag.default_value=!1;b.validators.flag.encodestr=function(a){return a?"1":void 0};b.validators.flag.decodestr=function(a){return"1"==a?!0:!1};b.validators.service_host=new b.Validator;b.validators.service_host.default_value="http://www.freebase.com";b.validators.service_host.encodestr=function(a){a=a.replace(/^http:\/\//,
"");return"undefined"!=typeof window&&a==window.location.host?".":a};b.validators.service_host.decodestr=function(a){"http"==a.substr(0,4)?url=a:"."==a?("undefined"!=typeof window&&(url=window.location.protocol+"//"+window.location.host),"undefined"!=typeof acre&&(url=acre.environ.server_protocol+"//"+acre.environ.host)):url="http://"+a;return url};b.App.prototype.encode_uristate=function(a){var d={},c,e,f={};for(c in this.argschema)e=this.argschema[c],f[e.statekey]=e;for(c in this.state)e=f[c],"undefined"!=
typeof e?d[e.key]=e.validator.encode(this.state[c]):d[c]=this.state[c];for(c in a)e=f[c],"undefined"!=typeof e?d[e.key]=e.validator.encode(a[c]):d[c]=a[c];for(c in d)"undefined"==typeof d[c]&&delete d[c];return b.formencode(d)};b.App.prototype.decode_uristate=function(a){var d={},c=b.formdecode(a),e;for(e in c)a=this.argschema[e],"undefined"!=typeof a?d[a.statekey]=a.validator.decode(c[e]):d[e]=c[e];for(e in this.argschema)a=this.argschema[e],c=a.statekey,c in d||(d[c]=a.validator.default_value);
return d};b.App.prototype.href=function(a,b){if("undefined"==typeof a||null===a)a=location.protocol+"//"+location.host+location.pathname;var c=this.encode_uristate(b);return a+(c?"?"+c:"")}})(mjt);
"undefined"!=typeof jQuery&&function(b){function a(a,b,f){var g="";if("string"===typeof a){var h=d[a];"object"===typeof h?(h=h[b],"function"===typeof h?g=mjt.flatten_markup(h.apply(this,f)):console.warn("acre template '"+b+"' does not exist in package '"+a+"'")):console.warn("acre template package '"+a+"' has not been registered")}else g=mjt.flatten_markup(a);return g}if("undefined"!=typeof b){var d={};b(window).bind("acre.template.register",function(a,b){var f=b.pkgid,g=b.source;"string"===typeof f&&
"object"===typeof g&&(g.def&&(g=(new mjt.TemplatePackage).init_from_js(g).toplevel()),d[f]=g)});b.fn.mjt=function(a){var b=mjt.flatten_markup(a);return this.each(function(){this.innerHTML=b})};b.fn.acre=function(c,d,f){return this.each(function(){b(this).html(a(c,d,f))})};b.acre=function(b,d,f){return a(b,d,f)}}}(jQuery);
(function(b){function a(a,f){var g=this,h=a.add(g),j=b(window),k,l,n,m=b.tools.expose&&(f.mask||f.expose),q=Math.random().toString().slice(10);m&&("string"==typeof m&&(m={color:m}),m.closeOnClick=m.closeOnEsc=!1);var o=f.target||a.attr("rel");l=o?b(o):a;if(!l.length)throw"Could not find Overlay: "+o;a&&-1==a.index(l)&&a.click(function(a){g.load(a);return a.preventDefault()});b.extend(g,{load:function(a){if(g.isOpened())return g;var e=c[f.effect];if(!e)throw'Overlay: cannot find effect : "'+f.effect+
'"';f.oneInstance&&b.each(d,function(){this.close(a)});a=a||b.Event();a.type="onBeforeLoad";h.trigger(a);if(a.isDefaultPrevented())return g;n=true;m&&b(l).expose(m);var k=f.top,o=f.left,t=l.outerWidth({margin:true}),v=l.outerHeight({margin:true});typeof k=="string"&&(k=k=="center"?Math.max((j.height()-v)/2,0):parseInt(k,10)/100*j.height());o=="center"&&(o=Math.max((j.width()-t)/2,0));e[0].call(g,{top:k,left:o},function(){if(n){a.type="onLoad";h.trigger(a)}});if(m&&f.closeOnClick)b.mask.getMask().one("click",
g.close);f.closeOnClick&&b(document).bind("click."+q,function(a){b(a.target).parents(l).length||g.close(a)});f.closeOnEsc&&b(document).bind("keydown."+q,function(a){a.keyCode==27&&g.close(a)});return g},close:function(a){if(!g.isOpened())return g;a=a||b.Event();a.type="onBeforeClose";h.trigger(a);if(!a.isDefaultPrevented()){n=false;c[f.effect][1].call(g,function(){a.type="onClose";h.trigger(a)});b(document).unbind("click."+q).unbind("keydown."+q);m&&b.mask.close();return g}},getOverlay:function(){return l},
getTrigger:function(){return a},getClosers:function(){return k},isOpened:function(){return n},getConf:function(){return f}});b.each(["onBeforeLoad","onStart","onLoad","onBeforeClose","onClose"],function(a,c){b.isFunction(f[c])&&b(g).bind(c,f[c]);g[c]=function(a){b(g).bind(c,a);return g}});k=l.find(f.close||".close");!k.length&&!f.close&&(k=b('<a class="close"></a>'),l.prepend(k));k.click(function(a){g.close(a)});f.load&&g.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(a,
b,d){c[a]=[b,d]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||6<b.browser.version,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var d=[],c={};b.tools.overlay.addEffect("default",function(a,c){var d=this.getConf(),h=b(window);d.fixed||(a.top+=h.scrollTop(),a.left+=h.scrollLeft());a.position=d.fixed?"fixed":"absolute";this.getOverlay().css(a).fadeIn(d.speed,c)},function(a){this.getOverlay().fadeOut(this.getConf().closeSpeed,
a)});b.fn.overlay=function(c){var f=this.data("overlay");if(f)return f;b.isFunction(c)&&(c={onBeforeLoad:c});c=b.extend(!0,{},b.tools.overlay.conf,c);this.each(function(){f=new a(b(this),c);d.push(f);b(this).data("overlay",f)});return c.api?f:this}})(jQuery);
(function(b){b.factory("paneldrawer",{init:function(){var a=this,d=this.options,c=this.element;this.headers=b("."+d.css_panel_header,c);this.panel_content=b(c).find("."+d.css_panel_content);this.drawer_content=b(c).find("."+d.css_drawer_content);this.drawer_toggle=b(c).find("."+d.css_drawer_toggle);this.drawer_toggle.click(function(){return a.toggle()});c.css("overflow","hidden");this.drawer_height=this.options.drawer_height||this.drawer_content.outerHeight();this.headers_height=0;b("."+d.css_panel_header,
c).each(function(c,d){a.headers_height+=b(d).outerHeight()});this.toggle_state=this.options.toggle_state;this.options.init_height&&this.set_height(b(c).innerHeight())},set_height:function(a){this.total_height=a;this.finish_toggle(this.toggle_state);this.panel_content.height(this.total_height-this.headers_height-(this.toggle_state?this.drawer_height:0))},finish_toggle:function(a){(this.toggle_state=a)?(this.drawer_content.height(this.drawer_height),this.drawer_toggle.removeClass("up"),this.drawer_toggle.addClass("down")):
(this.drawer_content.height(0),this.drawer_toggle.removeClass("down"),this.drawer_toggle.addClass("up"));this.options.init_height||this.element.css("height","initial");this.options.toggle_callback&&this.options.toggle_callback.call(this.drawer_toggle,this.toggle_state)},toggle:function(){var a=this,b=this.panel_content.height();this.element.height(this.total_height);this.toggle_state?this.options.animate?this.panel_content.animate({height:"+="+this.drawer_height},function(){a.finish_toggle(!a.toggle_state)}):
(this.panel_content.height(b+this.drawer_height),this.finish_toggle(!this.toggle_state)):this.options.animate?this.panel_content.animate({height:"-="+this.drawer_height},function(){a.finish_toggle(!a.toggle_state)}):(this.panel_content.height(b-this.drawer_height),this.finish_toggle(!this.toggle_state));return!1}});b.extend(!0,b.paneldrawer,{defaults:{css_panel_header:"panel-header",css_panel_content:"panel-content",css_drawer_header:"drawer-header",css_drawer_content:"drawer-content",css_drawer_toggle:"toggle",
animate:!0,toggle_state:!0,init_height:!0}})})(jQuery);
"CueCard"in window||function(){window.CueCard={loaded:!1,version:"trunk",loadingScriptsCount:0,error:null,helper:"http://www.freebase.com/cuecard/",apiProxy:{base:"http://www.freebase.com/cuecard/",read:"mqlread.ajax?",write:"mqlwrite.ajax?"},freebaseServiceUrl:"http://www.freebase.com/",params:{bundle:!0,externals:!0}};CueCard.findScript=function(a,b){for(var c=a.documentElement.getElementsByTagName("head"),e=0;e<c.length;e++)for(var f=c[e].firstChild;null!=f;){if(1==f.nodeType&&"script"==f.tagName.toLowerCase()){var g=
f.src;if(0<=g.indexOf(b))return g}f=f.nextSibling}return null};CueCard.parseURLParameters=function(a,b,c){b=b||{};c=c||{};"undefined"==typeof a&&(a=location.href);var e=a.indexOf("?");if(0>e)return b;for(var a=(a+"#").slice(e+1,a.indexOf("#")),f=a.split("&"),g,a={},h=window.decodeURIComponent||unescape,e=0;g=f[e];e++){var j=g.indexOf("="),k=h(g.slice(0,j).replace(/\+/g," ")),l=a[k];"undefined"==typeof l?l=[]:l instanceof Array||(l=[l]);a[k]=l.concat(h(g.slice(j+1).replace(/\+/g," ")))}for(e in a)a.hasOwnProperty(e)&&
(f=c[e]||String,g=a[e],g instanceof Array||(g=[g]),b[e]=f===Boolean&&"false"==g[0]?!1:f.apply(this,g));return b};if("string"==typeof CueCard_urlPrefix)CueCard.urlPrefix=CueCard_urlPrefix;else{var b=CueCard.findScript(document,"cuecard-api.js");if(null==b){CueCard.error=Error("Failed to derive URL prefix for CueCard API code files");return}CueCard.urlPrefix=b.substr(0,b.indexOf("cuecard-api.js"))}CueCard.parseURLParameters(b,CueCard.params,{bundle:Boolean,externals:Boolean});CueCard.loaded=!0}();
CueCard.createComposition=function(b){var a=new CueCard.QueryEditor(b.queryEditorElement,b.queryEditorOptions),d=null,c=null;"outputPaneElement"in b&&(d=b.outputPaneOptions||{},d.queryEditor=a,d=new CueCard.OutputPane(b.outputPaneElement,d),a.setOutputPane(d));"controlPaneElement"in b&&(c=b.controlPaneOptions||{},c.queryEditor=a,null!=d&&(c.outputPane=d),c=new CueCard.ControlPane(b.controlPaneElement,c),a.setControlPane(c));return{queryEditor:a,outputPane:d,controlPane:c}};
CueCard.showDialog=function(b){var a=Array.prototype.slice.call(arguments);a.shift();var d=$("<div id='dialog-"+b+"' class='modal'></div>").acre(fb.acre.current_script.app.path+"/cuecard/mjt/dialogs.mjt",b,a);$(document.body).append(d.hide());d.overlay({load:!0,mask:{color:"#000",loadSpeed:200,opacity:0.5},close:".modal-buttons .button",closeOnClick:!1,onClose:function(){d.remove()}})};CueCard.MqlSyntax={};
CueCard.MqlSyntax.KeywordSuggestions=[{label:"*",hint:"(keyword)",qualifiedProperty:"*",result:"*"},{label:"connect",hint:"(keyword)",qualifiedProperty:"connect",result:"connect"},{label:"create",hint:"(keyword)",qualifiedProperty:"create",result:"create"},{label:"estimate-count",hint:"(keyword)",qualifiedProperty:"estimate-count",result:"estimate-count"},{label:"limit",hint:"(keyword)",qualifiedProperty:"limit",result:"limit"},{label:"optional",hint:"(keyword)",qualifiedProperty:"optional",result:"optional"},
{label:"return",hint:"(keyword)",qualifiedProperty:"return",result:"return"},{label:"sort",hint:"(keyword)",qualifiedProperty:"sort",result:"sort"}];
CueCard.MqlSyntax.KeywordValueHints={"*":{choices:[{label:"null",hint:"return a single value",result:null},{label:"[]",hint:"return a list of values",result:[],offset:1},{label:"{}",hint:"return a single object",result:{},offset:1},{label:"[{}]",hint:"return a list of objects",result:[{}],offset:2}]},connect:{choices:[{label:"insert",hint:"attach a value or object to a non-unique property, or attach the first value or object to a unique property",result:"insert"},{label:"update",hint:"attach a value or object to a unique property replacing any value or object that was previously connected",
result:"update"},{label:"replace",hint:"update unique properties and performs an insert for non-unique properties",result:"replace"},{label:"delete",hint:"detach a value or object from any property",result:"delete"}]},create:{choices:[{label:"unless_exists",hint:"look for a matching object and create it if it doesn't exist",result:"unless_exists"},{label:"unless_connected",hint:"look for a matching object connected to the parent query, and create and connect it if it doesn't exist",result:"unless_connected"},
{label:"unconditional",hint:"create the specified object without looking for a match (dangerous; ues carefully)",result:"unconditional"}]},"estimate-count":{choices:[{label:"null",hint:"(keyword)",result:null}]},limit:{html:'Use a positive integer to limit how many results to return, or <span class="cuecard-code">0</span> for all available results.'},optional:{choices:[{label:"true",hint:"(keyword)",result:!0},{label:"false",hint:"(keyword)",result:!1},{label:"required",hint:"(keyword)",result:"required"},
{label:"forbidden",hint:"(keyword)",result:"forbidden"}]},"return":{choices:[{label:"count",hint:"(keyword)",result:"count"},{label:"estimate-count",hint:"(keyword)",result:"estimate-count"}]},sort:{html:'Use a property name in the same query node. Prefix it with <span class="cuecard-code">-</span> to sort in descending order. For more complex ordering, see <a href="">this documentation</a>.'}};
CueCard.MqlSyntax.UniqueTopicValueSuggestions=[{label:"null",hint:"returns a single topic ID",result:null},{label:"{}",hint:"returns a single topic object with a default set of properties",result:{},offset:1},{label:'{ "id" : null, "name" : null }',hint:"returns a single topic object with id and name",result:{id:null,name:null}}];
CueCard.MqlSyntax.TopicValueSuggestions=[{label:"[]",hint:"returns a list of topic IDs or topic names",result:[],offset:1},{label:"[{}]",hint:"returns a list of topic objects with a default set of properties",result:[{}],offset:2},{label:'[{ "id" : null, "name" : null, "optional" : true, "limit" : 10 }]',hint:"returns an optional, limited list of topic objects with id and name",result:[{id:null,name:null,optional:!0,limit:10}]}];
CueCard.MqlSyntax.SingleValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "type" : null }',hint:"returns a value with type",result:{value:null,type:null}}];CueCard.MqlSyntax.UniqueStringLiteralValueSuggestions=[{label:"null",hint:"returns a single string",result:null},{label:'{ "value" : null, "lang" : null, "optional" : true }',hint:"returns a single string with more options",result:{value:null,lang:null,optional:!0}}];
CueCard.MqlSyntax.StringLiteralValueSuggestions=[{label:"[]",hint:"returns a list of strings",result:null},{label:'[{ "value" : null, "lang" : null, "optional" : true }]',hint:"returns a list of strings with more options",result:[{value:null,lang:null,optional:!0}]}];CueCard.MqlSyntax.UniqueLiteralValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "optional" : true }',hint:"returns a single value with more options",result:{value:null,optional:!0}}];
CueCard.MqlSyntax.LiteralValueSuggestions=[{label:"[]",hint:"returns a list of values",result:null},{label:'[{ "value" : null, "optional" : true }]',hint:"returns a list of values with more options",result:[{value:null,optional:!0}]}];CueCard.SerializingContext=function(b){this._parent=b;this._root=null==b?this:b.getRoot();this._properties={}};
CueCard.SerializingContext.prototype={getProperty:function(b){return b in this._properties?this._properties[b]:null!=this._parent?this._parent.getProperty(b):null},setProperty:function(b,a){this._properties[b]=a},getRoot:function(){return this._root},getRootProperty:function(b){return this.getRoot().getProperty(b)},setRootProperty:function(b,a){return this.getRoot().setProperty(b,a)},create:function(){return new SerializingContext(this)}};
CueCard.IndentWriter=function(b){this._context=b;this._stream=b.getProperty("stream")};
CueCard.IndentWriter.prototype={appendLineBreak:function(){this._stream.append("\n")},appendIndent:function(){for(var b=this._context.getRootProperty("indentLevel"),a=this._context.getRootProperty("indentString"),d=0;d<b;d++)this._stream.append(a)},indent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")+1)},unindent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")-1)},append:function(b){this._stream.append(b)}};
(function(){function b(a){return/["\\\x00-\x1f]/.test(a)?a.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=e[b];if(c)return c;c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)}):a}function a(a){return null!=a&&"object"==typeof a&&!(a instanceof Array)&&!("__identifier__"in a)}function d(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}function c(b){return 0==b.length||1==b.length&&a(b[0])&&!d(b[0])}var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",
'"':'\\"',"'":"\\'","\\":"\\\\"},f=CueCard.jsonize=function(a,c){var c=c?c:{},d="",e="quoteAllFieldNames"in c?c.quoteAllFieldNames:!0,l="variables"in c?c.variables:{},n="resolveVariables"in c?c.resolveVariables:!1;if("context"in c)var m=new CueCard.SerializingContext(c.context);else{var q="indentCount"in c?c.indentCount:4,o="",m=0;for(;m<q;m++)o+=" ";m=new CueCard.SerializingContext(null);m.setProperty("indentCount",q);m.setProperty("indentString",o);m.setProperty("indentLevel",0);m.setProperty("stream",
{append:function(a){d+=a}})}m.setProperty("omitWhitespace","omitWhitespace"in c?c.omitWhitespace:!1);m.setProperty("maxFieldLength","maxFieldLength"in c?c.maxFieldLength:15);m.setProperty("breakLines","breakLines"in c?c.breakLines:!0);m.setProperty("alignFieldValues","alignFieldValues"in c?c.alignFieldValues:!0);m.setProperty("collapseSingleObjectArray","collapseSingleObjectArray"in c?c.collapseSingleObjectArray:!0);m.setProperty("variables",l);m.setProperty("resolveVariables",n);m.setProperty("encodeJavascriptString",
"encodeJavascriptString"in c?c.encodeJavascriptString:b);m.setRootProperty("fieldNameEncoder",{_m:{},encode:function(a){if(a in this._m)return this._m[a];var c=b(a);return this._m[a]=c=e||/\W/.test(c)?'"'+c+'"':c}});m.setProperty("path",[]);m.setRootProperty("contextualize","contextualize"in c?c.contextualize:function(a){return a});l=new CueCard.IndentWriter(m);f.converters.anything(a,m,l);return d};f.converters={anything:function(a,b,c){if(null==a)f.converters["null"](a,b,c);else if(a instanceof
Array)f.converters.array(a,b,c);else if(a instanceof Object)f.converters.object(a,b,c);else f.converters[typeof a](a,b,c)},array:function(b,c,e){var k=c.getProperty("omitWhitespace"),l=c.getProperty("breakLines");if(0==b.length)e.append("[]");else{if(1==b.length&&a(b[0]))if(d(b[0])){if(c.getProperty("collapseSingleObjectArray")){e.append("[");var n=b[0];f.converters.object(n,c,e);e.append("]");return}}else{e.append("[{}]");return}e.append("[");l?(e.appendLineBreak(),e.indent()):k||e.append(" ");for(var m=
b.length,q=0;q<m;q++){var n=b[q],o=f.converters[null==n?"null":typeof n];o&&(l&&e.appendIndent(),o(n,c,e),q<m-1&&e.append(","),l?e.appendLineBreak():k||e.append(" "))}l&&(e.unindent(),e.appendIndent());e.append("]")}},"boolean":function(a,b,c){c.append(String(a))},"null":function(a,b,c){c.append("null")},undefined:function(a,b,c){c.append("undefined")},number:function(a,b,c){c.append(isFinite(a)?String(a):"null")},object:function(b,d,e){if(b instanceof Array)f.converters.array(b,d,e);else if("__identifier__"in
b){var b=b.__identifier__,k=d.getProperty("resolveVariables"),l=d.getProperty("variables");b in l?k?(k=l[b],f.converters.anything(k,d,e)):e.append(b):f.converters.anything(b,d,e)}else{var l=d.getRootProperty("contextualize"),n=d.getProperty("path"),m=d.getProperty("omitWhitespace"),q=d.getProperty("breakLines"),o=d.getProperty("alignFieldValues");e.append("{");q?(e.appendLineBreak(),e.indent()):m||e.append(" ");var p=0,r=0,s=d.getRootProperty("fieldNameEncoder"),u;for(u in b)if(b.hasOwnProperty(u)&&
(k=b[u],p++,!a(k)&&(!(null!=k&&k instanceof Array)||c(k))))r=Math.max(r,s.encode(u).length);r=Math.min(r,d.getProperty("maxFieldLength"));for(u in b)if(b.hasOwnProperty(u)){var k=b[u],t=f.converters[null==k?"null":typeof k],v=s.encode(u);q&&e.appendIndent();e.append(v);e.append(m?":":": ");if(!m&&q&&o&&!a(k)&&(!(null!=k&&k instanceof Array)||c(k)))for(v=v.length;v<r;v++)e.append(" ");n.unshift({field:u});t(k,l(d,n),e);n.shift();p--;0<p&&e.append(",");q?e.appendLineBreak():m||e.append(" ")}q&&(e.unindent(),
e.appendIndent());e.append("}")}},string:function(a,b,c){c.append('"'+b.getProperty("encodeJavascriptString")(a)+'"')},"null":function(a,b,c){c.append("null")}}})();CueCard.QueryParser={};
CueCard.QueryParser.parseForContext=function(b,a,d,c){var e=new CueCard.QueryTokenizer(b,a),f=e.token(),g=[],h=CueCard.Token.Types,j=function(){f=0==g.length?e.next():g.shift()},k=function(a){if(0==a)return f;for(;a>g.length;)g.push(e.next());return g[a-1]},l=function(){for(;null!=f&&(f.type==h.whitespace||f.type==h.unrecognized);)j()},n=function(a){return new CueCard.Token(CueCard.Token.Types.phantom,"",a.start,a.start)},m=function(){return null!=f?f:new CueCard.Token(CueCard.Token.Types.phantom,
"",e.index(),e.index())},q=function(){var a=new CueCard.QueryNode(CueCard.QueryNode.TYPE_MISSING);a.startToken=a.endToken=n(m());return a},o=function(a){a=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL);a.startToken=f;for(null!=f&&(f.type==h.delimiter&&"{"==f.content)&&j();null!=f;){l();if(null==f)break;var b=null,c=null,d=null;f.type==h.identifier?(b=f.content,c=f,j(),l()):f.type==h.stringLiteral?(b=f.content.replace(/^['"]/,"").replace(/['"]$/,""),c=f,j(),l()):c=n(f);if(null!=f&&f.type==
h.delimiter&&(":"==f.content||";"==f.content))j(),l();null!=f&&(d=s(!1));if(null!=b||null!=d)b=new CueCard.QueryNodeLink(null!=b?b:"",c),b.value=null!=d?d:q(),a.links.push(b);l();if(null==f||f.type==h.delimiter&&("}"==f.content||"]"==f.content))break;f.type==h.delimiter&&","==f.content&&j()}null!=f&&(f.type==h.delimiter&&"}"==f.content)&&(a.endToken=f,j());null==a.endToken&&(a.endToken=m());return a},p=function(){var a=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY);a.startToken=f;
a.elements=[];for(null!=f&&(f.type==h.delimiter&&"["==f.content)&&j();null!=f;){l();if(null==f||f.type==h.delimiter&&"]"==f.content)break;a.elements.push(o());l();null!=f&&(f.type==h.delimiter&&","==f.content)&&j()}null!=f&&(f.type==h.delimiter&&"]"==f.content)&&(a.endToken=f,j());null==a.endToken&&(a.endToken=m());return a},r=function(){for(var a=1,b;null!=(b=k(a))&&(b.type==h.whitespace||b.type==h.unrecognized);)a++;if(null!=b){if(b.type==h.delimiter&&"{"==b.content)return p();if(b.type==h.identifier||
b.type==h.stringLiteral){for(a++;null!=(b=k(a))&&(b.type==h.whitespace||b.type==h.unrecognized);)a++;if(null!=b&&b.type==h.delimiter&&":"==b.content)return p()}}a=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);a.startToken=f;a.isArray=!0;a.value=[];for(null!=f&&(f.type==h.delimiter&&"["==f.content)&&j();null!=f;){l();if(null==f||f.type==h.delimiter&&"]"==f.content)break;b=s(!1);if(null==b)break;a.value.push(b);l();null!=f&&(f.type==h.delimiter&&","==f.content)&&j()}null!=f&&(f.type==h.delimiter&&
"]"==f.content)&&(a.endToken=f,j());null==a.endToken&&(a.endToken=m());return a},s=function(a){l();if(null==f)return q();if(f.type==h.delimiter)return"["==f.content?r():"{"==f.content?o():q();if(a)return p();a:{a=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);a.startToken=a.endToken=f;a.isArray=!1;if(f.type==h.numberLiteral)a.value=parseFloat(f.content);else if(f.type==h.stringLiteral)a.value=f.content.replace(/^['"]/,"").replace(/['"]$/,"");else if(f.type==h.booleanLiteral)a.value="true"==
f.content||"True"==f.content;else if(f.type==h.nullLiteral)a.value=null;else if(f.type==h.delimiter){a=null;break a}else a.value=f.content;j()}return a},u=function(a){return d<a.start.line||d==a.start.line&&c<=a.start.col},t=function(a){return d>a.start.line||d==a.start.line&&c>=a.start.col},v=function(a){return d<a.end.line||d==a.end.line&&c<=a.end.col},u=function(a){return d<a.start.line||d==a.start.line&&c<=a.start.col},z=function(a){return a.startToken==a.endToken?t(a.startToken)&&v(a.startToken):
t(a.startToken)&&u(a.endToken)},y=function(a,b){if(a.type==CueCard.QueryNode.TYPE_TERMINAL)if(a.isArray){for(var d=0;d<a.value.length;d++){var e=a.value[d];if(u(e.startToken)){b.push({child:d,relative:"before",node:a});return}if(z(e)){b.push({child:d,relative:"inside",node:a});y(e,b);return}}b.push({child:a.value.length,relative:"before",node:a})}else b.push({token:a.startToken,node:a,offset:c-a.startToken.start.col});else if(a.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){for(d=0;d<a.elements.length;d++){e=
a.elements[d];if(u(e.startToken)){b.push({child:d,relative:"before",node:a});return}if(z(e)){b.push({child:d,relative:"inside",node:a});y(e,b);return}}b.push({child:a.elements.length,relative:"before",node:a})}else if(a.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(d=0;d<a.links.length;d++){e=a.links[d];if(u(e.token)){b.push({child:d,relative:"before",node:a});return}if(v(e.token)){b.push({child:d,relative:"path",node:a,offset:c-e.token.start.col});return}if(t(e.value.startToken)){if(v(e.value.endToken)){b.push({child:d,
relative:"inside",node:a});y(e.value,b);return}}else{b.push({child:d,relative:"space",node:a});return}}b.push({child:a.links.length,relative:"before",node:a})}else b.push({token:a.startToken,node:a})};l();b={model:s(!0),context:[]};y(b.model,b.context);return b};CueCard.QueryTokenizer=function(b,a){this._text=b+" ";this._maxIndex=b.length;this._index=a;this._col=this._line=0;this.next()};CueCard.QueryTokenizer.prototype.token=function(){return this._token};CueCard.QueryTokenizer.prototype.index=function(){return this._index};
CueCard.QueryTokenizer._whitespaces=" \t\r\n";
CueCard.QueryTokenizer.prototype.next=function(){this._token=null;if(this._index<this._maxIndex){var b=this._text.charAt(this._index),a=this._text.charAt(this._index+1),d=this,c=function(){d._index++;d._col++},e=function(){return new CueCard.TokenPos(d._index,d._line,d._col)},f=function(){var a=e();c();return a},g=function(a,b,c){var f=e();d._pos=f;d._token=new CueCard.Token(a,c||d._text.substring(b.offset,f.offset),b,f)},h=function(a){var f=e();"u"==b&&c();c();for(var h="";d._index<d._maxIndex;){b=
d._text.charAt(d._index);if(b==a){c();break}else if("\r"==b||"\n"==b)break;"\\"==b?(c(),h+=d._text.charAt(d._index)):h+=b;c()}g(CueCard.Token.Types.stringLiteral,f,h)};if(0<=CueCard.QueryTokenizer._whitespaces.indexOf(b)){for(a=e();d._index<d._maxIndex;){f=d._text.charAt(d._index);if(0>CueCard.QueryTokenizer._whitespaces.indexOf(f))break;"\n"==f?(d._line++,d._col=0):d._col++;d._index++}g(CueCard.Token.Types.whitespace,a)}else if(0<="[{}],:".indexOf(b))g(CueCard.Token.Types.delimiter,f());else if('"'==
b||"'"==b)h(b);else if("u"==b&&('"'==a||"'"==a))h(a);else if("-"==b||"+"==b||CueCard.QueryTokenizer._isDigit(b)){a=e();for("+"==b?c():"-"==b&&c();d._index<d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c();if(d._index<d._maxIndex&&"."==d._text.charAt(d._index))for(c();d._index<d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c();if(d._index<d._maxIndex&&"e"==d._text.charAt(d._index)){c();b=d._text.charAt(d._index);for(("+"==b||"-"==b)&&c();d._index<
d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c()}g(CueCard.Token.Types.numberLiteral,a)}else if("*"==b)g(CueCard.Token.Types.identifier,f());else if(0<=CueCard.QueryTokenizer._identifierPrefix.indexOf(b)){for(a=e();d._index<d._maxIndex&&0<=CueCard.QueryTokenizer._identifierPrefix.indexOf(d._text.charAt(d._index));)c();f=!1;if(d._index<d._maxIndex-2&&(h=d._text.substr(d._index,2),">="==h||"<="==h||"~="==h))c(),c(),f=!0;!f&&d._index<d._maxIndex-1&&(h=d._text.substr(d._index,
1),(">"==h||"<"==h)&&c());f=e();h=d._text.substring(a.offset,f.offset);d._pos=f;d._token="null"==h||"None"==h?new CueCard.Token(CueCard.Token.Types.nullLiteral,h,a,f):"true"==h||"True"==h||"false"==h||"False"==h?new CueCard.Token(CueCard.Token.Types.booleanLiteral,h,a,f):new CueCard.Token(CueCard.Token.Types.identifier,h,a,f)}else g(CueCard.Token.Types.unrecognized,f())}return this._token};CueCard.QueryTokenizer._isDigit=function(b){return 0<="0123456789".indexOf(b)};
CueCard.QueryTokenizer._identifierPrefix="#!/_-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";CueCard.TokenPos=function(b,a,d){this.offset=b;this.line=a;this.col=d};CueCard.Token=function(b,a,d,c){this.type=b;this.content=a;this.start=d;this.end=c};CueCard.Token.Types={unrecognized:-1,phantom:0,whitespace:1,delimiter:2,nullLiteral:3,numberLiteral:4,stringLiteral:5,booleanLiteral:6,identifier:7};
CueCard.QueryNode=function(b){this.type=b;this.value=null;this.isArray=!1;this.endToken=this.startToken=null;this.links=[]};CueCard.QueryNode.TYPE_MISSING=-1;CueCard.QueryNode.TYPE_TERMINAL=0;CueCard.QueryNode.TYPE_NONTERMINAL=1;CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY=2;CueCard.QueryNode.prototype.toQueryJson=function(b){b=b||{};"qualifyAllProperties"in b||(b.qualifyAllProperties=!1);"excludeChild"in b||(b.excludeChild=-1);return this._toQueryJson(b)};
CueCard.QueryNode.prototype._toQueryJson=function(b){var a={qualifyAllProperties:b.qualifyAllProperties,excludeChild:-1};if(this.type==CueCard.QueryNode.TYPE_TERMINAL){if(this.isArray){for(var b=[],d=0;d<this.value.length;d++){var c=this.value[d];b.push(null!=c?c._toQueryJson(a):null)}return b}return this.startToken.type==CueCard.Token.Types.identifier?{__identifier__:this.value}:this.value}if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){b=[];for(d=0;d<this.elements.length;d++)b.push(this.elements[d]._toQueryJson(a));
return b}if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var c={},e=!1,f=0,d=0;d<this.links.length;d++)if(d!=b.excludeChild){var g=this.links[d];if(0<g.path.length){var h=g.getPath(b.qualifyAllProperties);if(h in c&&0==g.namespace.length)for(;h in c;)g.namespace="ns"+f++ +":",h=g.getPath(b.qualifyAllProperties);var j=null!=g.value?g.value._toQueryJson(a):null;c[h]=j;if("/type/object/type"==g.getUnnamespacedQualifiedPath()&&null!=j&&(!(j instanceof Array)||0<j.length))e=!0}}if(!e&&"expectedTypes"in
b&&0<b.expectedTypes.length){a=[];for(d=0;d<b.expectedTypes.length;d++)e=b.expectedTypes[d],"/type/object"!=e&&"/common/topic"!=e&&a.push(e);1==a.length?c.type=a[0]:1<a.length&&(c["type|="]=a)}return c}return null};CueCard.QueryNode.isMqlKeyword=function(b){switch(b){case "limit":case "sort":case "*":case "return":case "count":case "estimate-count":case "optional":case "create":case "connect":return!0}return!1};
CueCard.QueryNode.prototype.getDeclaredTypes=function(b){var a=null;this.type==CueCard.QueryNode.TYPE_NONTERMINAL?a=this.links:this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY&&(a=this.elements[0].links);if(null!=a)for(var d=0;d<a.length;d++){var c=a[d];"/type/object/type"==c.qualifiedProperty&&!c.reverse&&c.getValuesOfType(b,"string")}};
CueCard.QueryNode.prototype.getDeclaredIDs=function(b){var a=null;this.type==CueCard.QueryNode.TYPE_NONTERMINAL?a=this.links:this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY&&(a=this.elements[0].links);if(null!=a)for(var d=0;d<a.length;d++){var c=a[d];"/type/object/id"==c.qualifiedProperty&&!c.reverse&&c.getValuesOfType(b,"string")}};
CueCard.QueryNode.prototype.getDeclaredGUIDs=function(b){var a=null;this.type==CueCard.QueryNode.TYPE_NONTERMINAL?a=this.links:this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY&&(a=this.elements[0].links);if(null!=a)for(var d=0;d<a.length;d++){var c=a[d];"/type/object/guid"==c.qualifiedProperty&&!c.reverse&&c.getValuesOfType(b,"string")}};CueCard.QueryNode.prototype.qualifyAllProperties=function(b){this._qualifyAllProperties([],{},b)};
CueCard.QueryNode.prototype._qualifyAllProperties=function(b,a,d){if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var c=[],e=!1,f=[],g=[],h=[],j=0;j<this.links.length;j++){var k=this.links[j];(k.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||k.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY||k.value.type==CueCard.QueryNode.TYPE_MISSING)&&c.push(k);if("/type/object/type"==k.qualifiedProperty&&!k.reverse)k.getValuesOfType(f,"string");else if("/type/object/id"==k.qualifiedProperty&&!k.reverse)k.getValuesOfType(g,
"string");else if("/type/object/guid"==k.qualifiedProperty&&!k.reverse)k.getValuesOfType(h,"string");else if(null!=k.qualifiedProperty&&0<k.qualifiedProperty.length){var l=k.qualifiedProperty.lastIndexOf("/");0<l&&f.push(k.qualifiedProperty.substr(0,l))}else CueCard.QueryNode.isMqlKeyword(k.property)||(e=!0)}f=f.concat(b);k={};for(j=f.length-1;0<=j;j--)k[f[j]]=!0;var f=[],n;for(n in k)f.push(n);if(!e&&0==c.length)d.onDone(a);else{var m=this,e=[];0<f.length&&e.push("t="+encodeURIComponent(f.join(",")));
0<g.length&&e.push("i="+encodeURIComponent(g.join(",")));0<h.length&&e.push("g="+encodeURIComponent(h.join(",")));f=CueCard.helper+"qualify-properties.ajax?"+e.join("&");$.ajax(f,{dataType:"json",success:function(b){for(var b=b.result,e=b.properties,b=b.qualifications,f=0;f<m.links.length;f++){var g=m.links[f];0==g.qualifiedProperty.length&&!CueCard.QueryNode.isMqlKeyword(g.property)&&(g.qualifiedProperty=b[g.property]||g.property)}for(var h in e)a[h]=e[h];(function(){if(0==c.length)d.onDone(a);else{var b=
c.shift(),f=[];if(b.qualifiedProperty in e)for(var g=e[b.qualifiedProperty].expectedTypes,m=0;m<g.length;m++)f.push(g[m].id);f.push("/common/topic");f.push("/type/object");if(b.value.type==CueCard.QueryNode.TYPE_NONTERMINAL)b.value.expectedTypes=f;else if(b.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){g=b.value.elements;for(m=0;m<g.length;m++)g[m].expectedTypes=f}b.value._qualifyAllProperties(f,a,{onDone:arguments.callee,onError:d.onError})}})()},error:d.onError})}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){var j=
0,q=this.elements;(function(){if(j<q.length)q[j++]._qualifyAllProperties(b,a,{onDone:arguments.callee,onError:d.onError});else d.onDone(a)})()}else d.onDone()};CueCard.QueryNode.prototype.getCursorFromContext=function(b){return this._getCursorFromContext(b,0)};
CueCard.QueryNode.prototype._getCursorFromContext=function(b,a){var d=b[a];if(this.type==CueCard.QueryNode.TYPE_MISSING){var c=this.startToken;return{line:c.start.line,col:c.start.col}}if(this.type==CueCard.QueryNode.TYPE_TERMINAL){if(this.isArray){if("inside"==d.relative){if(d.child<this.value.length)return this.value[d.child]._getCursorFromContext(b,a+1);c=this.endToken;return{line:c.start.line,col:c.start.col}}if(d.child<this.value.length)return d=this.value[d.child],c=d.startToken,{line:c.start.line,
col:c.start.col};c=this.startToken;return{line:c.end.line,col:c.end.col}}c=this.startToken;return{line:c.start.line,col:c.start.col+("offset"in d?d.offset:0)}}if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){if("inside"==d.relative){if(d.child<this.elements.length)return this.elements[d.child]._getCursorFromContext(b,a+1);c=this.endToken;return{line:c.start.line,col:c.start.col}}if(d.child<this.elements.length)return d=this.elements[d.child],c=d.startToken,{line:c.start.line,col:c.start.col};
c=this.startToken;return{line:c.end.line,col:c.end.col}}if("inside"==d.relative){if(d.child<this.links.length)return this.links[d.child].value._getCursorFromContext(b,a+1);c=this.endToken;return{line:c.start.line,col:c.start.col}}if("before"==d.relative){if(d.child<this.links.length)return d=this.links[d.child].value,c=d.startToken,{line:c.start.line,col:c.start.col};c=this.startToken;return{line:c.end.line,col:c.end.col}}if(d.child<this.links.length){if("path"==d.relative)return c=this.links[d.child].token,
{line:c.start.line,col:c.start.col+("offset"in d?d.offset:0)};c=this.links[d.child].value.startToken;return{line:c.start.line,col:c.start.col}}c=this.endToken;return{line:c.end.line,col:c.end.col}};CueCard.QueryNode.prototype.toInsideOutQueryJson=function(b,a){var d=this;this.qualifyAllProperties({onDone:function(){a.onDone(d._toInsideOutQueryJson(b,0,null,null))},onError:a.onError})};
CueCard.QueryNode.prototype._toInsideOutQueryJson=function(b,a,d,c){null!=d&&!(c instanceof Array)&&(c=[c]);if(a<b.length){var e=b[a];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in e&&"inside"==e.relative){var f=e.child;if(f<this.links.length&&(e=this.links[f],e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)){var g=e.getInverseQualifiedPath(),f=this.toQueryJson({excludeChild:f});null!=d&&(f instanceof Array?f[0][d]=c:f[d]=c);
return e.value._toInsideOutQueryJson(b,a+1,g,f)}}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY&&"child"in e&&"inside"==e.relative){f=e.child;if(1<this.elements.length)throw Error("Cannot turn a query inside out if a query node has siblings");return 0==f?(b=this.elements[f]._toInsideOutQueryJson(b,a+1,d,c),b instanceof Array?b:[b]):null}}b=this.toQueryJson({expectedTypes:"expectedTypes"in this?this.expectedTypes:[]});null!=d&&(typeof b==Array?b[0][d]=c:b[d]=c);return b};
CueCard.QueryNode.prototype.locateInnerMostNonTerminal=function(b,a){var d=this;this.qualifyAllProperties({onDone:function(){var c=d._locateInnerMostNonTerminal(b,0);a.onDone(null!=c?c:{node:d,property:null,reverse:!1})},onError:a.onError})};
CueCard.QueryNode.prototype._locateInnerMostNonTerminal=function(b,a){if(a<b.length){var d=b[a];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in d&&"inside"==d.relative&&(d=d.child,d<this.links.length)){var c=this.links[d];if(c.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||c.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)return d=c.value._locateInnerMostNonTerminal(b,a+1),null==d&&(d={node:c.value}),"property"in d||(d.property=c.qualifiedProperty,d.reverse=c.reverse),d}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY&&("child"in d&&"inside"==d.relative)&&(d=d.child,d<this.elements.length))return c=this.elements[d],d=c._locateInnerMostNonTerminal(b,a+1),null==d&&(d={node:c}),d}return null};
CueCard.QueryNodeLink=function(b,a){this.path=b;this.token=a;this.reverse=!1;this.suffix=this.qualifiedProperty=this.originalProperty=this.property=this.namespace="";this.value=null;0<b.length&&"!"==b.charAt(0)&&(this.reverse=!0,b=b.substr(1));if(0<b.length){var d=b.indexOf(":");0<=d&&(this.namespace=b.substr(0,d+1),b=b.substr(d+1),0<b.length&&"!"==b.charAt(0)&&(this.reverse=!0,b=b.substr(1)))}if(2<=b.length&&(d=b.substr(b.length-2),">="==d||"<="==d||"~="==d))this.suffix=d,b=b.substr(0,b.length-2);
if(1<b.length&&""==this.suffix&&(d=b.substr(b.length-1),"<"==d||">"==d))this.suffix=d,b=b.substr(0,b.length-1);this.originalProperty=b;0<b.length&&("/"==b.charAt(0)?(this.qualifiedProperty=b,d=b.lastIndexOf("/"),this.property=b.substr(d+1)):this.property=b);""==this.qualifiedProperty&&("type"==this.property?this.qualifiedProperty="/type/object/type":"id"==this.property?this.qualifiedProperty="/type/object/id":"guid"==this.property?this.qualifiedProperty="/type/object/guid":"name"==this.property?this.qualifiedProperty=
"/type/object/name":"lang"==this.property?this.qualifiedProperty="/type/text/lang":CueCard.QueryNode.isMqlKeyword(this.property)&&(this.qualifiedProperty=this.property))};CueCard.QueryNodeLink.prototype.getQualifiedPath=function(){return(this.reverse?"!":"")+this.namespace+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getInverseQualifiedPath=function(){return(this.reverse?"":"!")+this.namespace+this.qualifiedProperty+this.suffix};
CueCard.QueryNodeLink.prototype.getUnnamespacedQualifiedPath=function(){return(this.reverse?"!":"")+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getPath=function(b){return(this.reverse?"!":"")+this.namespace+(b&&0<this.qualifiedProperty.length?this.qualifiedProperty:this.originalProperty)+this.suffix};
CueCard.QueryNodeLink.prototype.getValuesOfType=function(b,a){var d=function(c){if(c.isArray)for(var c=c.value,d=0;d<c.length;d++){var e=c[d];e.type==CueCard.QueryNode.TYPE_TERMINAL&&(null!=e.value&&typeof e.value==a)&&b.push(e.value)}else null!=c.value&&typeof c.value==a&&b.push(c.value)},c=this.value;if(c.type==CueCard.QueryNode.TYPE_TERMINAL)d(c);else if(c.type==CueCard.QueryNode.TYPE_NONTERMINAL||c.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)for(var c=c.type==CueCard.QueryNode.TYPE_NONTERMINAL?
c.links:c.elements[0].links,e=0;e<c.length;e++){var f=c[e];"/type/value/value"==f.qualifiedProperty&&f.value.type==CueCard.QueryNode.TYPE_TERMINAL&&d(f.value)}};CueCard.UI={};CueCard.UI.reportError=function(b){try{console.log(b)}catch(a){alert(b)}};CueCard.UI.createBlockingContinuations=function(b,a){return new CueCard.UI.Cont(b,a)};
CueCard.UI.Cont=function(b,a){var d=this;this._onDone=b;this._onError=a||CueCard.UI.reportError;this._progressUI=null;this._cleanedUp=this._canceled=!1;this.cleanUp=function(){d._cleanedUp||(d._cleanedUp=!0,null!=d._progressUI&&(d._progressUI.remove(),d._progressUI=null))};this.cancel=function(){d._canceled||(d._canceled=!0,d.cleanUp())};this.onError=function(){d.cleanUp();d._onError()};this.onDone=function(){var a=!1;if(!d._canceled){for(var a=[d],b=0;b<arguments.length;b++)a.push(arguments[b]);
a=d._onDone.apply(null,a)}a||d.cleanUp()};window.setTimeout(function(){d._cleanedUp||(d._progressUI=$('<div class="cuecard-progress">Working...</div>').appendTo($(document.body)))},300)};CueCard.UI.Cont.prototype.isCanceled=function(){return this._canceled};CueCard.UI.Cont.prototype.extend=function(b,a){this._onDone=b;this._onError=a||this._onError;return this};
CueCard.Popup=function(b,a,d,c,e){this._left=b;this._top=a;this._height=d;this._windows=c;this._handlers=e||{};this._pendingContinuations=[];this.elmt=$('<div class="cuecard-popup-container"></div>').css("top",this._top+this._height+"px").css("left",this._left+"px").appendTo("body");this._addEventHandlers()};CueCard.Popup.prototype.addPendingContinuation=function(b){this._pendingContinuations.push(b)};
CueCard.Popup.prototype.reposition=function(){var b=this.elmt.height(),a=this.elmt.width();this._top+this._height+b>=$(window).height()?this.elmt.css("top",this._top-b-5+"px"):this.elmt.css("top",this._top+this._height+"px");this._left+a>=$(window).width()?this.elmt.css("left",$(window).width()-a-25+"px"):this.elmt.css("left",this._left+"px")};CueCard.Popup.prototype.close=function(){this._remove();this._pendingContinuations=null};
CueCard.Popup.prototype.cancel=function(){null!=this.elmt&&(this._remove(),this._cancelPendingContinuations(),this._pendingContinuations=null)};CueCard.Popup.prototype._remove=function(){this._removeEventHandlers();this.elmt.remove();this.elmt=null};CueCard.Popup.prototype._cancelPendingContinuations=function(){for(var b=0;b<this._pendingContinuations.length;b++)try{this._pendingContinuations[b].cancel()}catch(a){}this._pendingContinuations=[]};
CueCard.Popup.prototype._addEventHandlers=function(){var b=this;this._handleKeyDown=function(a){return b._onKeyDown(a)};this._handleMouseDown=function(a){return b._onMouseDown(a)};for(var a=0;a<this._windows.length;a++){var d=this._windows[a];try{$(d.document).keydown(this._handleKeyDown).mousedown(this._handleMouseDown)}catch(c){alert("Unable to install keyup handler on codemirror window")}}};
CueCard.Popup.prototype._removeEventHandlers=function(){for(var b=0;b<this._windows.length;b++){var a=this._windows[b];try{$(a.document).unbind("keydown",this._handleKeyDown).unbind("mousedown",this._handleMouseDown)}catch(d){alert("Unable to install keyup handler on codemirror window")}}};CueCard.Popup.prototype._onKeyDown=function(b){if(27==b.keyCode&&(this.cancel(),"onCancel"in this._handlers))this._handlers.onCancel("key")};
CueCard.Popup.prototype._onMouseDown=function(b){if(this.mouseEventOutsidePopup(b)&&(this.cancel(),"onCancel"in this._handlers))this._handlers.onCancel("mouse")};CueCard.Popup.prototype.mouseEventOutsidePopup=function(b){if(b.currentTarget!=this.elmt[0].ownerDocument)return!0;var a=this.elmt.offset();return b.pageX<a.left||b.pageX>a.left+this.elmt.width()||b.pageY<a.top||b.pageY>a.top+this.elmt.height()?!0:!1};
CueCard.TypeBasedTopicSuggestor=function(b,a,d,c,e){this._popup=b;this._defaultSuggestions=a;this._expectedTypes=d;this._desiredProperty=c;this._onCommit=e;this._popup.elmt.addClass("cuecard-popup-container-wide")};
CueCard.TypeBasedTopicSuggestor.prototype.getSuggestions=function(b,a){b=b.toLowerCase();if(0==b.length){for(var d=[],c=0;c<this._defaultSuggestions.length;c++)d.push(this._defaultSuggestions[c]);a(d)}else{var e=this,d=CueCard.UI.createBlockingContinuations(function(b,c){for(var d=c.result,j=[],k=0;k<d.length;k++){var l=d[k];l.imageURL=null;"/common/topic/image"in l&&(null!=l["/common/topic/image"]&&0<l["/common/topic/image"].length)&&(l.imageURL=CueCard.freebaseServiceUrl+"api/trans/image_thumb"+
l["/common/topic/image"][0].id+"?mode=fillcrop&maxwidth=40&maxheight=40");j.push({result:l[e._desiredProperty],elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}"><table cellpadding="0" cellspacing="0"><tr valign="top"><td valign="top">'+(null==l.imageURL?'<div class="cuecard-suggestion-thumbnail-empty"> </div>':'<img src="'+l.imageURL+'" />')+'</td><td valign="top">'+l.name+'<div class="cuecard-suggestion-id">'+l[e._desiredProperty]+"</div></td></tr></table></a>")})}a(j)});this._popup.addPendingContinuation(d);
c=CueCard.helper+"suggest-values-of-types?t="+encodeURIComponent(this._expectedTypes.join(","))+"&q="+encodeURIComponent(b);$.ajax(c,{dataType:"json",success:d.onDone,error:d.onError})}};CueCard.TypeBasedTopicSuggestor.prototype.commit=function(b){this._onCommit(b)};CueCard.StaticChoicesSuggestor=function(b,a){this._defaultSuggestions=b;this._onCommit=a};
CueCard.StaticChoicesSuggestor.prototype.getSuggestions=function(b,a){for(var b=b.toLowerCase(),d=[],c=0;c<this._defaultSuggestions.length;c++){var e=this._defaultSuggestions[c];(0==b.length||0<=e.label.toLowerCase().indexOf(b))&&d.push(e)}a(d)};CueCard.StaticChoicesSuggestor.prototype.commit=function(b){this._onCommit(b)};CueCard.PropertySuggestor=function(b,a,d,c){this._popup=b;this._defaultSuggestions=a;this._entries=d;this._onCommit=c};
CueCard.PropertySuggestor.prototype.getSuggestions=function(b,a){for(var b=b.toLowerCase(),d=[],c={},e=0;e<this._entries.length;e++){var f=this._entries[e];if(0==b.length)d.push(f);else if(0<=f.label.toLowerCase().indexOf(b))d.push(f);else for(var g=0;g<f.expectedTypes.length;g++){var h=f.expectedTypes[g];if(0<=h.name.toLowerCase().indexOf(b)){d.push({label:f.label,hint:f.hint+" &rarr; type "+h.id,qualifiedProperty:f.qualifiedProperty,result:f.result,offset:f.offset,extent:f.extent});c[f.qualifiedProperty]=
!0;break}}}for(e=0;e<this._defaultSuggestions.length;e++)f=this._defaultSuggestions[e],(0==b.length||0<=f.label.toLowerCase().indexOf(b))&&d.push(f);3>b.length&&3<d.length?a(d):(e=CueCard.UI.createBlockingContinuations(function(b,e){for(var f=e.result,g=0;g<f.length;g++){var m=f[g];if(!(m.id in c)&&"/type/property/schema"in m&&null!=m["/type/property/schema"]&&0<m["/type/property/schema"].length&&"key"in m&&null!=m.key&&0<m.key.length){var h="/type/property/expected_type"in m&&null!=m["/type/property/expected_type"]?
m["/type/property/expected_type"]:[],o={label:m.key[0],hint:"of type "+m["/type/property/schema"][0].id,qualifiedProperty:m.id,expectedTypes:h};CueCard.QueryEditor.setPropertySuggestionSuffix(0<h.length?h[0]:"",o,o["/type/property/unique"],'"'+m.id+'" : ');d.push(o)}}a(d)}),this._popup.addPendingContinuation(e),f=CueCard.helper+"suggest-arbitrary-properties.ajax?q="+encodeURIComponent(b),$.ajax(f,{dataType:"json",success:e.onDone,error:e.onError}))};CueCard.PropertySuggestor.prototype.commit=function(b){this._onCommit(b)};
CueCard.TypeSuggestor=function(){};CueCard.TypeSuggestor.prototype.getSuggestions=function(){};
CueCard.SuggestionController=function(b,a,d,c){this._popup=b;this._suggestor=d;this._lastText=c;this._selectedIndex=-1;this._suggestions=[];this._input=$('<input value="'+c+'" />');this._suggestionContainer=$('<div class="cuecard-suggestion-container"></div>');$(a).append($('<div class="cuecard-suggestion-input-container"></div>').append(this._input)).append(this._suggestionContainer);var e=this;this._onKeyUp=function(a){if(!a.shiftKey&&!a.metaKey&&!a.ctrlKey){if(36==a.keyCode||38==a.keyCode||40==
a.keyCode)return e._cancelEvent(a);a=e._input[0].value;a!=e._lastText&&(e._lastText=a,e._updateSuggestions())}};this._onKeyDown=function(a){for(;!a.shiftKey&&!a.metaKey&&!a.ctrlKey;){if(13==a.keyCode||9==a.keyCode)e._commitSelectedSuggestion();else if(36==a.keyCode)0<e._suggestions.length&&e._selectSuggestion(0,!0);else if(38==a.keyCode)0<e._selectedIndex&&e._selectSuggestion(e._selectedIndex-1,!0);else if(40==a.keyCode)e._selectedIndex<e._suggestions.length-1&&e._selectSuggestion(e._selectedIndex+
1,!0);else break;return e._cancelEvent(a)}if("onKeyDown"in e._suggestor)return e._suggestor.onKeyDown(a,e._input[0].value)};this._input.keyup(this._onKeyUp).keydown(this._onKeyDown);b=this._input[0];b.setSelectionRange?(b.focus(),b.setSelectionRange(c.length,c.length)):b.createTextRange&&(b=b.createTextRange(),b.collapse(!0),b.moveEnd("character",c.length),b.moveStart("character",c.length),b.select());this._input[0].focus();this._updateSuggestions()};
CueCard.SuggestionController.prototype._updateSuggestions=function(){this._suggestionContainer.empty();this._suggestionContainer.html('<div class="cuecard-suggestion-progress">Please wait...</div>');this._selectedIndex=-1;this._suggestions.length=0;var b=this;this._suggestor.getSuggestions(this._lastText,function(a){b._renderSuggestions(a,b._lastText)})};
CueCard.SuggestionController.prototype._renderSuggestions=function(b){var a=this._suggestionContainer;a.empty();var d=this,c=function(b,c){("elmt"in b?b.elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}">'+b.label+("hint"in b?' <span class="cuecard-suggestion-hint">'+b.hint+"</span>":"")+"</a>")).mouseover(function(){d._selectSuggestion(c,!1)}).click(function(){d._commitSelectedSuggestion()}).appendTo(a)};this._suggestions=b;for(var e=0;e<b.length;e++)c(b[e],e);0<this._suggestions.length?
this._selectSuggestion(0,!1):$('<div class="cuecard-suggestion-noEntryMessage">No suggestion available.<br/>Press Enter to keep what you have typed,<br/>ESC to discard it.</div>').appendTo(a);this._popup.reposition()};
CueCard.SuggestionController.prototype._selectSuggestion=function(b,a){0<=this._selectedIndex&&this._getSuggestion(this._selectedIndex).removeClass("cuecard-suggestion-selected");this._selectedIndex=b;this._getSuggestion(this._selectedIndex).addClass("cuecard-suggestion-selected");a&&this._getSuggestion(this._selectedIndex)[0].scrollIntoView(!1)};
CueCard.SuggestionController.prototype._commitSelectedSuggestion=function(){0<=this._selectedIndex?this._suggestor.commit(this._suggestions[this._selectedIndex]):this._suggestor.commit(this._input[0].value)};CueCard.SuggestionController.prototype._getSuggestion=function(b){return $(this._suggestionContainer.children()[b])};CueCard.SuggestionController.prototype._cancelEvent=function(b){b.returnValue=!1;b.cancelBubble=!0;"preventDefault"in b&&b.preventDefault();return!1};
CueCard.QueryEditor=function(b,a){this._container=b;this._options=a;this._controlPane=this._outputPane=null;this._assistKeyComboDetected=this._warnWrites=!1;this._popup=null;var d=this,c="[{\n  \n}]",e=1,f=2;"content"in a&&(c=a.content,f=e=0);c={basefiles:[],parserConfig:{json:!0},height:"100%",autoMatchParens:!0,textWrapping:!1,highlightActiveLine:!0,readOnly:"readOnly"in a?a.readOnly:!1,content:c,passDelay:100,undoDelay:250,tabMode:"shift",initCallback:function(){d._editor.setParser("JSParser");
d._onReady();try{var b=d._editor.nthLine(e+1);d._editor.selectLines(b,f,b,f)}catch(c){}if("onReady"in a)a.onReady();a.focusOnReady&&d.focus()}};"onChange"in a&&(c.onChange=a.onChange);a.codeMirror&&$.extend(c,a.codeMirror);this._overflowInput=$("<input></input>").css("position","absolute").css("left","-500px").css("top","0px").appendTo(document.body);$(this._container).acre(fb.acre.current_script.app.path+"/cuecard/mjt/query-editor.mjt","query_editor",[this,c])};
CueCard.QueryEditor.nativeTypes={"/type/int":!0,"/type/float":!0,"/type/boolean":!0,"/type/rawstring":!0,"/type/uri":!0,"/type/datetime":!0,"/type/bytestring":!0,"/type/value":!0,"/type/text":!0,"/type/enumeration":!0};
CueCard.QueryEditor.prototype.dispose=function(){this._cancelPopup();$(this._editor._top_element).remove();this._overflowInput.remove();this._controlTopContainer.remove();this._controlBottomContainer.remove();this._iframeContainer.remove();this._iframeContainer=this._controlBottomContainer=this._controlTopContainer=this._overflowInput=this._editor=null};
CueCard.QueryEditor.prototype.layout=function(b,a){if(b)if(this._controlPane&&this._controlPane._paneldrawer)this._controlPane._paneldrawer.set_height(b);else{this._container.height(b);var d=this._options.hideControls?0:this._controlBottomContainer.outerHeight();this._iframeContainer.height(b-d)}a&&this._container.width(a)};CueCard.QueryEditor.prototype._addCodemirror=function(b,a){this._editor=new CodeMirror(function(a){b.append(a)},a)};
CueCard.QueryEditor.prototype.setOutputPane=function(b){this._outputPane=b};CueCard.QueryEditor.prototype.getOutputPane=function(){return this._outputPane};CueCard.QueryEditor.prototype.setControlPane=function(b){this._controlPane=b};CueCard.QueryEditor.prototype.getControlPane=function(){return this._controlPane};CueCard.QueryEditor.prototype.focus=function(){this._editor.focus();return this};
CueCard.QueryEditor.prototype.content=function(b){if(void 0==b)return this._editor.getCode();if(this._editor.getCode()!=b){var a=this._editor.editor;a.history.push(null,null,this._editor.win.fixSpaces(b.replace(/\t/g,"  ").replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n"));a.addDirtyNode();a.scheduleHighlight();if(a.history.onChange)a.history.onChange()}return this};
CueCard.QueryEditor.prototype.getUnresolvedQuery=function(){var b=this.getQueryModelAndContext().model.toQueryJson();return CueCard.jsonize(b,this.getJsonizingSettings({breakLines:!1,omitWhitespace:!0,variables:this._getVariables(),resolveVariables:!1}))};CueCard.QueryEditor.prototype.getResolvedQueryEnvelope=function(b){return this._getResolvedQueryEnvelope(!1,b)};
CueCard.QueryEditor.prototype.getJsonizingSettings=function(b){if(this._controlPane)return this._controlPane.getJsonizingSettings(b);b=b||{};"indentCount"in b||(b.indentCount=2);return b};CueCard.QueryEditor.prototype._getVariables=function(){return this._controlPane?this._controlPane.getVariables():{}};CueCard.QueryEditor.prototype._getQueryEnvelope=function(){return this._controlPane?this._controlPane.getQueryEnvelope():{}};
CueCard.QueryEditor.prototype._getResolvedQueryEnvelope=function(b,a){var a=a||{},d=this.getQueryModelAndContext(),c=d.model.toQueryJson();a.isWriteQuery=this._isWriteQuery(c);var e=this._getQueryEnvelope();if(b){this.content(CueCard.jsonize(c,this.getJsonizingSettings({variables:this._getVariables(),resolveVariables:!1})));try{var f=this.getQueryModelAndContext().model.getCursorFromContext(d.context),g=this._editor.nthLine(f.line+1);this._editor.selectLines(g,f.col)}catch(h){}}e.query=c;return e};
CueCard.QueryEditor.prototype._isWriteQuery=function(b){var a=function(b){if(null!=b)if(b instanceof Array){if(0<b.length&&"object"==typeof b[0])for(var c=0;c<b.length;c++)if(a(b[c]))return!0}else if("object"==typeof b)for(c in b)if("connect"==c||"create"==c||a(b[c]))return!0;return!1};return a(b)};CueCard.QueryEditor.prototype._confirmWriteQuery=function(b){return b.isWriteQuery&&!this._warnWrites&&0>CueCard.apiProxy.base.indexOf("sandbox")};
CueCard.QueryEditor.prototype.getMqlReadURL=function(){var b={},a=this.getResolvedQueryEnvelope(b),b=CueCard.freebaseServiceUrl+(b.isWriteQuery?"mqlwrite":"mqlread");"service"in this._options&&null!=this._options.service&&(b=this._options.service);a.query=CueCard.jsonize(a.query,this.getJsonizingSettings({breakLines:!1,variables:this._getVariables(),resolveVariables:!0}));return fb.h.build_url(b,"/",a)};
CueCard.QueryEditor.prototype.run=function(b){if(null!=this._outputPane){var a={},b=this._getResolvedQueryEnvelope(b||this._controlPane&&this._controlPane.getSetting("cleanup"),a),d=CueCard.jsonize(b,this.getJsonizingSettings({breakLines:!1,variables:this._getVariables(),resolveVariables:!0}));if(this._confirmWriteQuery(a)){if(!fb.user){window.confirm("You need to be signed in to write.\nDo you want to signin now?")&&$(window).trigger("fb.user.unauthorized");return}if(window.confirm("Your query will write data into Freebase.\nAre you sure you want to do that?"))this._warnWrites=
!0;else return}var c=CueCard.apiProxy.base+CueCard.apiProxy[a.isWriteQuery?"write":"read"],e=this,f=function(a){var b={};null!=e._controlPane&&(e._controlPane.getSetting("multilineErrorMessages")&&"error"in a)&&(b.encodeJavascriptString=function(a){return a});a=a.error||a.result||a;e._outputPane.setJSONContent(a,e.getJsonizingSettings(b),d);if("onRun"in e._options)e._options.onRun(a)},g=function(a){alert(a)};this._outputPane.setStatus("Querying...",!0);a.isWriteQuery?$(".cuecard-queryEditor-write-form").load(CueCard.apiProxy.base+
"mqlwrite_begin.mjt",function(){var a=$("form :input[name='ACRE_CSRF_TOKEN']",this).val();$.ajax(c,{type:"POST",data:{query:d,ACRE_CSRF_TOKEN:a},success:f,error:g,dataType:"json"})}):(d=this._outputPane.prepareQuery(d),$.ajax(c,{type:1024<d.length?"POST":"GET",data:{query:d},success:f,error:g,dataType:"json"}))}};
CueCard.QueryEditor.prototype.getQueryModelAndContext=function(){var b=this._editor.cursorPosition(!1),a=this._editor.lineNumber(b.line)-1,b=b.character;return CueCard.QueryParser.parseForContext(this._editor.getCode(),0,a,b)};
CueCard.QueryEditor.prototype._onReady=function(){var b=this;try{$(this._editor.win.document.body).keyup(function(a){return b._onEditorKeyUp(a)}).keydown(function(a){return b._onEditorKeyDown(a)}).mousedown(function(a){return b._onEditorMouseDown(a)})}catch(a){alert("Unable to install keyup handler on codemirror window")}"cleanUp"in this._options&&this._options.cleanUp&&(this._editor.getCode(),this._onCleanUp())};CueCard.QueryEditor.prototype._onRun=function(b){this.run(b)};
CueCard.QueryEditor.prototype._onCleanUp=function(){var b=this.getQueryModelAndContext().model.toQueryJson(),a=this._getVariables();this.content(CueCard.jsonize(b,this.getJsonizingSettings({variables:a,resolveVariables:!1})))};CueCard.QueryEditor.prototype._onEditorMouseDown=function(){};
CueCard.QueryEditor.prototype._onEditorKeyDown=function(b){if((9==b.keyCode||32==b.keyCode&&(b.ctrlKey||b.metaKey||b.altKey))&&$.localstore("cc_assist"))return this._assistKeyComboDetected=!0,b.preventDefault(),!1;this._assistKeyComboDetected=!1;(b.metaKey||b.ctrlKey)&&13==b.keyCode&&this._onRun(b.shiftKey)};CueCard.QueryEditor.prototype._onEditorKeyUp=function(b){if(this._assistKeyComboDetected)return this._assistKeyComboDetected=!1,this.startAssistAtCursor(),b.preventDefault(),!1};
CueCard.QueryEditor.prototype._toggleAssist=function(){var b=!!$(".cuecard-queryEditor-queryAssist",this._controlBottomContainer).attr("checked");$.localstore("cc_assist",b?1:0,!1)};
CueCard.QueryEditor.prototype.startAssistAtCursor=function(){var b=this._editor.cursorPosition(!1),a=this._editor.lineNumber(b.line)-1,d=b.character;this._editor.lineContent(b.line);for(var c=this._editor.win.document.body.firstChild,c=b.line||c,e=c.nextSibling,f=d;0<f&&null!=e&&"br"!=e.tagName.toLowerCase()&&null!=e.firstChild&&e.firstChild.nodeValue.length>=f;)f-=e.firstChild.nodeValue.length,c=e,e=e.nextSibling;b=$(e).offset();if(null==e||"br"==e.tagName.toLowerCase()){if(null!=e)$.browser.msie&&
null!=c&&"br"!=c.tagName.toLowerCase()?(e=c.offsetWidth,c=c.offsetHeight):(e=c.offsetLeft+c.offsetWidth,c=c.offsetTop+c.offsetHeight);else var b=$(c).offset(),g=c.firstChild?c.firstChild.nodeValue.length:0,e=b.left+(0==g?0:f*c.offsetWidth/g),c=c.offsetHeight;this._startAssist(a,d,{left:e,top:b.top,height:c})}else g=e.firstChild?e.firstChild.nodeValue.length:0,this._startAssist(a,d,{left:b.left+(0==g?0:f*e.offsetWidth/g),top:b.top,height:e.offsetHeight})};
CueCard.QueryEditor.prototype._startAssist=function(b,a,d){this._cancelPopup();if(null!=d){var c=$(this._iframeContainer).offset();c.left-=this._editor.win.document.body.scrollLeft+document.body.scrollLeft;c.top-=this._editor.win.document.body.scrollTop+document.body.scrollTop;var e=this;this._popup=new CueCard.Popup(Math.round(c.left+d.left),Math.round(c.top+d.top),Math.round(d.height),[window,this._editor.win],{onCancel:function(a){"key"==a&&e.focus()}});this._popup.elmt.html('<div class="cuecard-popup-message">Please wait...</div>');
d=this.getQueryModelAndContext();if(0<d.context.length)if(c=d.context[d.context.length-1],"relative"in c)if(c.node.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("path"==c.relative||"before"==c.relative){this._startSuggestProperties(b,a,d,c);return}if("space"==c.relative){var f=c.node.links[c.child];this._startSuggestValues(b,a,d,c,f);return}}else{if(c.node.type==CueCard.QueryNode.TYPE_TERMINAL){f=null;if(1<d.context.length)var g=d.context[d.context.length-2],f=g.node.links[g.child];this._startSuggestValues(b,
a,d,c,f);return}}else{f=null;1<d.context.length&&(g=d.context[d.context.length-2],g.node.type==CueCard.QueryNode.TYPE_NONTERMINAL?f=g.node.links[g.child]:2<d.context.length&&(g=d.context[d.context.length-3],f=g.node.links[g.child]));this._startSuggestValues(b,a,d,c,f);return}}this._popup.elmt.html('<div class="cuecard-popup-message">Sorry, we don\'t know how to assist you here. Send us a link to this exact query using the links at the upper right corner and we will investigate. Thank you!</div>')};
CueCard.QueryEditor.prototype._cancelPopup=function(){null!=this._popup&&(this._popup.cancel(),this._popup=null)};
CueCard.QueryEditor.prototype._startSuggestProperties=function(b,a,d,c){var e=this,c="path"==c.relative?c.node.links[c.child].token:null;this._startBufferInput();this._prepareQueryForSuggestions(d,b,a,c,function(a,b,c){var j=function(a,f){e._suggestProperties(d,f.result,b+e._stopBufferInput(),c)};d.model.locateInnerMostNonTerminal(d.context,a.extend(function(b,c){var d=[],e=[],g=[];c.node.getDeclaredTypes(d);c.node.getDeclaredIDs(e);c.node.getDeclaredGUIDs(g);var h=[];0<d.length&&h.push("t="+encodeURIComponent(d.join(",")));
0<e.length&&h.push("i="+encodeURIComponent(e.join(",")));0<g.length&&h.push("g="+encodeURIComponent(g.join(",")));null!=c.property&&(h.push("p="+encodeURIComponent(c.property)),h.push("r="+c.reverse));d=CueCard.helper+"suggest-properties.ajax?"+h.join("&");$.ajax(d,{dataType:"json",success:b.extend(j).onDone,error:a.onError});return!0}));return!0})};CueCard.QueryEditor.prototype._startBufferInput=function(){this._overflowInput[0].value="";this._overflowInput[0].focus()};
CueCard.QueryEditor.prototype._stopBufferInput=function(){return this._overflowInput[0].value};
CueCard.QueryEditor.prototype._suggestProperties=function(b,a,d,c){this._popup.elmt.empty();this._popup.elmt.html("<div></div>");var b=[],e;for(e in a.properties){var f=a.properties[e],g=e.lastIndexOf("/"),h=e.substr(g+1),g=e.substr(0,g),j=f.explicit;if("parentProperty"in f){var j='"'+f.parentProperty+'" : [{ "'+h+'" : ',k=f.unique?"null":"[]";b.push({label:h,hint:"of type "+g+" (through "+f.parentProperty+")",qualifiedProperty:e,result:j+k+" }]",offset:j.length,extent:k.length,expectedTypes:f.expectedTypes})}else j=
'"'+(j?h:e)+'" : ',h={label:h,hint:"of type "+g,qualifiedProperty:e,expectedTypes:f.expectedTypes},CueCard.QueryEditor.setPropertySuggestionSuffix(0<f.expectedTypes.length?f.expectedTypes[0].id:"",h,f.unique,j),b.push(h)}a=new CueCard.PropertySuggestor(this._popup,CueCard.MqlSyntax.KeywordSuggestions,b,c);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,a,d)};
CueCard.QueryEditor.setPropertySuggestionSuffix=function(b,a,d,c){var e=null;"/common/image"==b||"/common/document"==b?(e='{ "id" : null, "optional" : true, "limit" : 3 }',d||(e="["+e+"]")):"/measurement_unit/dated_integer"==b?(e='{ "number" : null, "date" : null }',d&&(e="["+e+"]")):"/measurement_unit/dated_money_value"==b?(e='{ "amount" : null, "valid_date" : null, "currency" : null }',d&&(e="["+e+"]")):e=0==b.indexOf("/type/")?d?"null":"[]":d?"{}":"[{}]";a.result=c+e;a.offset=c.length;a.extent=
e.length};
CueCard.QueryEditor.prototype._startSuggestValues=function(b,a,d,c,e){var f=this,g="token"in c?c.token:null;this._startBufferInput();this._prepareQueryForSuggestions(d,b,a,g,function(g,j,k,l){j+=f._stopBufferInput();if(null!=e&&!e.reverse&&CueCard.QueryNode.isMqlKeyword(e.path))f._suggestValuesForKeyword(b,a,d,c,e.path,j,k);else{var n=function(){f._popup.elmt.empty();f._popup.elmt.html('<div></div><div class="cuecard-suggestion-hint-message">Keep typing to search for topics of types fitting this point in the query.</div>')},m=
e.qualifiedProperty,q=e.reverse;if(!q&&("/type/object/id"==m||"/type/object/guid"==m||"/type/object/name"==m))return d.model.locateInnerMostNonTerminal(d.context,g.extend(function(a,b){n();var c=[];b.node.getDeclaredTypes(c);if("property"in b&&null!=b.property){var d=b.property;if(q)c.push(d.substr(0,d.lastIndexOf("/")));else if(d in l)for(var d=l[d].expectedTypes,g=0;g<d.length;g++)c.push(d[g].id)}c=new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax.SingleValueSuggestions,c,e.property,
k);new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,c,j)})),!0;n();var o=!1;if(q)g=[m.substr(0,m.lastIndexOf("/"))];else if("/type/object/type"==m)g=["/type/type"];else if(m in l)for(var o=l[m].unique,g=[],m=l[m].expectedTypes,p=0;p<m.length;p++)g.push(m[p].id);else g="/type/text/lang"==m?["/type/lang"]:[];m=1==g.length?g[0]:null;g=null!==m&&m in CueCard.QueryEditor.nativeTypes?new CueCard.StaticChoicesSuggestor(CueCard.MqlSyntax["/type/text"==m?o?"UniqueStringLiteralValueSuggestions":
"StringLiteralValueSuggestions":o?"UniqueLiteralValueSuggestions":"LiteralValueSuggestions"],k):new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax[o?"UniqueTopicValueSuggestions":"TopicValueSuggestions"],g,"id",k);new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,g,j)}})};
CueCard.QueryEditor.prototype._suggestValuesForKeyword=function(b,a,d,c,e,f,g){this._popup.elmt.empty();b=CueCard.MqlSyntax.KeywordValueHints[e];"html"in b?(this._popup.elmt.html('<div class="cuecard-suggestion-hint-message">'+b.html+"</div>"),this.focus()):(this._popup.elmt.html("<div></div>"),g=new CueCard.StaticChoicesSuggestor(b.choices,g),new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,g,f))};
CueCard.QueryEditor.prototype._prepareQueryForSuggestions=function(b,a,d,c,e){var f=this,g="",h,j=function(a,b,c,d,e){c=void 0===d||"string"!==typeof c?CueCard.jsonize(c,{breakLines:!1}):c;b+="number"==typeof d?d:c.length;e=b+("number"==typeof e?e:0);f._editor.editor.replaceSelection(c);a=f._editor.nthLine(a+1);f._editor.selectLines(a,b,a,e)};if(null!=c){var a=0,k=c.start.col;/^['"]/.test(c.content)&&(a=1);g=c.content.substring(a,d-k).replace(/['"]$/,"");h=function(a,b,d){var e=f._editor.nthLine(c.start.line+
1);f._editor.selectLines(e,c.start.col,e,c.end.col);j(c.start.line,c.start.col,a,b,d)}}else{var d=this._editor.cursorPosition(!0),l=this._editor.lineNumber(d.line)-1,n=d.character;h=function(a,b,c){var d=f._editor.nthLine(l+1);f._editor.selectLines(d,n,d,n);j(l,n,a,b,c)}}var m=function(a){f._popup.close();"string"==typeof a?h(a):h(a.result,a.offset,a.extent)},d=CueCard.UI.createBlockingContinuations(function(a,b){return e(a,g,m,b||{})});this._popup.addPendingContinuation(d);b.model.qualifyAllProperties(d)};
CueCard.OutputPane=function(b,a){this._elmt=$(b);this._options=a||{};this._TABS=a.tabs||[{name:"Results",key:"json"}];this._options.hideHelp||this._TABS.push({name:"Help",key:"help"});this._jsonResult=null;this._lastJsonOutputMode=$.localstore("cc_op_mode")||this._TABS[0].key;this._constructUI()};CueCard.OutputPane.prototype.dispose=function(){};
CueCard.OutputPane.prototype.layout=function(b,a){if(b){this._container.height(b);var d=this._container.innerHeight()-this._tabsContainer.outerHeight();this._contentContainer.height(d);$(".cuecard-outputPane-tabBody",this._contentContainer).height(d)}a&&this._container.width(a)};
CueCard.OutputPane.prototype._constructUI=function(){var b=this,a=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.current_script.app.path+"/cuecard/mjt/output-pane.mjt","tabs",[a,this]);var d;d=this._options.initial_tab?b.getTabIndex(this._options.initial_tab):b.getTabIndex("help");var c=$("#"+a+" > .cuecard-outputPane-tabs > .section-tabset");c.tabs("#"+a+" > .tabbed-content > .cuecard-outputPane-tabBody",{initialIndex:d,onBeforeClick:function(a,c){var d=b._TABS[c].key;"help"!==
d&&(b._lastJsonOutputMode=d,$.localstore("cc_op_mode",d,!1))}});this._tabs=c.data("tabs");this._json=this._getTab("json");this._json=this._json.length?this._json:!1;this._help=this._getTab("help");this._help=this._help.length?this._help:!1;this.setStatus("Run query to see results here...")};CueCard.OutputPane.prototype._getTab=function(b){return $("#"+this._idPrefix+"-"+b)};CueCard.OutputPane.prototype.prepareQuery=function(b){return b};
CueCard.OutputPane.prototype.getTabIndex=function(b){for(var a=0;a<this._TABS.length;a++)if(this._TABS[a].key===b)return a;return 0};
CueCard.OutputPane.prototype.setJSONContent=function(b,a,d){this._jsonResult=b;"result"in b?(this._setJsonText(CueCard.jsonize(b,a||{indentCount:2})),d=JSON.parse(d),this._list&&this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/mjt/output-pane.mjt","list",[b,d])):b.message?(delete b.response,this._setJsonText(CueCard.jsonize(b,a||{indentCount:2})),this._list&&this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/mjt/output-pane.mjt","list_error",[b.message])):b.messages&&
(b="string"==typeof b.messages[0]?b.messages[0]:b.messages[0].message,this._setJsonText(b),this._list&&this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/mjt/output-pane.mjt","list_error",[b]));this._tabs.click(this.getTabIndex(this._lastJsonOutputMode))};CueCard.OutputPane.prototype.setStatus=function(b,a){this._jsonResult=null;this._setJsonText(b);a&&this._tabs.click(this.getTabIndex(this._lastJsonOutputMode))};CueCard.OutputPane.prototype.getJson=function(){return this._jsonResult};
CueCard.OutputPane.prototype._setJsonText=function(b){var b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=[],d=/\"m?id\"\s*\:\s*\"([^\"]*)\"/gi;b.split(/[\n\r\f]/).forEach(function(b){a.push(b.replace(d,function(a,b){return a.replace(b,"<a target='_blank' class='property-value' data-id='"+b+"' href='"+b+"'>"+b+"</a>")}))});b="<pre>"+a.join("\n")+"</pre>";this._json.html(b)};CueCard.ControlPane=function(b,a){this._elmt=$(b);this._options=a||{};this._constructUI()};
CueCard.ControlPane.prototype.dispose=function(){};
CueCard.ControlPane.prototype._constructUI=function(){var b=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.current_script.app.path+"/cuecard/mjt/control-pane.mjt","tabs",[b,this]);$("#"+b+" > .section-tabset").tabs("#"+b+" > .tabbed-content > .cuecard-controlPane-tabBody",{initialIndex:0});this._options.paneldrawer&&(this._paneldrawer=this._options.paneldrawer.element.paneldrawer(this._options.paneldrawer).data("$.paneldrawer"),this._paneldrawer.drawer_toggle.show())};
CueCard.ControlPane.prototype.layout=function(){};CueCard.ControlPane.prototype._getDefaults=function(){var b=this._options,a=b.env||{},d={};d.extended=b.extended||a.extended;d.extended=1===d.extended?!0:!1;d.as_of_time=b.as_of_time||a.as_of_time||null;d.use_permission_of=b.use_permission_of||a.use_permission_of||null;d.costs=b.costs||!1;delete a.extended;delete a.as_of_time;delete a.use_permission_of;delete a.costs;return d};
CueCard.ControlPane.prototype._getTab=function(b){return $("#"+this._idPrefix+"-"+b)};CueCard.ControlPane.prototype._redangle=function(){var b=this,a=this._options.queryEditor.getQueryModelAndContext();a.model.toInsideOutQueryJson(a.context,CueCard.UI.createBlockingContinuations(function(a,c){b._setOutputJSON(c)}))};CueCard.ControlPane.prototype._qualify=function(){var b=this,a=this._options.queryEditor.getQueryModelAndContext().model;a.qualifyAllProperties(CueCard.UI.createBlockingContinuations(function(){b._setOutputJSON(a.toQueryJson({qualifyAllProperties:!0}))}))};
CueCard.ControlPane.prototype._generateCode=function(){var b=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),b=CueCard.CodeGeneration.generate(b,CueCard.CodeGeneration.serializers["acre-template"],{variables:this.getVariables()});CueCard.showDialog("acre_template",b)};
CueCard.ControlPane.prototype._oneLiner=function(){var b=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),a=this.getVariables(),a=this.getJsonizingSettings({variables:a,resolveVariables:!1});a.breakLines=!1;this._options.queryEditor.content(CueCard.jsonize(b,a))};
CueCard.ControlPane.prototype._setOutputJSON=function(b){switch(this._getTab("tools").find("input[name='tools-result']:checked").val()){case "replace":this._options.queryEditor.content(CueCard.jsonize(b,this.getJsonizingSettings()));break;case "output":this._options.outputPane.setJSONContent(b,this.getJsonizingSettings())}};
CueCard.ControlPane.prototype._runPage=function(b){var a=this._getTab("envelope").find("input[name='page']"),d=a.val(),d=parseInt(d)||1,d=d+b;1>d?a.val("1"):(a.val(d),null!=this._options.queryEditor&&this._options.queryEditor.run())};
CueCard.ControlPane.prototype._runCursor=function(b){if(null!=this._options.outputPane){var a=this._options.outputPane.getJson();void 0!==a&&(null!==a&&"cursor"in a)&&(this._getTab("envelope").find("input[name='cursor']").val(a.cursor),this._getTab("envelope").find("input[name='cursor-opt'][value='custom']").attr("checked","checked"),null!=this._options.queryEditor&&b&&this._options.queryEditor.run())}};
CueCard.ControlPane.prototype.getQueryEnvelopeSetting=function(b){switch(b){case "extended":return this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;case "as_of_time":if(b=this._getTab("envelope").find("input[name='as_of_time']").val(),0<b.length)return b}return null};
CueCard.ControlPane.prototype.getQueryEnvelope=function(b,a,d){b=b||{};1==this.getSetting("extended")&&(b.extended=1);this.getSetting("costs")&&(b.cost=!0);var c=this._getTab("envelope").find("input[name='as_of_time']").val();0<c.length&&(b.as_of_time=c);c=this._getTab("envelope").find("input[name='use_permission_of']").val();0<c.length&&(b.use_permission_of=c);var e=this._getTab("envelope").find("select"),c=function(a){return e[a].options[e[a].selectedIndex].value};d||(d=c(0),0<d.length&&(b.lang=
d));d=c(1);0<d.length&&(b.escape="false"==d?!1:d);d=c(2);0<d.length&&(b.uniqueness_failure=d);if(!a){a=this._getTab("envelope").find("input[name='page']").val();if(0<a.length)try{b.page=parseInt(a)}catch(f){}switch(this._getTab("envelope").find("input[name='cursor-opt']:checked").val()){case "true":b.cursor=!0;break;case "custom":b.cursor=this._getTab("envelope").find("input[name='cursor']").val()}}this.getCustomEnvelope(b);return b};
CueCard.ControlPane.prototype.getCustomEnvelope=function(b){for(var b=b||{},a=this._getTab("envelope").find("table.cuecard-controlPane-customEnvelope")[0],d=1;d<a.rows.length;d++){var c=a.rows[d],e=c.cells[0].firstChild.value,c=c.cells[1].firstChild.value;if(0<e.length){try{c=JSON.parse(c)}catch(f){}b[e]=c}}return b};
CueCard.ControlPane.prototype.getSetting=function(b){var a=this._getTab("tools").find("input");switch(b){case "cleanup":return b=a[0].checked,$.localstore("cc_cp_clean",b?"1":"0",!1),b;case "alignJSONPropertyValues":return b=a[1].checked,$.localstore("cc_cp_align",b?"1":"0",!1),b;case "liveQuery":return b=a[2].checked,$.localstore("cc_cp_live",b?"1":"0",!1),b;case "multilineErrorMessages":return b=a[3].checked,$.localstore("cc_cp_multi",b?"1":"0",!1),b;case "extended":return b=this._getTab("envelope").find("input[name='extended']").attr("checked")?
1:0,$.localstore("cc_cp_extended",b,!1),b;case "costs":return b=this._getTab("envelope").find("input[name='costs']").attr("checked")?1:0,$.localstore("cc_cp_costs",b,!1),b}return!1};CueCard.ControlPane.prototype.getJsonizingSettings=function(b){b=b||{};b.indentCount=2;b.alignFieldValues=this.getSetting("alignJSONPropertyValues");return b};
CueCard.ControlPane.prototype.getVariables=function(){for(var b={},a=this._getTab("variables").find("table")[0],d=1;d<a.rows.length;d++){var c=a.rows[d],e=c.cells[0].firstChild.value,c=c.cells[1].firstChild.value;try{c=JSON.parse(c)}catch(f){}b[e]=c}return b};CueCard.ControlPane.prototype._removeRow=function(b,a,d){var c=b.closest("table");b.closest(a).remove();1>$(a).length&&c.append($.acre(d()))};CueCard.CodeGeneration={serializers:{}};
CueCard.CodeGeneration.generate=function(b,a,d){var c="",e={_variables:{},createVariable:function(a){if(a in this._variables)return a+this._variables[a]++;this._variables[a]=1;return a}},f=e.createVariable("q"),g=e.createVariable("o"),h=new CueCard.SerializingContext(null);h.setProperty("indentString","indentString"in d?d.indentString:"  ");h.setProperty("indentLevel","indentLevel"in d?d.indentLevel:0);h.setProperty("stream",{append:function(a){c+=a}});a.prepareRootContext(h,d);var j=new CueCard.IndentWriter(h),
k=a.generateQueryCall(h,j,e,b,d.variables,f,g);h.setProperty("start",function(){return k});h.setProperty("stop",function(){});CueCard.CodeGeneration._processNode(b,a,h,j,e);return c};CueCard.CodeGeneration._deriveElementName=function(b,a){if(null==b){var d=a.getProperty("path");if(null!=d){if("!"==d.charAt(0))return d=d.substr(Math.max(d.indexOf(":")+1,1)).split("/"),d[Math.max(0,d.length-2)];d=d.substr(d.indexOf(":")+1).split("/");return d[d.length-1]}}else return d=b.split("/"),d[d.length-1];return"entry"};
CueCard.CodeGeneration._isImagePath=function(b){if("!"==b.charAt(0))return!1;b=b.substr(b.indexOf(":")+1);return"/common/topic/image"==b||"image"==b};CueCard.CodeGeneration._isImageNode=function(b){if(null==b||"object"!=typeof b)return!1;if(b instanceof Array)if(1==b.length&&"object"==typeof b[0])b=b[0];else return!1;for(var a in b)if("id"!=a&&"guid"!=a&&!CueCard.QueryNode.isMqlKeyword(a))return!1;return!0};
CueCard.CodeGeneration._processNode=function(b,a,d,c,e){if(null==b){var f=d.getProperty("start")(!0,!1);a.outputSimpleFieldValue(f,d,c);d.getProperty("stop")(!0,!1)}else if("object"==typeof b)if(b instanceof Array)if(0==b.length){var f=CueCard.CodeGeneration._deriveElementName(null,d),g=e.createVariable(f),h=e.createVariable(f.charAt(0)),f=d.getProperty("start")(!1,!1);a.openNodeArray(d,c,e,f,g,h,"values");a.outputSimpleFieldValue(g,d,c);a.closeNodeArray(d,c,e,f,g,h,"values");d.getProperty("stop")(!1,
!1)}else 1<b.length||("object"!=typeof b[0]||"__identifier__"in b)||(g=new CueCard.SerializingContext(d),g.setProperty("in-array",!0),arguments.callee(b[0],a,g,c,e));else if("forbidden"!=b.optional){g=null;f=0;for(h in b)if(b.hasOwnProperty(h)&&"*"!=h&&!CueCard.QueryNode.isMqlKeyword(h)){f++;var j=b[h];if("!"!=h.charAt(0)){var k=h.substr(h.indexOf(":")+1);if("type"==k||"/type/object/type"==k)null!=j&&"string"==typeof j&&(g=j)}}CueCard.CodeGeneration._processTypedObjectNode(b,g,f,a,d,c,e)}};
CueCard.CodeGeneration._processTypedObjectNode=function(b,a,d,c,e,f,g){function h(){var b=CueCard.CodeGeneration._deriveElementName(a,e);k=g.createVariable(b);e.getProperty("in-array")&&(l=g.createVariable(b.charAt(0)))}var j=null,k=null,l=null,n,m,q="optional"in b&&!0===b.optional;if(e.getProperty("in-array")){var o=0<d&&!("*"in b);n=function(){null==j&&(j=e.getProperty("start")(!1,q),h(),c.openNodeArray(e,f,g,j,k,l,o?"fields":"object"));return k};m=function(){null!=j&&(c.closeNodeArray(e,f,g,j,
k,l,o?"fields":"object"),e.getProperty("stop")(!1,q))}}else n=function(){null==j&&(j=e.getProperty("start")(!1,q),h(),c.openNode(e,f,g,j,k));return k},m=function(){null!=j&&(c.closeNode(e,f,g,j,k),e.getProperty("stop")(!1,q))};if(0==d||"*"in b)c.generateEmptyObjectNode(e,f,g,n());else{for(var p in b)if(b.hasOwnProperty(p)&&"*"!=p&&!CueCard.QueryNode.isMqlKeyword(p))if(d=b[p],CueCard.CodeGeneration._isImagePath(p)&&CueCard.CodeGeneration._isImageNode(d))c.generateImageField(e,f,g,p,d,n);else{var r=
c.createFieldContext(e,f,g,p,n);r.setProperty("path",p);CueCard.CodeGeneration._processNode(d,c,r,f,g)}"*"in b&&(d=b["*"],r=c.openWildcardField(e,f,g,n,d),CueCard.CodeGeneration._processNode(d,c,r,f,g),c.closeWildcardField(e,f,g,n,d))}m()};
CueCard.CodeGeneration.serializers["acre-template"]={prepareRootContext:function(){},generateQueryCall:function(b,a,d,c,e,f,g){a.appendIndent();a.append("<acre:script>");a.appendLineBreak();a.indent();a.appendIndent();a.append("var "+f+" = ");CueCard.jsonize(c,{context:b,variables:e,resolveVariables:!1});a.append(";");a.appendLineBreak();a.appendIndent();a.appendLineBreak();a.appendIndent();a.append("var "+g+" = acre.freebase.mqlread("+f+");");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</acre:script>");
a.appendLineBreak();return g+".result"},outputSimpleFieldValue:function(b,a,d){d.append("${"+b+"}")},openNodeArray:function(b,a,d,c,e,f,g){a.appendLineBreak();a.appendIndent();a.append('<ul acre:if="'+c+'.length != 0">');a.appendLineBreak();a.indent();a.appendIndent();a.append('<li acre:for="'+f+", "+e+" in "+c+'">');"fields"==g&&a.append("<table>");if("fields"==g||"object"==g)a.appendLineBreak(),a.indent()},closeNodeArray:function(b,a,d,c,e,f,g){if("fields"==g||"object"==g)a.unindent(),a.appendIndent();
"fields"==g&&a.append("</table>");a.append("</li>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</ul>");a.appendLineBreak();a.appendIndent();a.append('<div acre:else=""><ins>[no element]</ins></div>');a.appendLineBreak();a.appendLineBreak()},openNode:function(b,a,d,c,e){a.appendIndent();a.append("<acre:script>var "+e+" = "+c+";</acre:script>");a.appendLineBreak();a.appendIndent();a.append("<table>");a.appendLineBreak();a.indent()},closeNode:function(b,a){a.unindent();a.appendIndent();
a.append("</table>");a.appendLineBreak()},createFieldContext:function(b,a,d,c,e){b=new CueCard.SerializingContext(b);b.setProperty("in-array",!1);b.setProperty("start",function(b,d){var h=e();a.appendIndent();a.append("<tr><th>"+c+":</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append("<td"+(d?" acre:if=\"'"+c+"' in "+h+" && "+h+"['"+c+"'] != null\"":"")+">");b||(a.appendLineBreak(),a.indent());return h+"['"+c+"']"});b.setProperty("stop",function(b,c){b||(a.unindent(),a.appendIndent());
a.append("</td>");a.appendLineBreak();c&&(a.appendIndent(),a.append('<td acre:else=""><ins>[no value]</ins></td>'),a.appendLineBreak());a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()});return b},generateImageField:function(b,a,d,c,e,f){f=f();b=f+"['"+c+"']";a.appendIndent();a.append("<tr><th>"+c+":</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append("<td acre:if=\"'"+c+"' in "+f+" && "+b+' != null">');a.appendLineBreak();a.indent();c=e instanceof Array;a.appendIndent();
c?(e=e[0],c=d.createVariable("image"),d=d.createVariable("i"),a.append('<img acre:for="'+d+", "+c+" in "+b+'" src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+c+".guid.substr(1)}":"${"+c+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>')):a.append('<img src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+b+".guid.substr(1)}":"${"+b+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>');a.appendLineBreak();
a.unindent();a.appendIndent();a.append('<td acre:else=""><ins>[no image]</ins></td>');a.appendLineBreak();a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()},openWildcardField:function(b,a,d,c){var c=c(),e=d.createVariable("field"),f=d.createVariable("value");a.appendIndent();a.append('<tr acre:for="'+e+", "+f+" in "+c+'"><td>${'+e+"}:</td>");a.appendLineBreak();a.indent();b=new CueCard.SerializingContext(b);b.setProperty("in-array",!1);b.setProperty("start",function(b){a.appendIndent();
a.append("<td>");b||(a.appendLineBreak(),a.indent());return f});b.setProperty("stop",function(b){b||(a.unindent(),a.appendIndent());a.append("</td>");a.appendLineBreak()});return b},closeWildcardField:function(b,a){a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()},generateEmptyObjectNode:function(b,a,d,c){b=d.createVariable("field");d=d.createVariable("value");a.appendIndent();a.append("<table>");a.appendLineBreak();a.indent();a.appendIndent();a.append('<tr acre:for="'+b+", "+d+
" in "+c+'"><th>${'+b+"}:</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append('<td acre:if="'+d+' instanceof Array">${'+d+".join(', ')}</td>");a.appendLineBreak();a.appendIndent();a.append('<td acre:else="">${'+d+"}</td>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</table>");a.appendLineBreak()}};CueCard.ExampleTechniques="all;basic;sorting;text search;range constraint;date query;multiple constraints on same property;limiting number of results;geographic location;compound value type (CVT);schema inspection;attribution;adding data".split(";");
CueCard.Examples=[{name:"Vietnamese restaurants in Palo Alto, California",query:[{mid:null,name:null,type:"/dining/restaurant",cuisine:"Vietnamese","/business/business_location/address":[{state_province_region:"California",citytown:"Palo Alto"}]}],techniques:["basic","geographic location"]},{name:"Properties of /music/artist",query:[{type:"/type/property",schema:{id:"/music/artist"},id:null,name:null}],techniques:["schema inspection"]},{name:"All types created by the user jamie",query:[{creator:"/user/jamie",
name:null,id:null,type:"/type/type"}],techniques:["attribution"]},{name:"Cloud classifications sorted by name",query:[{clouds:[],name:null,mid:null,sort:"name",type:"/meteorology/cloud_classification"}],techniques:["basic","sorting"]},{name:"U.S. states containing cities whose names start with 'Blue' or 'Red'",query:[{"a:contains":[{name:null,mid:null,"name~=":"^Red",type:"/location/citytown"}],"b:contains":[{name:null,mid:null,"name~=":"^Blue",type:"/location/citytown"}],"b:type":"/location/us_state",
name:null,mid:null,type:"/location/location"}],techniques:["text search","multiple constraints on same property"]},{name:"2 of The Police's albums and their tracks",query:[{type:"/music/album",mid:null,limit:2,name:null,releases:{track:[],limit:1},artist:{name:"The Police",type:"/music/artist"}}],techniques:["basic","limiting number of results"]},{name:"25 Songs with the word 'love' in their titles, with release date, album and artist",query:[{releases:{album:{artist:[],name:null,limit:1},release_date:null,
limit:1},limit:25,name:null,"name~=":"Love*",type:"/music/track"}],techniques:["text search","limiting number of results","date query"]},{name:"Films starring both Joe Pesci and Robert de Niro, showing their full cast",query:[{"a:starring":[{actor:"Joe Pesci"}],"b:starring":[{actor:"Robert de Niro"}],name:null,mid:null,starring:[{actor:null}],type:"/film/film"}],techniques:["multiple constraints on same property","compound value type (CVT)"]},{name:"32 actors born in the 1960s, with two films of each actor",
query:[{"/people/person/date_of_birth":null,"/people/person/date_of_birth<":"1970","/people/person/date_of_birth>=":"1960",film:[{film:null,mid:null,limit:2}],limit:35,name:null,mid:null,type:"/film/actor"}],techniques:["multiple constraints on same property","date query","limiting number of results","range constraint"]},{name:"Directors who have directed both Parker Posey and any actor named Robert (in possibly different films)",query:[{"parker_film:film":[{name:null,mid:null,starring:[{actor:"Parker Posey"}]}],
"robert_film:film":[{name:null,mid:null,starring:[{actor:null,"actor~=":"Robert*"}]}],name:null,mid:null,type:"/film/director"}],techniques:["multiple constraints on same property","text search","compound value type (CVT)"]},{name:"Music artists with albums containing a track called 'One Tree Hill'",query:[{album:[{name:null,mid:null,releases:[{track:[{name:"One Tree Hill"}]}]}],name:null,id:null,type:"/music/artist"}],techniques:["compound value type (CVT)","basic"]},{name:"Everything about 'Jimi Hendrix'",
query:{"*":null,name:"Jimi Hendrix",type:"/music/artist"},techniques:["basic"]},{name:"Kevin Bacon's films, with cast, producers, music, etc.",query:[{type:"/film/film","only:starring":{actor:{name:"Kevin Bacon"}},name:null,imdb_id:[],music:[],produced_by:[],starring:[{actor:[]}]}],techniques:["basic","compound value type (CVT)"]},{name:"When 'Star Wars Episode IV' was added to the database, and by whom",query:[{creator:null,id:"/wikipedia/en/Star_Wars_Episode_IV",name:null,timestamp:null,type:"/film/film"}],
techniques:["attribution"]},{name:"Tracks on Synchronicity longer than 300 seconds",query:[{type:"/music/track",length:null,"length>":300,name:null,releases:[{album:{artist:"The Police",name:"Synchronicity"}}]}],techniques:["range constraint"]},{name:"Properties of a particular type (/government/politician)",query:[{type:"/type/property",schema:{id:"/government/politician"},id:null,name:null}],techniques:["schema inspection"]},{name:"Properties of a particular property (/type/object/name)",query:{"*":null,
id:"/type/object/name",type:"/type/property"},techniques:["schema inspection"]},{name:"Types in a particular domain (/music)",query:[{type:"/type/type",domain:{id:"/music"},name:null}],techniques:["schema inspection"]},{name:"Creating a new topic given a name and a type",query:{create:"unless_exists",name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,mid:null},techniques:["adding data"]},{name:"Setting a basic unique property to a topic",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",
id:null,basic_property:{value:42,connect:"update"}},techniques:["adding data"]},{name:"Connecting one topic to another",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",mid:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",mid:null,connect:"insert"}},techniques:["adding data"]},{name:"Deleting a link between two topics",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",mid:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",
mid:null,connect:"delete"}},techniques:["adding data"]}];CueCard.ExampleTechniqueMap={all:[]};for(var i=0;i<CueCard.Examples.length;i++){var example=CueCard.Examples[i];CueCard.ExampleTechniqueMap.all.push(i);for(var x=0;x<example.techniques.length;x++){var technique=example.techniques[x];technique in CueCard.ExampleTechniqueMap?CueCard.ExampleTechniqueMap[technique].push(i):CueCard.ExampleTechniqueMap[technique]=[i]}}
CueCard.Languages=[{name:"Afrikaans",id:"/lang/af"},{name:"Akkadian",id:"/lang/kk"},{name:"Albanian",id:"/lang/sq"},{name:"Amharic",id:"/lang/am"},{name:"Arabic",id:"/lang/ar"},{name:"Armenian",id:"/lang/hy"},{name:"Artificial",id:"/lang/art"},{name:"Asturian",id:"/lang/ast"},{name:"Australian languages",id:"/lang/aus"},{name:"Azerbaijani",id:"/lang/az"},{name:"Balinese",id:"/lang/ban"},{name:"Bambara",id:"/lang/bm"},{name:"Bantu",id:"/lang/bnt"},{name:"Basque",id:"/lang/eu"},{name:"Batak",id:"/lang/btk"},
{name:"Belarusian",id:"/lang/be"},{name:"Bengali",id:"/lang/bn"},{name:"Bhojpuri",id:"/lang/bho"},{name:"Bosnian",id:"/lang/bs"},{name:"Breton",id:"/lang/br"},{name:"Bulgarian",id:"/lang/bg"},{name:"Buriat",id:"/lang/bua"},{name:"Catalan",id:"/lang/ca"},{name:"Cebuano",id:"/lang/ceb"},{name:"Cherokee",id:"/lang/chr"},{name:"Chichewa",id:"/lang/ny"},{name:"Chinese",id:"/lang/zh"},{name:"Cornish",id:"/lang/kw"},{name:"Corsican",id:"/lang/co"},{name:"Cree",id:"/lang/cr"},{name:"Creoles",id:"/lang/cpf"},
{name:"Croatian",id:"/lang/hr"},{name:"Czech",id:"/lang/cs"},{name:"Danish",id:"/lang/da"},{name:"Duala",id:"/lang/dua"},{name:"Dutch",id:"/lang/nl"},{name:"English",id:"/lang/en"},{name:"Esperanto",id:"/lang/eo"},{name:"Estonian",id:"/lang/et"},{name:"Faroese",id:"/lang/fo"},{name:"Filipino",id:"/lang/fil"},{name:"Finnish",id:"/lang/fi"},{name:"French",id:"/lang/fr"},{name:"Frisian",id:"/lang/fy"},{name:"Friulian",id:"/lang/fur"},{name:"Fulah",id:"/lang/ff"},{name:"Ga",id:"/lang/gaa"},{name:"Gaelic",
id:"/lang/gd"},{name:"Gallegan",id:"/lang/gl"},{name:"Georgian",id:"/lang/ka"},{name:"German",id:"/lang/de"},{name:"Germanic",id:"/lang/gem"},{name:"Greek",id:"/lang/el"},{name:"Guarani",id:"/lang/gn"},{name:"Haitian",id:"/lang/ht"},{name:"Hausa",id:"/lang/ha"},{name:"Hawaiian",id:"/lang/haw"},{name:"Hebrew",id:"/lang/he"},{name:"Hindi",id:"/lang/hi"},{name:"Hungarian",id:"/lang/hu"},{name:"Icelandic",id:"/lang/is"},{name:"Indonesian",id:"/lang/id"},{name:"Inuktitut",id:"/lang/ku"},{name:"Inuktitut",
id:"/lang/iu"},{name:"Irish",id:"/lang/ga"},{name:"Italian",id:"/lang/it"},{name:"Japanese",id:"/lang/ja"},{name:"Judeo-Arabic",id:"/lang/jrb"},{name:"Kalaallisut",id:"/lang/kl"},{name:"Khmer",id:"/lang/km"},{name:"Kinyarwanda",id:"/lang/rw"},{name:"Klingon",id:"/lang/tlh"},{name:"Kongo",id:"/lang/kg"},{name:"Korean",id:"/lang/ko"},{name:"Ladino",id:"/lang/lad"},{name:"Latin",id:"/lang/la"},{name:"Latvian",id:"/lang/lv"},{name:"Limburgan",id:"/lang/li"},{name:"Lingala",id:"/lang/ln"},{name:"Lithuanian",
id:"/lang/lt"},{name:"Low German",id:"/lang/nds"},{name:"Luxembourgish",id:"/lang/lb"},{name:"Macedonian",id:"/lang/mk"},{name:"Malagasy",id:"/lang/mg"},{name:"Malay",id:"/lang/ms"},{name:"Malayalam",id:"/lang/ml"},{name:"Maltese",id:"/lang/mt"},{name:"Mandingo",id:"/lang/man"},{name:"Manx",id:"/lang/gv"},{name:"Maori",id:"/lang/mi"},{name:"Marathi",id:"/lang/mr"},{name:"Mohawk",id:"/lang/moh"},{name:"Moldavian",id:"/lang/mo"},{name:"Mongolian",id:"/lang/mn"},{name:"Nahuatl",id:"/lang/nah"},{name:"Navajo",
id:"/lang/nv"},{name:"Neapolitan",id:"/lang/nap"},{name:"Nepali",id:"/lang/ne"},{name:"Norse,",id:"/lang/non"},{name:"Northern Sami",id:"/lang/se"},{name:"Norwegian",id:"/lang/no"},{name:"Norwegian Nynorsk",id:"/lang/nn"},{name:"Occitan",id:"/lang/oc"},{name:"Panjabi",id:"/lang/pa"},{name:"Papiamento",id:"/lang/pap"},{name:"Persian",id:"/lang/fa"},{name:"Polish",id:"/lang/pl"},{name:"Portuguese",id:"/lang/pt"},{name:"Pushto",id:"/lang/ps"},{name:"Quechua",id:"/lang/qu"},{name:"Raeto-Romance",id:"/lang/rm"},
{name:"Romanian",id:"/lang/ro"},{name:"Romany",id:"/lang/rom"},{name:"Russian",id:"/lang/ru"},{name:"Sakha",id:"/lang/sah"},{name:"Sanskrit",id:"/lang/sa"},{name:"Sardinian",id:"/lang/sc"},{name:"Scots",id:"/lang/sco"},{name:"Serbian",id:"/lang/sr"},{name:"Shona",id:"/lang/sn"},{name:"Sicilian",id:"/lang/scn"},{name:"Slovak",id:"/lang/sk"},{name:"Slovenian",id:"/lang/sl"},{name:"Songhai",id:"/lang/son"},{name:"Spanish",id:"/lang/es"},{name:"Sundanese",id:"/lang/su"},{name:"Swahili",id:"/lang/sw"},
{name:"Swedish",id:"/lang/sv"},{name:"Syriac",id:"/lang/syr"},{name:"Tagalog",id:"/lang/tl"},{name:"Tahitian",id:"/lang/ty"},{name:"Tajik",id:"/lang/tg"},{name:"Tamashek",id:"/lang/tmh"},{name:"Tamil",id:"/lang/ta"},{name:"Telugu",id:"/lang/te"},{name:"Thai",id:"/lang/th"},{name:"Tibetan",id:"/lang/bo"},{name:"Tonga",id:"/lang/to"},{name:"Turkish",id:"/lang/tr"},{name:"Turkmen",id:"/lang/tk"},{name:"Tuvinian",id:"/lang/tyv"},{name:"Ukrainian",id:"/lang/uk"},{name:"Urdu",id:"/lang/ur"},{name:"Uzbek",
id:"/lang/uz"},{name:"Vietnamese",id:"/lang/vi"},{name:"Welsh",id:"/lang/cy"},{name:"Wolof",id:"/lang/wo"},{name:"Xhosa",id:"/lang/xh"},{name:"Yiddish",id:"/lang/yi"},{name:"Yoruba",id:"/lang/yo"},{name:"Zulu",id:"/lang/zu"}];
CueCard.XMetawebCosts={tu:{meaning:"time/user",subsystem:"graphd"},ts:{meaning:"time/system",subsystem:"graphd"},tr:{meaning:"time/real",subsystem:"graphd"},te:{meaning:"time/overall",subsystem:"graphd"},pr:{meaning:"page reclaims",subsystem:"graphd"},pf:{meaning:"page faults",subsystem:"graphd"},dw:{meaning:"primitive data writes",subsystem:"graphd"},dr:{meaning:"primitive data reads",subsystem:"graphd"},"in":{meaning:"index size reads",subsystem:"graphd"},ir:{meaning:"index element reads",subsystem:"graphd"},
iw:{meaning:"index element write",subsystem:"graphd"},va:{meaning:"value allocation",subsystem:"graphd"},dt:{meaning:"total time spent in the session",subsystem:"client/me"},mr:{meaning:"number of mql requests (independent of caches)",subsystem:"client/me"},ch:{meaning:"cache/hit (memcache, not Squid)",subsystem:"client/me",important:!0},cm:{meaning:"cache/miss (memcache, not Squid)",subsystem:"client/me"},cr:{meaning:"cache/read (memcache, not Squid)",subsystem:"client/me"},cs:{meaning:"cache skip (browser shift+reload skips memcache)",
subsystem:"client/me"},lh:{meaning:"lojson-cache/hit",subsystem:"client/me"},lm:{meaning:"lojson-cache/miss",subsystem:"client/me"},lr:{meaning:"lojson-cache/read",subsystem:"client/me"},nreqs:{meaning:"graph requests",subsystem:"client/me",important:!0},tf:{meaning:"time/formatted",subsystem:"client/me"},tg:{meaning:"time/graph",subsystem:"client/me",important:!0},rt:{meaning:"relevance/time",subsystem:"client/me"},cc:{meaning:"cpu time (utime + stime)",subsystem:"client/me"},mcu:{meaning:"mql user time",
subsystem:"client/me"},mcs:{meaning:"mql system time",subsystem:"client/me"},tm:{meaning:"mql real time",subsystem:"client/me",important:!0},utime:{meaning:"time in user mode (float)",subsystem:"client/me"},stime:{meaning:"time in system mode (float)",subsystem:"client/me"},maxrss:{meaning:"maximum resident set size",subsystem:"client/me"},ixrss:{meaning:"shared memory size",subsystem:"client/me"},idrss:{meaning:"unshared memory size",subsystem:"client/me"},isrss:{meaning:"unshared stack size",subsystem:"client/me"},
minflt:{meaning:"page faults not requiring I/O",subsystem:"client/me"},majflt:{meaning:"page faults requiring I/O",subsystem:"client/me"},nswap:{meaning:"number of swap outs",subsystem:"client/me"},inblock:{meaning:"block input operations",subsystem:"client/me"},oublock:{meaning:"block output operations",subsystem:"client/me"},msgsnd:{meaning:"messages sent",subsystem:"client/me"},msgrcv:{meaning:"messages received",subsystem:"client/me"},nsignals:{meaning:"signals received",subsystem:"client/me"},
nvcsw:{meaning:"voluntary context switches",subsystem:"client/me"},nivcsw:{meaning:"involuntary context switches",subsystem:"client/me"},br:{meaning:"number of blob requests",subsystem:"client/me"},bctn:{meaning:"cdb thumbnail time - from blobclient POV",subsystem:"client/me"},rt:{meaning:"relevance/time (FIX: same name, different semantics?)",subsystem:"gix"},pt:{meaning:"postgres time",subsystem:"gix"},qt:{meaning:"actual postgres query time",subsystem:"gix"},ct:{meaning:"postgres connect time",
subsystem:"gix"},mt:{meaning:"MQL time",subsystem:"gix"},tt:{meaning:"total time",subsystem:"other"},mt:{meaning:"total MQL time: mql_output + mql_filter",subsystem:"other"},mft:{meaning:"MQL filter time (total time, ie. not per invocation)",subsystem:"other"},mfc:{meaning:"number of mql_filter invocations",subsystem:"other"},sh:{meaning:"squid/hit",subsystem:"cache"},st:{meaning:"squid/total time",subsystem:"cache"},so:{meaning:"squid/origin server time",subsystem:"cache"}};
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/dialogs.mjt",source:{def:function(){var b=function(){var a=this.tpackage,b=this.exports,c=a._template_fragments,e=a.runtime.new_markuplist(),f=0;e[f++]=c[0];var g=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[1];d[e++]=b;d[e++]=c[2];return d},g=a.runtime.tfunc_factory("acre_template(t)",g,a,void 0,!1);b.acre_template=g;g.source_microdata=null;e[f++]=
c[3];return e};b.source_microdata=null;return b}(),info:{file:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/dialogs.mjt",stringtable:["",'\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Generated Acre Template</span>\n    </h1>\n    <div class="modal-content">\n      <textarea id="template-code" wrap="off">','</textarea>\n    </div>\n  </div>\n  <div class="modal-buttons">\n    <button class="button button-cancel">OK</button>\n  </div>',""],debug_locs:[1,
1,1,1,1,1,6,6,6,6,12,12,12,12,12,12,12,12,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/query-editor.mjt",source:{def:function(){var b=function(){var a=this.tpackage,b=this.exports,c=a._template_fragments,e=a.runtime.new_markuplist(),f=0;e[f++]=c[0];var g=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[1];if(!b._options.hideControls){e[f++]=c[2];var g=a.runtime.uniqueid("onclick");mjt._eventcb[g]=function(){b._toggleAssist()};e[f++]=
c[3];var m="1"==$.localstore("cc_assist")?{checked:""}:{};"class"in m||(e[f++]=c[4]);"type"in m||(e[f++]=c[5]);"onclick"in m||(e[f++]=c[6],e[f++]=a.runtime.make_attr_safe(g,!1),e[f++]=c[7]);for(var q in m)e[f++]=" "+q,e[f++]=a.runtime.bless('="'),e[f++]=a.runtime.htmlencode(""+m[q]),e[f++]=a.runtime.bless('"');e[f++]=c[8];g=a.runtime.uniqueid("onclick");mjt._eventcb[g]=function(){b._onCleanUp()};e[f++]=c[9];e[f++]=a.runtime.make_attr_safe(g,!1);e[f++]=c[10];g=a.runtime.uniqueid("onclick");mjt._eventcb[g]=
function(){b._onRun(false)};e[f++]=c[11];e[f++]=a.runtime.make_attr_safe(g,!1);e[f++]=c[12]}e[f++]=c[13];a.runtime.ondomready(function(){var a=$(b._container);b._container=a.find(".cuecard-queryEditor");b._iframeContainer=a.find(".cuecard-queryEditor-content");b._controlBottomContainer=a.find(".cuecard-queryEditor-controls-bottom");b._addCodemirror(b._iframeContainer,d);b.layout()},this);e[f++]=c[14];return e},g=a.runtime.tfunc_factory("query_editor(queryEditor, codeMirrorOptions)",g,a,void 0,!1);
b.query_editor=g;g.source_microdata=null;e[f++]=c[15];return e};b.source_microdata=null;return b}(),info:{file:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/query-editor.mjt",stringtable:';\n\n  <div class="cuecard-queryEditor">\n    <div class="cuecard-queryEditor-content panel-content"></div>;\n    <div class="cuecard-queryEditor-controls-bottom panel-header">\n      <div class="cuecard-queryEditor-controls-options">\n        Query\u00a0assist;\n        <input; class="button cuecard-queryEditor-queryAssist"; type="checkbox"; onclick="return mjt._eventcb.;.apply(this, [event])";>\n      </div>\n      <button class="button toggle up cuecard-queryEditor-options-toggle" style="display:none">\n        Options\n      </button>;\n      <button class="button cuecard-queryEditor-cleanUp" onclick="return mjt._eventcb.;.apply(this, [event])">\n        Tidy\n      </button>;\n      <button class="button primary cuecard-queryEditor-run" title="Ctrl-Enter" onclick="return mjt._eventcb.;.apply(this, [event])">\n        Run\n      </button>\n    </div>;\n    <div class="cuecard-queryEditor-write-form" style="display:none"></div>\n  </div>;;'.split(";"),
debug_locs:[1,1,1,1,1,1,7,7,7,7,11,11,11,11,11,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,22,22,22,22,22,22,22,22,22,22,22,26,26,26,26,26,26,26,26,26,29,29,29,29,29,33,33,33,33,33,34,35,36,37,38,39,40,41,42,44,44,44,44,44,44,45,45,45,45],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/control-pane.mjt",source:{def:function(){var b=function(){var a=this.tpackage,b=this.exports,c=a._template_fragments,e=a.runtime.new_markuplist(),f=0;e[f++]=c[0];var g=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[1];var g=[{name:"Tools",template:h,key:"tools"},{name:"Query Envelope",template:k,key:"envelope"},{name:"Variables",template:j,key:"variables"},
{name:"Settings",template:l,key:"settings"}];e[f++]=c[2];e[f++]=a.runtime.make_attr_safe(b,!1);e[f++]=c[3];a.runtime.foreach(this,g,function(d,g){for(var m=1;m;)e[f++]=c[4],e[f++]=a.runtime.make_attr_safe(b,!1),e[f++]=c[5],e[f++]=a.runtime.make_attr_safe(g.key,!1),e[f++]=c[6],e[f++]=g.name,e[f++]=c[7],m--;return m?a.runtime._break_token:a.runtime._continue_token});e[f++]=c[8];a.runtime.foreach(this,g,function(g,h){for(var j=1;j;)e[f++]=c[9],e[f++]=a.runtime.make_attr_safe(b,!1),e[f++]=c[10],e[f++]=
a.runtime.make_attr_safe(h.key,!1),e[f++]=c[11],e[f++]=h.template(d),e[f++]=c[12],j--;return j?a.runtime._break_token:a.runtime._continue_token});e[f++]=c[13];a.runtime.ondomready(function(){d.layout=function(){var a=this._elmt,b=a.find(".section-tabs").innerHeight()-a.find(".section-tabset").outerHeight();a.find(".cuecard-controlPane-tabBody").css("height",b)};d.layout()},this);e[f++]=c[14];return e},g=a.runtime.tfunc_factory("tabs(id, controlPane)",g,a,void 0,!1);b.tabs=g;g.source_microdata=null;
e[f++]=c[15];var h=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[16];var f=[{label:"Expand properties",command:"_qualify",hint:'E.g., "id" becomes "/type/object/id"'},{label:"Invert query",command:"_redangle",hint:"Make innermost cursour-containing node the outermost node"},{label:"Remove linebreaks",command:"_oneLiner",hint:"Reformat query to a single line"},{label:"Create Template",command:"_generateCode",hint:"Create an Acre template that displays the result of this query"}];d[e++]=
c[17];var g=function(d){var e=a.runtime.new_markuplist(),f=0;a.runtime.foreach(this,d,function(d,g){for(var m=1;m;){e[f++]=c[18];this.subst_id&&(e[f++]=a.runtime.bless(' id="'+this.subst_id+'"'));e[f++]=c[19];var h=a.runtime.uniqueid("onclick");mjt._eventcb[h]=function(){b[g.command]()};e[f++]=c[20];e[f++]=a.runtime.make_attr_safe(g.label,!1);e[f++]=c[21];e[f++]=a.runtime.make_attr_safe(h,!1);e[f++]=c[22];e[f++]=g.hint;e[f++]=c[23];m--}return m?a.runtime._break_token:a.runtime._continue_token});return e},
g=a.runtime.tfunc_factory("button(buttons)",g,a,void 0,!1);g.source_microdata=null;d[e++]=c[24];d[e++]=g(f.slice(0,3));d[e++]=c[25];d[e++]=g(f.slice(3));d[e++]=c[26];return d},h=a.runtime.tfunc_factory("tools(controlPane)",h,a,void 0,!1);b.tools=h;h.source_microdata=null;e[f++]=c[27];var j=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[28];var f=function(){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[29];this.subst_id&&(d[e++]=a.runtime.bless(' id="'+this.subst_id+'"'));d[e++]=c[30];var g=
a.runtime.uniqueid("onclick");mjt._eventcb[g]=function(){b._getTab("variables").find(".cuecard-controlPane-variables").append($.acre(f()))};d[e++]=c[31];d[e++]=a.runtime.make_attr_safe(g,!1);d[e++]=c[32];g=a.runtime.uniqueid("onclick");mjt._eventcb[g]=function(){b._removeRow($(this),"tr.query-options-row",f)};d[e++]=c[33];d[e++]=a.runtime.make_attr_safe(g,!1);d[e++]=c[34];return d},f=a.runtime.tfunc_factory("add_row()",f,a,void 0,!1);f.source_microdata=null;d[e++]=c[35];d[e++]=f();d[e++]=c[36];return d},
j=a.runtime.tfunc_factory("variables(controlPane)",j,a,void 0,!1);b.variables=j;j.source_microdata=null;e[f++]=c[37];var k=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[38];var f=b._getDefaults();d[e++]=c[39];a.runtime.foreach(this,[{name:"Extended",hint:"Enable MQL extensions"},{name:"As_of_time",hint:"Resolve the query based on data in Freebase as of the given time in ISO8601 format, e.g., 2009-02-28, 2009-03-13T22:16:40"},{name:"page",hint:'Page number starting from 1 if there is a "limit" property in the top level query node.'},
{name:"cursor",hint:""},{name:"Language",hint:"Return text values in the given language (specified with the language's Freebase ID)"},{name:"Escape",hint:""},{name:"uniqueness_failure",hint:""},{name:"use_permission_of",hint:'Specify the id of an object (typically a user, domain or type) whose permission you want to copy (<a href="http://freebaseapps.com/docs/mql/ch06.html#id2972357" target="_blank">more details</a>).'},{name:"Show Costs",hint:"Inlcude backend costs of executing the query."}],function(g,
h){for(var j=1;j;){d[e++]=c[40];d[e++]=h.name;d[e++]=c[41];switch(h.name){case "Show Costs":d[e++]=c[42];var k=f.costs?{checked:""}:{};"class"in k||(d[e++]=c[43]);"name"in k||(d[e++]=c[44]);"type"in k||(d[e++]=c[45]);for(var l in k)d[e++]=" "+l,d[e++]=a.runtime.bless('="'),d[e++]=a.runtime.htmlencode(""+k[l]),d[e++]=a.runtime.bless('"');d[e++]=c[46];break;case "Extended":d[e++]=c[47];k=f.extended?{checked:""}:{};"class"in k||(d[e++]=c[48]);"name"in k||(d[e++]=c[49]);"type"in k||(d[e++]=c[50]);for(var p in k)d[e++]=
" "+p,d[e++]=a.runtime.bless('="'),d[e++]=a.runtime.htmlencode(""+k[p]),d[e++]=a.runtime.bless('"');d[e++]=c[51];break;case "As_of_time":d[e++]=c[52];d[e++]=a.runtime.make_attr_safe(f.as_of_time||"",!1);d[e++]=c[53];break;case "use_permission_of":d[e++]=c[54];d[e++]=a.runtime.make_attr_safe(f.use_permission_of||"",!1);d[e++]=c[55];break;case "page":d[e++]=c[56];k=a.runtime.uniqueid("onclick");mjt._eventcb[k]=function(){b._runPage(-1)};d[e++]=c[57];d[e++]=a.runtime.make_attr_safe(k,!1);d[e++]=c[58];
k=a.runtime.uniqueid("onclick");mjt._eventcb[k]=function(){b._runPage(1)};d[e++]=c[59];d[e++]=a.runtime.make_attr_safe(k,!1);d[e++]=c[60];break;case "cursor":d[e++]=c[61];k=a.runtime.uniqueid("onchange");mjt._eventcb[k]=function(){b._getTab("envelope").find("input[name='cursor'][value='custom']").attr("checked","checked")};d[e++]=c[62];d[e++]=a.runtime.make_attr_safe(k,!1);d[e++]=c[63];k=a.runtime.uniqueid("onclick");mjt._eventcb[k]=function(){b._runCursor(!1)};d[e++]=c[64];d[e++]=a.runtime.make_attr_safe(k,
!1);d[e++]=c[65];k=a.runtime.uniqueid("onclick");mjt._eventcb[k]=function(){b._runCursor(!0)};d[e++]=c[66];d[e++]=a.runtime.make_attr_safe(k,!1);d[e++]=c[67];break;case "Language":d[e++]=c[68];a.runtime.foreach(this,CueCard.Languages,function(b,f){for(var g=1;g;){d[e++]=c[69];var h=fb.lang===f.id?{selected:"selected"}:{};"value"in h||(d[e++]=c[70],d[e++]=a.runtime.make_attr_safe(f.id,!1),d[e++]=c[71]);for(var j in h)d[e++]=" "+j,d[e++]=a.runtime.bless('="'),d[e++]=a.runtime.htmlencode(""+h[j]),d[e++]=
a.runtime.bless('"');d[e++]=c[72];d[e++]=f.name;d[e++]=c[73];d[e++]=f.id;d[e++]=c[74];g--}return g?a.runtime._break_token:a.runtime._continue_token});d[e++]=c[75];break;case "Escape":d[e++]=c[76];break;case "uniqueness_failure":d[e++]=c[77]}d[e++]=c[78];0<h.hint.length&&(d[e++]=c[79],d[e++]=mjt.bless(h.hint),d[e++]=c[80]);d[e++]=c[81];j--}return j?a.runtime._break_token:a.runtime._continue_token});d[e++]=c[82];var g="env"in b._options?b._options.env:{},h=!1;d[e++]=c[83];var j=function(d,e,f){var g=
a.runtime.new_markuplist(),h=0;g[h++]=c[84];this.subst_id&&(g[h++]=a.runtime.bless(' id="'+this.subst_id+'"'));g[h++]=c[85];g[h++]=a.runtime.make_attr_safe(e||"",!1);g[h++]=c[86];g[h++]=a.runtime.make_attr_safe(f||"",!1);g[h++]=c[87];e=a.runtime.uniqueid("onclick");mjt._eventcb[e]=function(){b._getTab("envelope").find("table.cuecard-controlPane-customEnvelope").append($.acre(j()))};g[h++]=c[88];g[h++]=a.runtime.make_attr_safe(e,!1);g[h++]=c[89];e=a.runtime.uniqueid("onclick");mjt._eventcb[e]=function(){b._removeRow($(this),
"tr.cuecard-controlPane-customEnvelope-row",j)};g[h++]=c[90];g[h++]=a.runtime.make_attr_safe(e,!1);g[h++]=c[91];if(!d)a.runtime.ondomready(function(){},this);g[h++]=c[92];return g},j=a.runtime.tfunc_factory("add_row(dontFocus, name, value)",j,a,void 0,!1);j.source_microdata=null;d[e++]=c[93];a.runtime.foreach(this,g,function(b,f){for(var g=1;g;)d[e++]=c[94],h=!0,d[e++]=c[95],d[e++]=j(!0,b,JSON.stringify(f)),d[e++]=c[96],g--;return g?a.runtime._break_token:a.runtime._continue_token});d[e++]=c[97];
h||(d[e++]=c[98],d[e++]=j(!0),d[e++]=c[99]);d[e++]=c[100];return d},k=a.runtime.tfunc_factory("envelope(controlPane)",k,a,void 0,!1);b.envelope=k;k.source_microdata=null;e[f++]=c[101];var l=function(){var b=a.runtime.new_markuplist(),d=0;b[d++]=c[102];var e="1"==$.localstore("cc_cp_clean")?{checked:""}:{};"type"in e||(b[d++]=c[103]);for(var f in e)b[d++]=" "+f,b[d++]=a.runtime.bless('="'),b[d++]=a.runtime.htmlencode(""+e[f]),b[d++]=a.runtime.bless('"');b[d++]=c[104];e="1"==$.localstore("cc_cp_align")?
{checked:""}:{};"type"in e||(b[d++]=c[105]);for(var g in e)b[d++]=" "+g,b[d++]=a.runtime.bless('="'),b[d++]=a.runtime.htmlencode(""+e[g]),b[d++]=a.runtime.bless('"');b[d++]=c[106];g="1"==$.localstore("cc_cp_multi")?{checked:""}:{};"type"in g||(b[d++]=c[107]);for(var h in g)b[d++]=" "+h,b[d++]=a.runtime.bless('="'),b[d++]=a.runtime.htmlencode(""+g[h]),b[d++]=a.runtime.bless('"');b[d++]=c[108];return b},l=a.runtime.tfunc_factory("settings(controlPane)",l,a,void 0,!1);b.settings=l;l.source_microdata=
null;e[f++]=c[109];return e};b.source_microdata=null;return b}(),info:{file:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/control-pane.mjt",stringtable:'{{\n\n  <div class="cuecard-controlPane section-tabs">\n    <div id="{">\n      <ul class="section-tabset clear">{\n        <li class="section-tab tab">\n          <a href="#{-{"><span>{</span></a>\n        </li>{\n      </ul>\n      <div class="tabbed-content">{\n        <div class="cuecard-controlPane-tabBody" id="{-{">\n          {\n        </div>{\n      </div>\n    </div>\n  </div>{{{{{<div class="cuecard-controlPane-powerTool"{>{\n    <input class="button" type="submit" value="{" onclick="return mjt._eventcb.{.apply(this, [event])">\n    <span class="cuecard-controlPane-powerTool-hint">{</span>\n  </div>{\n\n\n  <div class="cuecard-controlPane-section">\n    <p><em>Transform query</em>, outputting to:\n      <input checked="true" name="tools-result" type="radio" value="replace">query pane\n      <input name="tools-result" type="radio" value="output">results pane</p>\n    {\n  </div>\n\n  <div class="cuecard-controlPane-section">\n    <p><em>Acre Templates</em></p>\n    {\n  </div>{{\n  <table class="cuecard-controlPane-variables">\n    <tr>\n      <th><h3 class="module-section-title">Name</h3></th>\n      <th><h3 class="module-section-title">Value</h3></th>\n      <th></th>\n    </tr>{<tr class="query-options-row"{>\n      <td><input class="text-input variables-input"></td>\n      <td><input class="text-input variables-input"></td>\n      <td style="vertical-align:top">{\n        <button class="button small" onclick="return mjt._eventcb.{.apply(this, [event])">+</button>{\n        <button class="button small" onclick="return mjt._eventcb.{.apply(this, [event])">-</button>\n      </td>\n    </tr>{\n    {\n  </table>\n  <div>\n\n  </div>{{{\n\n  <div class="cuecard-controlPane-explanation">\n    <p>The query envelope contains directives to the query engine, specifying how to execute the query or how to return the results.</p>\n  </div>\n  <div class="cuecard-controlPane-configurations">{\n    <div class="query-options-row">\n      <p><em>{</em></p>{<input{ class="query-options-input"{ name="costs"{ type="checkbox"{>{<input{ class="query-options-input"{ name="extended"{ type="checkbox"{>{<input class="query-options-textbox text-input" name="as_of_time" value="{">{<input class="query-options-textbox text-input" name="use_permission_of" value="{">{<div class="cuecard-controlPane-configurations-page">\n            <input class="query-options-textbox text-input" name="page" type="text">{\n            <input class="button" type="submit" value="Previous" onclick="return mjt._eventcb.{.apply(this, [event])">{\n            <input class="button" type="submit" value="Next" onclick="return mjt._eventcb.{.apply(this, [event])">\n          </div>{\n            <div class="query-options-row">\n              <input checked="" class="control-pane-radio" id="cursor-unspecified" name="cursor-opt" type="radio" value="">\n              <label class="control-pane-label" for="cursor-unspecified">unspecified (return all results, possibly time-out)</label>\n            </div>\n            <div class="query-options-row">\n              <input class="control-pane-radio" id="cursor-true" name="cursor-opt" type="radio" value="true">\n              <label class="control-pane-label" for="cursor-true">true (start pagination with page size equal "limit" option in query)</label>\n            </div>\n            <div class="query-options-row">\n              <input class="control-pane-radio" id="cursor-continue" name="cursor-opt" type="radio" value="custom">\n              <label class="control-pane-label" for="cursor-continue">continue from cursor: </label>\n              <div class="cuecard-controlPane-configurations-cursor">{\n                <input class="query-options-textbox text-input" name="cursor" type="text" onchange="return mjt._eventcb.{.apply(this, [event])">\n                <div class="query-options-row">{\n                  <input class="button" type="submit" value="Paste from Last Result" onclick="return mjt._eventcb.{.apply(this, [event])">{\n                  <input class="button" type="submit" value="Paste &amp; Run" onclick="return mjt._eventcb.{.apply(this, [event])">\n                </div>\n              </div>\n            </div>{<select class="cuecard-controlPane-configurations-languages">\n            <option value="">--</option>{\n            <option{ value="{"{>\n              { ({)\n            </option>{\n          </select>{<select>\n            <option value="">--</option>\n            <option value="html">html</option>\n            <option value="false">false</option>\n          </select>{<select>\n            <option value="">--</option>\n            <option value="soft">soft</option>\n          </select>{\n        <\!-- bless is OK because hints only come from ENV declared statically above --\>{\n        <div class="cuecard-controlPane-hint">{</div>{\n    </div>{\n  </div>{\n\n  <p><em>Custom Envelope</em></p>\n  <table class="cuecard-controlPane-customEnvelope">\n    <tr>\n      <th><h3 class="module-section-title">Name</h3></th>\n      <th><h3 class="module-section-title">Value</h3></th>\n      <th></th>\n    </tr>{<tr class="cuecard-controlPane-customEnvelope-row"{>\n      <td><input class="query-options-textbox text-input variables-input" value="{"></td>\n      <td><input class="query-options-textbox text-input variables-input" value="{"></td>\n      <td style="vertical-align: top">{\n        <button class="button small" onclick="return mjt._eventcb.{.apply(this, [event])">+</button>{\n        <button class="button small" onclick="return mjt._eventcb.{.apply(this, [event])">-</button>\n      </td>{\n    </tr>{{{\n      {{{\n      {{\n  </table>{{\n  <div class="cuecard-controlPane-section">\n    <div class="cuecard-controlPane-setting">\n     <input{ type="checkbox"{>\n     <label class="control-pane-label">Always tidy running query</label>\n    </div>\n    <div class="cuecard-controlPane-setting">\n      <input{ type="checkbox"{>\n      <label class="control-pane-label">Align JSON values with spaces</label>\n    </div>\n    <div class="cuecard-controlPane-setting" style="display: none;">\n      <input type="checkbox">\n      <label class="control-pane-label">Try running query as you edit</label>\n    </div>\n    <div class="cuecard-controlPane-setting">\n      <input{ type="checkbox"{>\n      <label class="control-pane-label">Show multi-line errors on multiple lines</label>\n    </div>\n  </div>{'.split("{"),
debug_locs:[1,1,1,1,1,1,7,7,7,7,9,9,10,11,12,13,14,15,16,19,19,19,19,19,21,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,26,26,26,26,26,26,26,26,26,26,26,27,27,27,28,28,28,28,28,28,33,33,33,33,33,33,34,35,36,37,38,39,40,41,42,42,42,42,42,42,44,44,44,44,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,71,71,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,72,73,73,73,74,74,74,74,74,74,74,74,74,74,81,81,81,81,81,81,81,81,81,86,86,86,86,86,86,86,90,90,90,90,90,90,90,93,
93,93,93,100,100,100,100,100,100,100,100,100,100,100,100,105,105,105,105,105,105,105,105,105,105,107,107,107,107,107,107,107,109,109,109,109,109,109,109,110,110,110,115,115,115,115,115,115,115,115,115,115,118,118,118,118,120,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,140,140,140,140,140,140,140,140,140,141,141,141,141,142,142,142,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,148,148,
148,148,148,150,150,150,150,150,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,156,156,156,156,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,173,173,173,173,173,173,173,173,174,174,174,174,174,174,174,178,178,178,178,178,178,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,184,184,184,184,184,185,185,185,185,185,185,186,186,186,186,192,192,192,192,192,192,192,197,197,197,197,197,197,201,201,201,201,201,201,201,201,202,202,202,202,
202,202,205,205,205,206,207,208,217,217,217,217,217,217,217,217,217,217,217,217,217,217,218,218,218,219,219,219,222,222,222,222,222,222,222,222,224,224,224,224,224,224,224,226,226,226,226,226,227,228,229,229,230,230,230,230,230,230,230,230,230,230,231,231,233,233,233,234,234,234,234,234,234,234,235,235,235,236,236,240,240,240,240,240,240,240,242,242,242,242,245,245,245,245,245,245,245,245,245,245,245,245,245,245,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,257,257,257,257,257,257,257,
257,257,257,257,257,257,257,257,257,257,257,257,261,261,261,261,261,261,261,261,261,263,263,263,263],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/output-pane.mjt",source:{def:function(){var b=function(){var a=this.tpackage,b=this.exports,c=a._template_fragments,e=a.runtime.new_markuplist(),f=0;e[f++]=c[0];var g=this.exports,h;e[f++]=c[1];var j=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[2];h=d;e[f++]=c[3];e[f++]=a.runtime.make_attr_safe(b,!1);e[f++]=c[4];a.runtime.foreach(this,h._TABS,
function(d,g){for(var h=1;h;)e[f++]=c[5],e[f++]=a.runtime.make_attr_safe(b,!1),e[f++]=c[6],e[f++]=a.runtime.make_attr_safe(g.key,!1),e[f++]=c[7],e[f++]=g.name,e[f++]=c[8],h--;return h?a.runtime._break_token:a.runtime._continue_token});e[f++]=c[9];a.runtime.foreach(this,h._TABS,function(d,h){for(var j=1;j;)e[f++]=c[10],e[f++]=a.runtime.make_attr_safe(h.key,!1),e[f++]=c[11],e[f++]=a.runtime.make_attr_safe(b,!1),e[f++]=c[12],e[f++]=a.runtime.make_attr_safe(h.key,!1),e[f++]=c[13],e[f++]=g[h.key](),e[f++]=
c[14],j--;return j?a.runtime._break_token:a.runtime._continue_token});e[f++]=c[15];a.runtime.ondomready(function(){var a=$(h._elmt);h._container=a.find(".cuecard-outputPane");h._tabsContainer=a.find(".cuecard-outputPane-tabs");h._contentContainer=a.find(".cuecard-outputPane-content")},this);e[f++]=c[16];return e},j=a.runtime.tfunc_factory("tabs(id, oP)",j,a,void 0,!1);b.tabs=j;j.source_microdata=null;e[f++]=c[17];j=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[18];if(b&&b.result){e[f++]=
c[19];var g=function(a,b){function c(a,b){for(var d in a){var e=a[d],f=b[d],e=jQuery.isArray(e)?e[0]:e,f=jQuery.isArray(f)?f[0]:f;if(void 0===f||jQuery.isPlainObject(e)&&jQuery.isPlainObject(f)&&!c(e,f))return!1}return!0}for(var d=jQuery.extend(!0,{},h),b=jQuery.isArray(b)?b[0]:b,e=0;e<a.length;e++)if(d=d[a[e]],void 0===d)return!1;return jQuery.isPlainObject(d)?c(b,d):!0},h,j=function(a){if(jQuery.isPlainObject(a)){var b=!1,c;for(c in a){var b=!0,d=j(a[c]);void 0===d?delete a[c]:a[c]=d}return b?a:
void 0}return jQuery.isArray(a)?a.length?j(a[0]):void 0:null===a?void 0:a};h=j(d.query||{});e[f++]=c[20];var r=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[21];this.subst_id&&(e[f++]=a.runtime.bless(' id="'+this.subst_id+'"'));e[f++]=c[22];a.runtime.foreach(this,b,function(b,h){for(var j=1;j;)g(d.concat(b),h)||(e[f++]=c[23],e[f++]=b.split(":")[0].replace(/_/g," "),e[f++]=c[24],e[f++]=s(h,d.concat(b)),e[f++]=c[25]),j--;return j?a.runtime._break_token:a.runtime._continue_token});e[f++]=
c[26];return e},r=a.runtime.tfunc_factory("thead(r, path)",r,a,void 0,!1);r.source_microdata=null;e[f++]=c[27];var s=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[28];jQuery.isArray(b)&&(b=b[0]);e[f++]=c[29];jQuery.isPlainObject(b)&&(e[f++]=c[30],a.runtime.foreach(this,b,function(b,h){for(var j=1;j;)g(d.concat(b),h)||(e[f++]=c[31],e[f++]=b.split(":")[0].replace(/_/g," "),e[f++]=c[32],e[f++]=s(h,d.concat(b)),e[f++]=c[33]),j--;return j?a.runtime._break_token:a.runtime._continue_token}),
e[f++]=c[34]);e[f++]=c[35];return e},s=a.runtime.tfunc_factory("thead_value(v, path)",s,a,void 0,!1);s.source_microdata=null;e[f++]=c[36];var u=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[37];jQuery.isPlainObject(b)?(e[f++]=c[38],a.runtime.foreach(this,b,function(b,h){for(var j=1;j;)g(d.concat(b),h)||(e[f++]=c[39],e[f++]=t(h,d.concat(b)),e[f++]=c[40]),j--;return j?a.runtime._break_token:a.runtime._continue_token}),e[f++]=c[41]):(e[f++]=c[42],e[f++]=t(val,d),e[f++]=c[43]);e[f++]=c[44];
return e},u=a.runtime.tfunc_factory("row(r, path)",u,a,void 0,!1);u.source_microdata=null;e[f++]=c[45];var t=function(b,d){var e=a.runtime.new_markuplist(),f=0;e[f++]=c[46];switch(typeof b){case "string":e[f++]=c[47];/^\//.test(b)?(e[f++]=c[48],e[f++]=a.runtime.make_attr_safe(b,!0),e[f++]=c[49],e[f++]=b,e[f++]=c[50]):(e[f++]=c[51],e[f++]=b);e[f++]=c[52];break;case "number":e[f++]=c[53];e[f++]=b;break;case "boolean":e[f++]=c[54];e[f++]=b?"true":"false";break;case "object":e[f++]=c[55],jQuery.isArray(b)?
(e[f++]=c[56],a.runtime.foreach(this,b,function(b,g){for(var h=1;h;)e[f++]=c[57],e[f++]=t(g,d),e[f++]=c[58],h--;return h?a.runtime._break_token:a.runtime._continue_token}),e[f++]=c[59]):jQuery.isPlainObject(b)&&(e[f++]=c[60],a.runtime.foreach(this,b,function(b,h){for(var j=1;j;)g(d.concat(b),h)||(e[f++]=c[61],e[f++]=t(h,d.concat(b)),e[f++]=c[62]),j--;return j?a.runtime._break_token:a.runtime._continue_token}),e[f++]=c[63]),e[f++]=c[64]}e[f++]=c[65];return e},t=a.runtime.tfunc_factory("value(a, path)",
t,a,void 0,!1);t.source_microdata=null;e[f++]=c[66];if(jQuery.isArray(b.result)){e[f++]=c[67];e[f++]=r(b.result[0],[]);e[f++]=c[68];a.runtime.foreach(this,b.result,function(b,d){for(var g=1;g;)e[f++]=c[69],e[f++]=u(d,[]),e[f++]=c[70],g--;return g?a.runtime._break_token:a.runtime._continue_token});e[f++]=c[71];b.cursor&&(e[f++]=c[72]);e[f++]=c[73];if(b.result.length==(d.query.limit||100))e[f++]=c[74];e[f++]=c[75]}else e[f++]=c[76],"object"===typeof b.result&&(e[f++]=c[77],e[f++]=r(b.result,[])),e[f++]=
c[78],e[f++]=u(b.result,[]),e[f++]=c[79];e[f++]=c[80]}e[f++]=c[81];return e};j=a.runtime.tfunc_factory("list(o, q)",j,a,void 0,!1);b.list=j;j.source_microdata=null;e[f++]=c[82];j=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[83];h._options.stylesheet&&(d[e++]=c[84],d[e++]=a.runtime.make_attr_safe(h._options.stylesheet,!0),d[e++]=c[85]);d[e++]=c[86];d[e++]=b;d[e++]=c[87];return d};j=a.runtime.tfunc_factory("list_error(message)",j,a,void 0,!1);b.list_error=j;j.source_microdata=null;e[f++]=
c[88];j=a.runtime.tfunc_factory("json()",function(){var b=a.runtime.new_markuplist(),d=0;b[d++]=c[89];return b},a,void 0,!1);b.json=j;j.source_microdata=null;e[f++]=c[90];j=a.runtime.tfunc_factory("help()",function(){var b=a.runtime.new_markuplist(),d=0;b[d++]=c[91];a.runtime.foreach(this,CueCard.ExampleTechniques,function(e,f){for(var g=1;g;){b[d++]=c[92];var h="all"===f?{checked:"checked"}:{};"data-technique"in h||(b[d++]=c[93],b[d++]=a.runtime.make_attr_safe(f,!1),b[d++]=c[94]);for(var j in h)b[d++]=
" "+j,b[d++]=a.runtime.bless('="'),b[d++]=a.runtime.htmlencode(""+h[j]),b[d++]=a.runtime.bless('"');b[d++]=c[95];b[d++]=f;b[d++]=c[96];b[d++]=CueCard.ExampleTechniqueMap[f].length;b[d++]=c[97];g--}return g?a.runtime._break_token:a.runtime._continue_token});b[d++]=c[98];var e=function(b){var d=a.runtime.new_markuplist(),e=0;d[e++]=c[99];a.runtime.foreach(this,CueCard.Examples,function(f,g){for(var h=1;h;){if("all"!==b?-1!==g.techniques.indexOf(b):1)d[e++]=c[100],d[e++]=a.runtime.make_attr_safe(f,!1),
d[e++]=c[101],d[e++]=a.runtime.make_attr_safe(f,!1),d[e++]=c[102],d[e++]=g.name,d[e++]=c[103];h--}return h?a.runtime._break_token:a.runtime._continue_token});d[e++]=c[104];return d},e=a.runtime.tfunc_factory("list_examples(technique)",e,a,void 0,!1);e.source_microdata=null;b[d++]=c[105];a.runtime.ondomready(function(){selectTechnique=function(a){a=a||"all";$(".cuecard-examples-list").acre(e(a));return!1};selectExample=function(a){$(".cuecard-examples-example").removeClass("cuecard-examples-example-selected");
$("#cuecard-example-"+a).addClass("cuecard-examples-example-selected");h._options.queryEditor.content(CueCard.jsonize(CueCard.Examples[a].query,{indentCount:2}));h._options.queryEditor.run(!1);return!1};selectTechnique();$(".cuecard-examples-technique").change(function(){var a=$("option:selected",this).attr("data-technique");selectTechnique(a)})},this);b[d++]=c[106];return b},a,void 0,!1);b.help=j;j.source_microdata=null;e[f++]=c[107];return e};b.source_microdata=null;return b}(),info:{file:"//104a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/mjt/output-pane.mjt",
stringtable:',,,\n  \n  <div class="cuecard-outputPane" id=",">\n    <div class="cuecard-outputPane-tabs section-tabs">\n      <ul class="section-tabset clear">,\n        <li class="section-tab">\n          <a href="#,-,"><span>,</span></a>\n        </li>,\n      </ul>\n    </div>\n    <div class="cuecard-outputPane-content tabbed-content module-section">,\n      <div class="cuecard-outputPane-tabBody cuecard-outputPane-," id=",-,">\n        ,\n      </div>,\n    </div>\n  </div>,,,,\n  <table class="data-table">,,<thead,>\n      <tr>,\n        <th>\n          , ,\n        </th>,\n      </tr>\n    </thead>,,,,\n      <ul>,\n        <li>\n          , ,\n        </li>,\n      </ul>,,,,,\n        <td>\n          ,\n        </td>,,\n      <td>,</td>,,,,,\n          <a class="cuecard-outputPane-dataLink" href=",">,</a>,,,,,,\n          <ul class="data-list">,\n            <li>\n              ,\n            </li>,\n          </ul>,\n          <ul class="data-list">,\n            <li>\n              ,\n            </li>,\n          </ul>,,,,\n      ,\n      <tbody>,\n        <tr>,</tr>,\n      </tbody>\n      <tfooter>\n        <tr>\n          <td>,\n            <button onclick="__cc_runPage(-1)">Previous</button>,,\n            <button onclick="__cc_runPage(1)">Next</button>,\n          </td>\n        </tr>\n      </tfooter>,,,\n      <tbody>\n        <tr>,</tr>\n      </tbody>,\n  </table>,,,,\n  <link href="," rel="stylesheet">,\n  <div class="cuecard-outputPane-list-error">,</div>,,,,\n  <div class="cuecard-outputPane-helpContent">\n    <h1 class="title">The Query Editor enables you to run \n      <a href="http://wiki.freebase.com/wiki/Mql" rel="external help">MQL</a> queries in the browser and retrieve Freebase data</h1>\n    <h2>Enter your query and hit "Run" to get started.</h2>\n    <ul class="clear" id="help-links">\n      <li><a href="http://wiki.freebase.com/wiki/MQL" target="_blank">MQL API Guide</a></li>\n      <li><a href="http://wiki.freebase.com/wiki/MQL_Manual" target="_blank">MQL Reference</a></li>\n    </ul>\n\n    <div class="modal-inner" id="examples">\n      <div class="header">\n        <select class="cuecard-examples-technique">,\n          <option, data-technique=",",>\n            , (,)\n          </option>,\n        </select>\n        <h1 class="modal-title">\n          <span>Sample Queries</span>\n        </h1>\n      </div>,,\n        <a class="cuecard-examples-example" href="javascript:void(0);" id="cuecard-example-," onclick="return selectExample(\',\');">\n          ,\n        </a>,,\n      \n      <div class="cuecard-examples-list"></div>\n    </div>,\n  </div>,'.split(","),
debug_locs:[1,1,1,1,1,1,6,6,7,8,9,11,11,11,11,13,13,14,15,17,17,17,17,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,28,28,28,28,28,28,32,32,32,32,32,33,34,35,36,37,38,39,39,39,39,39,39,41,41,41,41,42,42,43,43,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,96,96,96,96,96,98,98,98,98,98,98,99,99,99,99,99,99,100,100,100,100,100,
100,100,102,102,102,102,102,102,102,104,104,104,104,105,105,106,106,107,107,107,107,107,107,108,108,108,108,108,108,109,109,109,109,109,109,109,110,110,110,111,111,111,111,111,113,113,113,113,114,114,115,115,115,115,115,116,116,116,116,117,117,117,117,117,117,117,118,118,119,119,119,119,119,119,120,120,120,120,120,122,122,122,122,123,123,123,125,125,125,125,125,125,125,125,125,126,126,126,126,127,127,127,128,128,128,128,129,129,129,129,131,131,132,132,132,132,132,133,133,133,133,134,134,134,134,134,
134,135,135,135,136,137,137,137,137,137,137,138,138,138,138,139,139,139,139,139,139,139,140,140,140,141,141,141,142,142,142,142,142,145,145,146,146,146,148,148,148,148,148,148,148,148,148,148,148,148,148,153,153,153,153,153,153,153,153,153,154,154,154,154,154,158,158,158,158,158,159,160,160,160,160,160,162,162,162,162,164,164,164,165,165,165,166,166,166,166,166,166,169,169,169,169,170,170,170,170,170,170,170,171,171,171,172,172,172,172,172,172,175,175,175,175,176,176,176,176,176,176,179,179,179,179,
193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,194,194,194,194,194,195,195,195,195,195,195,202,202,202,202,202,202,202,202,202,205,205,205,205,205,205,205,205,205,205,206,206,206,207,207,207,207,207,207,207,208,208,208,208,208,212,212,212,212,212,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,236,236,236,236,236,236,236,237,237,237,237],output_mode:"html"}}})})(window.freebase.acre,
window.freebase.h);
