
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(){var a=window.mjt,b=window.mjt={};b.noConflict=function(){window.mjt=a;return b};b.NAME="mjt";b.VERSION="0.9.3";b.LICENSE="========================================================================\nCopyright (c) 2007-2009, Metaweb Technologies, Inc.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY METAWEB TECHNOLOGIES ``AS IS'' AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE ARE DISCLAIMED. IN NO EVENT SHALL METAWEB TECHNOLOGIES BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\nWHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\nOR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN\nIF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n========================================================================\n"})();
var JSON=JSON||{};
(function(){function a(k){return k<10?"0"+k:k}function b(k){e.lastIndex=0;return e.test(k)?'"'+k.replace(e,function(n){var p=j[n];return typeof p==="string"?p:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function c(k,n){var p,o,l,m,q=f,t,s=n[k];if(s&&typeof s==="object"&&typeof s.toJSON==="function")s=s.toJSON(k);if(typeof h==="function")s=h.call(n,k,s);switch(typeof s){case "string":return b(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);case "object":if(!s)return"null";
f+=g;t=[];if(Object.prototype.toString.apply(s)==="[object Array]"){m=s.length;for(p=0;p<m;p+=1)t[p]=c(p,s)||"null";l=t.length===0?"[]":f?"[\n"+f+t.join(",\n"+f)+"\n"+q+"]":"["+t.join(",")+"]";f=q;return l}if(h&&typeof h==="object"){m=h.length;for(p=0;p<m;p+=1){o=h[p];if(typeof o==="string")if(l=c(o,s))t.push(b(o)+(f?": ":":")+l)}}else for(o in s)if(Object.hasOwnProperty.call(s,o))if(l=c(o,s))t.push(b(o)+(f?": ":":")+l);l=t.length===0?"{}":f?"{\n"+f+t.join(",\n"+f)+"\n"+q+"}":"{"+t.join(",")+"}";
f=q;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return this.valueOf()?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,n,p){var o;g=f="";if(typeof p==="number")for(o=0;o<p;o+=1)g+=" ";else if(typeof p==="string")g=p;if((h=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw new Error("JSON.stringify");return c("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,n){function p(l,m){var q,t,s=l[m];if(s&&typeof s==="object")for(q in s)if(Object.hasOwnProperty.call(s,q)){t=p(s,q);if(t!==undefined)s[q]=t;else delete s[q]}return n.call(l,m,s)}var o;d.lastIndex=0;if(d.test(k))k=k.replace(d,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){o=eval("("+k+")");return typeof n==="function"?p({"":o},""):o}throw new SyntaxError("JSON.parse");}})();
(function(a){if(typeof a.services=="undefined")a.services={};a.debug=0;var b={};a.uniqueid=function(d){var e=b[d];if(typeof e!=="number")e=1;b[d]=e+1;return d+"_"+e};var c=function(d,e){var f=document.createElement("div"),g,j;g=document.createElement("h3");g.style.backgroundColor="#fff0f0";g.appendChild(document.createTextNode(d));f.appendChild(g);for(var h=0;h<e.length;h++){var k=e[h];if(k instanceof Array){g=document.createElement("div");g.innerHTML=a.flatten_markup(k)}else{g=document.createElement("pre");
if(typeof k=="string")j=k;else try{j=JSON.stringify(k)}catch(n){j=""+k}j=j.replace(/\r?\n/g,"\r\n");g.appendChild(document.createTextNode(j))}f.appendChild(g)}(g=document.getElementById("mjt_debug_output"))||(g=document.getElementsByTagName("body")[0]);g&&g.appendChild(f)};(function(){function d(f){return Array.prototype.slice.apply(f).join(" ")}if(typeof console!="object"||typeof console.log=="undefined")if(typeof document!="undefined"){a.error=function(){c("error",arguments);return""};a.warn=function(){c("warning",
arguments);return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}else{if(typeof Packages!="undefined"){var e=java.lang.System.err;a.error=function(){e.println("error: "+d(arguments));return""};a.warn=function(){e.println("error: "+d(arguments));return""};a.log=function(){e.println("log: "+d(arguments));return""};a.note=function(){e.println("note: "+d(arguments));return""};a.openlog=function(){return""};
a.closelog=function(){return""};a.assert=function(){return""}}}else if(typeof console.debug=="function"){a.error=function(){console.error.apply(console,arguments);return""};a.warn=function(){console.warn.apply(console,arguments);return""};a.log=function(){console.log.apply(console,arguments);return""};a.note=function(){a.debug&&console.info.apply(console,arguments);return""};a.openlog=typeof console.group!="undefined"?function(){a.debug&&console.group.apply(console,arguments)}:a.log;a.closelog=typeof console.groupEnd!=
"undefined"?function(){a.debug&&console.groupEnd.apply(console,arguments);return""}:function(){return""};a.assert=function(f){if(!f){console.error.apply(console,arguments);throw new Error("assertion failed");}return""}}else{a.error=function(){console.log("error: "+d(arguments));return""};a.warn=function(){console.log("warning: "+d(arguments));return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}})();
a.formquote=function(d){if(/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(d))return d;return encodeURIComponent(d).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g")};a.formencode=function(d){var e=[],f="",g,j,h,k=[];for(g in d)k.push(g);k.sort();for(h in k){g=k[h];j=d[g];if(typeof j!="undefined"){j instanceof Array||(j=[j]);for(var n=0;n<j.length;n++){var p=j[n];e.push(f);f="&";e.push(a.formquote(g));e.push("=");e.push(a.formquote(p))}}}return e.join("")};
a.formdecode=function(d){if(typeof d=="undefined"||d===null)return{};d=d.replace(/^\s*/m,"").replace(/\s+$/m,"");if(d=="")return{};var e={};d=d.split("&");for(var f=0;f<d.length;f++){var g=d[f].indexOf("=");if(g<1)a.log('bad uri query argument, missing "=": ',d[f]);else{var j=[d[f].substring(0,g),d[f].substring(g+1)];g=decodeURIComponent(j[0].replace(/\+/g," "));j=decodeURIComponent(j[1].replace(/\+/g," "));if(g in e)if(e[g]instanceof Array)e[g].push(j);else e[g]=[e[g],j];else e[g]=j}}return e};a.form_url=
function(d,e){if(!(e&&a.formencode(e)))return d;return d+"?"+a.formencode(e)};a.htmlencode=function(d){if(typeof d!="string")d=""+d;return d.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")};a.label_package=function(d){var e=window;if(d){for(var f=d.split(".");f.length;)e=e[f.shift()];if(typeof e=="function")e=e.prototype;if((typeof e=="object"||typeof e=="function")&&e!==null)e._package_name=d;else a.log("missing package",d)}for(var g in e){f=e[g];if(a&&
a.Task&&f&&typeof f!="string"&&!f.nodeName&&f.constructor!=Array&&/function/i.test(f+"")&&typeof f.prototype=="object"&&f.prototype instanceof a.Task)f.prototype._task_class=d+"."+g}}})(mjt);
(function(a){var b=["safe_constructor_token"],c=function(e){return!!e&&typeof e!="string"&&!e.nodeName&&e.constructor!=Array&&/function/i.test(e+"")},d=function(e){var f=[];if(typeof e!="array")for(var g=0,j=e.length;g<j;g++)f.push(e[g]);else f=e.slice(0);return f};a.thunk=function(){return a.vthunk(arguments)};a.vthunk=function(){var e,f,g;f=arguments[0];g=typeof f=="object"&&typeof f.length=="number"?d(f):d(arguments);f=g.shift();if(typeof f=="string"){e=g.shift();f=f;c(e[f])||a.warn("mjt.thunk:",
f,"is not a method of",e)}else{e=null;f=f;c(f)||a.error("mjt.thunk:",f,"is not a function")}var j=arguments.callee._next_thunk_id||1;arguments.callee._next_thunk_id=j+1;var h=function(){var k=arguments.callee,n=k.bound_args.concat(d(arguments)),p=k.bound_this===null?this:k.bound_this,o=k.bound_func;if(typeof o=="string")o=p[o];c(o)||a.error("mjt.thunk: bad function",k,k.bound_func,p);return o.apply(p,n)};h.bound_this=e;h.bound_func=f;h.bound_args=g;h.thunk_id=j;return h};a.vcall=function(e){var f=
d(arguments).slice(1);return a.vthunk(e).apply(this,f)};a.vapply=function(e,f){return a.vthunk(e).apply(this,f)};a.Task=function(){if(arguments.length!==1||arguments[0]!==b){a.error("new mjt.Task() is illegal");throw new Error("don't call mjt.Task()");}};a.Task.prototype.toString=function(){return"["+this._task_id+"]"};a.Task.prototype.toMarkup=function(){return'<span class="mjt_task">task '+this._task_id+":"+this.state+"</span>"};if(typeof Object.getPrototypeOf!=="function")Object.getPrototypeOf=
typeof"test".__proto__==="object"?function(e){return e.__proto__}:function(e){return e.constructor.prototype};a.define_task=function(e,f){var g=function(){var j,h=d(arguments);if(this instanceof arguments.callee)if(h.length!==1||h[0]!==b)throw new Error("Task class should not be invoked with new ()");else return;else{j=new arguments.callee(b);j._factory=this}for(var k=[],n=arguments.callee;n!==undefined;n=n.__super)k.push(n);for(;k.length;){n=k.pop();n.prototype.hasOwnProperty("init")&&n.prototype.init.apply(j,
h)}typeof arguments.callee._auto_enqueue!="undefined"&&j.enqueue();return j};if(!e)e=a.Task;g.prototype=new e(b);g.prototype.constructor=g;g.__super=e;g.prototype.parameters=f||[];return g};a.Task._default_timeout=1E4;a.Task.pending=null;a.Task._on_pending_empty=[];a.Task.add_pending=function(e){if(this.pending==null)this.pending={};this.pending[e._task_id]=e};a.Task.delete_pending=function(e){if(!(this.pending===null||!(e._task_id in this.pending))){delete this.pending[e._task_id];for(var f in this.pending)return;
for(this.pending=null;this.pending==null&&this._on_pending_empty.length;)this._on_pending_empty.shift().ready()}};a.Task.prototype.init=function(){a.assert(typeof this.state==="undefined");this.state="init";this._onready=[];this._onerror=[];this._timeout=null;this._prereqs={};this._task_id=a.uniqueid(this._task_class?this._task_class:"task");a.Task.add_pending(this);for(var e=0;e<this.parameters.length;e++){var f=this.parameters[e];this[f.name]=typeof arguments[e]!="undefined"?arguments[e]:f["default"]}return this};
a.Task.prototype.set_timeout=function(e){if(typeof e==="undefined")e=a.Task._default_timeout;this._timeout!==null&&a.error("timeout already set");if(typeof setTimeout!="undefined")this._timeout=setTimeout(a.thunk("timeout",this),e);return this};a.Task.prototype.clear_timeout=function(){this._timeout!==null&&clearTimeout(this._timeout);this._timeout=null;return this};a.Task.prototype.require=function(e){if(this.state!=="init")throw new Error("task.enqueue() already called - too late for .require()");
if(e.state=="ready")return this;if(this.state=="error")return this;if(e.state=="error")return this._prereq_error(e);this._prereqs[e._task_id]=e;e.onready("_prereq_ready",this,e).onerror("_prereq_error",this,e);return this};a.Task.prototype.enqueue=function(){if(this.state!="init")return this;this.state="wait";a.Task.debug&&a.openlog(this,".enqueue()");try{for(var e in this._prereqs)this._prereqs[e].enqueue();return this._prereqs_check()}finally{a.closelog()}};a.Task.prototype._prereqs_check=function(){if(this._prereqs===
null)return this;for(var e in this._prereqs)return this;if(this.state=="init")return this;this._prereqs=null;this.request();return this};a.Task.prototype.request=function(){return this.ready()};a.Task.prototype._prereq_ready=function(e){if(this._prereqs===null)return this;delete this._prereqs[e._task_id];return this._prereqs_check()};a.Task.prototype._prereq_error=function(e){if(this._prereqs===null)return this;this._prereqs=null;e=e.messages[0];return this.error(e.code,e.message,e.text)};a.Task.prototype.onready=
function(){if(this.state=="ready")a.vcall(arguments,this.result);else this._onready instanceof Array&&this._onready.push(a.vthunk(arguments));return this};a.Task.prototype.onerror=function(){if(this.state=="error")a.vcall(arguments,this.messages[0].code,this.messages[0].message,this.messages[0].text);else this._onerror instanceof Array&&this._onerror.push(a.vthunk(arguments));return this};a.Task.prototype.ondone=function(){this.onready.apply(this,arguments);this.onerror.apply(this,arguments);return this};
a.Task.prototype._state_notify=function(e,f,g){if(!a.Task.debug){for(var j=0;j<f.length;j++){var h=f[j];h.apply(this,g)}return this}for(j=0;j<f.length;j++){h=f[j];typeof h.bound_func!=="undefined"?a.openlog(this,".on"+e," -> "+h.bound_this+".",h.bound_func,h.bound_args,h):a.openlog(this,".on"+e,h);try{h.apply(this,g)}finally{a.closelog()}}return this};a.Task.prototype.ready=function(e){if(this._prereqs!==null)for(var f in this._prereqs)if(typeof this._prereqs[f]!="undefined"){a.error("task.ready() called with remaining prereqs",
this);throw new Error("task.ready() called with remaining prereqs");}if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.ready() called in bad state "'+this.state+'", should be "wait"');this._onerror=null;this.clear_timeout();this.state="ready";f=this._onready;this._onready=null;this.result=e;a.Task.delete_pending(this);this._state_notify("ready",f,[e]);return this};a.Task.prototype._error=function(e,f){this._onready=this._prereqs=null;this.clear_timeout();
var g=this._onerror;this._onerror=null;if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.error() called in bad state "'+this.state+'". Error was '+e[0].message);this.state="error";this.messages=e;this._error_chain=f;var j=[e[0].code,e[0].message,e[0].text,this];a.Task.delete_pending(this);this._state_notify("error",g,j);return this};a.Task.prototype.error=function(e,f,g){return this._error([{code:e,message:f,text:typeof g!=="undefined"?g:""}])};
a.Task.prototype.error_nest=function(e){return this._error(e.messages,e)};a.Task.prototype.timeout=function(){this._timeout=null;return this.error("/user/mjt/messages/task_timeout","task timed out - possible unreachable server?")};a.Succeed=a.define_task(null,[{name:"succeed_result","default":null}]);a.Succeed.prototype.request=function(){return this.ready(this.succeed_result)};a.Fail=a.define_task(null,[{name:"fail_code","default":"mjt_fail"},{name:"fail_message","default":"error signaled using mjt.Fail"},
{name:"fail_full","default":""}]);a.Fail.prototype.request=function(){return this.error(this.fail_code,this.fail_message,this.fail_full)};a.Delay=a.define_task(null,[{name:"delay"}]);a.Delay.prototype.request=function(){var e=this;setTimeout(function(){e.ready(null)},this.delay)};a.NoPendingTasks=a.define_task();a.NoPendingTasks.prototype.init=function(){a.Task._on_pending_empty.push(this);a.Task.delete_pending(this)};a.NoPendingTasks.prototype.request=function(){}})(mjt);
(function(a){a.PagerSlice=a.define_task(null,[{name:"pager"},{name:"start"},{name:"count"}]);a.PagerSlice.prototype.init=function(){for(var b=this.chunks=this.pager.slice_chunks(this.start,this.count),c=0;c<b.length;c++)this.require(b[c]);return this.enqueue()};a.PagerSlice.prototype.request=function(){for(var b=this.chunks,c=[],d=0;d<b.length;d++){var e=b[d],f=this.start-e.start;if(!(f<0)){var g=f+this.count;if(f+g>e.count)g=e.count-f;g<=0||(c=f==0&&g==e.count?c.concat(e.result):c.concat(e.result.slice(f,
g)))}}return this.ready(c)};a.Pager=function(b){this.chunks=[];this.chunks_waiting=0;this.add_chunk(b)};a.Pager.prototype._next_chunk=function(b){b=this.chunks[this.chunks.length-1].next(b);this.add_chunk(b);return b};a.Pager.prototype.add_chunk=function(b){b.enqueue();this.chunks_waiting++;b.onready("chunk_ready",this).onerror("chunk_error",this);this.chunks.push(b);return this};a.Pager.prototype.chunk_ready=function(){this.chunks_waiting--};a.Pager.prototype.chunk_error=function(){this.chunks_waiting--};
a.Pager.prototype.slice_chunks=function(b,c){for(var d=[],e=b+c,f=this.chunks,g=0,j=0;j<f.length;j++){var h=this.chunks[j];if(!(h.start>=e))if(!(h.start+h.end<=b)){d.push(h);g=h.start+h.count}}e>g&&d.push(this._next_chunk(e-g));return d};a.Pager.prototype.slicetask=function(b,c){return a.PagerSlice(this,b,c)};a.Pager.prototype.slice=function(b,c,d,e){this.slicetask(b,c).onready(d).onerror(e)}})(mjt);
(function(a){a.dynamic_script=function(b,c,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";if(typeof b=="string")f.id=b;if(typeof c!=="undefined")f.src=c;if(typeof d!=="undefined"){if(/WebKit|Khtml/i.test(navigator.userAgent))throw new Error("safari doesnt evaluate dynamic script text");f.text=d}e.appendChild(f);return f};a.dynamic_iframe=function(b,c){var d=document.createElement("iframe");if(typeof b=="string")d.id=b;d.style.display=
"none";d.className="mjt_dynamic";d.setAttribute("src",c);return d};a.AsyncScript=a.define_task(null,[{name:"url"}]);a.AsyncScript.prototype.request=function(){var b=this,c=a.dynamic_script(null,this.url);if(/WebKit|Khtml/i.test(navigator.userAgent)){var d=a.dynamic_iframe();d.onload=function(){b.ready(null)};document.getElementsByTagName("body")[0].appendChild(d)}else{c.onreadystatechange=function(){/complete|loaded/.test(c.readyState)&&b.ready(null)};c.onload=function(){b.ready(null)}}};a.AsyncIframe=
a.define_task(null,[{name:"url"}]);a.AsyncIframe.prototype.request=function(){function b(){var e=d.contentWindow||d.contentDocument;if(e.document)return e.document;return e}this.domid=a.uniqueid("mjt_iframe");this.iframe=a.dynamic_iframe(this.domid,this.url);var c=this,d=this.iframe;d.onload=function(){c.ready(b(d))};d.onreadystatechange=function(){d.readyState=="complete"&&c.ready(b(d))};document.getElementsByTagName("body")[0].appendChild(d)}})(mjt);
(function(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];a.crc32=function(c,d){if(typeof d=="undefined")d=0;var e=0;d^=-1;for(var f=0,g=c.length;f<g;f++){e=(d^c.charCodeAt(f))&255;d=d>>>8^b[e]}return d^-1};a.hash=function(c){return(a.crc32(c)+2147483648).toString(16).toUpperCase()}})(mjt);
(function(a){a.JsonP=a.define_task();a.JsonP._cb={};a.JsonP._cache={};a.JsonP.flush_cache=function(){a.JsonP._cache={}};a.JsonP.prototype.init=function(){this._cbid=this.url=null;return this};a.JsonP.prototype.generate_callback_id=function(b){if(typeof b=="undefined"){this._cbid=a.uniqueid("cb");return this}this._cbid="c"+a.hash(this.url);if(typeof a.JsonP._cb[this._cbid]=="undefined")return this;a.log("info: repeated jsonp url hash",this._cbid,this.url);this._cbid=a.uniqueid("cb");return this};a.JsonP.prototype.install=
function(){a.JsonP._cache[this.url]=this;this.generate_callback_id(this.url);var b=this.callback_param+"=mjt.JsonP._cb."+this._cbid;this.cburl=this.url+(/\?/.test(this.url)?"&":"?")+b;var c=this;this._f=function(d){delete a.JsonP._cb[c._cbid];c.ready(d)};a.JsonP._cb[this._cbid]=this._f;this.onerror(function(d,e){function f(){a.log("JSONP already completed with ",d,":",e);delete a.JsonP._cb[c._cbid]}f._stale_jsonp_timed_out=new Date;a.JsonP._cb[c._cbid]=f});return this._send_request()};a.JsonP.prototype.request=
function(){if(!this.url)throw new Error("jsonp.url should be set, not "+this.url);if(typeof a.JsonP._cache[this.url]=="undefined")return this.install();var b=a.JsonP._cache[this.url];if(!(typeof b.cache_controller=="undefined"||b.cache_controller===null||b.cache_controller.is_fresh(b))){delete a.JsonP._cache[this.url];return this.install()}return b.onready("ready",this).onerror("error",this)};a.JsonP.prototype._send_request=function(){a.dynamic_script(undefined,this.cburl);return this};a.JsonP.prototype.jsonp_request_form=
function(b,c,d){c=typeof c=="string"?c:a.formencode(c);b=b;if(c)b+="?"+c;this.url=b;if(typeof acre==="undefined"&&b.length>2083){a.warn("mjt.JsonP: Warning: Adding a SCRIPT tag with a url of "+b.length+" chars. This is too long for Internet Explorer 7");a.log(b)}this.callback_param=d;return this.enqueue()}})(mjt);
(function(a){a.Xhr=a.define_task(null,[{name:"method"},{name:"url"},{name:"content_type","default":null},{name:"body","default":null},{name:"headers","default":null}]);a.Xhr.prototype.init=function(){var b;if(typeof XMLHttpRequest!="undefined")b=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")b=new ActiveXObject("MSXML2.XmlHttp");else return this.error("no XMLHttpRequest found");if(this.headers===null)this.headers={};this.xhr=b;return this};a.Xhr.prototype.request=function(){var b=this,
c=this.xhr;c.onreadystatechange=function(){if(c.readyState!=4)return b;c.onreadystatechange=function(){};if((""+c.status).charAt(0)=="2")return b.ready(c);return b.error("/apiary/http/status/"+c.status,c.statusText,c.responseText)};c.open(this.method,this.url,true);this.content_type!==null&&c.setRequestHeader("Content-Type",this.content_type);c.setRequestHeader("X-Requested-With","XMLHttpRequest");for(header in this.headers)c.setRequestHeader(header,this.headers[header]);if(this.body===null)var d=
c.send("");else{d=c.send(this.body);this.body=null}return this};a.XhrFormPost=function(b,c,d){c=a.formencode(c);return a.Xhr("POST",b,"application/x-www-form-urlencoded",c,d)}})(mjt);
(function(a){function b(){var c=a.freebase.readCookie("mwLastWriteTime");this.is_fresh=function(){var d=a.freebase.readCookie("mwLastWriteTime");return c==d}}if(typeof a.freebase=="undefined")a.freebase={};a.freebase.default_service_url="http://www.freebase.com";a.freebase.set_service_url=function(c){var d;if(typeof window!="undefined")d=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")d=acre.environ.server_protocol+"//"+acre.environ.host;a.freebase.service_url=c;a.freebase.xhr_ok=
a.freebase.service_url==d?true:false;if(typeof a.freebase.SchemaCache!="undefined")this.schema_cache=new this.SchemaCache(this)};a.freebase.set_service_url(a.freebase.default_service_url);a.freebase.FreebaseJsonPTask=a.define_task();a.freebase.FreebaseJsonPTask.prototype.init=function(){this.jsonp=a.JsonP();if(typeof a.freebase.readCookie!="undefined")this.jsonp.cache_controller=new b};a.freebase.FreebaseJsonPTask.prototype.service_request=function(c,d){var e=a.freebase.service_url;if(typeof this.service_url!=
"undefined"&&this.service_url)e=this.service_url;this.jsonp.set_timeout().jsonp_request_form(e+c,d,"callback").onready("handle_envelope",this).onerror("handle_error_jsonp",this);return this};a.freebase.FreebaseJsonPTask.prototype.handle_envelope=function(c){if(c.code!="/api/status/ok"){c=c.messages[0];return this.error(c.code,c.message,c)}return this.response(c)};a.freebase.FreebaseJsonPTask.prototype.handle_error_jsonp=function(){this.error.apply(this,arguments)};a.freebase.FreebaseJsonPTask.prototype.request=
function(){a.error("must override BaseTask.request()")};a.freebase.FreebaseJsonPTask.prototype.response=function(){a.error("must override BaseTask.response()")};a.freebase.MqlRead=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"query"},{name:"qenv","default":{}}]);a.freebase.MqlRead.prototype.build_envelope=function(){var c={escape:false};for(var d in this.qenv)c[d]=this.qenv[d];c.query=this.query;if(this.query instanceof Array){if(typeof c.cursor=="undefined"){c.cursor=true;this.start=0}this.requested_count=
this.query[0].limit||100}return c};a.freebase.MqlRead.prototype.request=function(){var c=this.build_envelope();return this.service_request("/api/service/mqlread",{query:JSON.stringify(c)})};a.freebase.MqlRead.prototype.response=function(c){if(c.result===null)return this.error("/user/mjt/messages/empty_result","no results found");if(typeof c.cursor==="string")this.next_cursor=c.cursor;if(c.result instanceof Array){this.count=c.result.length;this.more_available=false;if(this.count>=this.requested_count&&
this.next_cursor!=false)this.more_available=true}return this.ready(c.result)};a.freebase.MqlRead.prototype.next=function(c){if(this.state!=="ready")throw new Error("MqlRead.next(): bad state "+this.state);if(!this.more_available){a.warn("paging .next(): no more items",this);return null}var d=this.query[0],e={};for(var f in d)if(d.hasOwnProperty(f))e[f]=d[f];if(typeof c!="undefined")e.limit=c;c=a.freebase.MqlRead([e],{cursor:this.next_cursor});c.start=this.start+this.count;return c};a.freebase.MqlReadMultiple=
a.define_task(a.freebase.FreebaseJsonPTask);a.freebase.MqlReadMultiple.prototype.init=function(){this.reads={}};a.freebase.MqlReadMultiple.prototype.request=function(){var c={};for(var d in this.reads)c[d]=this.reads[d].build_envelope();return this.service_request("/api/service/mqlread",{queries:JSON.stringify(c)})};a.freebase.MqlReadMultiple.prototype.mqlread=function(c,d){this.reads[c]=d;return this};a.freebase.MqlReadMultiple.prototype.response=function(c){for(var d in this.reads)this.reads[d].handle_envelope(c[d]);
return this.ready(c.result)};a.freebase.TransGet=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"id"},{name:"trans_type","default":"raw"},{name:"values","default":null}]);a.freebase.TransGet.prototype.request=function(){if(this.values===null)this.values={};return this.service_request("/api/trans/"+this.trans_type+this.id,this.values)};a.freebase.TransGet.prototype.response=function(c){c.result.media_type=c.result.media_type.replace(/^\/media_type\//,"");if(typeof c.result.text_encoding=="string")c.result.text_encoding=
c.result.text_encoding.replace(/^\/media_type\/text_encoding\//,"");return this.ready(c.result)};a.freebase.Touch=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"service_url","default":null}]);a.freebase.Touch.prototype.request=function(){this.jsonp.cache_controller={is_fresh:function(){return false}};return this.service_request("/api/service/touch")};a.freebase.Touch.prototype.response=function(){return this.ready(null)}})(mjt);
(function(a){var b=function(c,d,e){d||(d=6);if(e){var f=e.match(/([-+])([0-9]{2}):([0-9]{2})/),g=Number(f[2])*60+Number(f[3]);g*=f[1]=="-"?-1:1;c=new Date(Number(Number(c)+g*6E4))}else e="Z";f=function(j){return(j<10?"0":"")+j};g="";g+=c.getUTCFullYear();if(d>1)g+="-"+f(c.getUTCMonth()+1);if(d>2)g+="-"+f(c.getUTCDate());if(d>3)g+="T"+f(c.getUTCHours())+":"+f(c.getUTCMinutes());if(d>5){c=Number(c.getUTCSeconds()+"."+(c.getUTCMilliseconds()<100?"0":"")+f(c.getUTCMilliseconds()));g+=":"+f(c)}else if(d>
4)g+=":"+f(c.getUTCSeconds());if(d>3)g+=e;return g};a.freebase.date_from_iso=function(c){if(typeof c=="undefined"||c===null)return NaN;c=c.toString();var d=new Date(0,0);c=c.indexOf("T")==-1?c.split(" "):c.split("T");d=d;var e=c[0],f=e.match(/^(-?[0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/);if(f){var g=f[4],j=f[6],h=f[8];e=f[10];var k=f[12]||1;d.setFullYear(f[1]);if(h){d.setMonth(0);d.setDate(Number(h))}else if(e){d.setMonth(0);d.setDate(1);f=d.getDay()||
7;e=Number(k)+7*Number(e);f<=4?d.setDate(e+1-f):d.setDate(e+8-f)}else{if(g){d.setDate(1);d.setMonth(g-1)}j&&d.setDate(j)}d=d}else{a.log("invalid date string: "+e);d=NaN}if(c.length==2){d=d;e=c[1];f=e.match(/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/);c=0;if(f){if(f[0]!="Z"){c=Number(f[3])*60+Number(f[5]||0);if(f[2]!="-")c*=-1}c-=d.getTimezoneOffset();e=e.substr(0,e.length-f[0].length)}if(f=e.match(/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/)){e=f[1];k=Number(f[3]||0);g=f[5]||0;f=f[7]?Number("0."+
f[7])*1E3:0;d.setHours(e);d.setMinutes(k);d.setSeconds(g);d.setMilliseconds(f);c!==0&&d.setTime(d.getTime()+c*6E4);d=d}else{a.log("invalid time string: "+e);d=NaN}}return d};a.freebase.date_to_iso=function(c){return b(c)}})(mjt);
(function(a){a.freebase.imgurl=function(b,c,d,e,f){var g={};if(typeof c!=="undefined")g.maxwidth=c;if(typeof d!=="undefined")g.maxheight=d;if(typeof e!=="undefined")g.mode=e;if(typeof e!=="undefined")g.errorid=f;return a.form_url(this.service_url+"/api/trans/image_thumb"+a.formquote(b),g)};a.freebase.extend_query=function(b,c){if(typeof c=="undefined")c={};if(typeof b=="undefined")throw new Error("extend_query: MQL query is undefined");for(var d in c){for(var e=c[d],f=d.split("."),g=f.pop(),j=b instanceof
Array?b[0]:b,h=0;h<f.length;h++){var k=f[h];if(typeof j[k]!="object"||j[k]===null)j[k]={};j=j[k];if(j instanceof Array){if(j.length==0)j=[{}];if(j.length>1)throw new Error("extend_query: path "+JSON.stringify(d)+" references an array with more than one element");j=j[0]}}if(j===null||typeof j!="object")throw new Error("extend_query: path "+JSON.stringify(d)+" does not exist in query");j[g]=e}return b}})(mjt);
(function(a){var b=/^[A-Za-z0-9][A-Za-z0-9_-]*$/,c=new RegExp("([^A-Za-z0-9_-])","g");a.freebase.mqlkey_quote=function(d){if(b.exec(d))return d;var e=function(f,g){var j=g.charCodeAt(0).toString(16).toUpperCase();if(j.length==2)j="00"+j;return"$"+j};x=d.replace(c,e);if(x.charAt(0)=="-"||x.charAt(0)=="_")x=e(x,x.charAt(0))+x.substr(1);return x};a.freebase.mqlkey_unquote=function(d){return d=d.replace(/\$([0-9A-Fa-f]{4})/g,function(e,f){return String.fromCharCode(parseInt(f,16))})}})(mjt);
(function(a,b){b.readCookie=function(c){if(typeof acre!="undefined"){if(typeof acre.environ.cookies[c]=="undefined")return"";return acre.environ.cookies[c].value}if(typeof document=="undefined")return"";var d="";c+="=";if(document.cookie.length>0){var e=document.cookie.indexOf(c);if(e!=-1){e+=c.length;c=document.cookie.indexOf(";",e);if(c==-1)c=document.cookie.length;d=document.cookie.substring(e,c)}}return d};b.parse_metaweb_cookies=function(){function c(f,g){var j=f.indexOf("|"+g+"_");if(j!=-1){j=
j+2+g.length;var h=f.indexOf("|",j);if(h!=-1)return decodeURIComponent(f.substr(j,h-j))}return null}a.freebase.freebase_user=null;var d=b.readCookie("metaweb-user-info");if(d.indexOf("A|")==0){var e={type:"/type/user"};e.id=c(d,"p");e.guid=c(d,"g");e.name=c(d,"u");if(!e.id)e.id=e.guid;a.freebase.freebase_user=e}};b.parse_metaweb_cookies();b.FreebaseXhrTask=a.define_task(null);b.FreebaseXhrTask.prototype.init=function(){};b.FreebaseXhrTask.prototype.xhr_request=function(c,d,e,f){d=b.service_url+d;
this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.xhr_form_post=function(c,d){c=b.service_url+c;this.xhr=a.XhrFormPost(c,d).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.request=function(){};b.FreebaseXhrTask.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");d=d?d.replace(/;.*$/,""):"";if(!d.match(/^(application\/json|text\/javascript|text\/plain)$/))return this.error("/user/mjt/messages/json_response_expected",
"status: "+c.status+", content-type: "+d,c.responseText);this.envelope=c=JSON.parse(c.responseText);if(c.code!=="/api/status/ok")return this.error(c.code,c.messages[0].message,c.messages[0]);return this.ready(c.result)};b.FreebaseXhrTask.prototype.xhr_error=function(c,d,e,f){c=null;try{c=JSON.parse(f);var g=c.messages[0];return this.error(g.code,g.message,g)}catch(j){return this.error(d,e,f)}};b.TransUnsafe=a.define_task(null,[{name:"id"}]);b.TransUnsafe.prototype.xhr_request=function(c,d,e,f){d=
b.service_url+d;this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.TransUnsafe.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");this.content_type=d?d.replace(/;.*$/,""):"";this.responseText=c.responseText;return this.ready()};b.TransUnsafe.prototype.xhr_error=function(c,d,e,f){return this.error(d,e,f)};b.TransUnsafe.prototype.request=function(){return this.xhr_request("GET","/api/trans/unsafe"+this.id)};
b.MqlWrite=a.define_task(b.FreebaseXhrTask,[{name:"query"},{name:"qenv","default":{}}]);b.MqlWrite.prototype.request=function(){var c={query:this.query};for(var d in this.qenv)c[d]=this.qenv[d];return this.xhr_form_post("/api/service/mqlwrite",{query:JSON.stringify(c)})};b.FlushCache=a.define_task(b.FreebaseXhrTask);b.FlushCache.prototype.request=function(){return this.xhr_request("POST","/api/service/touch")};b.FlushCache.prototype.xhr_ready=function(){return this.ready(null)};b.Upload=a.define_task(b.FreebaseXhrTask,
[{name:"content_type"},{name:"body"},{name:"values"}]);b.Upload.prototype.request=function(){var c="/api/service/upload",d=a.formencode(this.values);if(d)c+="?"+d;return this.xhr_request("POST",c,this.content_type,this.body)};b.Signin=a.define_task(b.FreebaseXhrTask,[{name:"username"},{name:"password"},{name:"domain","default":null},{name:"options","default":{}}]);b.Signin.prototype.request=function(){if(typeof this.username=="undefined")return this.xhr_form_post("/api/account/logout",{});var c={username:this.username,
password:this.password};if(this.domain!==null)c.domain=this.domain;for(var d in this.options)c[d]=this.options[d];return this.xhr_form_post("/api/account/login",c).ondone("clear_password",this)};b.Signin.prototype.clear_password=function(){delete this.password;return this}})(mjt,mjt.freebase);
(function(a){a.bless=function(b){return new a.Markup(b)};a.MarkupList=function(){for(var b=0;b<arguments.length;b++)this[b]=arguments[b]};a.Markup=function(b){this.html=b};a.Markup.prototype.toMarkup=function(){return this.html};(function(){function b(d,e,f){f.push('<span style="outline-style:solid;color:red;">');if(e){f.push(e);f.push("</span>")}else{f.push("bad markup element, type [");f.push(typeof d);f.push("]</span>")}}function c(d,e){switch(typeof d){case "object":if(d===null)b(d,"[null]",e);
else if(d instanceof a.MarkupList)for(var f=0;f in d;f++)c(d[f],e);else if(typeof d.toMarkupList==="function")c(d.toMarkupList(),e);else if(typeof d.toMarkup==="function")e.push(d.toMarkup());else typeof d.toString==="function"?e.push(a.htmlencode(d.toString())):b(d,"[object]",e);break;case "undefined":b(d,"[undefined]",e);break;case "string":e.push(a.htmlencode(d));break;case "boolean":e.push(String(d));break;case "number":e.push(String(d));break;case "function":b(d,"[function]",e);break}return e}
a.flatten_markup=function(d){return c(d,[]).join("")}})();a.make_attr_safe=function(b){return a.bless(a.flatten_markup(b).replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;"))}})(mjt);
(function(a){a.error_html=function(b,c,d){var e=[];if(c&&b.lineNumber){var f=b.lineNumber;c=c.split("\n");if(f<0)f=0;if(f>=c.length)f=c.length-1;var g=f-10;if(g<0)g=0;var j=[];e.push(a.bless(["\n<pre>"]));for(g=g;g<f;g++)j.push(c[g]);e.push(j.join("\n"));e.push(a.bless(['</pre>\n<pre style="color:red">']));e.push(c[f]+"\n");e.push(a.bless(["</pre>\n<pre>"]));j=[];for(g=f+1;g<c.length;g++)j.push(c[g]);e.push(j.join("\n"));e.push(a.bless(["</pre>\n"]))}b=[a.bless(['<div class="mjt_error"']),d?[a.bless([' id="']),
d,a.bless(['"'])]:[],a.bless([">"]),b.name,": ",b.message,e,a.bless(["</div>\n"])];return b=b.concat(e)};a.Codeblock=function(b,c){this.name=b;this.codestr=c;this.baseline=this.basefile=null};a.Codeblock.prototype.handle_exception=function(b,c){if(typeof c.mjt_error=="undefined"){var d=false;if(typeof c.sourceURL!="undefined")c.fileName=c.sourceURL;if(typeof c.line!="undefined"){d=true;c.lineNumber=c.line}c.mjt_error=c instanceof Error?{fileName:c.fileName,lineNumber:c.lineNumber,name:c.name,message:c.message,
stack:c.stack,rhinoException:c.rhinoException}:{name:"Unknown exception",fileName:"",message:""+c};if(this.basefile||d)if(typeof c.stack=="string"){d=this.basefile.replace(/(\W)/g,"\\$1")+":(\\d+)\n";d=new RegExp(d);if(d=d.exec(c.stack)){d=parseInt(d[1])-this.baseline;d>0&&this.log_error_context(b,c,d)}}else if(c.fileName==this.basefile||d){d=d?c.lineNumber-1:c.lineNumber-this.baseline;if(d>0){c.mjt_error.lineNumber=d;c.mjt_error.fileName="<generated code>";this.log_error_context(b,c,d)}}}};a.Codeblock.prototype.log_error_context=
function(b,c,d){var e=this.extract_context(this.codestr,d,5);d="---"+d+"--\>  ";for(var f=[],g=0;g<d.length;g++)f.push(" ");f=f.join("");e=[f,e.prev_lines.join("\n"+f),"\n",d,e.the_line,"\n",f,e.next_lines.join("\n"+f)].join("");a.error("error",b,"\n    "+c.name+": "+c.message+"\n",e)};a.Codeblock.prototype.extract_context=function(b,c,d){b=b.split("\n");if(c<0)c=0;if(c>=b.length)c=b.length-1;var e=c-d;if(e<0)e=0;var f=[];for(line=e;line<c;line++)f.push(b[line]);e=b[c];var g=[];for(line=c+1;line<
b.length&&line<c+d;line++)g.push(b[line]);return{prev_lines:f,the_line:e,next_lines:g}};a.Codeblock.prototype.evaluate=function(){var b=(new Date).getTime(),c=[this.codestr];c=["var __mjt_eval = (function(){",this.codestr,"})(); __mjt_eval;\n"];c=c.join("");a.debug&&a.log("evaluating code "+this.name,{click_me:"view code",codestr:c});var d;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined")d=eval(c);else{try{null()}catch(e){this.baseline=e.lineNumber+2;this.basefile=e.fileName}try{d=
eval(c)}catch(f){this.handle_exception("evaluating codeblock "+this.name,f);throw f;}}b=(new Date).getTime()-b;a.note("evaluated code in ",b,"msec, ",c.length,"chars, got ",typeof d);return d}})(mjt);
(function(a){a._eventcb={};a.kws=function(){for(var b={},c=0;c<arguments.length;c+=2)b[arguments[c]]=arguments[c+1];return b};a.foreach=function(b,c,d){var e,f;if(typeof c=="string"||c instanceof Array||typeof jQuery=="object"&&c instanceof jQuery){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c[e]])}else if(typeof c==="object")if(typeof document!="undefined"&&typeof c.item!="undefined"&&c.item===document.childNodes.item){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c.item(e)])}else for(e in c)c.hasOwnProperty(e)&&
d.apply(b,[e,c[e]])};a.ondomready=function(b,c){var d=a._ondomready_queue;if(a._ondomready_timer===null)a._ondomready_timer=setTimeout(a._ondomready_run,20);d.push(b);d.push(c)};a._ondomready_queue=[];a._ondomready_timer=null;a._ondomready_run=function(){a._ondomready_timer=null;var b=a._ondomready_queue;for(a._ondomready_queue=[];b.length;){var c=b.shift(),d=b.shift();c.apply(d)}};a.cleanup_noquote=function(b,c){var d=a.flatten_markup(b);d=d.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&amp;/g,"&");if(typeof c!="undefined")d=d.replace(new RegExp("</("+c+"\\s*)>","ig"),"<\\/$1>");return a.bless(d)};a.ref=function(b){b=['<a href="view?name=',a.formquote(b),'">',a.htmlencode(b),"</a>"].join("");return new a.Markup(b)};a.TemplateCall=function(b){this.raw_tfunc=b;delete this._markup};a.TemplateCall.prototype.toMarkupList=function(){return this._markup};a.TemplateCall.prototype.toMarkup=function(){return a.flatten_markup(this._markup)};a.TemplateCall.prototype.redisplay=
function(){var b=new this.this_tfunc;b.prev_tcall=this;b.subst_id=this.subst_id;b.render(this.targs).display();return b};a.TemplateCall.prototype.display=function(b){if(typeof acre!="undefined")return this;if(typeof b!="undefined")this.subst_id=b;b=this.subst_id;if(typeof b=="string"){var c=document.getElementById(b);if(c)b=c;else{a.note("no element with id "+b);return null}}if(b.nodeName=="IFRAME"){b=b.contentWindow||b.contentDocument;if(b.document)b=b.document;b=b.getElementsByTagName("body")[0]}if(!b)return this;
typeof this._markup!="undefined"&&a.replace_html(b,this);return this};a.TemplateCall.prototype.render=function(b){if(typeof b!="undefined")this.targs=b;b=this.raw_tfunc;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined"){this._markup=b.apply(this,this.targs);return this}try{this._markup=b.apply(this,this.targs)}catch(c){c.tcall=this;b=this.tpackage._codeblock;if(b===null)throw c;b.handle_exception("applying tfunc "+this.signature,c);b=[];for(var d in this.tasks){var e=this.tasks[d];
typeof e==="object"&&e!==null?b.push(d+":"+e.state):b.push(d+":"+typeof e)}this._markup=new a.MarkupList(a.bless("<h3>error applying "),this.signature," to id=",this.subst_id,a.bless("</h3>"),"states:[",b.join(" "),"]");throw c;}return this};a.TemplateCall.prototype.mktask=function(b,c){this.tasks[b]=c;var d=this;c.state=="init"&&c.enqueue();return c.ondone(function(){d.render().display()})};a.tfunc_factory=function(b,c,d,e){var f=function(){var g=arguments.callee;if(this instanceof g){this.tasks=
{};this.defs=this.exports={};typeof a.deprecate=="function"&&a.deprecate(this,"defs",".exports")}else{for(var j=new g,h=[],k=0;k<arguments.length;k++)h[k]=arguments[k];k=j.signature.replace(/\(.*\)$/,"");j.subst_id=g.prototype.has_tasks?a.uniqueid("tcall__"+k):null;j.render(h);return j}};f.prototype=new a.TemplateCall(c);f.prototype.signature=b;f.prototype.tpackage=d;f.prototype.has_tasks=e;f.prototype.source_microdata=c.source_microdata;return f.prototype.this_tfunc=f}})(mjt);
(function(a){a.TemplatePackage=function(){this.namespace=this._template_fragments=this.output_mode=this.debug_locs=this._codeblock=this._compiled=this._template_strings=this.source=null};a.TemplatePackage.prototype.runtime={_break_token:a._break_token,_continue_token:a._continue_token,bless:a.bless,cleanup_noquote:a.cleanup_noquote,foreach:a.foreach,htmlencode:a.htmlencode,make_attr_safe:a.make_attr_safe,new_markuplist:function(){return new a.MarkupList},ondomready:a.ondomready,ref:a.ref,tfunc_factory:a.tfunc_factory,
uniqueid:a.uniqueid};a.TemplatePackage.prototype.init_from_json=function(b){if(typeof b.file!="undefined")this.source=b.file;if(typeof b.stringtable!="undefined")this._template_strings=b.stringtable;this._codeblock=null;if(typeof b.code=="string")this._codeblock=new a.Codeblock(this.source,b.code);else if(typeof b.code=="function")this._compiled=b.code;if(typeof b.debug_locs!="undefined")this.debug_locs=b.debug_locs;if(typeof b.output_mode!="undefined")this.output_mode=b.output_mode;return this};
a.TemplatePackage.prototype.init_from_js=function(b){var c=b.def;this.init_from_json(b.info);this._compiled=c;return this};a.TemplatePackage.prototype.get_metadata=function(){return{file:this.source,stringtable:this._template_strings,debug_locs:this.debug_locs,output_mode:this.output_mode}};a.TemplatePackage.prototype.toJSON=function(){var b=this.get_metadata();if(this._codeblock===null){a.warn("TemplatePackage.toJSON: complete source code unavailable",this.source);b.code=this._compiled}else b.code=
this._codeblock.codestr;return JSON.stringify(b)};a.TemplatePackage.prototype.toJS=function(){var b=null;if(this._codeblock===null){a.warn("TemplatePackage.toJS: complete source code unavailable",this.source);b=this._compiled}else b="(function () {"+this._codeblock.codestr+"})()";return["{def: ",b,",\ninfo:",JSON.stringify(this.get_metadata()),"}\n"].join("")};a.TemplatePackage.prototype.lookup_line=function(b){if(!(debug_locs instanceof Array)||b>=this.debug_locs.length)return null;return this.debug_locs[b-
1]};a.TemplatePackage.prototype.compile_document=function(b,c){(new Date).getTime();if(typeof c=="undefined")c=new a.TemplateCompiler;c.compile_top(b,"rawmain()");(new Date).getTime();return this.init_from_json({source:this.source,stringtable:c.strings,code:c.codestr+"; return rawmain;",debug_locs:c.debug_locs,output_mode:c.output_mode})};a.TemplatePackage.prototype.load_document=function(b,c){this.source+="#"+b.id;this.compile_document(b);return this.load(c)};a.TemplatePackage.prototype.toplevel=
function(b){this.namespace===null&&this.load(b);return this.namespace};a.TemplatePackage.prototype.toString=function(){this.namespace===null&&this.load(targs);return a.flatten_markup(this.namespace._main.prototype.tpackage.tcall)};a.TemplatePackage.prototype.load=function(b){this._template_fragments=[];for(var c=0;c<this._template_strings.length;c++)this._template_fragments[c]=a.bless(this._template_strings[c]);if(this._compiled===null)if(this._codeblock===null)a.error("TemplatePackage has no code",
this.source);else this._compiled=this._codeblock.evaluate();if(typeof b=="undefined")b=[];this._args=b;b=a.tfunc_factory("_main()",this._compiled,this,false,true);c=new b;c.render(this._args);this.tcall=c;c.pkg=this;if(typeof this._compiled.doc_content_type!="undefined")c.doc_content_type=this._compiled.doc_content_type;if(typeof c.exports._main!="undefined")throw new Error("_main() is illegal as a template function name");this.namespace=c.exports;this.namespace._main=b;if(typeof c.exports.main!=
"undefined")throw new Error("main() is illegal as a template function name");this.namespace.main=b;typeof a.deprecate=="function"&&a.deprecate(this.namespace,"main","._main");return this}})(mjt);
(function(a){a.run=function(c,d,e){var f;if(typeof a.app=="undefined")a.app=new a.App;if(arguments.length==0){var g=new a.TemplatePackage;return a.run_page(g)}if(typeof c===null)throw new Error("mjt.run: null target");else if(typeof c=="string"){f=c;c=document.getElementById(f)}else if(typeof c=="object"){if(c.id=="")c.id=a.uniqueid("run_target");f=c.id}if(arguments.length==1){g=new a.TemplatePackage;g.source=window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+f;return a.run_element(g,
c,e)}if(typeof d!=="function"){a.error("invalid template function",d,arguments);throw new Error("mjt.run: invalid args");}g=new d;g.subst_id=f;g.render(e).display();return g.exports};var b=function(c,d){var e=[],f;for(f=d.firstChild;f!==null;f=f.nextSibling)f.nodeType==1&&e.push(f);for(var g=0;g<e.length;g++){f=e[g];switch(f.nodeName){case "TITLE":c.title=f.innerHTML;break;case "META":switch(f.name){case "description":c.summary=f.content;break;case "author":c.author=f.content;break;case "content-language":c.language=
f.content;break;case "x-mjt-id":c.id=f.content;break}break;case "SCRIPT":break;case "STYLE":break;default:break}}};a.run_page=function(c){b(c,document.getElementsByTagName("head")[0]);var d=a.Succeed();c.source=window.location.protocol+"//"+window.location.host+window.location.pathname;for(var e=document.createElement("div"),f=document.getElementsByTagName("body")[0],g=f.firstChild;g!==null;){var j=g;g=g.nextSibling;if(!(j.nodeName==="IFRAME"&&j.className==="mjt_dynamic")){f.removeChild(j);e.appendChild(j)}}e.id=
a.uniqueid("mjt_body");e.style.display="none";f.appendChild(e);if(f.style.display=="none")f.style.display="";d.enqueue().onready(function(){a.run_element(c,e,[])});return c.namespace};a.run_element=function(c,d,e){c.load_document(d,e);c.tcall.subst_id=d.id;c.tcall.display();return c.tcall.exports};a.load_element=function(c){var d=typeof c=="string"?document.getElementById(c):c,e=new a.TemplatePackage;e.source=window.location.protocol+"//"+window.location.host+window.location.pathname;if(typeof c==
"string")e.source+="#"+c;e.load_document(d,[]);return e};a.load_from_iframe=function(c){var d=new a.TemplatePackage;d.source=window.location.protocol+"//"+window.location.host+window.location.pathname;var e=c;if(typeof c=="string")e=document.getElementById(c);if(e.nodeName!="IFRAME"){a.error("called mjt.load_from_iframe on node tag",e.nodeName);return null}c=e.contentWindow||e.contentDocument;if(c.document)c=c.document;e=c.getElementsByTagName("body")[0];d.load_document(e,[]);return d.namespace};
a.load_string=function(c){var d=document.createElement("div");d.innerHTML=c;return a.load_element(d)};a.replace_html=function(c,d){var e=document.createElement("div"),f=a.flatten_markup(d);e.innerHTML=f;if(c.parentNode===null)a.warn("attempt to replace html that has already been replaced?");else{f=e.firstChild;if(f===null)a.warn("bad html in replace_innerhtml");else{if(f.nextSibling){a.warn("template output should have a single toplevel node");f=e}c.parentNode.replaceChild(f,c);if(f.style&&f.style.display==
"none")f.style.display=""}}}})(mjt);
(function(a){a.Scope=function(b,c,d){this.template=b;c||(c=null);this.parent=c;d||(d="[unnamed]");this.decl=d;this.tasks={};this.toplevel=false;this.microdata={items:{},item:null,stack:[],lastvalue:null};if(c!==null)this.microdata.items=c.microdata.items};a.TemplateCompiler=function(){this.strings=[];this.codestr=null;this.debug_locs=[];this.compiler_dt=this.source_loc=null;this._markup=[];this._code=[];this.next_unique_id={};this.debug=a.debug;this.browser_dom=typeof navigator!="undefined";this.browser_target=
true;this.document_content_type=this.output_prefix=null;this.set_output_mode("html");this.mjtns_re=/^(?:mjt\.|mjt:|acre:)(.+)$/;this._ie_attribute_bs=this.browser_dom&&/MSIE/.test(navigator.userAgent)};a.TemplateCompiler.prototype.set_output_mode=function(b){this.output_mode=b;this.empty_tags={};this.boolean_attrs={};this.preserve_space_tags={};this.noescape_tags={};switch(b){case "text":break;case "xml":break;case "html":this.empty_tags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,
isindex:1,link:1,meta:1,param:1};this.boolean_attrs={selected:1,checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1};this.preserve_space_tags={pre:1,textarea:1};this.noescape_tags={script:1,style:1};break;default:throw new Error('set_output_mode: unknown mode "'+b+'"');}};a.TemplateCompiler.prototype.compile_top=function(b,c){this.scope=new a.Scope(this,null,"[toplevel]");this.scope.toplevel=true;this.scope.toplevel_def=c;this.compile_node(b);
this.codestr=this._code.join("");this._markup=this._code=null;if(this.codestr=="")throw new Error("template compiled with no output");};a.TemplateCompiler.prototype.uniqueid=function(b){var c=this.next_unique_id[b];if(typeof c!=="number")c=1;this.next_unique_id[b]=c+1;return b+"_"+c};a.TemplateCompiler.prototype._ampRE=/\&/g;a.TemplateCompiler.prototype._ltRE=/\</g;a.TemplateCompiler.prototype._gtRE=/\>/g;a.TemplateCompiler.prototype.htmlencode=function(b){return b.replace(this._ampRE,"&amp;").replace(this._ltRE,
"&lt;").replace(this._gtRE,"&gt;")};a.TemplateCompiler.prototype.jsencode=function(b){return JSON.stringify([b]).replace(/^[^"]*/,"").replace(/[^"]*$/,"")};a.TemplateCompiler.prototype.flush_markup=function(b){if(this._markup.length==0)return-1;var c=this._markup.join("");this._markup=[];var d=this.strings.length;this.strings[d]=c;if(this.debug){b=c.replace(/\r?\n/gm,"\n                                                  // ");c="__m[__n++]=__ts["+d+"];";if(c.length<50)c+="                                                  ".substr(c.length);
this.emit(c,"// ",b,"\n")}else b||this.emit("__m[__n++]=__ts[",d,"];\n");return d};a.TemplateCompiler.prototype.emit=function(){this._markup.length&&this.flush_markup();for(var b=0;b<arguments.length;b++)for(var c=(""+arguments[b]).split("\n"),d=0;d<c.length;d++){if(d>0){this._code.push("\n");this.debug_locs.push(this.source_loc)}this._code.push(c[d])}};a.TemplateCompiler.prototype.emitln=function(){this.emit.apply(this,arguments);this.emit("\n")};a.TemplateCompiler.prototype.markup=function(){for(var b=
0;b<arguments.length;b++)this._markup.push(arguments[b])};a.TemplateCompiler.prototype.warn=function(b){this.markup('<span style="outline-style:solid;color:red;">',this.htmlencode(b),"</span>")};a.TemplateCompiler.prototype.compile_task=function(b,c){if(c.firstChild===null||c.firstChild.nodeType!=3||c.firstChild.nextSibling!==null)throw new Error("mjt.task="+b+" declaration may only contain text");var d=c.firstChild.nodeValue;if(d.match(/;\s*$/)){a.warn("mjt.task=",b,"definition should not end with a semicolon");
d=d.replace(/;\s*$/,"")}this.browser_dom&&d.match(/\/\/ /)&&a.warn('"//" comments in mjt.task=',b,"definition will fail on IE6");this.emitln("var ",b," = this.tasks && this.tasks.",b,";");this.emitln("if (!",b,") { ",b,' = this.mktask("',b,'", (\n',d,")); }");this.scope.has_tasks=true};a.TemplateCompiler.prototype.compile_text=function(b,c,d,e,f){var g=/[^A-Za-z0-9_.]/gm,j=/\}/gm,h=/\]/gm,k={has_subs:false,next_node_leading_ws:null};if(typeof c=="undefined")c=false;if(typeof d=="undefined")d=false;
if(typeof e=="undefined")e=false;if(typeof f=="undefined")f=false;var n,p,o=b.length,l=0,m=b.indexOf("$",l);if(m==-1){n=b.split("\n").length-1;if(d)b=b.replace(/^\s+/m,"");if(e)b=b.replace(/\s+$/m,"");if(c=/\n\s*$/.exec(b)){k.next_node_leading_ws=c[0];b=b.substr(0,c.index)}this.markup(this.htmlencode(b));this.source_loc+=n;return k}for(;m>=0;){p=b.substring(l,m);n=p.split("\n").length-1;if(l==0&&d)p=p.replace(/^\s+/m,"");this.markup(this.htmlencode(p));this.source_loc+=n;m++;if(m>=o){this.warn("premature end of $ substitution in "+
this.jsencode(b));return k}switch(b.charAt(m)){case "$":if(f){this.markup("$");break}m++;this.markup("$");break;case "(":this.markup("$");break;case "{":j.lastIndex=m+1;n=j.exec(b);if(n===null){this.warn("missing close after ${ in "+this.jsencode(b));return k}p=b.substring(m+1,j.lastIndex-1);m=j.lastIndex;if(/\{/.test(p))throw new Error('template compiler: "{" and "}" are forbidden inside "${...}"');c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",p,");"):this.emitln("__m[__n++]=(",p,");");
k.has_subs=true;this.source_loc+=p.split("\n").length-1;break;case "[":if(f){this.markup("$");break}if(c)throw new Error('template compiler: "$[...]" is illegal in an attribute');h.lastIndex=m+1;n=h.exec(b);if(n===null){this.warn("missing close after $[ in "+this.jsencode(b));return k}p=b.substring(m+1,h.lastIndex-1);m=h.lastIndex;if(/\[/.test(p))throw new Error('template compiler: "[" and "]" are forbidden inside "$[...]"');this.emitln("__m[__n++]=__pkg.runtime.ref(",this.jsencode(p),");");k.has_subs=
true;this.source_loc+=p.split("\n").length-1;break;default:if(f){this.markup("$");break}g.lastIndex=m;n=g.exec(b);if(n===null){p=b.substring(m);m=o}else if(n.index>m){p=b.substring(m,n.index);m=n.index}else{this.warn("unknown character following $ in "+this.jsencode(b));return k}c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",p,");"):this.emitln("__m[__n++]=",p,";");k.has_subs=true}l=m;m=b.indexOf("$",l)}if(l>=0&&l<o){p=b.substring(l);n=p.split("\n").length-1;if(e)p=p.replace(/\s+$/m,"");
if(c=/\n\s*$/.exec(p)){k.next_node_leading_ws=c[0];p=p.substr(0,c.index)}this.markup(this.htmlencode(p));this.source_loc+=n}return k};a.TemplateCompiler.prototype.compile_onevent_attr=function(b,c){var d=this.uniqueid(b+"_cb");this.emitln("var ",d,' = __pkg.runtime.uniqueid("',b,'");');this.emitln("mjt._eventcb[",d,"] = function (event) {");this.emit(c);this.emitln("}");return"return mjt._eventcb.${"+d+"}.apply(this, [event])"};a.TemplateCompiler.prototype.get_attributes=function(b,c,d){for(var e=
this.mjtns_re.exec(b.nodeName),f=null,g=b.attributes,j=0;j<g.length;j++){var h=g[j];if(h.specified){var k=h.nodeName,n=this.mjtns_re.exec(k);if(n)d[n[1]]=h.nodeValue;else if(e&&k.indexOf(":")==-1){if(typeof d[k]!="undefined")throw new Error("template compiler: ambiguous template attribute: both "+k+" and "+h.nodeName+" are specified");d[k]=h.nodeValue}else if(k=="src")f=h.nodeValue;else{n={name:k};if(typeof h.nodeValue!="undefined")n.value=h.nodeValue;if(this.browser_dom){k.substr(0,2)=="on"&&a.warn(k,
'="..."',"will break on IE6, use","mjt."+k);if(this._ie_attribute_bs)if(k=="style")n.value=""+b.style.cssText;else if(k=="CHECKED")n.value="1";else if(h=b.getAttribute(k,2))n.value=h;if(typeof n.value=="number")n.value=""+n.value}c.push(n)}}}if(this.browser_dom&&this._ie_attribute_bs&&b.nodeName=="INPUT"){n={name:"value",value:b.value};c.push(n)}if(typeof d.src!="undefined")c.push({name:"src",value:d.src});else f!==null&&c.push({name:"src",value:f})};a.TemplateCompiler.prototype.compile_choose=function(b,
c){var d="init";if(c){this.emitln("switch (",c,") {");d="dispatch_init"}else a.log('choose="" is deprecated, use if...elif...else instead');for(var e=b.firstChild;e!=null;){var f=e.nextSibling,g=e.nodeType;if(g==3)e.nodeValue.match(/[^ \t\r\n]/)&&a.warn("only whitespace text is allowed in mjt.choose, found",'"'+e.nodeValue+'"');else if(g==1){g=d;var j={};this.get_attributes(e,[],j);var h=false;if(typeof j.when!="undefined")h=false;else if(typeof j.otherwise!="undefined")h=true;else{a.warn("all elements inside mjt.choose must have a mjt.when= or mjt.otherwise= attribute");
break}if(d=="init")if(h){this.emitln("{");g="closed"}else{this.emitln("if (",j.when,") {");g="open"}else if(d=="open")if(h){this.emitln("} else {");g="closed"}else{this.emitln("} else if (",j.when,") {");g="open"}else if(d.match(/^dispatch/)){d!="dispatch_init"&&this.emitln("break;");if(h)this.emitln("default:");else{this.emit("case ");this.emit(this.jsencode(j.when));this.emitln(":")}g="dispatch"}this.compile_node(e,{choose_state:"in_choose"});d=g}e=f}if(c=="")this.emitln("}");else{d!="dispatch_init"&&
this.emitln("break;");this.emitln("};")}};a.TemplateCompiler.prototype.compile_def=function(b){var c=b.match(/^([^(]+)\(([^)]*)\)$/);if(c){var d=c[1];c=c[2];this.debug&&this.emitln("// mjt.def=",b);this.emitln("var ",d," = function (",c,") {");this.scope=new a.Scope(this,this.scope,b)}else a.warn("bad mjt.def=",b,": must contain an argument list")};a.TemplateCompiler.prototype.complete_def=function(){this.scope=this.scope.parent;this.scope.toplevel&&this.output_mode=="text"?this.emitln("return __pkg.runtime.cleanup_noquote(__m);"):
this.emitln("return __m;");this.emitln("};")};a.TemplateCompiler.prototype.generate_open_tag=function(b,c,d,e){this.markup("<",b);for(var f={},g=0;g<c.length;g++){var j=c[g];if(typeof j.value=="function")a.warn("ignoring function-valued attr",b,j.name,j.value);else f[j.name]=j.value}if("id"in f)e=false;if(d){b=this.uniqueid("dattrs");g=this.uniqueid("sattrs");this.emitln("var ",b," = (",d,");");this.emitln("var ",g," = {};");for(g=0;g<c.length;g++){d=c[g].name;f=c[g].value;this.emit("if (!(",this.jsencode(d),
" in ",b,")) {");if(d in this.boolean_attrs)this.markup(" ",d);else{this.markup(" ",d,'="');this.compile_text(f,true);this.markup('"')}this.emitln(" }")}e&&this.emitln('if (this.subst_id && !("id" in ',b,")) ",b,".id=this.subst_id;");c=this.uniqueid("di");this.emitln("for (var ",c," in ",b,") {");this.emitln("__m[__n++]=' ' + "+c+";");this.emitln("__m[__n++]=__pkg.runtime.bless('=\"');");this.emitln("__m[__n++]=__pkg.runtime.htmlencode(''+"+b+"["+c+"]);");this.emitln("__m[__n++]=__pkg.runtime.bless('\"');");
this.emitln("}")}else{for(g=0;g<c.length;g++){j=c[g];this.markup(" ",j.name,'="');this.compile_text(j.value,true);this.markup('"')}e&&this.emitln("if (this.subst_id) { __m[__n++]=__pkg.runtime.bless(' id=\"' + this.subst_id + '\"'); }")}};a.TemplateCompiler.prototype.compile_node=function(b,c){if(typeof c=="undefined")c={};var d="none";if(typeof c.choose_state!="undefined")d=c.choose_state;if(typeof b.getUserData!="undefined")try{var e=b.getUserData("lineNumber");if(e!==null){if(typeof e=="string")e=
parseInt(e);this.source_loc=e}}catch(f){this.source_loc=null}e=null;switch(b.nodeType){case 1:this.compile_element(b,d,c.leading_ws);break;case 2:break;case 3:e=this.compile_text(b.nodeValue,false,c.trim_leading_ws,c.trim_trailing_ws).next_node_leading_ws;break;case 4:c.leading_ws&&this.markup(c.leading_ws);this.compile_text(b.nodeValue,false);break;case 5:c.leading_ws&&this.markup(c.leading_ws);this.markup("&"+b.nodeName+";");break;case 6:a.warn("template compiler: skipping dom node type",b.nodeType);
break;case 7:a.warn("template compiler: got <? ?>",b.nodeName,b.nodeValue);break;case 8:c.leading_ws&&this.markup(c.leading_ws);this.output_mode!="text"&&this.markup("<!--"+b.nodeValue+"--\>");break;case 9:a.warn("template compiler: skipping dom node type",b.nodeType);break;case 10:c.leading_ws&&this.markup(c.leading_ws);this.markup("<!DOCTYPE "+b.nodeName+' PUBLIC "'+b.publicId+'" "'+b.systemId+'">');a.warn("ignoring DOCTYPE",b.nodeName,b.nodeValue);break;case 11:a.warn("template compiler: skipping dom node type",
b.nodeType);break;case 12:a.warn("template compiler: skipping dom node type",b.nodeType);break;default:a.warn("template compiler: unknown dom node type",b.nodeType)}return e};a.TemplateCompiler.prototype.compile_element=function(b,c,d){var e=[],f=true,g=b.nodeName,j=g.toLowerCase(),h={},k=[];this.get_attributes(b,k,h);var n={};for(ai=0;ai<k.length;ai++){var p=k[ai];n[p.name]=p}if(this.scope.toplevel){if(typeof h.def!="undefined")throw new Error('template compiler: def="'+h.def+'" illegal at top element');
h.def=this.scope.toplevel_def}if(this.output_mode=="text")h.strip="1";var o=this.mjtns_re.exec(b.nodeName);if(o)switch(o[1]){case "script":h.script=h.script||"";break;case "none":a.warn("<mjt:none> is deprecated, use <mjt:block> instead");h.strip="1";break;case "block":h.strip="1";break;case "task":if(typeof h["var"]=="string")h.task=h["var"];else a.error("mjt:task requires var= or mjt:var= attribute");break;case "doc":this.scope.toplevel||a.error("mjt:doc is only legal as the toplevel tag");h.strip=
"1";this.document_content_type=typeof h.type!="undefined"?h.type:"text/html";if(typeof h["xml-pi"]!="undefined")if(h["xml-pi"]=="true"||h["xml-pi"]=="1")this.output_prefix='<?xml version="1.0" encoding="utf-8" ?>\n';else if(h["xml-pi"]=="false"||h["xml-pi"]=="0")this.output_prefix=null;if(this.document_content_type=="text/html")this.set_output_mode("html");else if(/^text\//.test(this.document_content_type))this.set_output_mode("text");else{/^application\/.*xml$/.test(this.document_content_type);this.set_output_mode("xml")}break;
default:a.error("ignoring unknown mjt tag",g);break}o=null;var l=false;if(typeof h.trim!="undefined")l=true;if(b.firstChild!==null)o=function(w){w=w.firstChild;var y={};if(l)y.trim_leading_ws=true;for(;w!=null;){var r=w.nextSibling;if(l&&r===null)y.trim_trailing_ws=true;y.leading_ws=this.compile_node(w,y);y.trim_leading_ws=false;y.trim_trailing_ws=false;w=r}return y.leading_ws};if(!(j=="script"&&this.browser_dom)){if(j in this.noescape_tags)o=function(w){w=w.firstChild;if(w!==null)if(w.nodeType!=
3||w.nextSibling)a.warn("<"+g+"> tag should contain only text");else if(w.nodeValue.match(new RegExp("</"+g)))a.warn("illegal content for HTML script tag, removed");else{this.emitln(" __m[__n++]=(function () {");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");w=this.compile_text(w.nodeValue,false,false,false,true);this.emitln("return __pkg.runtime.cleanup_noquote(__m, "+this.jsencode(j)+");");this.emitln("})();");return w.next_node_leading_ws}};if(typeof h.task!="undefined")this.compile_task(h.task,
b);else{if(typeof h.def!="undefined"){typeof k.id!="undefined"&&a.warn("mjt.def=",h.def,'must not have an id="..." attribute');this.compile_def(h.def,b);if(this.scope.parent.toplevel){this.emitln("var __pkg = this.tpackage;");this.emitln("var exports = this.exports;");this.emitln("var __ts=__pkg._template_fragments;");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");this.output_prefix!=null&&this.markup(this.output_prefix)}else this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");
e.push(function(){var w=this.scope;if(w.has_tasks)if(!f||typeof h.strip!="undefined")a.error("can't strip toplevel tag of mjt.def=\""+h.def+'" tag because it contains tasks');this.complete_def();var y=h.def.replace(/\(.*/,"");this.scope.toplevel&&this.document_content_type!=null&&this.emitln(y,".doc_content_type = ",this.jsencode(this.document_content_type),";");this.scope.toplevel||this.emitln(y," = __pkg.runtime.tfunc_factory(",this.jsencode(h.def),", ",y,", ","__pkg",", ",w.has_tasks,", ",false,
");");this.scope.parent&&this.scope.parent.toplevel&&this.emitln("exports.",y," = ",y,";");typeof w.microdata!="undefined"&&this.emitln(y,".source_microdata = ",JSON.stringify(w.microdata.lastvalue),";")})}if(typeof h.when!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.when, in choice state",c);e.push(function(){this.flush_markup()})}if(typeof h.otherwise!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.otherwise, in choice state ",c);e.push(function(){this.flush_markup()})}var m=
{meta:"content",audio:"src",embed:"src",iframe:"src",img:"src",source:"src",video:"src",a:"href",area:"href",link:"href",object:"data",time:"datetime"},q=this.scope.microdata;if(q&&typeof h.itemprop!="undefined"){"itemprop"in n||k.push({name:"itemprop",value:h.itemprop});if(q.item===null)throw new Error("got mjt.itemprop= without containing mjt.item=");if(typeof h["for"]!="undefined")throw new Error(g+' element has both acre:itemprop= and mjt.for="" attributes');c="itemvalue["+this.jsencode(h.itemprop)+
"]";h["for"]="itemindex,itemvalue in ((typeof "+c+' == "object" && '+c+" !== null && "+c+" instanceof Array) ? "+c+" : ["+c+"])";if(j in m){c=m[j];c in n||k.push({name:c,value:"$itemvalue"})}else if(b.firstChild===null)h.content="itemvalue";e.push(function(){var w=h.itemprop;if(j in m){var y=m[j];q.item[w]=y in k?k[y]:null}else q.item[w]=b.firstChild===null?null:q.lastvalue})}if(typeof h["for"]!="undefined"){var t=/^(\w+)(\s*,\s*(\w+))?\s+in\s+(.+)$/.exec(h["for"]);if(t){c=t[1];p=t[3];t=t[4];var s;
if(p){s=c;c=p}else{s=this.uniqueid(c+"_index");c=c}this.emitln("__pkg.runtime.foreach(this, (",t,"), function (",s,", ",c,") {");var v=this.uniqueid("once");this.emitln("var ",v," = 1;");this.emitln("while (",v,") {");e.push(function(){this.emitln(v,"--;");this.emitln("} /* while once */");this.emitln("return ",v," ? __pkg.runtime._break_token :  __pkg.runtime._continue_token;");this.emitln("}); /* foreach */")})}else if(h["for"].charAt(0)=="("){this.emitln("for ",h["for"]," {");e.push(function(){this.emitln("}")})}else a.warn("bad mjt.for= syntax")}if(typeof h["if"]!=
"undefined"){this.emitln("if (",h["if"],") {");e.push(function(){this.emitln("}")})}if(typeof h.elif!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and elif=""');this._markup=[];this.emitln("else if (",h.elif,") {");e.push(function(){this.emitln("}")})}if(typeof h["else"]!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and else=""');this._markup=[];this.emitln("else {");
e.push(function(){this.emitln("}")})}if(typeof h.script!="undefined"){o=false;switch(h.script){case "":break;case "1":break;case "ondomready":o=true;break;default:a.warn("reserved mjtattrs.script= value:",h.script);break}o&&this.emitln("__pkg.runtime.ondomready(function () {");if(c=b.firstChild)if(c.nodeType!=3||c.nextSibling)a.warn("the mjt.script element can only contain javascript text, not HTML.  perhaps you need to quote '<', '>', or '&' (this is unlike a <script> tag!)");else{c=c?c.nodeValue:
"";c.match(/\/\/ /)&&this.browser_dom&&a.warn('"//" comments in mjt.script= definition will fail on IE6');c=c.split("\n");for(p=0;p<c.length;p++){this.emitln(c[p]);this.source_loc++}}o&&this.emitln("}, this);");f=false;o=null}if(typeof h.choose!="undefined"){this.flush_markup();o=function(w){this.compile_choose(w,h.choose)}}if(typeof h.replace!="undefined"){f=false;o=function(){this.emitln("__m[__n++]=(",h.replace,");")}}if(typeof h.content!="undefined")o=function(){this.emitln("__m[__n++]=(",h.content,
");")};for(var u in h)if(u.substr(0,2)=="on")if(this.browser_target){p={name:u,value:this.compile_onevent_attr(u,h[u])};k.push(p)}else a.warn("mjt:onevent= attributes only make sense if targeting a browser");this.debug&&this.browser_dom&&typeof h.def!="undefined"&&k.push({name:"mjt_template",value:h.def});if(q&&typeof h.item!="undefined"){"item"in n||k.push({name:"item",value:h.item});q.stack.push(q.item);if("id"in n){c=n.id.value;q.item=c in q.items?q.items[c]:(q.items[c]={})}else q.item={};if(h.item!=
"")q.item.__type=h.item;this.emitln("var item = itemvalue;");e.push(function(){q.lastvalue=q.item;q.item=q.stack.pop()})}if(q&&typeof h.itemfor!="undefined"){"itemfor"in n||k.push({name:"itemfor",value:h.itemfor});q.stack.push(q.item);if(typeof q.items[h.itemfor]=="undefined")q.items[h.itemfor]={};q.item=q.items[h.itemfor];e.push(function(){q.lastvalue=q.item;q.item=q.stack.pop()})}n=typeof h.strip!="undefined"?h.strip:null;u=null;if(n=="1")f=false;if(f){c=typeof h.attrs!="undefined"?h.attrs:null;
if(n!==null){u=this.uniqueid("strip");this.emitln("var ",u," = (",n,");");this.emitln("if (!",u,") {")}d&&typeof h.def==="undefined"&&this.markup(d);typeof h.def!="undefined"?this.generate_open_tag(g,k,c,true):this.generate_open_tag(g,k,c,false);o===null&&this.output_mode=="xml"?this.markup("/>"):this.markup(">");n!==null&&this.emitln("}")}if(o!==null)if(j in this.empty_tags)a.warn('tag "'+g+'" must be empty, content ignored');else var A=o.apply(this,[b]);if(f)if(!(o===null&&this.output_mode=="xml"))if(!(j in
this.empty_tags))if(u){this.emitln("if (!",u,") {");typeof A!=="undefined"&&this.markup(A);this.markup("</",g,">");this.emitln("}")}else{typeof A!=="undefined"&&this.markup(A);this.markup("</",g,">")}for(d=e.length-1;d>=0;d--)e[d].apply(this,[])}}}})(mjt);
(function(a){a.App=function(b){if(typeof b=="undefined")b={};this.state=null;this.yui_history_id="mjtapp";this.argschema={"mjt.server":{key:"mjt.server",statekey:"service_url",validator:a.validators.service_host},"mjt.debug":{key:"mjt.debug",statekey:"debug",validator:a.validators.flag}};for(var c in b)this.argschema[c]=b[c];this._onstatechange={};this.init()};a.App.prototype.init=function(){this.init_state();a.service_url=this.state.service_url;a.freebase.set_service_url(this.state.service_url);
a.debug=this.state.debug;a.Task.debug=this.state.debug;a.urlquery=this.state;return this};a.App.prototype.onstatechange=function(){this._onstatechange[a.uniqueid("statecb")]=a.vthunk(arguments);return this};a.App.prototype.refresh=function(){for(var b in this._onstatechange)this._onstatechange[b].apply(this,[]);return this};a.App.prototype._handle_onhistory=function(b){a.log("yui setting state",b,typeof this.state);if(b===null){b=YAHOO.util.History.getCurrentState(this.yui_history_id);a.log("yui history onLoadEvent:",
b)}else a.log("yui history state:",b);this.state=rison.decode_object(b);this.refresh()};a.App.prototype.init_state=function(){var b;if(typeof window!="undefined")b=window.location.search;if(typeof acre!="undefined")b=acre.environ.query_string;this.state=typeof b=="string"&&b.length>0&&b.charAt(0)=="?"?this.decode_uristate(b.substr(1)):this.decode_uristate("");if(typeof YAHOO==="undefined"||!YAHOO.util.History)return this;b=YAHOO.util.History;var c=b.getBookmarkedState(this.yui_history_id);c||(c=rison.encode_object(this.state));
a.log("yui history initial state",c);b.register(this.yui_history_id,c,a.vthunk("_handle_onhistory",this));b.onLoadEvent.subscribe(a.vthunk("_handle_onhistory",this,null));b.initialize("yui-history-iframe","yui-history-field");return this};a.App.prototype.mark_history=function(){if(this.yui_history_id!==null){var b=rison.encode_object(this.state);YAHOO.util.History.navigate(this.yui_history_id,b)}};a.Validator=function(){};a.Validator.prototype.encode=function(b){if(b!=this.default_value)return this.encodestr(b)};
a.Validator.prototype.decode=function(b){if(typeof b=="undefined")return this.default_value;return this.decodestr(b)};a.validators={};a.validators.flag=new a.Validator;a.validators.flag.default_value=false;a.validators.flag.encodestr=function(b){return b?"1":undefined};a.validators.flag.decodestr=function(b){return b=="1"?true:false};a.validators.service_host=new a.Validator;a.validators.service_host.default_value="http://www.freebase.com";a.validators.service_host.encodestr=function(b){b=b.replace(/^http:\/\//,
"");if(typeof window!="undefined"&&b==window.location.host)return".";return b};a.validators.service_host.decodestr=function(b){if(b.substr(0,4)=="http")url=b;else if(b=="."){if(typeof window!="undefined")url=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")url=acre.environ.server_protocol+"//"+acre.environ.host}else url="http://"+b;return url};a.App.prototype.encode_uristate=function(b){var c={},d,e,f={};for(d in this.argschema){e=this.argschema[d];f[e.statekey]=e}for(d in this.state){e=
f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(this.state[d]);else c[d]=this.state[d]}for(d in b){e=f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(b[d]);else c[d]=b[d]}for(d in c)typeof c[d]=="undefined"&&delete c[d];return a.formencode(c)};a.App.prototype.decode_uristate=function(b){var c={},d=a.formdecode(b),e;for(e in d){b=this.argschema[e];if(typeof b!="undefined")c[b.statekey]=b.validator.decode(d[e]);else c[e]=d[e]}for(e in this.argschema){b=this.argschema[e];d=b.statekey;
if(!(d in c))c[d]=b.validator.default_value}return c};a.App.prototype.href=function(b,c){if(typeof b=="undefined"||b===null)b=location.protocol+"//"+location.host+location.pathname;var d=this.encode_uristate(c);return b+(d?"?"+d:"")}})(mjt);
typeof jQuery!="undefined"&&function(a){function b(d,e,f){var g="";if(typeof d==="string"){var j=c[d];if(typeof j==="object"){j=j[e];if(typeof j==="function")g=mjt.flatten_markup(j.apply(this,f));else console.warn("acre template '"+e+"' does not exist in package '"+d+"'")}else console.warn("acre template package '"+d+"' has not been registered")}else g=mjt.flatten_markup(d);return g}if(typeof a!="undefined"){var c={};a(window).bind("acre.template.register",function(d,e){var f=e.pkgid,g=e.source;if(typeof f===
"string"&&typeof g==="object"){if(g.def)g=(new mjt.TemplatePackage).init_from_js(g).toplevel();c[f]=g}});a.fn.mjt=function(d){var e=mjt.flatten_markup(d);return this.each(function(){this.innerHTML=e})};a.fn.acre=function(d,e,f){return this.each(function(){a(this).html(b(d,e,f))})};a.acre=function(d,e,f){return b(d,e,f)}}}(jQuery);
(function(a){function b(e,f){var g=this,j=e.add(g),h=a(window),k,n,p,o=a.tools.expose&&(f.mask||f.expose),l=Math.random().toString().slice(10);if(o){if(typeof o=="string")o={color:o};o.closeOnClick=o.closeOnEsc=false}var m=f.target||e.attr("rel");n=m?a(m):e;if(!n.length)throw"Could not find Overlay: "+m;e&&e.index(n)==-1&&e.click(function(q){g.load(q);return q.preventDefault()});a.extend(g,{load:function(q){if(g.isOpened())return g;var t=d[f.effect];if(!t)throw'Overlay: cannot find effect : "'+f.effect+
'"';f.oneInstance&&a.each(c,function(){this.close(q)});q=q||a.Event();q.type="onBeforeLoad";j.trigger(q);if(q.isDefaultPrevented())return g;p=true;o&&a(n).expose(o);var s=f.top,v=f.left,u=n.outerWidth({margin:true}),A=n.outerHeight({margin:true});if(typeof s=="string")s=s=="center"?Math.max((h.height()-A)/2,0):parseInt(s,10)/100*h.height();if(v=="center")v=Math.max((h.width()-u)/2,0);t[0].call(g,{top:s,left:v},function(){if(p){q.type="onLoad";j.trigger(q)}});o&&f.closeOnClick&&a.mask.getMask().one("click",
g.close);f.closeOnClick&&a(document).bind("click."+l,function(w){a(w.target).parents(n).length||g.close(w)});f.closeOnEsc&&a(document).bind("keydown."+l,function(w){w.keyCode==27&&g.close(w)});return g},close:function(q){if(!g.isOpened())return g;q=q||a.Event();q.type="onBeforeClose";j.trigger(q);if(!q.isDefaultPrevented()){p=false;d[f.effect][1].call(g,function(){q.type="onClose";j.trigger(q)});a(document).unbind("click."+l).unbind("keydown."+l);o&&a.mask.close();return g}},getOverlay:function(){return n},
getTrigger:function(){return e},getClosers:function(){return k},isOpened:function(){return p},getConf:function(){return f}});a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(q,t){a.isFunction(f[t])&&a(g).bind(t,f[t]);g[t]=function(s){a(g).bind(t,s);return g}});k=n.find(f.close||".close");if(!k.length&&!f.close){k=a('<a class="close"></a>');n.prepend(k)}k.click(function(q){g.close(q)});f.load&&g.load()}a.tools=a.tools||{version:"@VERSION"};a.tools.overlay={addEffect:function(e,
f,g){d[e]=[f,g]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var c=[],d={};a.tools.overlay.addEffect("default",function(e,f){var g=this.getConf(),j=a(window);if(!g.fixed){e.top+=j.scrollTop();e.left+=j.scrollLeft()}e.position=g.fixed?"fixed":"absolute";this.getOverlay().css(e).fadeIn(g.speed,f)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,
e)});a.fn.overlay=function(e){var f=this.data("overlay");if(f)return f;if(a.isFunction(e))e={onBeforeLoad:e};e=a.extend(true,{},a.tools.overlay.conf,e);this.each(function(){f=new b(a(this),e);c.push(f);a(this).data("overlay",f)});return e.api?f:this}})(jQuery);
"CueCard"in window||function(){window.CueCard={loaded:false,version:"trunk",loadingScriptsCount:0,error:null,helper:"http://www.freebase.com/cuecard/",apiProxy:{base:"http://www.freebase.com/cuecard/",read:"mqlread?",write:"mqlwrite?"},freebaseServiceUrl:"http://www.freebase.com/",params:{bundle:true,externals:true}};CueCard.findScript=function(b,c){for(var d=b.documentElement.getElementsByTagName("head"),e=0;e<d.length;e++)for(var f=d[e].firstChild;f!=null;){if(f.nodeType==1&&f.tagName.toLowerCase()==
"script"){var g=f.src;if(g.indexOf(c)>=0)return g}f=f.nextSibling}return null};CueCard.parseURLParameters=function(b,c,d){c=c||{};d=d||{};if(typeof b=="undefined")b=location.href;var e=b.indexOf("?");if(e<0)return c;b=(b+"#").slice(e+1,b.indexOf("#"));var f=b.split("&"),g;b={};var j=window.decodeURIComponent||unescape;for(e=0;g=f[e];e++){var h=g.indexOf("="),k=j(g.slice(0,h).replace(/\+/g," ")),n=b[k];if(typeof n=="undefined")n=[];else n instanceof Array||(n=[n]);b[k]=n.concat(j(g.slice(h+1).replace(/\+/g,
" ")))}for(e in b)if(b.hasOwnProperty(e)){f=d[e]||String;g=b[e];g instanceof Array||(g=[g]);c[e]=f===Boolean&&g[0]=="false"?false:f.apply(this,g)}return c};if(typeof CueCard_urlPrefix=="string")CueCard.urlPrefix=CueCard_urlPrefix;else{var a=CueCard.findScript(document,"cuecard-api.js");if(a==null){CueCard.error=new Error("Failed to derive URL prefix for CueCard API code files");return}CueCard.urlPrefix=a.substr(0,a.indexOf("cuecard-api.js"))}CueCard.parseURLParameters(a,CueCard.params,{bundle:Boolean,
externals:Boolean});CueCard.loaded=true}();
CueCard.createComposition=function(a){var b=new CueCard.QueryEditor(a.queryEditorElement,a.queryEditorOptions),c=null,d=null;if("outputPaneElement"in a){c=a.outputPaneOptions||{};c.queryEditor=b;c=new CueCard.OutputPane(a.outputPaneElement,c);b.setOutputPane(c)}if("controlPaneElement"in a){d=a.controlPaneOptions||{};d.queryEditor=b;if(c!=null)d.outputPane=c;d=new CueCard.ControlPane(a.controlPaneElement,d);b.setControlPane(d)}return{queryEditor:b,outputPane:c,controlPane:d}};
CueCard.showDialog=function(a){var b=Array.prototype.slice.call(arguments);b.shift();var c=$("<div id='dialog-"+a+"' class='modal'></div>").acre(fb.acre.apps.cuecard+"/dialogs.mjt",a,b);$(document.body).append(c.hide());c.overlay({load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5},close:".modal-buttons .button",closeOnClick:false,onClose:function(){c.remove()}})};CueCard.MqlSyntax={};
CueCard.MqlSyntax.KeywordSuggestions=[{label:"*",hint:"(keyword)",qualifiedProperty:"*",result:"*"},{label:"connect",hint:"(keyword)",qualifiedProperty:"connect",result:"connect"},{label:"create",hint:"(keyword)",qualifiedProperty:"create",result:"create"},{label:"estimate-count",hint:"(keyword)",qualifiedProperty:"estimate-count",result:"estimate-count"},{label:"limit",hint:"(keyword)",qualifiedProperty:"limit",result:"limit"},{label:"optional",hint:"(keyword)",qualifiedProperty:"optional",result:"optional"},
{label:"return",hint:"(keyword)",qualifiedProperty:"return",result:"return"},{label:"sort",hint:"(keyword)",qualifiedProperty:"sort",result:"sort"}];
CueCard.MqlSyntax.KeywordValueHints={"*":{choices:[{label:"null",hint:"return a single value",result:null},{label:"[]",hint:"return a list of values",result:[],offset:1},{label:"{}",hint:"return a single object",result:{},offset:1},{label:"[{}]",hint:"return a list of objects",result:[{}],offset:2}]},connect:{choices:[{label:"insert",hint:"attach a value or object to a non-unique property, or attach the first value or object to a unique property",result:"insert"},{label:"update",hint:"attach a value or object to a unique property replacing any value or object that was previously connected",
result:"update"},{label:"replace",hint:"update unique properties and performs an insert for non-unique properties",result:"replace"},{label:"delete",hint:"detach a value or object from any property",result:"delete"}]},create:{choices:[{label:"unless_exists",hint:"look for a matching object and create it if it doesn't exist",result:"unless_exists"},{label:"unless_connected",hint:"look for a matching object connected to the parent query, and create and connect it if it doesn't exist",result:"unless_connected"},
{label:"unconditional",hint:"create the specified object without looking for a match (dangerous; ues carefully)",result:"unconditional"}]},"estimate-count":{choices:[{label:"null",hint:"(keyword)",result:null}]},limit:{html:'Use a positive integer to limit how many results to return, or <span class="cuecard-code">0</span> for all available results.'},optional:{choices:[{label:"true",hint:"(keyword)",result:true},{label:"false",hint:"(keyword)",result:false},{label:"required",hint:"(keyword)",result:"required"},
{label:"forbidden",hint:"(keyword)",result:"forbidden"}]},"return":{choices:[{label:"count",hint:"(keyword)",result:"count"},{label:"estimate-count",hint:"(keyword)",result:"estimate-count"}]},sort:{html:'Use a property name in the same query node. Prefix it with <span class="cuecard-code">-</span> to sort in descending order. For more complex ordering, see <a href="">this documentation</a>.'}};
CueCard.MqlSyntax.UniqueTopicValueSuggestions=[{label:"null",hint:"returns a single topic ID",result:null},{label:"{}",hint:"returns a single topic object with a default set of properties",result:{},offset:1},{label:'{ "id" : null, "name" : null }',hint:"returns a single topic object with id and name",result:{id:null,name:null}}];
CueCard.MqlSyntax.TopicValueSuggestions=[{label:"[]",hint:"returns a list of topic IDs or topic names",result:[],offset:1},{label:"[{}]",hint:"returns a list of topic objects with a default set of properties",result:[{}],offset:2},{label:'[{ "id" : null, "name" : null, "optional" : true, "limit" : 10 }]',hint:"returns an optional, limited list of topic objects with id and name",result:[{id:null,name:null,optional:true,limit:10}]}];
CueCard.MqlSyntax.SingleValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "type" : null }',hint:"returns a value with type",result:{value:null,type:null}}];CueCard.MqlSyntax.UniqueStringLiteralValueSuggestions=[{label:"null",hint:"returns a single string",result:null},{label:'{ "value" : null, "lang" : null, "optional" : true }',hint:"returns a single string with more options",result:{value:null,lang:null,optional:true}}];
CueCard.MqlSyntax.StringLiteralValueSuggestions=[{label:"[]",hint:"returns a list of strings",result:null},{label:'[{ "value" : null, "lang" : null, "optional" : true }]',hint:"returns a list of strings with more options",result:[{value:null,lang:null,optional:true}]}];CueCard.MqlSyntax.UniqueLiteralValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "optional" : true }',hint:"returns a single value with more options",result:{value:null,optional:true}}];
CueCard.MqlSyntax.LiteralValueSuggestions=[{label:"[]",hint:"returns a list of values",result:null},{label:'[{ "value" : null, "optional" : true }]',hint:"returns a list of values with more options",result:[{value:null,optional:true}]}];CueCard.SerializingContext=function(a){this._parent=a;this._root=a==null?this:a.getRoot();this._properties={}};
CueCard.SerializingContext.prototype={getProperty:function(a){return a in this._properties?this._properties[a]:this._parent!=null?this._parent.getProperty(a):null},setProperty:function(a,b){this._properties[a]=b},getRoot:function(){return this._root},getRootProperty:function(a){return this.getRoot().getProperty(a)},setRootProperty:function(a,b){return this.getRoot().setProperty(a,b)},create:function(){return new SerializingContext(this)}};
CueCard.IndentWriter=function(a){this._context=a;this._stream=a.getProperty("stream")};
CueCard.IndentWriter.prototype={appendLineBreak:function(){this._stream.append("\n")},appendIndent:function(){for(var a=this._context.getRootProperty("indentLevel"),b=this._context.getRootProperty("indentString"),c=0;c<a;c++)this._stream.append(b)},indent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")+1)},unindent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")-1)},append:function(a){this._stream.append(a)}};
(function(){function a(g){return/["\\\x00-\x1f]/.test(g)?g.replace(/([\x00-\x1f\\"])/g,function(j,h){var k=e[h];if(k)return k;k=h.charCodeAt();return"\\u00"+Math.floor(k/16).toString(16)+(k%16).toString(16)}):g}function b(g){return g!=null&&typeof g=="object"&&!(g instanceof Array)&&!("__identifier__"in g)}function c(g){for(var j in g)if(g.hasOwnProperty(j))return true;return false}function d(g){return g.length==0||g.length==1&&b(g[0])&&!c(g[0])}var e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},f=CueCard.jsonize=function(g,j){j=j?j:{};var h="",k="quoteAllFieldNames"in j?j.quoteAllFieldNames:true,n="variables"in j?j.variables:{},p="resolveVariables"in j?j.resolveVariables:false;if("context"in j)var o=new CueCard.SerializingContext(j.context);else{var l="indentCount"in j?j.indentCount:4,m="";for(o=0;o<l;o++)m+=" ";o=new CueCard.SerializingContext(null);o.setProperty("indentCount",l);o.setProperty("indentString",m);o.setProperty("indentLevel",0);
o.setProperty("stream",{append:function(q){h+=q}})}o.setProperty("omitWhitespace","omitWhitespace"in j?j.omitWhitespace:false);o.setProperty("maxFieldLength","maxFieldLength"in j?j.maxFieldLength:15);o.setProperty("breakLines","breakLines"in j?j.breakLines:true);o.setProperty("alignFieldValues","alignFieldValues"in j?j.alignFieldValues:true);o.setProperty("collapseSingleObjectArray","collapseSingleObjectArray"in j?j.collapseSingleObjectArray:true);o.setProperty("variables",n);o.setProperty("resolveVariables",
p);o.setProperty("encodeJavascriptString","encodeJavascriptString"in j?j.encodeJavascriptString:a);o.setRootProperty("fieldNameEncoder",{_m:{},encode:function(q){if(q in this._m)return this._m[q];else{var t=a(q);return this._m[q]=t=k||/\W/.test(t)?'"'+t+'"':t}}});o.setProperty("path",[]);o.setRootProperty("contextualize","contextualize"in j?j.contextualize:function(q){return q});n=new CueCard.IndentWriter(o);f.converters.anything(g,o,n);return h};f.converters={anything:function(g,j,h){if(g==null)f.converters["null"](g,
j,h);else if(g instanceof Array)f.converters.array(g,j,h);else g instanceof Object?f.converters.object(g,j,h):f.converters[typeof g](g,j,h)},array:function(g,j,h){var k=j.getProperty("omitWhitespace"),n=j.getProperty("breakLines");if(g.length==0)h.append("[]");else{if(g.length==1)if(b(g[0]))if(c(g[0])){if(j.getProperty("collapseSingleObjectArray")){h.append("[");var p=g[0];f.converters.object(p,j,h);h.append("]");return}}else{h.append("[{}]");return}h.append("[");if(n){h.appendLineBreak();h.indent()}else k||
h.append(" ");for(var o=g.length,l=0;l<o;l++){p=g[l];var m=f.converters[p==null?"null":typeof p];if(m){n&&h.appendIndent();m(p,j,h);l<o-1&&h.append(",");if(n)h.appendLineBreak();else k||h.append(" ")}}if(n){h.unindent();h.appendIndent()}h.append("]")}},"boolean":function(g,j,h){h.append(String(g))},"null":function(g,j,h){h.append("null")},undefined:function(g,j,h){h.append("undefined")},number:function(g,j,h){h.append(isFinite(g)?String(g):"null")},object:function(g,j,h){if(g instanceof Array)f.converters.array(g,
j,h);else if("__identifier__"in g){g=g.__identifier__;var k=j.getProperty("resolveVariables"),n=j.getProperty("variables");if(g in n)if(k){k=n[g];f.converters.anything(k,j,h)}else h.append(g);else f.converters.anything(g,j,h)}else{n=j.getRootProperty("contextualize");var p=j.getProperty("path"),o=j.getProperty("omitWhitespace"),l=j.getProperty("breakLines"),m=j.getProperty("alignFieldValues");h.append("{");if(l){h.appendLineBreak();h.indent()}else o||h.append(" ");var q=0,t=0,s=j.getRootProperty("fieldNameEncoder");
for(var v in g)if(g.hasOwnProperty(v)){k=g[v];q++;if(!b(k)&&(!(k!=null&&k instanceof Array)||d(k)))t=Math.max(t,s.encode(v).length)}t=Math.min(t,j.getProperty("maxFieldLength"));for(v in g)if(g.hasOwnProperty(v)){k=g[v];var u=f.converters[k==null?"null":typeof k],A=s.encode(v);l&&h.appendIndent();h.append(A);h.append(o?":":": ");if(!o&&l&&m&&!b(k)&&(!(k!=null&&k instanceof Array)||d(k)))for(A=A.length;A<t;A++)h.append(" ");p.unshift({field:v});u(k,n(j,p),h);p.shift();q--;q>0&&h.append(",");if(l)h.appendLineBreak();
else o||h.append(" ")}if(l){h.unindent();h.appendIndent()}h.append("}")}},string:function(g,j,h){h.append('"'+j.getProperty("encodeJavascriptString")(g)+'"')},"null":function(g,j,h){h.append("null")}}})();CueCard.JsonpQueue={pendingCallIDs:{},callInProgress:0};CueCard.JsonpQueue.cancelAll=function(){CueCard.JsonpQueue.pendingCallIDs={}};
CueCard.JsonpQueue.call=function(a,b,c,d){if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="progress";CueCard.JsonpQueue.callInProgress++;var e=(new Date).getTime()+"x"+Math.floor(Math.random()*1E3),f=document.createElement("script");f.setAttribute("onerror","err"+e+"();");a+=(a.indexOf("?")<0?"?":"&")+"callback=cb"+e;f.setAttribute("src",a);var g=function(){CueCard.JsonpQueue.callInProgress--;if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="auto";d||f.parentNode.removeChild(f);
try{delete window["cb"+e];delete window["err"+e]}catch(j){window["cb"+e]=undefined;window["err"+e]=undefined}if(e in CueCard.JsonpQueue.pendingCallIDs){delete CueCard.JsonpQueue.pendingCallIDs[e];return true}else return false};window["cb"+e]=function(j){if(g())try{b(j)}catch(h){}};window["err"+e]=function(){if(g())if(typeof c=="function")try{c(a)}catch(j){}};CueCard.JsonpQueue.pendingCallIDs[e]=true;document.getElementsByTagName("head")[0].appendChild(f)};
CueCard.JsonpQueue.queryOne=function(a,b,c,d){CueCard.JsonpQueue.queryOneEnvelope({query:a},b,c,d)};CueCard.JsonpQueue.queryOneEnvelope=function(a,b,c,d){a=CueCard.jsonize({q1:a},{breakLines:false});a=CueCard.freebaseServiceUrl+"api/service/mqlread?queries="+encodeURIComponent(a);CueCard.JsonpQueue.call(a,function(e){if(e.q1.code=="/api/status/error")typeof c=="function"&&c(e.q1);else b(e.q1)},function(){typeof c=="function"&&c("Unknown")},d)};CueCard.QueryParser={};
CueCard.QueryParser.parseForContext=function(a,b,c,d){var e=new CueCard.QueryTokenizer(a,b),f=e.token(),g=[],j=CueCard.Token.Types,h=function(){f=g.length==0?e.next():g.shift()},k=function(r){if(r==0)return f;else{for(;r>g.length;)g.push(e.next());return g[r-1]}},n=function(){for(;f!=null&&(f.type==j.whitespace||f.type==j.unrecognized);)h()},p=function(r){return new CueCard.Token(CueCard.Token.Types.phantom,"",r.start,r.start)},o=function(){return f!=null?f:new CueCard.Token(CueCard.Token.Types.phantom,
"",e.index(),e.index())},l=function(){var r=new CueCard.QueryNode(CueCard.QueryNode.TYPE_MISSING);r.startToken=r.endToken=p(o());return r},m=function(r){r=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL);r.startToken=f;for(f!=null&&f.type==j.delimiter&&f.content=="{"&&h();f!=null;){n();if(f==null)break;var z=null,B=null,C=null;if(f.type==j.identifier){z=f.content;B=f;h();n()}else if(f.type==j.stringLiteral){z=f.content.replace(/^['"]/,"").replace(/['"]$/,"");B=f;h();n()}else B=p(f);if(f!=
null&&f.type==j.delimiter&&(f.content==":"||f.content==";")){h();n()}if(f!=null)C=s(false);if(z!=null||C!=null){z=new CueCard.QueryNodeLink(z!=null?z:"",B);z.value=C!=null?C:l();r.links.push(z)}n();if(f==null||f.type==j.delimiter&&(f.content=="}"||f.content=="]"))break;f.type==j.delimiter&&f.content==","&&h()}if(f!=null&&f.type==j.delimiter&&f.content=="}"){r.endToken=f;h()}if(r.endToken==null)r.endToken=o();return r},q=function(){var r=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY);
r.startToken=f;r.elements=[];for(f!=null&&f.type==j.delimiter&&f.content=="["&&h();f!=null;){n();if(f==null||f.type==j.delimiter&&f.content=="]")break;r.elements.push(m());n();f!=null&&f.type==j.delimiter&&f.content==","&&h()}if(f!=null&&f.type==j.delimiter&&f.content=="]"){r.endToken=f;h()}if(r.endToken==null)r.endToken=o();return r},t=function(){for(var r=1,z;(z=k(r))!=null&&(z.type==j.whitespace||z.type==j.unrecognized);)r++;if(z!=null)if(z.type==j.delimiter&&z.content=="{")return q();else if(z.type==
j.identifier||z.type==j.stringLiteral){for(r++;(z=k(r))!=null&&(z.type==j.whitespace||z.type==j.unrecognized);)r++;if(z!=null&&z.type==j.delimiter&&z.content==":")return q()}r=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);r.startToken=f;r.isArray=true;r.value=[];for(f!=null&&f.type==j.delimiter&&f.content=="["&&h();f!=null;){n();if(f==null||f.type==j.delimiter&&f.content=="]")break;z=s(false);if(z==null)break;r.value.push(z);n();f!=null&&f.type==j.delimiter&&f.content==","&&h()}if(f!=null&&
f.type==j.delimiter&&f.content=="]"){r.endToken=f;h()}if(r.endToken==null)r.endToken=o();return r},s=function(r){n();if(f==null)r=l();else{if(f.type==j.delimiter)r=f.content=="["?t():f.content=="{"?m():l();else{if(r)r=q();else a:{r=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);r.startToken=r.endToken=f;r.isArray=false;if(f.type==j.numberLiteral)r.value=parseFloat(f.content);else if(f.type==j.stringLiteral)r.value=f.content.replace(/^['"]/,"").replace(/['"]$/,"");else if(f.type==j.booleanLiteral)r.value=
f.content=="true"||f.content=="True";else if(f.type==j.nullLiteral)r.value=null;else if(f.type==j.delimiter){r=null;break a}else r.value=f.content;h();r=r}r=r}r=r}return r},v=function(r){return c<r.start.line||c==r.start.line&&d<=r.start.col},u=function(r){return c>r.start.line||c==r.start.line&&d>=r.start.col},A=function(r){return c<r.end.line||c==r.end.line&&d<=r.end.col};v=function(r){return c<r.start.line||c==r.start.line&&d<=r.start.col};var w=function(r){return r.startToken==r.endToken?u(r.startToken)&&
A(r.startToken):u(r.startToken)&&v(r.endToken)},y=function(r,z){if(r.type==CueCard.QueryNode.TYPE_TERMINAL)if(r.isArray){for(var B=0;B<r.value.length;B++){var C=r.value[B];if(v(C.startToken)){z.push({child:B,relative:"before",node:r});return}else if(w(C)){z.push({child:B,relative:"inside",node:r});y(C,z);return}}z.push({child:r.value.length,relative:"before",node:r})}else z.push({token:r.startToken,node:r,offset:d-r.startToken.start.col});else if(r.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){for(B=
0;B<r.elements.length;B++){C=r.elements[B];if(v(C.startToken)){z.push({child:B,relative:"before",node:r});return}else if(w(C)){z.push({child:B,relative:"inside",node:r});y(C,z);return}}z.push({child:r.elements.length,relative:"before",node:r})}else if(r.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(B=0;B<r.links.length;B++){C=r.links[B];if(v(C.token)){z.push({child:B,relative:"before",node:r});return}else if(A(C.token)){z.push({child:B,relative:"path",node:r,offset:d-C.token.start.col});return}else if(u(C.value.startToken)){if(A(C.value.endToken)){z.push({child:B,
relative:"inside",node:r});y(C.value,z);return}}else{z.push({child:B,relative:"space",node:r});return}}z.push({child:r.links.length,relative:"before",node:r})}else z.push({token:r.startToken,node:r})};n();a={model:s(true),context:[]};y(a.model,a.context);return a};CueCard.QueryTokenizer=function(a,b){this._text=a+" ";this._maxIndex=a.length;this._index=b;this._col=this._line=0;this.next()};CueCard.QueryTokenizer.prototype.token=function(){return this._token};
CueCard.QueryTokenizer.prototype.index=function(){return this._index};CueCard.QueryTokenizer._whitespaces=" \t\r\n";
CueCard.QueryTokenizer.prototype.next=function(){this._token=null;if(this._index<this._maxIndex){var a=this._text.charAt(this._index),b=this._text.charAt(this._index+1),c=this,d=function(){c._index++;c._col++},e=function(){return new CueCard.TokenPos(c._index,c._line,c._col)},f=function(){var p=e();d();return p},g=function(p,o,l){var m=e();c._pos=m;c._token=new CueCard.Token(p,l||c._text.substring(o.offset,m.offset),o,m)},j=function(){for(var p=e();c._index<c._maxIndex;){var o=c._text.charAt(c._index);
if(CueCard.QueryTokenizer._whitespaces.indexOf(o)<0)break;if(o=="\n"){c._line++;c._col=0}else c._col++;c._index++}g(CueCard.Token.Types.whitespace,p)},h=function(p){var o=e();a=="u"&&d();d();for(var l="";c._index<c._maxIndex;){a=c._text.charAt(c._index);if(a==p){d();break}else if(a=="\r"||a=="\n")break;if(a=="\\"){d();l+=c._text.charAt(c._index)}else l+=a;d()}g(CueCard.Token.Types.stringLiteral,o,l)},k=function(){var p=e();if(a=="+")d();else a=="-"&&d();for(;c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d();
if(c._index<c._maxIndex&&c._text.charAt(c._index)==".")for(d();c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d();if(c._index<c._maxIndex&&c._text.charAt(c._index)=="e"){d();a=c._text.charAt(c._index);if(a=="+"||a=="-")d();for(;c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d()}g(CueCard.Token.Types.numberLiteral,p)},n=function(){for(var p=e();c._index<c._maxIndex&&CueCard.QueryTokenizer._identifierPrefix.indexOf(c._text.charAt(c._index))>=
0;)d();var o=false;if(c._index<c._maxIndex-2){var l=c._text.substr(c._index,2);if(l==">="||l=="<="||l=="~="){d();d();o=true}}if(!o&&c._index<c._maxIndex-1){l=c._text.substr(c._index,1);if(l==">"||l=="<")d()}o=e();l=c._text.substring(p.offset,o.offset);c._pos=o;c._token=l=="null"||l=="None"?new CueCard.Token(CueCard.Token.Types.nullLiteral,l,p,o):l=="true"||l=="True"||l=="false"||l=="False"?new CueCard.Token(CueCard.Token.Types.booleanLiteral,l,p,o):new CueCard.Token(CueCard.Token.Types.identifier,
l,p,o)};if(CueCard.QueryTokenizer._whitespaces.indexOf(a)>=0)j();else if("[{}],:".indexOf(a)>=0)g(CueCard.Token.Types.delimiter,f());else if(a=='"'||a=="'")h(a);else if(a=="u"&&(b=='"'||b=="'"))h(b);else if(a=="-"||a=="+"||CueCard.QueryTokenizer._isDigit(a))k();else if(a=="*")g(CueCard.Token.Types.identifier,f());else CueCard.QueryTokenizer._identifierPrefix.indexOf(a)>=0?n():g(CueCard.Token.Types.unrecognized,f())}return this._token};
CueCard.QueryTokenizer._isDigit=function(a){return"0123456789".indexOf(a)>=0};CueCard.QueryTokenizer._identifierPrefix="#!/_-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";CueCard.TokenPos=function(a,b,c){this.offset=a;this.line=b;this.col=c};CueCard.Token=function(a,b,c,d){this.type=a;this.content=b;this.start=c;this.end=d};CueCard.Token.Types={unrecognized:-1,phantom:0,whitespace:1,delimiter:2,nullLiteral:3,numberLiteral:4,stringLiteral:5,booleanLiteral:6,identifier:7};
CueCard.QueryNode=function(a){this.type=a;this.value=null;this.isArray=false;this.endToken=this.startToken=null;this.links=[]};CueCard.QueryNode.TYPE_MISSING=-1;CueCard.QueryNode.TYPE_TERMINAL=0;CueCard.QueryNode.TYPE_NONTERMINAL=1;CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY=2;CueCard.QueryNode.prototype.toQueryJson=function(a){a=a||{};if(!("qualifyAllProperties"in a))a.qualifyAllProperties=false;if(!("excludeChild"in a))a.excludeChild=-1;return this._toQueryJson(a)};
CueCard.QueryNode.prototype._toQueryJson=function(a){var b={qualifyAllProperties:a.qualifyAllProperties,excludeChild:-1};if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray){a=[];for(var c=0;c<this.value.length;c++){var d=this.value[c];a.push(d!=null?d._toQueryJson(b):null)}return a}else return this.startToken.type==CueCard.Token.Types.identifier?{__identifier__:this.value}:this.value;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){a=[];for(c=0;c<this.elements.length;c++)a.push(this.elements[c]._toQueryJson(b));
return a}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){d={};var e=false,f=0;for(c=0;c<this.links.length;c++)if(c!=a.excludeChild){var g=this.links[c];if(g.path.length>0){var j=g.getPath(a.qualifyAllProperties);if(j in d&&g.namespace.length==0)for(;j in d;){g.namespace="ns"+f++ +":";j=g.getPath(a.qualifyAllProperties)}var h=g.value!=null?g.value._toQueryJson(b):null;d[j]=h;if(g.getUnnamespacedQualifiedPath()=="/type/object/type"&&h!=null&&(!(h instanceof Array)||h.length>0))e=true}}if(!e&&
"expectedTypes"in a&&a.expectedTypes.length>0){b=[];for(c=0;c<a.expectedTypes.length;c++){e=a.expectedTypes[c];e!="/type/object"&&e!="/common/topic"&&b.push(e)}if(b.length==1)d.type=b[0];else if(b.length>1)d["type|="]=b}return d}else return null};CueCard.QueryNode.isMqlKeyword=function(a){switch(a){case "limit":case "sort":case "*":case "return":case "count":case "estimate-count":case "optional":case "create":case "connect":return true}return false};
CueCard.QueryNode.prototype.getDeclaredTypes=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/type"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredIDs=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/id"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredGUIDs=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/guid"&&!d.reverse&&d.getValuesOfType(a,"string")}};CueCard.QueryNode.prototype.qualifyAllProperties=function(a){this._qualifyAllProperties([],{},a)};
CueCard.QueryNode.prototype._qualifyAllProperties=function(a,b,c){if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var d=[],e=false,f=[],g=[],j=[],h=0;h<this.links.length;h++){var k=this.links[h];if(k.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||k.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY||k.value.type==CueCard.QueryNode.TYPE_MISSING)d.push(k);if(k.qualifiedProperty=="/type/object/type"&&!k.reverse)k.getValuesOfType(f,"string");else if(k.qualifiedProperty=="/type/object/id"&&!k.reverse)k.getValuesOfType(g,
"string");else if(k.qualifiedProperty=="/type/object/guid"&&!k.reverse)k.getValuesOfType(j,"string");else if(k.qualifiedProperty!=null&&k.qualifiedProperty.length>0){var n=k.qualifiedProperty.lastIndexOf("/");n>0&&f.push(k.qualifiedProperty.substr(0,n))}else CueCard.QueryNode.isMqlKeyword(k.property)||(e=true)}f=f.concat(a);k={};for(h=f.length-1;h>=0;h--)k[f[h]]=true;f=[];for(var p in k)f.push(p);if(!e&&d.length==0)c.onDone(b);else{var o=this;e=[];f.length>0&&e.push("t="+encodeURIComponent(f.join(",")));
g.length>0&&e.push("i="+encodeURIComponent(g.join(",")));j.length>0&&e.push("g="+encodeURIComponent(j.join(",")));f=CueCard.helper+"qualify-properties?"+e.join("&");CueCard.JsonpQueue.call(f,function(m){var q=m.properties;m=m.qualifications;for(var t=0;t<o.links.length;t++){var s=o.links[t];if(s.qualifiedProperty.length==0&&!CueCard.QueryNode.isMqlKeyword(s.property))s.qualifiedProperty=m[s.property]||s.property}for(var v in q)b[v]=q[v];(function(){if(d.length==0)c.onDone(b);else{var u=d.shift(),
A=[];if(u.qualifiedProperty in q)for(var w=q[u.qualifiedProperty].expectedTypes,y=0;y<w.length;y++)A.push(w[y].id);A.push("/common/topic");A.push("/type/object");if(u.value.type==CueCard.QueryNode.TYPE_NONTERMINAL)u.value.expectedTypes=A;else if(u.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){w=u.value.elements;for(y=0;y<w.length;y++)w[y].expectedTypes=A}u.value._qualifyAllProperties(A,b,{onDone:arguments.callee,onError:c.onError})}})()},c.onError)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){h=
0;var l=this.elements;(function(){h<l.length?l[h++]._qualifyAllProperties(a,b,{onDone:arguments.callee,onError:c.onError}):c.onDone(b)})()}else c.onDone()};CueCard.QueryNode.prototype.getCursorFromContext=function(a){return this._getCursorFromContext(a,0)};
CueCard.QueryNode.prototype._getCursorFromContext=function(a,b){var c=a[b];if(this.type==CueCard.QueryNode.TYPE_MISSING){var d=this.startToken;return{line:d.start.line,col:d.start.col}}else if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray)if(c.relative=="inside")if(c.child<this.value.length)return this.value[c.child]._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.child<this.value.length){c=this.value[c.child];d=c.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else{d=this.startToken;return{line:d.start.line,col:d.start.col+("offset"in c?c.offset:0)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if(c.relative=="inside")if(c.child<this.elements.length)return this.elements[c.child]._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.child<this.elements.length){c=this.elements[c.child];d=c.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(c.relative=="inside")if(c.child<this.links.length)return this.links[c.child].value._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.relative=="before")if(c.child<this.links.length){c=this.links[c.child].value;d=c.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(c.child<this.links.length)if(c.relative==
"path"){d=this.links[c.child].token;return{line:d.start.line,col:d.start.col+("offset"in c?c.offset:0)}}else{d=this.links[c.child].value.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.endToken;return{line:d.end.line,col:d.end.col}}};CueCard.QueryNode.prototype.toInsideOutQueryJson=function(a,b){var c=this;this.qualifyAllProperties({onDone:function(){b.onDone(c._toInsideOutQueryJson(a,0,null,null))},onError:b.onError})};
CueCard.QueryNode.prototype._toInsideOutQueryJson=function(a,b,c,d){if(c!=null&&!(d instanceof Array))d=[d];if(b<a.length){var e=a[b];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in e&&e.relative=="inside"){var f=e.child;if(f<this.links.length){e=this.links[f];if(e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){var g=e.getInverseQualifiedPath();f=this.toQueryJson({excludeChild:f});if(c!=null)if(f instanceof Array)f[0][c]=d;else f[c]=
d;return e.value._toInsideOutQueryJson(a,b+1,g,f)}}}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in e&&e.relative=="inside"){f=e.child;if(this.elements.length>1)throw new Error("Cannot turn a query inside out if a query node has siblings");else if(f==0){a=this.elements[f]._toInsideOutQueryJson(a,b+1,c,d);return a instanceof Array?a:[a]}else return null}}a=this.toQueryJson({expectedTypes:"expectedTypes"in this?this.expectedTypes:[]});if(c!=null)if(typeof a==Array)a[0][c]=
d;else a[c]=d;return a};CueCard.QueryNode.prototype.locateInnerMostNonTerminal=function(a,b){var c=this;this.qualifyAllProperties({onDone:function(){var d=c._locateInnerMostNonTerminal(a,0);b.onDone(d!=null?d:{node:c,property:null,reverse:false})},onError:b.onError})};
CueCard.QueryNode.prototype._locateInnerMostNonTerminal=function(a,b){if(b<a.length){var c=a[b];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in c&&c.relative=="inside"){c=c.child;if(c<this.links.length){var d=this.links[c];if(d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){c=d.value._locateInnerMostNonTerminal(a,b+1);if(c==null)c={node:d.value};if(!("property"in c)){c.property=d.qualifiedProperty;c.reverse=d.reverse}return c}}}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in c&&c.relative=="inside"){c=c.child;if(c<this.elements.length){d=this.elements[c];c=d._locateInnerMostNonTerminal(a,b+1);if(c==null)c={node:d};return c}}}return null};
CueCard.QueryNodeLink=function(a,b){this.path=a;this.token=b;this.reverse=false;this.suffix=this.qualifiedProperty=this.originalProperty=this.property=this.namespace="";this.value=null;if(a.length>0)if(a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}if(a.length>0){var c=a.indexOf(":");if(c>=0){this.namespace=a.substr(0,c+1);a=a.substr(c+1);if(a.length>0&&a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}}}if(a.length>=2){c=a.substr(a.length-2);if(c==">="||c=="<="||c=="~="){this.suffix=c;a=a.substr(0,
a.length-2)}}if(a.length>1&&this.suffix==""){c=a.substr(a.length-1);if(c=="<"||c==">"){this.suffix=c;a=a.substr(0,a.length-1)}}this.originalProperty=a;if(a.length>0)if(a.charAt(0)=="/"){this.qualifiedProperty=a;c=a.lastIndexOf("/");this.property=a.substr(c+1)}else this.property=a;if(this.qualifiedProperty=="")if(this.property=="type")this.qualifiedProperty="/type/object/type";else if(this.property=="id")this.qualifiedProperty="/type/object/id";else if(this.property=="guid")this.qualifiedProperty=
"/type/object/guid";else if(this.property=="name")this.qualifiedProperty="/type/object/name";else if(this.property=="lang")this.qualifiedProperty="/type/text/lang";else if(CueCard.QueryNode.isMqlKeyword(this.property))this.qualifiedProperty=this.property};CueCard.QueryNodeLink.prototype.getQualifiedPath=function(){return(this.reverse?"!":"")+this.namespace+this.qualifiedProperty+this.suffix};
CueCard.QueryNodeLink.prototype.getInverseQualifiedPath=function(){return(this.reverse?"":"!")+this.namespace+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getUnnamespacedQualifiedPath=function(){return(this.reverse?"!":"")+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getPath=function(a){return(this.reverse?"!":"")+this.namespace+(a&&this.qualifiedProperty.length>0?this.qualifiedProperty:this.originalProperty)+this.suffix};
CueCard.QueryNodeLink.prototype.getValuesOfType=function(a,b){var c=function(g){if(g.isArray){g=g.value;for(var j=0;j<g.length;j++){var h=g[j];h.type==CueCard.QueryNode.TYPE_TERMINAL&&h.value!=null&&typeof h.value==b&&a.push(h.value)}}else g.value!=null&&typeof g.value==b&&a.push(g.value)},d=this.value;if(d.type==CueCard.QueryNode.TYPE_TERMINAL)c(d);else if(d.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){d=d.type==CueCard.QueryNode.TYPE_NONTERMINAL?d.links:
d.elements[0].links;for(var e=0;e<d.length;e++){var f=d[e];f.qualifiedProperty=="/type/value/value"&&f.value.type==CueCard.QueryNode.TYPE_TERMINAL&&c(f.value)}}};CueCard.UI={};CueCard.UI.reportError=function(a){try{console.log(a)}catch(b){alert(a)}};CueCard.UI.createBlockingContinuations=function(a,b){return new CueCard.UI.Cont(a,b)};
CueCard.UI.Cont=function(a,b){var c=this;this._onDone=a;this._onError=b||CueCard.UI.reportError;this._progressUI=null;this._cleanedUp=this._canceled=false;this.cleanUp=function(){if(!c._cleanedUp){c._cleanedUp=true;if(c._progressUI!=null){c._progressUI.remove();c._progressUI=null}}};this.cancel=function(){if(!c._canceled){c._canceled=true;c.cleanUp()}};this.onError=function(){c.cleanUp();c._onError()};this.onDone=function(){var d=false;if(!c._canceled){d=[c];for(var e=0;e<arguments.length;e++)d.push(arguments[e]);
d=c._onDone.apply(null,d)}d||c.cleanUp()};window.setTimeout(function(){if(!c._cleanedUp)c._progressUI=$('<div class="cuecard-progress">Working...</div>').appendTo($(document.body))},300)};CueCard.UI.Cont.prototype.isCanceled=function(){return this._canceled};CueCard.UI.Cont.prototype.extend=function(a,b){this._onDone=a;this._onError=b||this._onError;return this};
CueCard.Popup=function(a,b,c,d,e){this._left=a;this._top=b;this._height=c;this._windows=d;this._handlers=e||{};this._pendingContinuations=[];this.elmt=$('<div class="cuecard-popup-container"></div>').css("top",this._top+this._height+"px").css("left",this._left+"px").appendTo("body");this._addEventHandlers()};CueCard.Popup.prototype.addPendingContinuation=function(a){this._pendingContinuations.push(a)};
CueCard.Popup.prototype.reposition=function(){var a=this.elmt.height(),b=this.elmt.width();this._top+this._height+a>=$(window).height()?this.elmt.css("top",this._top-a-5+"px"):this.elmt.css("top",this._top+this._height+"px");this._left+b>=$(window).width()?this.elmt.css("left",$(window).width()-b-25+"px"):this.elmt.css("left",this._left+"px")};CueCard.Popup.prototype.close=function(){this._remove();this._pendingContinuations=null};
CueCard.Popup.prototype.cancel=function(){if(this.elmt!=null){this._remove();this._cancelPendingContinuations();this._pendingContinuations=null}};CueCard.Popup.prototype._remove=function(){this._removeEventHandlers();this.elmt.remove();this.elmt=null};CueCard.Popup.prototype._cancelPendingContinuations=function(){for(var a=0;a<this._pendingContinuations.length;a++)try{this._pendingContinuations[a].cancel()}catch(b){}this._pendingContinuations=[]};
CueCard.Popup.prototype._addEventHandlers=function(){var a=this;this._handleKeyDown=function(e){return a._onKeyDown(e)};this._handleMouseDown=function(e){return a._onMouseDown(e)};for(var b=0;b<this._windows.length;b++){var c=this._windows[b];try{$(c.document).keydown(this._handleKeyDown).mousedown(this._handleMouseDown)}catch(d){alert("Unable to install keyup handler on codemirror window")}}};
CueCard.Popup.prototype._removeEventHandlers=function(){for(var a=0;a<this._windows.length;a++){var b=this._windows[a];try{$(b.document).unbind("keydown",this._handleKeyDown).unbind("mousedown",this._handleMouseDown)}catch(c){alert("Unable to install keyup handler on codemirror window")}}};CueCard.Popup.prototype._onKeyDown=function(a){if(a.keyCode==27){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("key")}};
CueCard.Popup.prototype._onMouseDown=function(a){if(this.mouseEventOutsidePopup(a)){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("mouse")}};CueCard.Popup.prototype.mouseEventOutsidePopup=function(a){if(a.currentTarget!=this.elmt[0].ownerDocument)return true;else{var b=this.elmt.offset();if(a.pageX<b.left||a.pageX>b.left+this.elmt.width()||a.pageY<b.top||a.pageY>b.top+this.elmt.height())return true}return false};
CueCard.TypeBasedTopicSuggestor=function(a,b,c,d,e){this._popup=a;this._defaultSuggestions=b;this._expectedTypes=c;this._desiredProperty=d;this._onCommit=e;this._popup.elmt.addClass("cuecard-popup-container-wide")};
CueCard.TypeBasedTopicSuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();if(a.length==0){for(var c=[],d=0;d<this._defaultSuggestions.length;d++)c.push(this._defaultSuggestions[d]);b(c)}else{var e=this;c=CueCard.UI.createBlockingContinuations(function(f,g){for(var j=[],h=0;h<g.result.length;h++){var k=g.result[h],n=null;if("/common/topic/image"in k&&k["/common/topic/image"]!=null&&k["/common/topic/image"].length>0)n=CueCard.freebaseServiceUrl+"api/trans/image_thumb"+k["/common/topic/image"][0].id+
"?mode=fillcrop&maxwidth=40&maxheight=40";j.push({result:k[e._desiredProperty],elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}"><table cellpadding="0" cellspacing="0"><tr valign="top"><td valign="top">'+(n==null?'<div class="cuecard-suggestion-thumbnail-empty"> </div>':'<img src="'+n+'" />')+'</td><td valign="top">'+k.name+'<div class="cuecard-suggestion-id">'+k[e._desiredProperty]+"</div></td></tr></table></a>")})}b(j)});this._popup.addPendingContinuation(c);d=CueCard.helper+"suggest-values-of-types?t="+
encodeURIComponent(this._expectedTypes.join(","))+"&q="+encodeURIComponent(a);CueCard.JsonpQueue.call(d,c.onDone,c.onError)}};CueCard.TypeBasedTopicSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.StaticChoicesSuggestor=function(a,b){this._defaultSuggestions=a;this._onCommit=b};
CueCard.StaticChoicesSuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();for(var c=[],d=0;d<this._defaultSuggestions.length;d++){var e=this._defaultSuggestions[d];if(a.length==0||e.label.toLowerCase().indexOf(a)>=0)c.push(e)}b(c)};CueCard.StaticChoicesSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.PropertySuggestor=function(a,b,c,d){this._popup=a;this._defaultSuggestions=b;this._entries=c;this._onCommit=d};
CueCard.PropertySuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();for(var c=[],d={},e=0;e<this._entries.length;e++){var f=this._entries[e];if(a.length==0)c.push(f);else if(f.label.toLowerCase().indexOf(a)>=0)c.push(f);else for(var g=0;g<f.expectedTypes.length;g++){var j=f.expectedTypes[g];if(j.name.toLowerCase().indexOf(a)>=0){c.push({label:f.label,hint:f.hint+" &rarr; type "+j.id,qualifiedProperty:f.qualifiedProperty,result:f.result,offset:f.offset,extent:f.extent});d[f.qualifiedProperty]=
true;break}}}for(e=0;e<this._defaultSuggestions.length;e++){f=this._defaultSuggestions[e];if(a.length==0||f.label.toLowerCase().indexOf(a)>=0)c.push(f)}if(a.length<3&&c.length>3)b(c);else{e=CueCard.UI.createBlockingContinuations(function(h,k){for(var n=0;n<k.result.length;n++){var p=k.result[n];if(!(p.id in d)&&"/type/property/schema"in p&&p["/type/property/schema"]!=null&&p["/type/property/schema"].length>0&&"key"in p&&p.key!=null&&p.key.length>0){var o="/type/property/expected_type"in p&&p["/type/property/expected_type"]!=
null?p["/type/property/expected_type"]:[],l={label:p.key[0],hint:"of type "+p["/type/property/schema"][0].id,qualifiedProperty:p.id,expectedTypes:o};CueCard.QueryEditor.setPropertySuggestionSuffix(o.length>0?o[0]:"",l,l["/type/property/unique"],'"'+p.id+'" : ');c.push(l)}}b(c)});this._popup.addPendingContinuation(e);f=CueCard.helper+"suggest-arbitrary-properties?q="+encodeURIComponent(a);CueCard.JsonpQueue.call(f,e.onDone,e.onError)}};CueCard.PropertySuggestor.prototype.commit=function(a){this._onCommit(a)};
CueCard.TypeSuggestor=function(){};CueCard.TypeSuggestor.prototype.getSuggestions=function(){};
CueCard.SuggestionController=function(a,b,c,d){this._popup=a;this._suggestor=c;this._lastText=d;this._selectedIndex=-1;this._suggestions=[];this._input=$('<input value="'+d+'" />');this._suggestionContainer=$('<div class="cuecard-suggestion-container"></div>');$(b).append($('<div class="cuecard-suggestion-input-container"></div>').append(this._input)).append(this._suggestionContainer);var e=this;this._onKeyUp=function(f){if(!f.shiftKey&&!f.metaKey&&!f.ctrlKey){if(f.keyCode==36||f.keyCode==38||f.keyCode==
40)return e._cancelEvent(f);f=e._input[0].value;if(f!=e._lastText){e._lastText=f;e._updateSuggestions()}}};this._onKeyDown=function(f){for(;!f.shiftKey&&!f.metaKey&&!f.ctrlKey;){if(f.keyCode==13||f.keyCode==9)e._commitSelectedSuggestion();else if(f.keyCode==36)e._suggestions.length>0&&e._selectSuggestion(0,true);else if(f.keyCode==38)e._selectedIndex>0&&e._selectSuggestion(e._selectedIndex-1,true);else if(f.keyCode==40)e._selectedIndex<e._suggestions.length-1&&e._selectSuggestion(e._selectedIndex+
1,true);else break;return e._cancelEvent(f)}if("onKeyDown"in e._suggestor)return e._suggestor.onKeyDown(f,e._input[0].value)};this._input.keyup(this._onKeyUp).keydown(this._onKeyDown);a=this._input[0];if(a.setSelectionRange){a.focus();a.setSelectionRange(d.length,d.length)}else if(a.createTextRange){a=a.createTextRange();a.collapse(true);a.moveEnd("character",d.length);a.moveStart("character",d.length);a.select()}this._input[0].focus();this._updateSuggestions()};
CueCard.SuggestionController.prototype._updateSuggestions=function(){this._suggestionContainer.empty();this._suggestionContainer.html('<div class="cuecard-suggestion-progress">Please wait...</div>');this._selectedIndex=-1;this._suggestions.length=0;var a=this;this._suggestor.getSuggestions(this._lastText,function(b){a._renderSuggestions(b,a._lastText)})};
CueCard.SuggestionController.prototype._renderSuggestions=function(a){var b=this._suggestionContainer;b.empty();var c=this,d=function(f,g){("elmt"in f?f.elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}">'+f.label+("hint"in f?' <span class="cuecard-suggestion-hint">'+f.hint+"</span>":"")+"</a>")).mouseover(function(){c._selectSuggestion(g,false)}).click(function(){c._commitSelectedSuggestion()}).appendTo(b)};this._suggestions=a;for(var e=0;e<a.length;e++)d(a[e],e);this._suggestions.length>
0?this._selectSuggestion(0,false):$('<div class="cuecard-suggestion-noEntryMessage">No suggestion available.<br/>Press Enter to keep what you have typed,<br/>ESC to discard it.</div>').appendTo(b);this._popup.reposition()};
CueCard.SuggestionController.prototype._selectSuggestion=function(a,b){this._selectedIndex>=0&&this._getSuggestion(this._selectedIndex).removeClass("cuecard-suggestion-selected");this._selectedIndex=a;this._getSuggestion(this._selectedIndex).addClass("cuecard-suggestion-selected");b&&this._getSuggestion(this._selectedIndex)[0].scrollIntoView(false)};
CueCard.SuggestionController.prototype._commitSelectedSuggestion=function(){this._selectedIndex>=0?this._suggestor.commit(this._suggestions[this._selectedIndex]):this._suggestor.commit(this._input[0].value)};CueCard.SuggestionController.prototype._getSuggestion=function(a){return $(this._suggestionContainer.children()[a])};CueCard.SuggestionController.prototype._cancelEvent=function(a){a.returnValue=false;a.cancelBubble=true;"preventDefault"in a&&a.preventDefault();return false};
CueCard.QueryEditor=function(a,b){this._container=a;this._options=b;this._controlPane=this._outputPane=null;this._assistKeyComboDetected=this._warnWrites=false;this._popup=null;var c=this,d="[{\n  \n}]",e=1,f=2;if("content"in b){d=b.content;f=e=0}d={basefiles:[],parserfile:[fb.acre.libs.codemirror],stylesheet:[fb.acre.libs.codemirror_css],parserConfig:{json:true},height:"100%",autoMatchParens:true,textWrapping:false,highlightActiveLine:true,readOnly:"readOnly"in b?b.readOnly:false,content:d,passDelay:100,
undoDelay:250,initCallback:function(){c._onReady();try{var g=c._editor.nthLine(e+1);c._editor.selectLines(g,f,g,f)}catch(j){}"onReady"in b&&b.onReady();b.focusOnReady&&c.focus()}};if("onChange"in b)d.onChange=b.onChange;b.codeMirror&&$.extend(d,b.codeMirror);this._overflowInput=$("<input></input>").css("position","absolute").css("left","-500px").css("top","0px").appendTo(document.body);$(this._container).acre(fb.acre.apps.cuecard+"/query-editor.mjt","query_editor",[this,d])};
CueCard.QueryEditor.nativeTypes={"/type/int":true,"/type/float":true,"/type/boolean":true,"/type/rawstring":true,"/type/uri":true,"/type/datetime":true,"/type/bytestring":true,"/type/value":true,"/type/text":true,"/type/enumeration":true};
CueCard.QueryEditor.prototype.dispose=function(){this._cancelPopup();$(this._editor._top_element).remove();this._overflowInput.remove();this._controlTopContainer.remove();this._controlBottomContainer.remove();this._iframeContainer.remove();this._iframeContainer=this._controlBottomContainer=this._controlTopContainer=this._overflowInput=this._editor=null};CueCard.QueryEditor.prototype._addCodemirror=function(a,b){this._editor=new CodeMirror(function(c){a.append(c)},b)};
CueCard.QueryEditor.prototype.setOutputPane=function(a){this._outputPane=a};CueCard.QueryEditor.prototype.getOutputPane=function(){return this._outputPane};CueCard.QueryEditor.prototype.setControlPane=function(a){this._controlPane=a};CueCard.QueryEditor.prototype.getControlPane=function(){return this._controlPane};CueCard.QueryEditor.prototype.focus=function(){this._editor.focus();return this};
CueCard.QueryEditor.prototype.content=function(a){if(a==undefined)return this._editor.getCode();else{if(this._editor.getCode()!=a){var b=this._editor.editor;b.history.push(null,null,this._editor.win.fixSpaces(a.replace(/\t/g,"  ").replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n"));b.addDirtyNode();b.scheduleHighlight();b.history.onChange&&b.history.onChange()}return this}};
CueCard.QueryEditor.prototype.getUnresolvedQuery=function(){var a=this.getQueryModelAndContext().model.toQueryJson();return CueCard.jsonize(a,this.getJsonizingSettings({breakLines:false,omitWhitespace:true,variables:this._getVariables(),resolveVariables:false}))};CueCard.QueryEditor.prototype.getResolvedQueryEnvelope=function(a){return this._getResolvedQueryEnvelope(false,a)};
CueCard.QueryEditor.prototype.getJsonizingSettings=function(a){if(this._controlPane)return this._controlPane.getJsonizingSettings(a);else{a=a||{};if(!("indentCount"in a))a.indentCount=2;return a}};CueCard.QueryEditor.prototype._getVariables=function(){return this._controlPane?this._controlPane.getVariables():{}};CueCard.QueryEditor.prototype._getQueryEnvelope=function(){return this._controlPane?this._controlPane.getQueryEnvelope():{}};
CueCard.QueryEditor.prototype._getResolvedQueryEnvelope=function(a,b){b=b||{};var c=this.getQueryModelAndContext(),d=c.model.toQueryJson();b.isWriteQuery=this._isWriteQuery(d);var e=this._getQueryEnvelope(),f=this._getVariables();if(a){this.content(CueCard.jsonize(d,this.getJsonizingSettings({variables:f,resolveVariables:false})));try{var g=this.getQueryModelAndContext().model.getCursorFromContext(c.context);this._editor.selectLines(this._editor.nthLine(g.line+1),g.col)}catch(j){}}e.query=d;return CueCard.jsonize(e,
this.getJsonizingSettings({breakLines:false,variables:f,resolveVariables:true}))};CueCard.QueryEditor.prototype._isWriteQuery=function(a){var b=function(c){if(c!=null)if(c instanceof Array){if(c.length>0&&typeof c[0]=="object")for(var d=0;d<c.length;d++)if(b(c[d]))return true}else if(typeof c=="object")for(d in c)if(d=="connect"||d=="create"||b(c[d]))return true;return false};return b(a)};
CueCard.QueryEditor.prototype._confirmWriteQuery=function(a){return a.isWriteQuery&&!this._warnWrites&&CueCard.apiProxy.base.indexOf("sandbox")<0};CueCard.QueryEditor.prototype.getMqlReadURL=function(){var a={},b=this.getResolvedQueryEnvelope(a);a=CueCard.freebaseServiceUrl+"api/service/"+(a.isWriteQuery?"mqlwrite":"mqlread");if("service"in this._options&&this._options.service!=null)a=this._options.service;return a+"?query="+encodeURIComponent(b)};
CueCard.QueryEditor.prototype.run=function(a){if(this._outputPane!=null){var b={};a=this._getResolvedQueryEnvelope(a||this._controlPane&&this._controlPane.getSetting("cleanup"),b);if(this._confirmWriteQuery(b))if(window.confirm("Your query will write data into Freebase.\nAre you sure you want to do that?"))this._warnWrites=true;else return;var c=CueCard.apiProxy.base+CueCard.apiProxy[b.isWriteQuery?"write":"read"]+("emql"in this._options&&this._options.emql?"emql=1&":"")+("debug"in this._options?
"debug="+this._options.debug+"&":"")+("service"in this._options&&this._options.service!=null?"service="+encodeURIComponent(this._options.service)+"&":""),d=this,e=function(g){if(g.error=="unauthorized"){d._outputPane.setStatus("Query editor is not authorized to write on your behalf.");d._options.onUnauthorizedMqlWrite()}else{d._outputPane.renderResponseHeaders(g.headers);var j={};if(d._controlPane!=null&&d._controlPane.getSetting("multilineErrorMessages")&&"code"in g.body&&g.body.code=="/api/status/error"&&
"messages"in g.body&&g.body.messages!=null)j.encodeJavascriptString=function(h){return h};d._outputPane.setJSONContent(g.body,d.getJsonizingSettings(j))}},f=function(g){alert(g)};this._outputPane.setStatus("Querying...");b.isWriteQuery||a.length>1024?$.post(c,{query:a},e,"json"):CueCard.JsonpQueue.call(c+"query="+encodeURIComponent(a),e,f)}"onRun"in this._options&&this._options.onRun()};
CueCard.QueryEditor.prototype.getQueryModelAndContext=function(){var a=this._editor.cursorPosition(false),b=this._editor.lineNumber(a.line)-1;a=a.character;return CueCard.QueryParser.parseForContext(this._editor.getCode(),0,b,a)};
CueCard.QueryEditor.prototype._onReady=function(){var a=this;try{$(this._editor.win.document).keyup(function(c){return a._onEditorKeyUp(c)}).keydown(function(c){return a._onEditorKeyDown(c)}).mousedown(function(c){return a._onEditorMouseDown(c)})}catch(b){alert("Unable to install keyup handler on codemirror window")}if("cleanUp"in this._options&&this._options.cleanUp){this._editor.getCode();this._onCleanUp()}};CueCard.QueryEditor.prototype._onRun=function(a){this.run(a)};
CueCard.QueryEditor.prototype._onCleanUp=function(){var a=this.getQueryModelAndContext().model.toQueryJson(),b=this._getVariables();this.content(CueCard.jsonize(a,this.getJsonizingSettings({variables:b,resolveVariables:false})))};CueCard.QueryEditor.prototype._onEditorMouseDown=function(){};
CueCard.QueryEditor.prototype._onEditorKeyDown=function(a){if(a.keyCode==9||a.keyCode==32&&(a.ctrlKey||a.metaKey||a.altKey)){this._assistKeyComboDetected=true;a.preventDefault();return false}else{this._assistKeyComboDetected=false;if((a.metaKey||a.ctrlKey)&&a.keyCode==13)this._onRun(a.shiftKey)}};CueCard.QueryEditor.prototype._onEditorKeyUp=function(a){if(this._assistKeyComboDetected){this._assistKeyComboDetected=false;this.startAssistAtCursor();a.preventDefault();return false}};
CueCard.QueryEditor.prototype.startAssistAtCursor=function(){var a=this._editor.cursorPosition(false),b=this._editor.lineNumber(a.line)-1,c=a.character;this._editor.lineContent(a.line);var d=this._editor.win.document.body.firstChild;d=a.line||d;for(var e=d.nextSibling,f=c;f>0&&e!=null&&e.tagName.toLowerCase()!="br"&&e.firstChild!=null&&e.firstChild.nodeValue.length>=f;){f-=e.firstChild.nodeValue.length;d=e;e=e.nextSibling}if(e==null||e.tagName.toLowerCase()=="br"){if(e!=null){a=$(e).offset();if($.browser.msie&&
d!=null&&d.tagName.toLowerCase()!="br"){f=d.offsetWidth;d=d.offsetHeight}else{f=a.left;d=e.offsetHeight}}else{a=$(d).offset();var g=d.firstChild?d.firstChild.nodeValue.length:0;f=a.left+(g==0?0:f*d.offsetWidth/g);d=d.offsetHeight}this._startAssist(b,c,{left:f,top:a.top,height:d})}else{a=$(e).offset();g=e.firstChild?e.firstChild.nodeValue.length:0;this._startAssist(b,c,{left:a.left+(g==0?0:f*e.offsetWidth/g),top:a.top,height:e.offsetHeight})}};
CueCard.QueryEditor.prototype._startAssist=function(a,b,c){this._cancelPopup();if(c!=null){var d=$(this._iframeContainer).offset();d.left-=this._editor.win.document.body.scrollLeft+document.body.scrollLeft;d.top-=this._editor.win.document.body.scrollTop+document.body.scrollTop;var e=this;this._popup=new CueCard.Popup(Math.round(d.left+c.left),Math.round(d.top+c.top),Math.round(c.height),[window,this._editor.win],{onCancel:function(j){j=="key"&&e.focus()}});this._popup.elmt.html('<div class="cuecard-popup-message">Please wait...</div>');
c=this.getQueryModelAndContext();if(c.context.length>0){d=c.context[c.context.length-1];if("relative"in d)if(d.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)if(d.relative=="path"||d.relative=="before"){this._startSuggestProperties(a,b,c,d);return}else{if(d.relative=="space"){var f=d.node.links[d.child];this._startSuggestValues(a,b,c,d,f);return}}else{if(d.node.type==CueCard.QueryNode.TYPE_TERMINAL){f=null;if(c.context.length>1){var g=c.context[c.context.length-2];f=g.node.links[g.child]}this._startSuggestValues(a,
b,c,d,f);return}}else{f=null;if(c.context.length>1){g=c.context[c.context.length-2];if(g.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)f=g.node.links[g.child];else if(c.context.length>2){g=c.context[c.context.length-3];f=g.node.links[g.child]}}this._startSuggestValues(a,b,c,d,f);return}}}this._popup.elmt.html('<div class="cuecard-popup-message">Sorry, we don\'t know how to assist you here. Send us a link to this exact query using the links at the upper right corner and we will investigate. Thank you!</div>')};
CueCard.QueryEditor.prototype._cancelPopup=function(){if(this._popup!=null){this._popup.cancel();this._popup=null}};
CueCard.QueryEditor.prototype._startSuggestProperties=function(a,b,c,d){var e=this;d=d.relative=="path"?d.node.links[d.child].token:null;this._startBufferInput();this._prepareQueryForSuggestions(c,a,b,d,function(f,g,j){var h=function(k,n){e._suggestProperties(c,n,g+e._stopBufferInput(),j)};c.model.locateInnerMostNonTerminal(c.context,f.extend(function(k,n){var p=[],o=[],l=[];n.node.getDeclaredTypes(p);n.node.getDeclaredIDs(o);n.node.getDeclaredGUIDs(l);var m=[];p.length>0&&m.push("t="+encodeURIComponent(p.join(",")));
o.length>0&&m.push("i="+encodeURIComponent(o.join(",")));l.length>0&&m.push("g="+encodeURIComponent(l.join(",")));if(n.property!=null){m.push("p="+encodeURIComponent(n.property));m.push("r="+n.reverse)}p=CueCard.helper+"suggest-properties?"+m.join("&");CueCard.JsonpQueue.call(p,k.extend(h).onDone,f.onError);return true}));return true})};CueCard.QueryEditor.prototype._startBufferInput=function(){this._overflowInput[0].value="";this._overflowInput[0].focus()};
CueCard.QueryEditor.prototype._stopBufferInput=function(){return this._overflowInput[0].value};
CueCard.QueryEditor.prototype._suggestProperties=function(a,b,c,d){this._popup.elmt.empty();this._popup.elmt.html("<div></div>");a=[];for(var e in b.properties){var f=b.properties[e],g=e.lastIndexOf("/"),j=e.substr(g+1);g=e.substr(0,g);var h=f.explicit;if("parentProperty"in f){h='"'+f.parentProperty+'" : [{ "'+j+'" : ';var k=f.unique?"null":"[]";a.push({label:j,hint:"of type "+g+" (through "+f.parentProperty+")",qualifiedProperty:e,result:h+k+" }]",offset:h.length,extent:k.length,expectedTypes:f.expectedTypes})}else{g=
{label:j,hint:"of type "+g,qualifiedProperty:e,expectedTypes:f.expectedTypes};CueCard.QueryEditor.setPropertySuggestionSuffix(f.expectedTypes.length>0?f.expectedTypes[0].id:"",g,f.unique,'"'+(h?j:e)+'" : ');a.push(g)}}b=new CueCard.PropertySuggestor(this._popup,CueCard.MqlSyntax.KeywordSuggestions,a,d);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,b,c)};
CueCard.QueryEditor.setPropertySuggestionSuffix=function(a,b,c,d){var e=null;if(a=="/common/image"||a=="/common/document"){e='{ "id" : null, "optional" : true, "limit" : 3 }';c||(e="["+e+"]")}else if(a=="/measurement_unit/dated_integer"){e='{ "number" : null, "date" : null }';if(c)e="["+e+"]"}else if(a=="/measurement_unit/dated_money_value"){e='{ "amount" : null, "valid_date" : null, "currency" : null }';if(c)e="["+e+"]"}else e=a.indexOf("/type/")==0?c?"null":"[]":c?"{}":"[{}]";b.result=d+e;b.offset=
d.length;b.extent=e.length};
CueCard.QueryEditor.prototype._startSuggestValues=function(a,b,c,d,e){var f=this,g="token"in d?d.token:null;this._startBufferInput();this._prepareQueryForSuggestions(c,a,b,g,function(j,h,k,n){h+=f._stopBufferInput();if(e!=null&&!e.reverse&&CueCard.QueryNode.isMqlKeyword(e.path))f._suggestValuesForKeyword(a,b,c,d,e.path,h,k);else{var p=function(){f._popup.elmt.empty();f._popup.elmt.html('<div></div><div class="cuecard-suggestion-hint-message">Keep typing to search for topics of types fitting this point in the query.</div>')},o=
e.qualifiedProperty,l=e.reverse;if(!l&&(o=="/type/object/id"||o=="/type/object/guid"||o=="/type/object/name")){c.model.locateInnerMostNonTerminal(c.context,j.extend(function(t,s){p();var v=[];s.node.getDeclaredTypes(v);if("property"in s&&s.property!=null){var u=s.property;if(l)v.push(u.substr(0,u.lastIndexOf("/")));else if(u in n){u=n[u].expectedTypes;for(var A=0;A<u.length;A++)v.push(u[A].id)}}v=new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax.SingleValueSuggestions,v,e.property,k);
new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,v,h)}));return true}else{p();var m=false;if(l)j=[o.substr(0,o.lastIndexOf("/"))];else if(o=="/type/object/type")j=["/type/type"];else if(o in n){m=n[o].unique;j=[];o=n[o].expectedTypes;for(var q=0;q<o.length;q++)j.push(o[q].id)}else j=o=="/type/text/lang"?["/type/lang"]:[];o=j.length==1?j[0]:null;j=o!==null&&o in CueCard.QueryEditor.nativeTypes?new CueCard.StaticChoicesSuggestor(CueCard.MqlSyntax[o=="/type/text"?m?"UniqueStringLiteralValueSuggestions":
"StringLiteralValueSuggestions":m?"UniqueLiteralValueSuggestions":"LiteralValueSuggestions"],k):new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax[m?"UniqueTopicValueSuggestions":"TopicValueSuggestions"],j,"id",k);new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,j,h)}}})};
CueCard.QueryEditor.prototype._suggestValuesForKeyword=function(a,b,c,d,e,f,g){this._popup.elmt.empty();a=CueCard.MqlSyntax.KeywordValueHints[e];if("html"in a){this._popup.elmt.html('<div class="cuecard-suggestion-hint-message">'+a.html+"</div>");this.focus()}else{this._popup.elmt.html("<div></div>");g=new CueCard.StaticChoicesSuggestor(a.choices,g);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,g,f)}};
CueCard.QueryEditor.prototype._prepareQueryForSuggestions=function(a,b,c,d,e){var f=this,g="",j,h=function(l,m,q,t,s){q=t===undefined||typeof q!=="string"?CueCard.jsonize(q,{breakLines:false}):q;m=m+(typeof t=="number"?t:q.length);s=m+(typeof s=="number"?s:0);f._editor.editor.replaceSelection(q);l=f._editor.nthLine(l+1);f._editor.selectLines(l,m,l,s)};if(d!=null){b=0;var k=d.start.col;if(/^['"]/.test(d.content))b=1;g=d.content.substring(b,c-k).replace(/['"]$/,"");j=function(l,m,q){var t=f._editor.nthLine(d.start.line+
1);f._editor.selectLines(t,d.start.col,t,d.end.col);h(d.start.line,d.start.col,l,m,q)}}else{c=this._editor.cursorPosition(true);var n=this._editor.lineNumber(c.line)-1,p=c.character;j=function(l,m,q){var t=f._editor.nthLine(n+1);f._editor.selectLines(t,p,t,p);h(n,p,l,m,q)}}var o=function(l){f._popup.close();typeof l=="string"?j(l):j(l.result,l.offset,l.extent)};c=CueCard.UI.createBlockingContinuations(function(l,m){return e(l,g,o,m||{})});this._popup.addPendingContinuation(c);a.model.qualifyAllProperties(c)};
CueCard.QueryEditor.prototype._showExamples=function(){var a=this;CueCard.showDialog("examples",{onDone:function(b){a.content(b);a._onRun(false)}})};CueCard.OutputPane=function(a,b){this._elmt=$(a);this._options=b||{};this._jsonResult=null;this._lastJsonOutputMode=$.cookie("cc_op_mode")=="text"?"text":"tree";this._treeConstructed=false;this._constructUI()};CueCard.OutputPane.prototype.dispose=function(){};
CueCard.OutputPane.prototype._constructUI=function(){var a=this,b=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.apps.cuecard+"/output-pane.mjt","tabs",[b,this]);var c=$("#"+b+" > .section-tabset");c.tabs("#"+b+" > .tabbed-content > .cuecard-outputPane-tabBody",{initialIndex:this._lastJsonOutputMode=="tree"?0:1,onBeforeClick:function(d,e){window.__cc_tree_disposePopup();if(e==0){a._lastJsonOutputMode="tree";a._jsonResult!=null&&!a._treeConstructed&&a._constructTree()}else if(e==
1)a._lastJsonOutputMode="text";$.cookie("cc_op_mode",a._lastJsonOutputMode,{expires:365})}});this._tabs=c.data("tabs");this._tree=this._getTab("tree").find("div");this._json=this._getTab("json").find("div");this._status=this._getTab("status").find("div");this._json_iframe=document.createElement("iframe");this._json.append(this._json_iframe)};CueCard.OutputPane.prototype._getTab=function(a){return $("#"+this._idPrefix+"-"+a)};
CueCard.OutputPane.prototype._setIFrameText=function(a){a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var b=this._json_iframe.contentWindow.document;b.open();b.write("<pre style='white-space:pre-wrap;'>"+a+"</pre>");b.close()};
CueCard.OutputPane.prototype.setJSONContent=function(a,b){this._jsonResult=a;this._setIFrameText(CueCard.jsonize(a,b||{indentCount:2}));var c;if(this._lastJsonOutputMode=="tree"){this._constructTree();c=0}else{this._tree.empty();this._treeConstructed=false;c=1}var d=this;window.setTimeout(function(){d._tabs.click(c)},100)};
CueCard.OutputPane.prototype.setStatus=function(a){this._tabs.click(2);this._status.html(a);this._jsonResult=null;this._setIFrameText("");this._tree.empty();this._treeConstructed=false};CueCard.OutputPane.prototype.getJson=function(){return this._jsonResult};CueCard.OutputPane.prototype.renderResponseHeaders=function(a){this.setStatus($.acre(fb.acre.apps.cuecard+"/output-pane.mjt","status",[a]))};
CueCard.OutputPane.prototype._constructTree=function(){this._treeConstructed=true;var a=[],b=function(j,h){return'<img class="cuecard-outputPane-tree-toggle" onclick="__cc_tree_toggle(this);" src="'+CueCard.urlPrefix+j+'" '+(h?"":' style="display: none;"')+"/>"},c=function(j){a.push(j)},d=function(j){return"<a class='cuecard-outputPane-tree-explore' target='_blank' href='"+CueCard.freebaseServiceUrl+"tools/explore"+j+"'>xp</a>"},e=function(j,h,k){if(j=="image"||j=="/common/topic/image")c("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)' fbid='"+h+"'>"+k+"</a>"+d(h));else j=="article"||j=="/common/topic/article"?c("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverArticle(this)' onmouseout='__cc_tree_mouseOutArticle(this)' fbid='"+h+"'>"+k+"</a>"+d(h)):c("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverTopic(this)' onmouseout='__cc_tree_mouseOutTopic(this)' fbid='"+h+"'>"+k+"</a>"+d(h))},f=function(j,h){return j.length>h.length&&j.substr(0,h.length)==h},g=function(j,h,k){if(j==null){h.startBody(false);c("<span>"+JSON.stringify(j)+"</span>");h.endBody(false)}else if(typeof j!="object"){h.startBody(false);var n=k[0];k=k.length>1?k[1]:"";if(n=="id"||n=="/type/object/id")e(k,j,JSON.stringify(j));else if(n=="guid"||n=="/type/object/guid")e(k,
"/guid/"+j.substr(1),JSON.stringify(j));else if(n=="type"||n=="/type/object/type")c("<a target='_blank' href='"+CueCard.freebaseServiceUrl+"type/schema"+j+"'>"+JSON.stringify(j)+"</a>"+d(j));else if(typeof j=="string"&&(f(j,"http://")||f(j,"https://")||f(j,"ftp://")))f(j,"http://chart.apis.google.com/chart?")?c("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+j+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)'>"+JSON.stringify(j)+"</a>"):
c("<a target='_blank' href='"+j+"'>"+JSON.stringify(j)+"</a>");else c("<span>"+JSON.stringify(j)+"</span>");h.endBody(false)}else if(j instanceof Array)if(j.length==0){h.startBody(false);c("<span>[]</span>");h.endBody(false)}else{n=j.length>1&&typeof j[0]=="object"?"":' style="display: none;"';h.startBody(true,'<span cc:mode="normal">[ <a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_expandAll(this);"'+n+'>expand all</a><span class="cuecard-outputPane-tree-toggles"'+
n+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_collapseAll(this);"'+n+'>collapse all</a><span class="cuecard-outputPane-tree-toggles"'+n+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_flip(this);"'+n+">1-by-1</a></span>",'<span style="display: none;">[ '+(j.length>1?j.length+" elements":"1 element")+" ]</span>");c('<div class="cuecard-outputPane-tree-arrayBody cuecard-outputPane-tree-normalMode">');
n=function(o,l,m){return{startBody:function(q,t,s){q?c('<div class="cuecard-outputPane-tree-arrayElement">'+b("expanded.png",true)+b("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+o+":</span> "+t+s+"<span>"+(l?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipPrevious(this);">previous</a> ':"")+(m?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipNext(this);">next</a>':"")+"</span>"):c('<div class="cuecard-outputPane-tree-arrayElement"><span class="cuecard-outputPane-tree-memberName">'+
o+":</span> ")},endBody:function(){c("</div>")}}};for(var p=0;p<j.length;p++)g(j[p],n(p,p>0,p<j.length-1),k);c("</div>");h.endBody(true)}else{h.startBody(true,"<span>{</span>",'<span style="display: none;">{...}</span>');c('<div class="cuecard-outputPane-tree-objectBody cuecard-outputPane-tree-normalMode">');n=function(o){return{startBody:function(l,m,q){l?c('<div class="cuecard-outputPane-tree-objectField">'+b("expanded.png",true)+b("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+
o+":</span> "+m+q+"<span></span>"):c('<div class="cuecard-outputPane-tree-objectField"><span class="cuecard-outputPane-tree-memberName">'+o+":</span> ")},endBody:function(){c("</div>")}}};for(p in j)g(j[p],n(p),[p].concat(k));c("</div>");h.endBody(true)}};g(this._jsonResult,{startBody:function(){},endBody:function(){}},["__root__"]);this._tree.html(a.join(""))};window.__cc_tree_toggle=function(a){var b=a.src.indexOf("expanded.png")>0;a=a.parentNode;b?window.__cc_tree_collapse(a):window.__cc_tree_expand(a)};
window.__cc_tree_expand=function(a){if(a.firstChild.tagName.toLowerCase()=="img"){var b=a.lastChild;b.style.display="block";a.childNodes[0].style.display="inline";a.childNodes[1].style.display="none";a=b.previousSibling.previousSibling;a.previousSibling.style.display="inline";a.style.display="none"}};
window.__cc_tree_collapse=function(a){if(a.firstChild.tagName.toLowerCase()=="img"){var b=a.lastChild;b.style.display="none";a.childNodes[0].style.display="none";a.childNodes[1].style.display="inline";a=b.previousSibling.previousSibling;a.previousSibling.style.display="none";a.style.display="inline"}};
(function(){var a=function(b){var c=b.parentNode.getAttribute("cc:mode"),d=b.parentNode.nextSibling.nextSibling.nextSibling;if(c=="flip"){for(c=0;c<d.childNodes.length;c++)d.childNodes[c].style.display="block";b.parentNode.setAttribute("cc:mode","normal");$(b.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").addClass("cuecard-outputPane-tree-normalMode").removeClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_expandAll=function(b){a(b);b=b.parentNode.nextSibling.nextSibling.nextSibling;
for(var c=0;c<b.childNodes.length;c++)__cc_tree_expand(b.childNodes[c])};window.__cc_tree_collapseAll=function(b){a(b);b=b.parentNode.nextSibling.nextSibling.nextSibling;for(var c=0;c<b.childNodes.length;c++)__cc_tree_collapse(b.childNodes[c])};window.__cc_tree_flip=function(b){var c=b.parentNode.getAttribute("cc:mode"),d=b.parentNode.nextSibling.nextSibling.nextSibling;if(c=="normal"){for(c=0;c<d.childNodes.length;c++){var e=d.childNodes[c];e.style.display=c==0?"block":"none";__cc_tree_expand(e)}b.parentNode.setAttribute("cc:mode",
"flip");$(b.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").removeClass("cuecard-outputPane-tree-normalMode").addClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_flipPrevious=function(b){b=b.parentNode.parentNode;b.style.display="none";b.previousSibling.style.display="block"};window.__cc_tree_flipNext=function(b){b=b.parentNode.parentNode;b.style.display="none";b.nextSibling.style.display="block"};window.__cc_tree_mouseOverTopic=function(b){var c=b.getAttribute("fbid");
$.getJSON("http://hotshot.dfhuynh.user.dev.freebaseapps.com/html?id="+c+"&callback=?",function(d){var e=__cc_tree_createPopup(b);$(e).addClass("cuecard-outputPane-tree-popup-topic").html(d)})};window.__cc_tree_mouseOutTopic=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverImage=function(b){var c=b.getAttribute("fbid");c=c!=null&&c.length>0?CueCard.freebaseServiceUrl+"api/trans/image_thumb"+c+"?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100":b.href;__cc_tree_createPopup(b).innerHTML=
"<img src='"+c+"' />"};window.__cc_tree_mouseOutImage=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverArticle=function(b){var c=b.getAttribute("fbid");$.getJSON(CueCard.freebaseServiceUrl+"api/trans/blurb"+c+"?callback=?",function(d){d=d.result.body;var e=__cc_tree_createPopup(b);$(e).addClass("cuecard-outputPane-tree-popup-article").html(d)})};window.__cc_tree_mouseOutArticle=function(){__cc_tree_disposePopup()};window.__cc_tree_createPopup=function(b){var c=document.getElementById("cuecard-outputPane-tree-popup");
if(c==null){c=document.createElement("div");c.id="cuecard-outputPane-tree-popup";c.className="cuecard-outputPane-tree-popup";c.onmouseover=window.__cc_tree_disposePopup;document.body.appendChild(c)}var d=$(b).offset();c.style.top=d.top+b.offsetHeight+10+"px";c.style.left=d.left+"px";return c};window.__cc_tree_disposePopup=function(){var b=document.getElementById("cuecard-outputPane-tree-popup");b!=null&&b.parentNode.removeChild(b)}})();
CueCard.ControlPane=function(a,b){this._elmt=$(a);this._options=b||{};this._constructUI()};CueCard.ControlPane.prototype.dispose=function(){};CueCard.ControlPane.prototype._constructUI=function(){var a=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.apps.cuecard+"/control-pane.mjt","tabs",[a,this]);$("#"+a+" > .section-tabset").tabs("#"+a+" > .tabbed-content > .cuecard-controlPane-tabBody",{initialIndex:0})};
CueCard.ControlPane.prototype._getDefaults=function(){var a=this._options,b=a.env||{},c={};c.extended=a.extended||b.extended;c.extended=c.extended===1?true:false;c.as_of_time=a.as_of_time||b.as_of_time||null;c.use_permission_of=a.use_permission_of||b.use_permission_of||null;delete b.extended;delete b.as_of_time;delete b.use_permission_of;return c};CueCard.ControlPane.prototype._getTab=function(a){return $("#"+this._idPrefix+"-"+a)};
CueCard.ControlPane.prototype._redangle=function(){var a=this,b=this._options.queryEditor.getQueryModelAndContext();b.model.toInsideOutQueryJson(b.context,CueCard.UI.createBlockingContinuations(function(c,d){a._setOutputJSON(d)}))};CueCard.ControlPane.prototype._qualify=function(){var a=this,b=this._options.queryEditor.getQueryModelAndContext().model;b.qualifyAllProperties(CueCard.UI.createBlockingContinuations(function(){a._setOutputJSON(b.toQueryJson({qualifyAllProperties:true}))}))};
CueCard.ControlPane.prototype._generateCode=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson();a=CueCard.CodeGeneration.generate(a,CueCard.CodeGeneration.serializers["acre-template"],{variables:this.getVariables()});CueCard.showDialog("acre_template",a)};
CueCard.ControlPane.prototype._oneLiner=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),b=this.getJsonizingSettings({variables:this.getVariables(),resolveVariables:false});b.breakLines=false;this._options.queryEditor.content(CueCard.jsonize(a,b))};
CueCard.ControlPane.prototype._setOutputJSON=function(a){switch(this._getTab("tools").find("input[name='tools-result']:checked").val()){case "replace":this._options.queryEditor.content(CueCard.jsonize(a,this.getJsonizingSettings()));break;case "output":this._options.outputPane.setJSONContent(a,this.getJsonizingSettings());break}};
CueCard.ControlPane.prototype._runPage=function(a){var b=this._getTab("envelope").find("input[name='page']"),c=b.val();c=parseInt(c)||1;c+=a;if(c<1)b.val("1");else{b.val(c);this._options.queryEditor!=null&&this._options.queryEditor.run()}};
CueCard.ControlPane.prototype._runCursor=function(a){if(this._options.outputPane!=null){var b=this._options.outputPane.getJson();if(b!==undefined&&b!==null&&"cursor"in b){this._getTab("envelope").find("input[name='cursor']").val(b.cursor);this._getTab("envelope").find("input[name='cursor-opt'][value='custom']").attr("checked","checked");this._options.queryEditor!=null&&a&&this._options.queryEditor.run()}}};
CueCard.ControlPane.prototype.getQueryEnvelopeSetting=function(a){switch(a){case "extended":return this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;case "as_of_time":a=this._getTab("envelope").find("input[name='as_of_time']").val();if(a.length>0)return a;break}return null};
CueCard.ControlPane.prototype.getQueryEnvelope=function(a,b){a=a||{};if(this.getSetting("extended")==1)a.extended=1;var c=this._getTab("envelope").find("input[name='as_of_time']").val();if(c.length>0)a.as_of_time=c;c=this._getTab("envelope").find("input[name='use_permission_of']").val();if(c.length>0)a.use_permission_of=c;var d=this._getTab("envelope").find("select");c=function(g){return d[g].options[d[g].selectedIndex].value};var e=c(0);if(e.length>0)a.lang=e;e=c(1);if(e.length>0)a.escape=e=="false"?
false:e;c=c(2);if(c.length>0)a.uniqueness_failure=c;if(!b){c=this._getTab("envelope").find("input[name='page']").val();if(c.length>0)try{a.page=parseInt(c)}catch(f){}switch(this._getTab("envelope").find("input[name='cursor-opt']:checked").val()){case "true":a.cursor=true;break;case "custom":a.cursor=this._getTab("envelope").find("input[name='cursor']").val();break}}this.getCustomEnvelope(a);return a};
CueCard.ControlPane.prototype.getCustomEnvelope=function(a){a=a||{};for(var b=this._getTab("customEnvelope").find("table")[0],c=1;c<b.rows.length;c++){var d=b.rows[c],e=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;if(e.length>0){try{d=JSON.parse(d)}catch(f){}a[e]=d}}return a};
CueCard.ControlPane.prototype.getSetting=function(a){var b=this._getTab("settings").find("input");switch(a){case "cleanup":a=b[0].checked;$.cookie("cc_cp_clean",a?"1":"0",{expires:365});return a;case "alignJSONPropertyValues":a=b[1].checked;$.cookie("cc_cp_align",a?"1":"0",{expires:365});return a;case "liveQuery":a=b[2].checked;$.cookie("cc_cp_live",a?"1":"0",{expires:365});return a;case "multilineErrorMessages":a=b[3].checked;$.cookie("cc_cp_multi",a?"1":"0",{expires:365});return a;case "extended":a=
this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;$.cookie("cc_cp_extended",a,{expires:365});return a}return false};CueCard.ControlPane.prototype.getJsonizingSettings=function(a){a=a||{};a.indentCount=2;a.alignFieldValues=this.getSetting("alignJSONPropertyValues");return a};
CueCard.ControlPane.prototype.getVariables=function(){for(var a={},b=this._getTab("variables").find("table")[0],c=1;c<b.rows.length;c++){var d=b.rows[c],e=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;try{d=JSON.parse(d)}catch(f){}a[e]=d}return a};CueCard.CodeGeneration={serializers:{}};
CueCard.CodeGeneration.generate=function(a,b,c){var d="",e={_variables:{},createVariable:function(n){if(n in this._variables)return n+this._variables[n]++;else{this._variables[n]=1;return n}}},f=e.createVariable("q"),g=e.createVariable("o"),j=new CueCard.SerializingContext(null);j.setProperty("indentString","indentString"in c?c.indentString:"  ");j.setProperty("indentLevel","indentLevel"in c?c.indentLevel:0);j.setProperty("stream",{append:function(n){d+=n}});b.prepareRootContext(j,c);var h=new CueCard.IndentWriter(j),
k=b.generateQueryCall(j,h,e,a,c.variables,f,g);j.setProperty("start",function(){return k});j.setProperty("stop",function(){});CueCard.CodeGeneration._processNode(a,b,j,h,e);return d};
CueCard.CodeGeneration._deriveElementName=function(a,b){if(a==null){var c=b.getProperty("path");if(c!=null)if(c.charAt(0)=="!"){c=c.substr(Math.max(c.indexOf(":")+1,1)).split("/");return c[Math.max(0,c.length-2)]}else{c=c.substr(c.indexOf(":")+1).split("/");return c[c.length-1]}}else{c=a.split("/");return c[c.length-1]}return"entry"};CueCard.CodeGeneration._isImagePath=function(a){if(a.charAt(0)=="!")return false;a=a.substr(a.indexOf(":")+1);return a=="/common/topic/image"||a=="image"};
CueCard.CodeGeneration._isImageNode=function(a){if(a==null||typeof a!="object")return false;if(a instanceof Array)if(a.length==1&&typeof a[0]=="object")a=a[0];else return false;for(var b in a)if(b!="id"&&b!="guid"&&!CueCard.QueryNode.isMqlKeyword(b))return false;return true};
CueCard.CodeGeneration._processNode=function(a,b,c,d,e){if(a==null){var f=c.getProperty("start")(true,false);b.outputSimpleFieldValue(f,c,d);c.getProperty("stop")(true,false)}else if(typeof a=="object")if(a instanceof Array)if(a.length==0){f=CueCard.CodeGeneration._deriveElementName(null,c);var g=e.createVariable(f),j=e.createVariable(f.charAt(0));f=c.getProperty("start")(false,false);b.openNodeArray(c,d,e,f,g,j,"values");b.outputSimpleFieldValue(g,c,d);b.closeNodeArray(c,d,e,f,g,j,"values");c.getProperty("stop")(false,
false)}else{if(!(a.length>1||typeof a[0]!="object"||"__identifier__"in a)){g=new CueCard.SerializingContext(c);g.setProperty("in-array",true);arguments.callee(a[0],b,g,d,e)}}else if(a.optional!="forbidden"){g=null;f=0;for(j in a)if(a.hasOwnProperty(j)&&j!="*"&&!CueCard.QueryNode.isMqlKeyword(j)){f++;var h=a[j];if(j.charAt(0)!="!"){var k=j.substr(j.indexOf(":")+1);if(k=="type"||k=="/type/object/type")if(h!=null&&typeof h=="string")g=h}}CueCard.CodeGeneration._processTypedObjectNode(a,g,f,b,c,d,e)}};
CueCard.CodeGeneration._processTypedObjectNode=function(a,b,c,d,e,f,g){function j(){var s=CueCard.CodeGeneration._deriveElementName(b,e);k=g.createVariable(s);if(e.getProperty("in-array"))n=g.createVariable(s.charAt(0))}var h=null,k=null,n=null,p,o,l="optional"in a&&a.optional===true;if(e.getProperty("in-array")){var m=c>0&&!("*"in a);p=function(){if(h==null){h=e.getProperty("start")(false,l);j();d.openNodeArray(e,f,g,h,k,n,m?"fields":"object")}return k};o=function(){if(h!=null){d.closeNodeArray(e,
f,g,h,k,n,m?"fields":"object");e.getProperty("stop")(false,l)}}}else{p=function(){if(h==null){h=e.getProperty("start")(false,l);j();d.openNode(e,f,g,h,k)}return k};o=function(){if(h!=null){d.closeNode(e,f,g,h,k);e.getProperty("stop")(false,l)}}}if(c==0||"*"in a)d.generateEmptyObjectNode(e,f,g,p());else{for(var q in a)if(a.hasOwnProperty(q)&&q!="*"&&!CueCard.QueryNode.isMqlKeyword(q)){c=a[q];if(CueCard.CodeGeneration._isImagePath(q)&&CueCard.CodeGeneration._isImageNode(c))d.generateImageField(e,f,
g,q,c,p);else{var t=d.createFieldContext(e,f,g,q,p);t.setProperty("path",q);CueCard.CodeGeneration._processNode(c,d,t,f,g)}}if("*"in a){c=a["*"];t=d.openWildcardField(e,f,g,p,c);CueCard.CodeGeneration._processNode(c,d,t,f,g);d.closeWildcardField(e,f,g,p,c)}}o()};
CueCard.CodeGeneration.serializers["acre-template"]={prepareRootContext:function(){},generateQueryCall:function(a,b,c,d,e,f,g){b.appendIndent();b.append("<acre:script>");b.appendLineBreak();b.indent();b.appendIndent();b.append("var "+f+" = ");CueCard.jsonize(d,{context:a,variables:e,resolveVariables:false});b.append(";");b.appendLineBreak();b.appendIndent();b.appendLineBreak();b.appendIndent();b.append("var "+g+" = acre.freebase.mqlread("+f+");");b.appendLineBreak();b.unindent();b.appendIndent();
b.append("</acre:script>");b.appendLineBreak();return g+".result"},outputSimpleFieldValue:function(a,b,c){c.append("${"+a+"}")},openNodeArray:function(a,b,c,d,e,f,g){b.appendLineBreak();b.appendIndent();b.append('<ul acre:if="'+d+'.length != 0">');b.appendLineBreak();b.indent();b.appendIndent();b.append('<li acre:for="'+f+", "+e+" in "+d+'">');g=="fields"&&b.append("<table>");if(g=="fields"||g=="object"){b.appendLineBreak();b.indent()}},closeNodeArray:function(a,b,c,d,e,f,g){if(g=="fields"||g=="object"){b.unindent();
b.appendIndent()}g=="fields"&&b.append("</table>");b.append("</li>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</ul>");b.appendLineBreak();b.appendIndent();b.append('<div acre:else=""><ins>[no element]</ins></div>');b.appendLineBreak();b.appendLineBreak()},openNode:function(a,b,c,d,e){b.appendIndent();b.append("<acre:script>var "+e+" = "+d+";</acre:script>");b.appendLineBreak();b.appendIndent();b.append("<table>");b.appendLineBreak();b.indent()},closeNode:function(a,b){b.unindent();
b.appendIndent();b.append("</table>");b.appendLineBreak()},createFieldContext:function(a,b,c,d,e){a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",function(f,g){var j=e();b.appendIndent();b.append("<tr><th>"+d+":</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append("<td"+(g?" acre:if=\"'"+d+"' in "+j+" && "+j+"['"+d+"'] != null\"":"")+">");if(!f){b.appendLineBreak();b.indent()}return j+"['"+d+"']"});a.setProperty("stop",function(f,g){if(!f){b.unindent();
b.appendIndent()}b.append("</td>");b.appendLineBreak();if(g){b.appendIndent();b.append('<td acre:else=""><ins>[no value]</ins></td>');b.appendLineBreak()}b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()});return a},generateImageField:function(a,b,c,d,e,f){f=f();a=f+"['"+d+"']";b.appendIndent();b.append("<tr><th>"+d+":</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append("<td acre:if=\"'"+d+"' in "+f+" && "+a+' != null">');b.appendLineBreak();b.indent();d=e instanceof
Array;b.appendIndent();if(d){e=e[0];d=c.createVariable("image");c=c.createVariable("i");b.append('<img acre:for="'+c+", "+d+" in "+a+'" src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+d+".guid.substr(1)}":"${"+d+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>')}else b.append('<img src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+a+".guid.substr(1)}":"${"+a+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>');
b.appendLineBreak();b.unindent();b.appendIndent();b.append('<td acre:else=""><ins>[no image]</ins></td>');b.appendLineBreak();b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()},openWildcardField:function(a,b,c,d){d=d();var e=c.createVariable("field"),f=c.createVariable("value");b.appendIndent();b.append('<tr acre:for="'+e+", "+f+" in "+d+'"><td>${'+e+"}:</td>");b.appendLineBreak();b.indent();a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",
function(g){b.appendIndent();b.append("<td>");if(!g){b.appendLineBreak();b.indent()}return f});a.setProperty("stop",function(g){if(!g){b.unindent();b.appendIndent()}b.append("</td>");b.appendLineBreak()});return a},closeWildcardField:function(a,b){b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()},generateEmptyObjectNode:function(a,b,c,d){a=c.createVariable("field");c=c.createVariable("value");b.appendIndent();b.append("<table>");b.appendLineBreak();b.indent();b.appendIndent();b.append('<tr acre:for="'+
a+", "+c+" in "+d+'"><th>${'+a+"}:</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append('<td acre:if="'+c+' instanceof Array">${'+c+".join(', ')}</td>");b.appendLineBreak();b.appendIndent();b.append('<td acre:else="">${'+c+"}</td>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</table>");b.appendLineBreak()}};
CueCard.ExampleTechniques=["all","basic","sorting","text search","range constraint","date query","multiple constraints on same property","limiting number of results","geographic location","compound value type (CVT)","schema inspection","attribution","adding data"];
CueCard.Examples=[{name:"Vietnamese restaurants in Aspen, Colorado",query:[{"/business/business_location/address":{citytown:"Aspen",state_province_region:"Colorado"},cuisine:"Vietnamese",name:null,id:null,type:"/dining/restaurant"}],techniques:["basic","geographic location"]},{name:"Properties of /music/artist",query:[{id:"/music/artist",properties:[{}],type:"/type/type"}],techniques:["schema inspection"]},{name:"All types created by the user jamie",query:[{creator:"/user/jamie",name:null,id:null,
type:"/type/type"}],techniques:["attribution"]},{name:"Cloud classifications sorted by name",query:[{clouds:[],name:null,id:null,sort:"name",type:"/meteorology/cloud_classification"}],techniques:["basic","sorting"]},{name:"U.S. states containing cities whose names start with 'Blue' or 'Red'",query:[{"a:contains":[{name:null,id:null,"name~=":"^Red",type:"/location/citytown"}],"b:contains":[{name:null,id:null,"name~=":"^Blue",type:"/location/citytown"}],"b:type":"/location/us_state",name:null,id:null,
type:"/location/location"}],techniques:["text search","multiple constraints on same property"]},{name:"2 of The Police's albums and their tracks",query:{album:[{id:null,limit:2,name:null,track:[]}],id:null,name:"The Police",type:"/music/artist"},techniques:["basic","limiting number of results"]},{name:"25 Songs with the word 'love' in their titles, with release date, album and artist",query:[{album:{artist:[],name:null,id:null,release_date:null},limit:25,name:null,"name~=":"Love*",type:"/music/track"}],
techniques:["text search","limiting number of results","date query"]},{name:"Films starring both Joe Pesci and Robert de Niro, showing their full cast",query:[{"a:starring":[{actor:"Joe Pesci"}],"b:starring":[{actor:"Robert de Niro"}],name:null,id:null,starring:[{actor:null}],type:"/film/film"}],techniques:["multiple constraints on same property","compound value type (CVT)"]},{name:"32 actors born in the 1960s, with two films of each actor",query:[{"/people/person/date_of_birth":null,"/people/person/date_of_birth<":"1970",
"/people/person/date_of_birth>=":"1960",film:[{film:null,id:null,limit:2}],limit:35,name:null,id:null,type:"/film/actor"}],techniques:["multiple constraints on same property","date query","limiting number of results","range constraint"]},{name:"Directors who have directed both Parker Posey and any actor named Robert (in possibly different films)",query:[{"a:film":[{name:null,id:null,starring:{actor:"Parker Posey"}}],"b:film":[{name:null,id:null,starring:{actor:null,"actor~=":"Robert*"}}],name:null,
id:null,type:"/film/director"}],techniques:["multiple constraints on same property","text search","compound value type (CVT)"]},{name:"Music artists with albums containing a track called 'One Tree Hill'",query:[{album:[{name:null,id:null,track:[{length:null,name:"One Tree Hill"}]}],name:null,id:null,type:"/music/artist"}],techniques:["compound value type (CVT)","basic"]},{name:"Everything about 'Jimi Hendrix'",query:{"*":null,name:"Jimi Hendrix",type:"/music/artist"},techniques:["basic"]},{name:"Kevin Bacon's films, with cast, producers, music, etc.",
query:[{film:[{film:{imdb_id:[],music:[],name:null,id:null,produced_by:[],starring:[{actor:[{}]}],type:[]}}],name:"Kevin Bacon",type:"/film/actor"}],techniques:["basic","compound value type (CVT)"]},{name:"When 'Star Wars Episode IV' was added to the database, and by whom",query:[{creator:null,id:"/wikipedia/en/Star_Wars_Episode_IV",name:null,timestamp:null,type:"/film/film"}],techniques:["attribution"]},{name:"Tracks on Synchronicity longer than 300 seconds",query:[{artist:"The Police",name:"Synchronicity",
track:[{length:null,"length>":300,name:null}],type:"/music/album"}],techniques:["range constraint"]},{name:"Properties of a particular type (/government/politician)",query:{id:"/government/politician",properties:[],type:"/type/type"},techniques:["schema inspection"]},{name:"Properties of a particular property (/type/object/name)",query:{"*":null,id:"/type/object/name",type:"/type/property"},techniques:["schema inspection"]},{name:"Types in a particular domain (/music)",query:{id:"/music",type:"/type/domain",
types:[]},techniques:["schema inspection"]},{name:"Creating a new topic given a name and a type",query:{create:"unless_exists",name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,guid:null},techniques:["adding data"]},{name:"Setting a basic unique property to a topic",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,basic_property:{value:42,connect:"update"}},techniques:["adding data"]},{name:"Connecting one topic to another",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",
id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"insert"}},techniques:["adding data"]},{name:"Deleting a link between two topics",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"delete"}},techniques:["adding data"]}];CueCard.ExampleTechniqueMap={all:[]};
for(var i=0;i<CueCard.Examples.length;i++){var example=CueCard.Examples[i];CueCard.ExampleTechniqueMap.all.push(i);for(var x=0;x<example.techniques.length;x++){var technique=example.techniques[x];if(technique in CueCard.ExampleTechniqueMap)CueCard.ExampleTechniqueMap[technique].push(i);else CueCard.ExampleTechniqueMap[technique]=[i]}}
CueCard.Languages=[{name:"Afrikaans",id:"/lang/af"},{name:"Akkadian",id:"/lang/kk"},{name:"Albanian",id:"/lang/sq"},{name:"Amharic",id:"/lang/am"},{name:"Arabic",id:"/lang/ar"},{name:"Armenian",id:"/lang/hy"},{name:"Artificial",id:"/lang/art"},{name:"Asturian",id:"/lang/ast"},{name:"Australian languages",id:"/lang/aus"},{name:"Azerbaijani",id:"/lang/az"},{name:"Balinese",id:"/lang/ban"},{name:"Bambara",id:"/lang/bm"},{name:"Bantu",id:"/lang/bnt"},{name:"Basque",id:"/lang/eu"},{name:"Batak",id:"/lang/btk"},
{name:"Belarusian",id:"/lang/be"},{name:"Bengali",id:"/lang/bn"},{name:"Bhojpuri",id:"/lang/bho"},{name:"Bosnian",id:"/lang/bs"},{name:"Breton",id:"/lang/br"},{name:"Bulgarian",id:"/lang/bg"},{name:"Buriat",id:"/lang/bua"},{name:"Catalan",id:"/lang/ca"},{name:"Cebuano",id:"/lang/ceb"},{name:"Cherokee",id:"/lang/chr"},{name:"Chichewa",id:"/lang/ny"},{name:"Chinese",id:"/lang/zh"},{name:"Cornish",id:"/lang/kw"},{name:"Corsican",id:"/lang/co"},{name:"Cree",id:"/lang/cr"},{name:"Creoles",id:"/lang/cpf"},
{name:"Croatian",id:"/lang/hr"},{name:"Czech",id:"/lang/cs"},{name:"Danish",id:"/lang/da"},{name:"Duala",id:"/lang/dua"},{name:"Dutch",id:"/lang/nl"},{name:"English",id:"/lang/en"},{name:"Esperanto",id:"/lang/eo"},{name:"Estonian",id:"/lang/et"},{name:"Faroese",id:"/lang/fo"},{name:"Filipino",id:"/lang/fil"},{name:"Finnish",id:"/lang/fi"},{name:"French",id:"/lang/fr"},{name:"Frisian",id:"/lang/fy"},{name:"Friulian",id:"/lang/fur"},{name:"Fulah",id:"/lang/ff"},{name:"Ga",id:"/lang/gaa"},{name:"Gaelic",
id:"/lang/gd"},{name:"Gallegan",id:"/lang/gl"},{name:"Georgian",id:"/lang/ka"},{name:"German",id:"/lang/de"},{name:"Germanic",id:"/lang/gem"},{name:"Greek",id:"/lang/el"},{name:"Guarani",id:"/lang/gn"},{name:"Haitian",id:"/lang/ht"},{name:"Hausa",id:"/lang/ha"},{name:"Hawaiian",id:"/lang/haw"},{name:"Hebrew",id:"/lang/he"},{name:"Hindi",id:"/lang/hi"},{name:"Hungarian",id:"/lang/hu"},{name:"Icelandic",id:"/lang/is"},{name:"Indonesian",id:"/lang/id"},{name:"Inuktitut",id:"/lang/ku"},{name:"Inuktitut",
id:"/lang/iu"},{name:"Irish",id:"/lang/ga"},{name:"Italian",id:"/lang/it"},{name:"Japanese",id:"/lang/ja"},{name:"Judeo-Arabic",id:"/lang/jrb"},{name:"Kalaallisut",id:"/lang/kl"},{name:"Khmer",id:"/lang/km"},{name:"Kinyarwanda",id:"/lang/rw"},{name:"Klingon",id:"/lang/tlh"},{name:"Kongo",id:"/lang/kg"},{name:"Korean",id:"/lang/ko"},{name:"Ladino",id:"/lang/lad"},{name:"Latin",id:"/lang/la"},{name:"Latvian",id:"/lang/lv"},{name:"Limburgan",id:"/lang/li"},{name:"Lingala",id:"/lang/ln"},{name:"Lithuanian",
id:"/lang/lt"},{name:"Low German",id:"/lang/nds"},{name:"Luxembourgish",id:"/lang/lb"},{name:"Macedonian",id:"/lang/mk"},{name:"Malagasy",id:"/lang/mg"},{name:"Malay",id:"/lang/ms"},{name:"Malayalam",id:"/lang/ml"},{name:"Maltese",id:"/lang/mt"},{name:"Mandingo",id:"/lang/man"},{name:"Manx",id:"/lang/gv"},{name:"Maori",id:"/lang/mi"},{name:"Marathi",id:"/lang/mr"},{name:"Mohawk",id:"/lang/moh"},{name:"Moldavian",id:"/lang/mo"},{name:"Mongolian",id:"/lang/mn"},{name:"Nahuatl",id:"/lang/nah"},{name:"Navajo",
id:"/lang/nv"},{name:"Neapolitan",id:"/lang/nap"},{name:"Nepali",id:"/lang/ne"},{name:"Norse,",id:"/lang/non"},{name:"Northern Sami",id:"/lang/se"},{name:"Norwegian",id:"/lang/no"},{name:"Norwegian Nynorsk",id:"/lang/nn"},{name:"Occitan",id:"/lang/oc"},{name:"Panjabi",id:"/lang/pa"},{name:"Papiamento",id:"/lang/pap"},{name:"Persian",id:"/lang/fa"},{name:"Polish",id:"/lang/pl"},{name:"Portuguese",id:"/lang/pt"},{name:"Pushto",id:"/lang/ps"},{name:"Quechua",id:"/lang/qu"},{name:"Raeto-Romance",id:"/lang/rm"},
{name:"Romanian",id:"/lang/ro"},{name:"Romany",id:"/lang/rom"},{name:"Russian",id:"/lang/ru"},{name:"Sakha",id:"/lang/sah"},{name:"Sanskrit",id:"/lang/sa"},{name:"Sardinian",id:"/lang/sc"},{name:"Scots",id:"/lang/sco"},{name:"Serbian",id:"/lang/sr"},{name:"Shona",id:"/lang/sn"},{name:"Sicilian",id:"/lang/scn"},{name:"Slovak",id:"/lang/sk"},{name:"Slovenian",id:"/lang/sl"},{name:"Songhai",id:"/lang/son"},{name:"Spanish",id:"/lang/es"},{name:"Sundanese",id:"/lang/su"},{name:"Swahili",id:"/lang/sw"},
{name:"Swedish",id:"/lang/sv"},{name:"Syriac",id:"/lang/syr"},{name:"Tagalog",id:"/lang/tl"},{name:"Tahitian",id:"/lang/ty"},{name:"Tajik",id:"/lang/tg"},{name:"Tamashek",id:"/lang/tmh"},{name:"Tamil",id:"/lang/ta"},{name:"Telugu",id:"/lang/te"},{name:"Thai",id:"/lang/th"},{name:"Tibetan",id:"/lang/bo"},{name:"Tonga",id:"/lang/to"},{name:"Turkish",id:"/lang/tr"},{name:"Turkmen",id:"/lang/tk"},{name:"Tuvinian",id:"/lang/tyv"},{name:"Ukrainian",id:"/lang/uk"},{name:"Urdu",id:"/lang/ur"},{name:"Uzbek",
id:"/lang/uz"},{name:"Vietnamese",id:"/lang/vi"},{name:"Welsh",id:"/lang/cy"},{name:"Wolof",id:"/lang/wo"},{name:"Xhosa",id:"/lang/xh"},{name:"Yiddish",id:"/lang/yi"},{name:"Yoruba",id:"/lang/yo"},{name:"Zulu",id:"/lang/zu"}];
CueCard.XMetawebCosts={tu:{meaning:"time/user",subsystem:"graphd"},ts:{meaning:"time/system",subsystem:"graphd"},tr:{meaning:"time/real",subsystem:"graphd"},te:{meaning:"time/overall",subsystem:"graphd"},pr:{meaning:"page reclaims",subsystem:"graphd"},pf:{meaning:"page faults",subsystem:"graphd"},dw:{meaning:"primitive data writes",subsystem:"graphd"},dr:{meaning:"primitive data reads",subsystem:"graphd"},"in":{meaning:"index size reads",subsystem:"graphd"},ir:{meaning:"index element reads",subsystem:"graphd"},
iw:{meaning:"index element write",subsystem:"graphd"},va:{meaning:"value allocation",subsystem:"graphd"},dt:{meaning:"total time spent in the session",subsystem:"client/me"},mr:{meaning:"number of mql requests (independent of caches)",subsystem:"client/me"},ch:{meaning:"cache/hit (memcache, not Squid)",subsystem:"client/me",important:true},cm:{meaning:"cache/miss (memcache, not Squid)",subsystem:"client/me"},cr:{meaning:"cache/read (memcache, not Squid)",subsystem:"client/me"},cs:{meaning:"cache skip (browser shift+reload skips memcache)",
subsystem:"client/me"},lh:{meaning:"lojson-cache/hit",subsystem:"client/me"},lm:{meaning:"lojson-cache/miss",subsystem:"client/me"},lr:{meaning:"lojson-cache/read",subsystem:"client/me"},nreqs:{meaning:"graph requests",subsystem:"client/me",important:true},tf:{meaning:"time/formatted",subsystem:"client/me"},tg:{meaning:"time/graph",subsystem:"client/me",important:true},rt:{meaning:"relevance/time",subsystem:"client/me"},cc:{meaning:"cpu time (utime + stime)",subsystem:"client/me"},mcu:{meaning:"mql user time",
subsystem:"client/me"},mcs:{meaning:"mql system time",subsystem:"client/me"},tm:{meaning:"mql real time",subsystem:"client/me",important:true},utime:{meaning:"time in user mode (float)",subsystem:"client/me"},stime:{meaning:"time in system mode (float)",subsystem:"client/me"},maxrss:{meaning:"maximum resident set size",subsystem:"client/me"},ixrss:{meaning:"shared memory size",subsystem:"client/me"},idrss:{meaning:"unshared memory size",subsystem:"client/me"},isrss:{meaning:"unshared stack size",
subsystem:"client/me"},minflt:{meaning:"page faults not requiring I/O",subsystem:"client/me"},majflt:{meaning:"page faults requiring I/O",subsystem:"client/me"},nswap:{meaning:"number of swap outs",subsystem:"client/me"},inblock:{meaning:"block input operations",subsystem:"client/me"},oublock:{meaning:"block output operations",subsystem:"client/me"},msgsnd:{meaning:"messages sent",subsystem:"client/me"},msgrcv:{meaning:"messages received",subsystem:"client/me"},nsignals:{meaning:"signals received",
subsystem:"client/me"},nvcsw:{meaning:"voluntary context switches",subsystem:"client/me"},nivcsw:{meaning:"involuntary context switches",subsystem:"client/me"},br:{meaning:"number of blob requests",subsystem:"client/me"},bctn:{meaning:"cdb thumbnail time - from blobclient POV",subsystem:"client/me"},rt:{meaning:"relevance/time (FIX: same name, different semantics?)",subsystem:"gix"},pt:{meaning:"postgres time",subsystem:"gix"},qt:{meaning:"actual postgres query time",subsystem:"gix"},ct:{meaning:"postgres connect time",
subsystem:"gix"},mt:{meaning:"MQL time",subsystem:"gix"},tt:{meaning:"total time",subsystem:"other"},mt:{meaning:"total MQL time: mql_output + mql_filter",subsystem:"other"},mft:{meaning:"MQL filter time (total time, ie. not per invocation)",subsystem:"other"},mfc:{meaning:"number of mql_filter invocations",subsystem:"other"},sh:{meaning:"squid/hit",subsystem:"cache"},st:{meaning:"squid/total time",subsystem:"cache"},so:{meaning:"squid/origin server time",subsystem:"cache"}};
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];var g=function(j){var h=b.runtime.new_markuplist(),k=0;h[k++]=d[1];h[k++]=j;h[k++]=d[2];return h};g=b.runtime.tfunc_factory("acre_template(t)",g,b,undefined,false);c.acre_template=g;g.source_microdata=null;e[f++]=
d[3];f=function(j){var h=b.runtime.new_markuplist(),k=0;h[k++]=d[4];var n=function(o){var l=b.runtime.new_markuplist(),m=0;l[m++]=d[5];b.runtime.foreach(this,CueCard.ExampleTechniques,function(q,t){for(var s=1;s;){l[m++]=d[6];l[m++]=b.runtime.make_attr_safe(t===o?"cuecard-examples-technique-selected":"cuecard-examples-technique");l[m++]=d[7];l[m++]=b.runtime.make_attr_safe(t);l[m++]=d[8];l[m++]=t;l[m++]=d[9];l[m++]=CueCard.ExampleTechniqueMap[t].length;l[m++]=d[10];s--}return s?b.runtime._break_token:
b.runtime._continue_token});l[m++]=d[11];return l};n=b.runtime.tfunc_factory("list_techniques(selected_technique)",n,b,undefined,false);n.source_microdata=null;h[k++]=d[12];var p=function(o){var l=b.runtime.new_markuplist(),m=0;l[m++]=d[13];b.runtime.foreach(this,CueCard.Examples,function(q,t){for(var s=1;s;){if(o!=="all"?t.techniques.indexOf(o)!==-1:true){l[m++]=d[14];l[m++]=b.runtime.make_attr_safe(q);l[m++]=d[15];l[m++]=b.runtime.make_attr_safe(q);l[m++]=d[16];l[m++]=t.name;l[m++]=d[17]}s--}return s?
b.runtime._break_token:b.runtime._continue_token});l[m++]=d[18];return l};p=b.runtime.tfunc_factory("list_examples(technique)",p,b,undefined,false);p.source_microdata=null;h[k++]=d[19];b.runtime.ondomready(function(){var o=$("#dialog-examples").height()-$("#dialog-examples .modal-title").height()-$("#dialog-examples .modal-buttons").height();$("#cuecard-examples-dialog").height(o-50);selectTechnique=function(l){l=l||"all";$(".cuecard-examples-dialog-columnBody.cuecard-examples-dialog-column-0").acre(n(l));
$(".cuecard-examples-dialog-columnBody.cuecard-examples-dialog-column-1").acre(p(l));return false};selectExample=function(l){$(".cuecard-examples-example").removeClass("cuecard-examples-example-selected");$("#cuecard-example-"+l).addClass("cuecard-examples-example-selected");$("#cuecard-examples-dialog").find("textarea").val(CueCard.jsonize(CueCard.Examples[l].query,{indentCount:2}));return false};selectTechnique();$("#examples-submit").click(function(){var l=$("#cuecard-examples-dialog").find("textarea").val();
j.onDone(l)})},this);h[k++]=d[20];return h};f=b.runtime.tfunc_factory("examples(opts)",f,b,undefined,false);c.examples=f;f.source_microdata=null;return e};a.source_microdata=null;return a}(),info:{file:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",stringtable:["",'\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Generated Acre Template</span>\n    </h1>\n    <div class="modal-content">\n      <textarea id="template-code" wrap="off">','</textarea>\n    </div>\n  </div>\n  <div class="modal-buttons">\n    <button class="button button-cancel">OK</button>\n  </div>',
"","","",'\n    <a class="','" href="javascript:selectTechnique(\'',"')\">\n      "," (",")\n    </a>","","","",'\n    <a class="cuecard-examples-example" href="javascript:selectExample(\'','\')" id="cuecard-example-','">\n      ',"\n    </a>","",'\n\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Examples</span>\n    </h1>\n    <div class="modal-content" id="cuecard-examples-dialog">\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-0">Techniques</div>\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-1">Examples</div>\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-2">Query</div>\n      <div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-0"></div>\n      <div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-1"></div>\n      <textarea class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-2 cuecard-examples-query" readonly="true" wrap="off">\n    </textarea></div>\n  </div>\n  \n  <div class="modal-buttons">\n    <button class="button button-submit" id="examples-submit" type="submit">Paste &amp; Run</button>\n    <button class="button button-cancel">Cancel</button>\n  </div>',
""],debug_locs:[1,1,1,1,1,1,6,6,6,6,12,12,12,12,12,12,12,12,18,18,18,18,18,18,18,18,18,18,18,20,20,20,20,22,22,22,22,24,24,24,24,24,24,24,24,24,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,29,29,29,29,31,31,31,31,31,31,31,31,31,31,32,32,32,33,33,33,33,33,33,33,34,34,34,34,34,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,81,81,81,81,81,81,81,81],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];f=function(g,j){var h=b.runtime.new_markuplist(),k=0;h[k++]=d[1];var n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g._showExamples()};h[k++]=d[2];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[3];
n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g._editor.editor.history.undo()};h[k++]=d[4];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[5];n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g._editor.editor.history.redo()};h[k++]=d[6];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[7];n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g.content("");g.focus()};h[k++]=d[8];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[9];n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g.startAssistAtCursor()};
h[k++]=d[10];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[11];n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g._onCleanUp()};h[k++]=d[12];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[13];n=b.runtime.uniqueid("onclick");mjt._eventcb[n]=function(){g._onRun(false)};h[k++]=d[14];h[k++]=b.runtime.make_attr_safe(n);h[k++]=d[15];b.runtime.ondomready(function(){var p=$(g._container);g._controlTopContainer=p.find(".cuecard-queryEditor-controls-top");g._iframeContainer=p.find(".cuecard-queryEditor-content");
g._controlBottomContainer=p.find(".cuecard-queryEditor-controls-bottom");g._addCodemirror(p.find(".cuecard-queryEditor-content"),j);g.layout=function(){var o=p.height()-g._controlTopContainer[0].offsetHeight-g._controlBottomContainer[0].offsetHeight;g._iframeContainer.height(o).css("top",g._controlTopContainer[0].offsetHeight)};g.layout()},this);h[k++]=d[16];return h};f=b.runtime.tfunc_factory("query_editor(queryEditor, codeMirrorOptions)",f,b,undefined,false);c.query_editor=f;f.source_microdata=
null;return e};a.source_microdata=null;return a}(),info:{file:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",stringtable:["",'\n\n  <div class="cuecard-queryEditor-inner">\n    <div class="cuecard-queryEditor-controls-top">\n      <table cellpadding="0" cellspacing="0" width="100%"><tr>\n        <td class="cuecard-queryEditor-controls-leftAligned">','\n          <button class="button cuecard-queryEditor-examples" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Examples...\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-leftAligned">\n          <span>\n            <a href="http://www.freebase.com/docs/data" target="_blank">MQL\u00a0Tutorial</a>\u00a0\u2022\u00a0<a href="http://www.freebase.com/docs/mql" target="_blank">MQL\u00a0Reference</a>\n          </span>\n        </td>\n        <td width="99%"></td>\n        <td class="cuecard-queryEditor-controls-rightAligned">',
'\n          <button class="button cuecard-queryEditor-undo" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Undo\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button cuecard-queryEditor-redo" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Redo\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button cuecard-queryEditor-redo" onclick="return mjt._eventcb.',
'.apply(this, [event])">\n            Clear\n          </button>\n        </td>\n      </tr></table>\n    </div>\n    <div class="cuecard-queryEditor-content"></div>\n    <div class="cuecard-queryEditor-controls-bottom">\n      <table cellpadding="0" cellspacing="0" width="100%"><tr>\n        <td class="cuecard-queryEditor-controls-leftAligned">','\n          <button class="button button-primary cuecard-queryEditor-queryAssist" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Query\u00a0Assist\n          </button>\n          <span class="cuecard-queryEditor-buttonHint">Tab</span>\n        </td>\n        <td width="90%"></td>\n        <td class="cuecard-queryEditor-controls-rightAligned">',
'\n          <button class="button cuecard-queryEditor-cleanUp" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Clean\u00a0Up\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button button-primary cuecard-queryEditor-run" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Run\n          </button>\n          <span class="cuecard-queryEditor-buttonHint">Ctrl-Enter</span>\n        </td>\n      </tr></table>\n    </div>\n  </div>',
""],debug_locs:[1,1,1,1,1,1,7,7,7,7,14,14,14,14,14,14,14,14,14,14,14,14,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,32,32,32,32,32,32,32,32,32,32,32,38,38,38,38,38,38,38,38,38,38,38,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,57,57,57,57,57,57,57,57,57,57,57,57,57,63,63,63,63,63,63,63,63,63,63,63,72,72,72,72,72,72,72,72,72,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,90,90,90,90,90,90,90,90,90],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];var g=function(o,l){var m=b.runtime.new_markuplist(),q=0;m[q++]=d[1];var t=[{name:"Tools",template:j,key:"tools"},{name:"Variables",template:h,key:"variables"},{name:"Envelope",template:k,key:"envelope"},
{name:"Custom Envelope",template:n,key:"customEnvelope"},{name:"Settings",template:p,key:"settings"}];m[q++]=d[2];m[q++]=b.runtime.make_attr_safe(o);m[q++]=d[3];b.runtime.foreach(this,t,function(s,v){for(var u=1;u;){m[q++]=d[4];m[q++]=b.runtime.make_attr_safe(o);m[q++]=d[5];m[q++]=b.runtime.make_attr_safe(v.key);m[q++]=d[6];m[q++]=v.name;m[q++]=d[7];u--}return u?b.runtime._break_token:b.runtime._continue_token});m[q++]=d[8];b.runtime.foreach(this,t,function(s,v){for(var u=1;u;){m[q++]=d[9];m[q++]=
b.runtime.make_attr_safe(o);m[q++]=d[10];m[q++]=b.runtime.make_attr_safe(v.key);m[q++]=d[11];m[q++]=v.template(l);m[q++]=d[12];u--}return u?b.runtime._break_token:b.runtime._continue_token});m[q++]=d[13];b.runtime.ondomready(function(){l.layout=function(){var s=this._elmt,v=s.find(".section-tabs").innerHeight()-s.find(".section-tabset").outerHeight();s.find(".cuecard-controlPane-tabBody").css("height",v)};l.layout()},this);m[q++]=d[14];return m};g=b.runtime.tfunc_factory("tabs(id, controlPane)",g,
b,undefined,false);c.tabs=g;g.source_microdata=null;e[f++]=d[15];var j=function(o){var l=b.runtime.new_markuplist(),m=0;l[m++]=d[16];l[m++]=d[17];b.runtime.foreach(this,[{label:"Qualify All Properties",command:"_qualify",hint:'Expand all properties to their full IDs (e.g., "id" \u2192 "/type/object/id").'},{label:"Turn Inside Out",command:"_redangle",hint:"Take the inner most query node {...} that contains the text cursor and make it the outermost query node."},{label:"Generate Acre Template",command:"_generateCode",
hint:"Generate an ACRE template that can render the result of this query."},{label:"One-liner",command:"_oneLiner",hint:"Reformat query into a one-liner."}],function(q,t){for(var s=1;s;){l[m++]=d[18];var v=b.runtime.uniqueid("onclick");mjt._eventcb[v]=function(){o[t.command]()};l[m++]=d[19];l[m++]=b.runtime.make_attr_safe(t.label);l[m++]=d[20];l[m++]=b.runtime.make_attr_safe(v);l[m++]=d[21];l[m++]=t.hint;l[m++]=d[22];s--}return s?b.runtime._break_token:b.runtime._continue_token});l[m++]=d[23];return l};
j=b.runtime.tfunc_factory("tools(controlPane)",j,b,undefined,false);c.tools=j;j.source_microdata=null;e[f++]=d[24];var h=function(o){var l=b.runtime.new_markuplist(),m=0;l[m++]=d[25];var q=function(){var s=b.runtime.new_markuplist(),v=0;s[v++]=d[26];if(this.subst_id)s[v++]=b.runtime.bless(' id="'+this.subst_id+'"');s[v++]=d[27];var u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){$(this).closest(".cuecard-controlPane-variables-row").remove()};s[v++]=d[28];s[v++]=b.runtime.make_attr_safe(u);
s[v++]=d[29];return s};q=b.runtime.tfunc_factory("add_row()",q,b,undefined,false);q.source_microdata=null;l[m++]=d[30];l[m++]=q();l[m++]=d[31];var t=b.runtime.uniqueid("onclick");mjt._eventcb[t]=function(){o._getTab("variables").find(".cuecard-controlPane-variables").append($.acre(q()))};l[m++]=d[32];l[m++]=b.runtime.make_attr_safe(t);l[m++]=d[33];return l};h=b.runtime.tfunc_factory("variables(controlPane)",h,b,undefined,false);c.variables=h;h.source_microdata=null;e[f++]=d[34];var k=function(o){var l=
b.runtime.new_markuplist(),m=0;l[m++]=d[35];var q=o._getDefaults();l[m++]=d[36];b.runtime.foreach(this,[{name:"extended",hint:"Enable MQL extensions"},{name:"as_of_time",hint:"Resolve the query based on data in Freebase as of the given time in ISO8601 format, e.g., 2009-02-28, 2009-03-13T22:16:40"},{name:"use_permission_of",hint:'Specify the id of an object (typically a user, domain or type) whose permission you want to copy (<a href="http://freebaseapps.com/docs/mql/ch06.html#id2972357" target="_blank">more details</a>).'},
{name:"page",hint:'Page number starting from 1 if there is a "limit" property in the top level query node.'},{name:"cursor",hint:""},{name:"lang",hint:"Return text values in the given language (specified with the language's Freebase ID)"},{name:"escape",hint:""},{name:"uniqueness_failure",hint:""}],function(t,s){for(var v=1;v;){l[m++]=d[37];l[m++]=s.name;l[m++]=d[38];switch(s.name){case "extended":l[m++]=d[39];var u=q.extended?{checked:""}:{};"name"in u||(l[m++]=d[40]);"type"in u||(l[m++]=d[41]);
for(var A in u){l[m++]=" "+A;l[m++]=b.runtime.bless('="');l[m++]=b.runtime.htmlencode(""+u[A]);l[m++]=b.runtime.bless('"')}l[m++]=d[42];break;case "as_of_time":l[m++]=d[43];l[m++]=b.runtime.make_attr_safe(q.as_of_time||"");l[m++]=d[44];break;case "use_permission_of":l[m++]=d[45];l[m++]=b.runtime.make_attr_safe(q.use_permission_of||"");l[m++]=d[46];break;case "page":l[m++]=d[47];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){o._runPage(-1)};l[m++]=d[48];l[m++]=b.runtime.make_attr_safe(u);
l[m++]=d[49];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){o._runPage(1)};l[m++]=d[50];l[m++]=b.runtime.make_attr_safe(u);l[m++]=d[51];break;case "cursor":l[m++]=d[52];u=b.runtime.uniqueid("onchange");mjt._eventcb[u]=function(){o._getTab("envelope").find("input[name='cursor'][value='custom']").attr("checked","checked")};l[m++]=d[53];l[m++]=b.runtime.make_attr_safe(u);l[m++]=d[54];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){o._runCursor(false)};l[m++]=d[55];l[m++]=b.runtime.make_attr_safe(u);
l[m++]=d[56];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){o._runCursor(true)};l[m++]=d[57];l[m++]=b.runtime.make_attr_safe(u);l[m++]=d[58];break;case "lang":l[m++]=d[59];b.runtime.foreach(this,CueCard.Languages,function(w,y){for(var r=1;r;){l[m++]=d[60];l[m++]=b.runtime.make_attr_safe(y.id);l[m++]=d[61];l[m++]=y.name;l[m++]=d[62];l[m++]=y.id;l[m++]=d[63];r--}return r?b.runtime._break_token:b.runtime._continue_token});l[m++]=d[64];break;case "escape":l[m++]=d[65];break;case "uniqueness_failure":l[m++]=
d[66];break}l[m++]=d[67];if(s.hint.length>0){l[m++]=d[68];l[m++]=mjt.bless(s.hint);l[m++]=d[69]}l[m++]=d[70];v--}return v?b.runtime._break_token:b.runtime._continue_token});l[m++]=d[71];return l};k=b.runtime.tfunc_factory("envelope(controlPane)",k,b,undefined,false);c.envelope=k;k.source_microdata=null;e[f++]=d[72];var n=function(o){var l=b.runtime.new_markuplist(),m=0;l[m++]=d[73];var q="env"in o._options?o._options.env:{},t=false;l[m++]=d[74];var s=function(v,u,A){var w=b.runtime.new_markuplist(),
y=0;w[y++]=d[75];if(this.subst_id)w[y++]=b.runtime.bless(' id="'+this.subst_id+'"');w[y++]=d[76];w[y++]=b.runtime.make_attr_safe(u||"");w[y++]=d[77];w[y++]=b.runtime.make_attr_safe(A||"");w[y++]=d[78];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){$(this).closest(".cuecard-controlPane-customEnvelope-row").remove()};w[y++]=d[79];w[y++]=b.runtime.make_attr_safe(u);w[y++]=d[80];v||b.runtime.ondomready(function(){},this);w[y++]=d[81];return w};s=b.runtime.tfunc_factory("add_row(dontFocus, name, value)",
s,b,undefined,false);s.source_microdata=null;l[m++]=d[82];b.runtime.foreach(this,q,function(v,u){for(var A=1;A;){l[m++]=d[83];t=true;l[m++]=d[84];l[m++]=s(true,v,JSON.stringify(u));l[m++]=d[85];A--}return A?b.runtime._break_token:b.runtime._continue_token});l[m++]=d[86];if(!t){l[m++]=d[87];l[m++]=s(true);l[m++]=d[88]}l[m++]=d[89];q=b.runtime.uniqueid("onclick");mjt._eventcb[q]=function(){o._getTab("customEnvelope").find(".cuecard-controlPane-customEnvelope").append($.acre(s()))};l[m++]=d[90];l[m++]=
b.runtime.make_attr_safe(q);l[m++]=d[91];return l};n=b.runtime.tfunc_factory("custom_envelope(controlPane)",n,b,undefined,false);c.custom_envelope=n;n.source_microdata=null;e[f++]=d[92];var p=function(){var o=b.runtime.new_markuplist(),l=0;o[l++]=d[93];var m=$.cookie("cc_cp_clean")=="1"?{checked:""}:{};"type"in m||(o[l++]=d[94]);for(var q in m){o[l++]=" "+q;o[l++]=b.runtime.bless('="');o[l++]=b.runtime.htmlencode(""+m[q]);o[l++]=b.runtime.bless('"')}o[l++]=d[95];m=$.cookie("cc_cp_align")=="1"?{checked:""}:
{};"type"in m||(o[l++]=d[96]);for(var t in m){o[l++]=" "+t;o[l++]=b.runtime.bless('="');o[l++]=b.runtime.htmlencode(""+m[t]);o[l++]=b.runtime.bless('"')}o[l++]=d[97];t=$.cookie("cc_cp_multi")=="1"?{checked:""}:{};"type"in t||(o[l++]=d[98]);for(var s in t){o[l++]=" "+s;o[l++]=b.runtime.bless('="');o[l++]=b.runtime.htmlencode(""+t[s]);o[l++]=b.runtime.bless('"')}o[l++]=d[99];return o};p=b.runtime.tfunc_factory("settings(controlPane)",p,b,undefined,false);c.settings=p;p.source_microdata=null;e[f++]=
d[100];return e};a.source_microdata=null;return a}(),info:{file:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",stringtable:["","",'\n\n  <div class="cuecard-controlPane section-tabs">\n    <div id="','">\n      <ul class="section-tabset clear">','\n        <li class="section-tab tab">\n          <a href="#',"-",'"><span>',"</span></a>\n        </li>",'\n      </ul>\n      <div class="tabbed-content">','\n        <div class="cuecard-controlPane-tabBody" id="',"-",'">\n          ',
"\n        </div>","\n      </div>\n    </div>\n  </div>","","","",'\n\n  <div class="cuecard-controlPane-section">\n    <table><tr valign="top">\n      <td>','\n        <div class="cuecard-controlPane-powerTool">','\n          <input class="button" type="submit" value="','" onclick="return mjt._eventcb.','.apply(this, [event])">\n          <div class="cuecard-controlPane-powerTool-hint">',"</div>\n        </div>",'\n      </td>\n      <td width="40%">\n        Results of tools<br>\n        <input checked="true" name="tools-result" type="radio" value="replace"> replace query (undo-able)<br>\n        <input name="tools-result" type="radio" value="output"> go into output pane\n      </td>\n    </tr></table>\n  </div>',
"",'\n  <table class="cuecard-controlPane-variables">\n    <tr>\n      <th width="30%">name</th>\n      <th width="50%">value</th>\n      <th></th>\n    </tr>','<tr class="cuecard-controlPane-variables-row"',">\n      <td><input></td>\n      <td><input></td>\n      <td>",'\n        <input class="button" type="submit" value="Remove" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>\n    </tr>',"\n    ","\n  </table>\n  <div>",'\n    <input class="button" type="submit" value="Add" onclick="return mjt._eventcb.',
'.apply(this, [event])">\n  </div>',"","",'\n  \n  <div class="cuecard-controlPane-explanation">\n    The query envelope contains directives to the query engine, specifying how to execute the query or how to return the results.\n  </div>\n  <table class="cuecard-controlPane-configurations">',"\n    <tr>\n      <td>","</td>\n      <td>","<input",' name="extended"',' type="checkbox"',">",'<input name="as_of_time" value="','">','<input name="use_permission_of" value="','">','<div class="cuecard-controlPane-configurations-page">\n            <input name="page" type="text">',
'\n            <input class="button" type="submit" value="Previous" onclick="return mjt._eventcb.','.apply(this, [event])">','\n            <input class="button" type="submit" value="Next" onclick="return mjt._eventcb.','.apply(this, [event])">\n          </div>','\n            <div>\n              <input checked="" name="cursor-opt" type="radio" value="">\n              unspecified (return all results, possibly time-out)\n            </div>\n            <div>\n              <input name="cursor-opt" type="radio" value="true">\n              true (start pagination with page size equal "limit" option in query)\n            </div>\n            <div>\n              <input name="cursor-opt" type="radio" value="custom">\n              continue from cursor: \n              <div class="cuecard-controlPane-configurations-cursor">',
'\n                <input name="cursor" type="text" onchange="return mjt._eventcb.','.apply(this, [event])">','\n                <input class="button" type="submit" value="Paste from Last Result" onclick="return mjt._eventcb.','.apply(this, [event])"> ','\n                <input class="button" type="submit" value="Paste &amp; Run" onclick="return mjt._eventcb.','.apply(this, [event])">\n              </div>\n            </div>','<select class="cuecard-controlPane-configurations-languages">\n            <option value="">--</option>',
'\n            <option value="','">'," (",")</option>","\n          </select>",'<select>\n            <option value="">--</option>\n            <option value="html">html</option>\n            <option value="false">false</option>\n          </select>','<select>\n            <option value="">--</option>\n            <option value="soft">soft</option>\n          </select>',"",'\n        <div class="cuecard-controlPane-hint">',"</div>","\n      </td>\n    </tr>","\n  </table>","","",'\n  \n  <table class="cuecard-controlPane-customEnvelope">\n    <tr>\n      <th width="30%">name</th>\n      <th width="50%">value</th>\n      <th></th>\n    </tr>',
'<tr class="cuecard-controlPane-customEnvelope-row"','>\n      <td><input value="','"></td>\n      <td><input value="','"></td>\n      <td>','\n        <input class="button" type="submit" value="Remove" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>',"\n    </tr>","","","\n      ","","","\n      ","","\n  </table>\n  <div>",'\n    <input class="button" type="submit" value="Add" onclick="return mjt._eventcb.','.apply(this, [event])">\n  </div>',"","\n  <div>\n    <input",' type="checkbox"',
">\n    Always clean up query before running\n  </div>\n  <div>\n    <input",' type="checkbox"','>\n    Align JSON property values with spaces\n  </div>\n  <div style="display: none;">\n    <input type="checkbox">\n    Try running query as you edit\n  </div>\n  <div>\n    <input',' type="checkbox"',">\n    Show error messages with multiple lines on multiple lines\n  </div>",""],debug_locs:[1,1,1,1,1,1,7,7,7,7,9,9,10,11,12,13,14,15,16,17,20,20,20,20,20,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,
24,24,24,24,27,27,27,27,27,27,27,27,27,27,27,28,28,28,29,29,29,29,29,29,34,34,34,34,34,34,35,36,37,38,39,40,41,42,44,44,44,44,44,44,46,46,46,46,48,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,76,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,77,77,78,78,78,79,79,79,79,79,79,89,89,89,89,89,89,89,89,89,89,89,89,89,89,92,92,92,92,99,99,99,99,99,99,99,99,99,99,99,99,104,104,104,104,104,104,104,104,104,104,106,106,106,106,106,106,106,107,107,107,111,111,111,111,111,111,111,111,
111,113,113,113,113,113,113,113,116,116,116,116,118,118,119,120,121,122,123,124,125,126,127,128,129,130,131,137,137,137,137,137,137,137,137,137,138,138,138,138,140,140,140,140,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,144,144,144,144,144,146,146,146,146,146,150,150,150,150,150,150,150,150,151,151,151,151,151,151,151,152,152,152,152,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,169,169,169,169,169,169,169,172,172,172,172,
172,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,177,177,177,177,183,183,183,183,183,183,183,188,188,188,188,188,188,191,191,191,191,191,191,191,193,193,193,193,193,193,193,196,196,196,196,196,196,196,199,199,199,199,200,200,201,202,203,211,211,211,211,211,211,211,211,211,211,211,211,211,212,212,212,213,213,213,216,216,216,216,216,216,216,216,218,218,218,218,218,219,220,221,221,222,222,222,222,222,222,222,222,222,222,223,223,225,225,225,226,226,226,226,226,226,226,227,227,227,
228,228,232,232,232,232,232,232,232,232,232,234,234,234,234,234,234,234,237,237,237,237,239,239,239,239,239,239,239,239,239,239,239,239,239,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,254,254,254,254,254,254,254,254,255,255,255,255],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];var g=function(j,h){var k=b.runtime.new_markuplist(),n=0;k[n++]=d[1];var p=[{name:"Tree",key:"tree"},{name:"Text",key:"json"},{name:"Status",key:"status"}];k[n++]=d[2];k[n++]=b.runtime.make_attr_safe(j);k[n++]=
d[3];b.runtime.foreach(this,p,function(o,l){for(var m=1;m;){k[n++]=d[4];k[n++]=b.runtime.make_attr_safe(j);k[n++]=d[5];k[n++]=b.runtime.make_attr_safe(l.key);k[n++]=d[6];k[n++]=l.name;k[n++]=d[7];m--}return m?b.runtime._break_token:b.runtime._continue_token});k[n++]=d[8];b.runtime.foreach(this,p,function(o,l){for(var m=1;m;){k[n++]=d[9];k[n++]=b.runtime.make_attr_safe(j);k[n++]=d[10];k[n++]=b.runtime.make_attr_safe(l.key);k[n++]=d[11];k[n++]=b.runtime.make_attr_safe(l.key);k[n++]=d[12];m--}return m?
b.runtime._break_token:b.runtime._continue_token});k[n++]=d[13];b.runtime.ondomready(function(){h.layout=function(){var o=this._elmt,l=o.innerHeight()-o.find(".section-tab").outerHeight()-(h._options.verticalPadding||12),m=o.find(".section-tabs").innerWidth()-(h._options.horizontalPadding||0),q=l-20,t=m-20;o.find(".cuecard-outputPane-tabBody, .cuecard-outputPane-textarea").height(l).width(m);o.find(".cuecard-outputPane-status, .cuecard-outputPane-tree").css("padding",10).height(q).width(t)};h.layout()},
this);k[n++]=d[14];return k};g=b.runtime.tfunc_factory("tabs(id, outputPane)",g,b,undefined,false);c.tabs=g;g.source_microdata=null;e[f++]=d[15];g=function(j){var h=b.runtime.new_markuplist(),k=0;h[k++]=d[16];if(j["x-metaweb-tid"]){h[k++]=d[17];var n=j["x-metaweb-tid"];h[k++]=d[18];h[k++]=b.runtime.make_attr_safe(encodeURIComponent(n));h[k++]=d[19];h[k++]=n;h[k++]=d[20]}h[k++]=d[21];if(j["x-metaweb-cost"]){h[k++]=d[22];n=j["x-metaweb-cost"].split(",");var p=true;h[k++]=d[23];b.runtime.foreach(this,
n,function(o,l){for(var m=1;m;){h[k++]=d[24];var q=l.split("=");q[0]=q[0].replace(/^\s+/,"").replace(/\s+$/,"");var t=CueCard.XMetawebCosts[q[0]],s=(o%2?"cuecard-outputPane-odd":"cuecard-outputPane-even")+(t!==undefined&&"important"in t&&t.important?" cuecard-outputPane-cost-important":"");h[k++]=d[25];h[k++]=b.runtime.make_attr_safe(s);h[k++]=d[26];h[k++]=q[0];h[k++]=d[27];h[k++]=q[1];h[k++]=d[28];if(t!==undefined){h[k++]=d[29];h[k++]=t.meaning;h[k++]=d[30]}else h[k++]=d[31];h[k++]=d[32];if(t!==
undefined){h[k++]=d[33];h[k++]=t.subsystem;h[k++]=d[34]}else h[k++]=d[35];h[k++]=d[36];m--}return m?b.runtime._break_token:b.runtime._continue_token});h[k++]=d[37]}h[k++]=d[38];p=true;h[k++]=d[39];b.runtime.foreach(this,j,function(o,l){for(var m=1;m;){if(o!="x-metaweb-cost"&&o!="x-metaweb-tid"){h[k++]=d[40];var q=p?{"class":"cuecard-outputPane-odd"}:{"class":"cuecard-outputPane-even"};for(var t in q){h[k++]=" "+t;h[k++]=b.runtime.bless('="');h[k++]=b.runtime.htmlencode(""+q[t]);h[k++]=b.runtime.bless('"')}h[k++]=
d[41];h[k++]=o;h[k++]=d[42];h[k++]=l;h[k++]=d[43];p=!p;h[k++]=d[44]}m--}return m?b.runtime._break_token:b.runtime._continue_token});h[k++]=d[45];return h};g=b.runtime.tfunc_factory("status(headers)",g,b,undefined,false);c.status=g;g.source_microdata=null;e[f++]=d[46];return e};a.source_microdata=null;return a}(),info:{file:"//3a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",stringtable:["","",'\n  \n  <div class="cuecard-outputPane section-tabs">\n    <div id="','">\n      <ul class="section-tabset clear">',
'\n        <li class="section-tab tab">\n          <a href="#',"-",'"><span>',"</span></a>\n        </li>",'\n      </ul>\n      <div class="tabbed-content">','\n        <div class="cuecard-outputPane-tabBody" id="',"-",'">\n          <div class="cuecard-outputPane-','"></div>\n        </div>',"\n      </div>\n    </div>\n  </div>","","",'\n  <div class="cuecard-outputPane-responseHeaders">',"",'\n      <h3>x-metaweb-tid (transaction ID)</h3>\n      <div>\n        <a href="http://stats.metaweb.com/query/transaction?tid=',
'" target="_blank">\n          ',"\n        </a>\n      </div>","","","\n      <h3>x-metaweb-cost header components</h3>\n      <table>\n        <tr><th>code</th><th>value</th><th>meaning</th><th>subsystem</th></tr>","",'\n          <tr class="','">\n            <td>',"</td>\n            <td>","</td>","\n            <td>","</td>","<td>--</td>","","\n            <td>","</td>","<td>--</td>","\n          </tr>","\n      </table>","\n\n    <h3>response headers</h3>\n    <table>","","\n        <tr",">\n          <td>",
"</td>\n          <td>","</td>\n        </tr>","","\n    </table>\n\n  </div>",""],debug_locs:[1,1,1,1,1,1,6,6,6,6,8,8,9,10,11,12,13,14,17,17,17,17,17,19,19,19,19,19,20,20,20,20,20,20,20,20,21,21,21,21,21,21,24,24,24,24,24,24,24,24,24,24,24,25,25,25,26,26,26,26,26,26,31,31,31,31,31,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,48,48,48,48,48,48,50,50,50,50,53,53,53,54,54,57,57,57,57,57,58,58,58,61,61,61,61,63,63,64,64,65,66,67,71,71,71,71,71,71,71,72,72,73,74,75,76,77,78,78,78,79,79,79,80,80,80,
81,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,82,82,84,84,84,84,84,84,86,86,86,90,90,90,90,90,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,93,93,93,94,94,94,96,96,96,98,98,98,98,98,98,102,102,102,102,102,102,102,102,102,103,103,103,103],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
