
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
["mjt/header.js","mjt/json2.js","mjt/util.js","mjt/task.js","mjt/pager.js","mjt/browserio.js","mjt/crc32.js","mjt/jsonp.js","mjt/xhr.js","mjt/freebase_api.js","mjt/freebase_isodate.js","mjt/freebase_misc.js","mjt/freebase_mqlkey.js","mjt/freebase_xhr.js","mjt/markup.js","mjt/eval.js","mjt/template.js","mjt/linker.js","mjt/runtime.js","mjt/compile.js","mjt/pageapp.js","mjt/mjtjquery.js"](function(b){function a(f,e){var g=this,j=f.add(g),h=b(window),l,o,r,n=b.tools.expose&&(e.mask||e.expose),k=Math.random().toString().slice(10);
if(n){if(typeof n=="string")n={color:n};n.closeOnClick=n.closeOnEsc=false}var m=e.target||f.attr("rel");o=m?b(m):f;if(!o.length)throw"Could not find Overlay: "+m;f&&f.index(o)==-1&&f.click(function(p){g.load(p);return p.preventDefault()});b.extend(g,{load:function(p){if(g.isOpened())return g;var s=c[e.effect];if(!s)throw'Overlay: cannot find effect : "'+e.effect+'"';e.oneInstance&&b.each(d,function(){this.close(p)});p=p||b.Event();p.type="onBeforeLoad";j.trigger(p);if(p.isDefaultPrevented())return g;
r=true;n&&b(o).expose(n);var t=e.top,v=e.left,u=o.outerWidth({margin:true}),y=o.outerHeight({margin:true});if(typeof t=="string")t=t=="center"?Math.max((h.height()-y)/2,0):parseInt(t,10)/100*h.height();if(v=="center")v=Math.max((h.width()-u)/2,0);s[0].call(g,{top:t,left:v},function(){if(r){p.type="onLoad";j.trigger(p)}});n&&e.closeOnClick&&b.mask.getMask().one("click",g.close);e.closeOnClick&&b(document).bind("click."+k,function(z){b(z.target).parents(o).length||g.close(z)});e.closeOnEsc&&b(document).bind("keydown."+
k,function(z){z.keyCode==27&&g.close(z)});return g},close:function(p){if(!g.isOpened())return g;p=p||b.Event();p.type="onBeforeClose";j.trigger(p);if(!p.isDefaultPrevented()){r=false;c[e.effect][1].call(g,function(){p.type="onClose";j.trigger(p)});b(document).unbind("click."+k).unbind("keydown."+k);n&&b.mask.close();return g}},getOverlay:function(){return o},getTrigger:function(){return f},getClosers:function(){return l},isOpened:function(){return r},getConf:function(){return e}});b.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),
function(p,s){b.isFunction(e[s])&&b(g).bind(s,e[s]);g[s]=function(t){b(g).bind(s,t);return g}});l=o.find(e.close||".close");if(!l.length&&!e.close){l=b('<a class="close"></a>');o.prepend(l)}l.click(function(p){g.close(p)});e.load&&g.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(f,e,g){c[f]=[e,g]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||b.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,
speed:"normal",target:null,top:"10%"}};var d=[],c={};b.tools.overlay.addEffect("default",function(f,e){var g=this.getConf(),j=b(window);if(!g.fixed){f.top+=j.scrollTop();f.left+=j.scrollLeft()}f.position=g.fixed?"fixed":"absolute";this.getOverlay().css(f).fadeIn(g.speed,e)},function(f){this.getOverlay().fadeOut(this.getConf().closeSpeed,f)});b.fn.overlay=function(f){var e=this.data("overlay");if(e)return e;if(b.isFunction(f))f={onBeforeLoad:f};f=b.extend(true,{},b.tools.overlay.conf,f);this.each(function(){e=
new a(b(this),f);d.push(e);b(this).data("overlay",e)});return f.api?e:this}})(jQuery);
"CueCard"in window||function(){window.CueCard={loaded:false,version:"trunk",loadingScriptsCount:0,error:null,helper:"http://www.freebase.com/cuecard/",apiProxy:{base:"http://www.freebase.com/cuecard/",read:"mqlread?",write:"mqlwrite?"},freebaseServiceUrl:"http://www.freebase.com/",params:{bundle:true,externals:true}};CueCard.findScript=function(a,d){for(var c=a.documentElement.getElementsByTagName("head"),f=0;f<c.length;f++)for(var e=c[f].firstChild;e!=null;){if(e.nodeType==1&&e.tagName.toLowerCase()==
"script"){var g=e.src;if(g.indexOf(d)>=0)return g}e=e.nextSibling}return null};CueCard.parseURLParameters=function(a,d,c){d=d||{};c=c||{};if(typeof a=="undefined")a=location.href;var f=a.indexOf("?");if(f<0)return d;a=(a+"#").slice(f+1,a.indexOf("#"));var e=a.split("&"),g;a={};var j=window.decodeURIComponent||unescape;for(f=0;g=e[f];f++){var h=g.indexOf("="),l=j(g.slice(0,h).replace(/\+/g," ")),o=a[l];if(typeof o=="undefined")o=[];else o instanceof Array||(o=[o]);a[l]=o.concat(j(g.slice(h+1).replace(/\+/g,
" ")))}for(f in a)if(a.hasOwnProperty(f)){e=c[f]||String;g=a[f];g instanceof Array||(g=[g]);d[f]=e===Boolean&&g[0]=="false"?false:e.apply(this,g)}return d};if(typeof CueCard_urlPrefix=="string")CueCard.urlPrefix=CueCard_urlPrefix;else{var b=CueCard.findScript(document,"cuecard-api.js");if(b==null){CueCard.error=new Error("Failed to derive URL prefix for CueCard API code files");return}CueCard.urlPrefix=b.substr(0,b.indexOf("cuecard-api.js"))}CueCard.parseURLParameters(b,CueCard.params,{bundle:Boolean,
externals:Boolean});CueCard.loaded=true}();
CueCard.createComposition=function(b){var a=new CueCard.QueryEditor(b.queryEditorElement,b.queryEditorOptions),d=null,c=null;if("outputPaneElement"in b){d=b.outputPaneOptions||{};d.queryEditor=a;d=new CueCard.OutputPane(b.outputPaneElement,d);a.setOutputPane(d)}if("controlPaneElement"in b){c=b.controlPaneOptions||{};c.queryEditor=a;if(d!=null)c.outputPane=d;c=new CueCard.ControlPane(b.controlPaneElement,c);a.setControlPane(c)}return{queryEditor:a,outputPane:d,controlPane:c}};
CueCard.showDialog=function(b){var a=Array.prototype.slice.call(arguments);a.shift();var d=$("<div id='dialog-"+b+"' class='modal'></div>").acre(fb.acre.apps.cuecard+"/dialogs.mjt",b,a);$(document.body).append(d.hide());d.overlay({load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5},close:".modal-buttons .button",closeOnClick:false,onClose:function(){d.remove()}})};CueCard.MqlSyntax={};
CueCard.MqlSyntax.KeywordSuggestions=[{label:"*",hint:"(keyword)",qualifiedProperty:"*",result:"*"},{label:"connect",hint:"(keyword)",qualifiedProperty:"connect",result:"connect"},{label:"create",hint:"(keyword)",qualifiedProperty:"create",result:"create"},{label:"estimate-count",hint:"(keyword)",qualifiedProperty:"estimate-count",result:"estimate-count"},{label:"limit",hint:"(keyword)",qualifiedProperty:"limit",result:"limit"},{label:"optional",hint:"(keyword)",qualifiedProperty:"optional",result:"optional"},
{label:"return",hint:"(keyword)",qualifiedProperty:"return",result:"return"},{label:"sort",hint:"(keyword)",qualifiedProperty:"sort",result:"sort"}];
CueCard.MqlSyntax.KeywordValueHints={"*":{choices:[{label:"null",hint:"return a single value",result:null},{label:"[]",hint:"return a list of values",result:[],offset:1},{label:"{}",hint:"return a single object",result:{},offset:1},{label:"[{}]",hint:"return a list of objects",result:[{}],offset:2}]},connect:{choices:[{label:"insert",hint:"attach a value or object to a non-unique property, or attach the first value or object to a unique property",result:"insert"},{label:"update",hint:"attach a value or object to a unique property replacing any value or object that was previously connected",
result:"update"},{label:"replace",hint:"update unique properties and performs an insert for non-unique properties",result:"replace"},{label:"delete",hint:"detach a value or object from any property",result:"delete"}]},create:{choices:[{label:"unless_exists",hint:"look for a matching object and create it if it doesn't exist",result:"unless_exists"},{label:"unless_connected",hint:"look for a matching object connected to the parent query, and create and connect it if it doesn't exist",result:"unless_connected"},
{label:"unconditional",hint:"create the specified object without looking for a match (dangerous; ues carefully)",result:"unconditional"}]},"estimate-count":{choices:[{label:"null",hint:"(keyword)",result:null}]},limit:{html:'Use a positive integer to limit how many results to return, or <span class="cuecard-code">0</span> for all available results.'},optional:{choices:[{label:"true",hint:"(keyword)",result:true},{label:"false",hint:"(keyword)",result:false},{label:"required",hint:"(keyword)",result:"required"},
{label:"forbidden",hint:"(keyword)",result:"forbidden"}]},"return":{choices:[{label:"count",hint:"(keyword)",result:"count"},{label:"estimate-count",hint:"(keyword)",result:"estimate-count"}]},sort:{html:'Use a property name in the same query node. Prefix it with <span class="cuecard-code">-</span> to sort in descending order. For more complex ordering, see <a href="">this documentation</a>.'}};
CueCard.MqlSyntax.UniqueTopicValueSuggestions=[{label:"null",hint:"returns a single topic ID",result:null},{label:"{}",hint:"returns a single topic object with a default set of properties",result:{},offset:1},{label:'{ "id" : null, "name" : null }',hint:"returns a single topic object with id and name",result:{id:null,name:null}}];
CueCard.MqlSyntax.TopicValueSuggestions=[{label:"[]",hint:"returns a list of topic IDs or topic names",result:[],offset:1},{label:"[{}]",hint:"returns a list of topic objects with a default set of properties",result:[{}],offset:2},{label:'[{ "id" : null, "name" : null, "optional" : true, "limit" : 10 }]',hint:"returns an optional, limited list of topic objects with id and name",result:[{id:null,name:null,optional:true,limit:10}]}];
CueCard.MqlSyntax.SingleValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "type" : null }',hint:"returns a value with type",result:{value:null,type:null}}];CueCard.MqlSyntax.UniqueStringLiteralValueSuggestions=[{label:"null",hint:"returns a single string",result:null},{label:'{ "value" : null, "lang" : null, "optional" : true }',hint:"returns a single string with more options",result:{value:null,lang:null,optional:true}}];
CueCard.MqlSyntax.StringLiteralValueSuggestions=[{label:"[]",hint:"returns a list of strings",result:null},{label:'[{ "value" : null, "lang" : null, "optional" : true }]',hint:"returns a list of strings with more options",result:[{value:null,lang:null,optional:true}]}];CueCard.MqlSyntax.UniqueLiteralValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "optional" : true }',hint:"returns a single value with more options",result:{value:null,optional:true}}];
CueCard.MqlSyntax.LiteralValueSuggestions=[{label:"[]",hint:"returns a list of values",result:null},{label:'[{ "value" : null, "optional" : true }]',hint:"returns a list of values with more options",result:[{value:null,optional:true}]}];CueCard.SerializingContext=function(b){this._parent=b;this._root=b==null?this:b.getRoot();this._properties={}};
CueCard.SerializingContext.prototype={getProperty:function(b){return b in this._properties?this._properties[b]:this._parent!=null?this._parent.getProperty(b):null},setProperty:function(b,a){this._properties[b]=a},getRoot:function(){return this._root},getRootProperty:function(b){return this.getRoot().getProperty(b)},setRootProperty:function(b,a){return this.getRoot().setProperty(b,a)},create:function(){return new SerializingContext(this)}};
CueCard.IndentWriter=function(b){this._context=b;this._stream=b.getProperty("stream")};
CueCard.IndentWriter.prototype={appendLineBreak:function(){this._stream.append("\n")},appendIndent:function(){for(var b=this._context.getRootProperty("indentLevel"),a=this._context.getRootProperty("indentString"),d=0;d<b;d++)this._stream.append(a)},indent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")+1)},unindent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")-1)},append:function(b){this._stream.append(b)}};
(function(){function b(g){return/["\\\x00-\x1f]/.test(g)?g.replace(/([\x00-\x1f\\"])/g,function(j,h){var l=f[h];if(l)return l;l=h.charCodeAt();return"\\u00"+Math.floor(l/16).toString(16)+(l%16).toString(16)}):g}function a(g){return g!=null&&typeof g=="object"&&!(g instanceof Array)&&!("__identifier__"in g)}function d(g){for(var j in g)if(g.hasOwnProperty(j))return true;return false}function c(g){return g.length==0||g.length==1&&a(g[0])&&!d(g[0])}var f={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},e=CueCard.jsonize=function(g,j){j=j?j:{};var h="",l="quoteAllFieldNames"in j?j.quoteAllFieldNames:true,o="variables"in j?j.variables:{},r="resolveVariables"in j?j.resolveVariables:false;if("context"in j)var n=new CueCard.SerializingContext(j.context);else{var k="indentCount"in j?j.indentCount:4,m="";for(n=0;n<k;n++)m+=" ";n=new CueCard.SerializingContext(null);n.setProperty("indentCount",k);n.setProperty("indentString",m);n.setProperty("indentLevel",0);
n.setProperty("stream",{append:function(p){h+=p}})}n.setProperty("omitWhitespace","omitWhitespace"in j?j.omitWhitespace:false);n.setProperty("maxFieldLength","maxFieldLength"in j?j.maxFieldLength:15);n.setProperty("breakLines","breakLines"in j?j.breakLines:true);n.setProperty("alignFieldValues","alignFieldValues"in j?j.alignFieldValues:true);n.setProperty("collapseSingleObjectArray","collapseSingleObjectArray"in j?j.collapseSingleObjectArray:true);n.setProperty("variables",o);n.setProperty("resolveVariables",
r);n.setProperty("encodeJavascriptString","encodeJavascriptString"in j?j.encodeJavascriptString:b);n.setRootProperty("fieldNameEncoder",{_m:{},encode:function(p){if(p in this._m)return this._m[p];else{var s=b(p);return this._m[p]=s=l||/\W/.test(s)?'"'+s+'"':s}}});n.setProperty("path",[]);n.setRootProperty("contextualize","contextualize"in j?j.contextualize:function(p){return p});o=new CueCard.IndentWriter(n);e.converters.anything(g,n,o);return h};e.converters={anything:function(g,j,h){if(g==null)e.converters["null"](g,
j,h);else if(g instanceof Array)e.converters.array(g,j,h);else g instanceof Object?e.converters.object(g,j,h):e.converters[typeof g](g,j,h)},array:function(g,j,h){var l=j.getProperty("omitWhitespace"),o=j.getProperty("breakLines");if(g.length==0)h.append("[]");else{if(g.length==1)if(a(g[0]))if(d(g[0])){if(j.getProperty("collapseSingleObjectArray")){h.append("[");var r=g[0];e.converters.object(r,j,h);h.append("]");return}}else{h.append("[{}]");return}h.append("[");if(o){h.appendLineBreak();h.indent()}else l||
h.append(" ");for(var n=g.length,k=0;k<n;k++){r=g[k];var m=e.converters[r==null?"null":typeof r];if(m){o&&h.appendIndent();m(r,j,h);k<n-1&&h.append(",");if(o)h.appendLineBreak();else l||h.append(" ")}}if(o){h.unindent();h.appendIndent()}h.append("]")}},"boolean":function(g,j,h){h.append(String(g))},"null":function(g,j,h){h.append("null")},undefined:function(g,j,h){h.append("undefined")},number:function(g,j,h){h.append(isFinite(g)?String(g):"null")},object:function(g,j,h){if(g instanceof Array)e.converters.array(g,
j,h);else if("__identifier__"in g){g=g.__identifier__;var l=j.getProperty("resolveVariables"),o=j.getProperty("variables");if(g in o)if(l){l=o[g];e.converters.anything(l,j,h)}else h.append(g);else e.converters.anything(g,j,h)}else{o=j.getRootProperty("contextualize");var r=j.getProperty("path"),n=j.getProperty("omitWhitespace"),k=j.getProperty("breakLines"),m=j.getProperty("alignFieldValues");h.append("{");if(k){h.appendLineBreak();h.indent()}else n||h.append(" ");var p=0,s=0,t=j.getRootProperty("fieldNameEncoder");
for(var v in g)if(g.hasOwnProperty(v)){l=g[v];p++;if(!a(l)&&(!(l!=null&&l instanceof Array)||c(l)))s=Math.max(s,t.encode(v).length)}s=Math.min(s,j.getProperty("maxFieldLength"));for(v in g)if(g.hasOwnProperty(v)){l=g[v];var u=e.converters[l==null?"null":typeof l],y=t.encode(v);k&&h.appendIndent();h.append(y);h.append(n?":":": ");if(!n&&k&&m&&!a(l)&&(!(l!=null&&l instanceof Array)||c(l)))for(y=y.length;y<s;y++)h.append(" ");r.unshift({field:v});u(l,o(j,r),h);r.shift();p--;p>0&&h.append(",");if(k)h.appendLineBreak();
else n||h.append(" ")}if(k){h.unindent();h.appendIndent()}h.append("}")}},string:function(g,j,h){h.append('"'+j.getProperty("encodeJavascriptString")(g)+'"')},"null":function(g,j,h){h.append("null")}}})();CueCard.JsonpQueue={pendingCallIDs:{},callInProgress:0};CueCard.JsonpQueue.cancelAll=function(){CueCard.JsonpQueue.pendingCallIDs={}};
CueCard.JsonpQueue.call=function(b,a,d,c){if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="progress";CueCard.JsonpQueue.callInProgress++;var f=(new Date).getTime()+"x"+Math.floor(Math.random()*1E3),e=document.createElement("script");e.setAttribute("onerror","err"+f+"();");b+=(b.indexOf("?")<0?"?":"&")+"callback=cb"+f;e.setAttribute("src",b);var g=function(){CueCard.JsonpQueue.callInProgress--;if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="auto";c||e.parentNode.removeChild(e);
try{delete window["cb"+f];delete window["err"+f]}catch(j){window["cb"+f]=undefined;window["err"+f]=undefined}if(f in CueCard.JsonpQueue.pendingCallIDs){delete CueCard.JsonpQueue.pendingCallIDs[f];return true}else return false};window["cb"+f]=function(j){if(g())try{a(j)}catch(h){}};window["err"+f]=function(){if(g())if(typeof d=="function")try{d(b)}catch(j){}};CueCard.JsonpQueue.pendingCallIDs[f]=true;document.getElementsByTagName("head")[0].appendChild(e)};
CueCard.JsonpQueue.queryOne=function(b,a,d,c){CueCard.JsonpQueue.queryOneEnvelope({query:b},a,d,c)};CueCard.JsonpQueue.queryOneEnvelope=function(b,a,d,c){b=CueCard.jsonize({q1:b},{breakLines:false});b=CueCard.freebaseServiceUrl+"api/service/mqlread?queries="+encodeURIComponent(b);CueCard.JsonpQueue.call(b,function(f){if(f.q1.code=="/api/status/error")typeof d=="function"&&d(f.q1);else a(f.q1)},function(){typeof d=="function"&&d("Unknown")},c)};CueCard.QueryParser={};
CueCard.QueryParser.parseForContext=function(b,a,d,c){var f=new CueCard.QueryTokenizer(b,a),e=f.token(),g=[],j=CueCard.Token.Types,h=function(){e=g.length==0?f.next():g.shift()},l=function(q){if(q==0)return e;else{for(;q>g.length;)g.push(f.next());return g[q-1]}},o=function(){for(;e!=null&&(e.type==j.whitespace||e.type==j.unrecognized);)h()},r=function(q){return new CueCard.Token(CueCard.Token.Types.phantom,"",q.start,q.start)},n=function(){return e!=null?e:new CueCard.Token(CueCard.Token.Types.phantom,
"",f.index(),f.index())},k=function(){var q=new CueCard.QueryNode(CueCard.QueryNode.TYPE_MISSING);q.startToken=q.endToken=r(n());return q},m=function(q){q=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL);q.startToken=e;for(e!=null&&e.type==j.delimiter&&e.content=="{"&&h();e!=null;){o();if(e==null)break;var w=null,B=null,C=null;if(e.type==j.identifier){w=e.content;B=e;h();o()}else if(e.type==j.stringLiteral){w=e.content.replace(/^['"]/,"").replace(/['"]$/,"");B=e;h();o()}else B=r(e);if(e!=
null&&e.type==j.delimiter&&(e.content==":"||e.content==";")){h();o()}if(e!=null)C=t(false);if(w!=null||C!=null){w=new CueCard.QueryNodeLink(w!=null?w:"",B);w.value=C!=null?C:k();q.links.push(w)}o();if(e==null||e.type==j.delimiter&&(e.content=="}"||e.content=="]"))break;e.type==j.delimiter&&e.content==","&&h()}if(e!=null&&e.type==j.delimiter&&e.content=="}"){q.endToken=e;h()}if(q.endToken==null)q.endToken=n();return q},p=function(){var q=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY);
q.startToken=e;q.elements=[];for(e!=null&&e.type==j.delimiter&&e.content=="["&&h();e!=null;){o();if(e==null||e.type==j.delimiter&&e.content=="]")break;q.elements.push(m());o();e!=null&&e.type==j.delimiter&&e.content==","&&h()}if(e!=null&&e.type==j.delimiter&&e.content=="]"){q.endToken=e;h()}if(q.endToken==null)q.endToken=n();return q},s=function(){for(var q=1,w;(w=l(q))!=null&&(w.type==j.whitespace||w.type==j.unrecognized);)q++;if(w!=null)if(w.type==j.delimiter&&w.content=="{")return p();else if(w.type==
j.identifier||w.type==j.stringLiteral){for(q++;(w=l(q))!=null&&(w.type==j.whitespace||w.type==j.unrecognized);)q++;if(w!=null&&w.type==j.delimiter&&w.content==":")return p()}q=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);q.startToken=e;q.isArray=true;q.value=[];for(e!=null&&e.type==j.delimiter&&e.content=="["&&h();e!=null;){o();if(e==null||e.type==j.delimiter&&e.content=="]")break;w=t(false);if(w==null)break;q.value.push(w);o();e!=null&&e.type==j.delimiter&&e.content==","&&h()}if(e!=null&&
e.type==j.delimiter&&e.content=="]"){q.endToken=e;h()}if(q.endToken==null)q.endToken=n();return q},t=function(q){o();if(e==null)q=k();else{if(e.type==j.delimiter)q=e.content=="["?s():e.content=="{"?m():k();else{if(q)q=p();else a:{q=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);q.startToken=q.endToken=e;q.isArray=false;if(e.type==j.numberLiteral)q.value=parseFloat(e.content);else if(e.type==j.stringLiteral)q.value=e.content.replace(/^['"]/,"").replace(/['"]$/,"");else if(e.type==j.booleanLiteral)q.value=
e.content=="true"||e.content=="True";else if(e.type==j.nullLiteral)q.value=null;else if(e.type==j.delimiter){q=null;break a}else q.value=e.content;h();q=q}q=q}q=q}return q},v=function(q){return d<q.start.line||d==q.start.line&&c<=q.start.col},u=function(q){return d>q.start.line||d==q.start.line&&c>=q.start.col},y=function(q){return d<q.end.line||d==q.end.line&&c<=q.end.col};v=function(q){return d<q.start.line||d==q.start.line&&c<=q.start.col};var z=function(q){return q.startToken==q.endToken?u(q.startToken)&&
y(q.startToken):u(q.startToken)&&v(q.endToken)},A=function(q,w){if(q.type==CueCard.QueryNode.TYPE_TERMINAL)if(q.isArray){for(var B=0;B<q.value.length;B++){var C=q.value[B];if(v(C.startToken)){w.push({child:B,relative:"before",node:q});return}else if(z(C)){w.push({child:B,relative:"inside",node:q});A(C,w);return}}w.push({child:q.value.length,relative:"before",node:q})}else w.push({token:q.startToken,node:q,offset:c-q.startToken.start.col});else if(q.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){for(B=
0;B<q.elements.length;B++){C=q.elements[B];if(v(C.startToken)){w.push({child:B,relative:"before",node:q});return}else if(z(C)){w.push({child:B,relative:"inside",node:q});A(C,w);return}}w.push({child:q.elements.length,relative:"before",node:q})}else if(q.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(B=0;B<q.links.length;B++){C=q.links[B];if(v(C.token)){w.push({child:B,relative:"before",node:q});return}else if(y(C.token)){w.push({child:B,relative:"path",node:q,offset:c-C.token.start.col});return}else if(u(C.value.startToken)){if(y(C.value.endToken)){w.push({child:B,
relative:"inside",node:q});A(C.value,w);return}}else{w.push({child:B,relative:"space",node:q});return}}w.push({child:q.links.length,relative:"before",node:q})}else w.push({token:q.startToken,node:q})};o();b={model:t(true),context:[]};A(b.model,b.context);return b};CueCard.QueryTokenizer=function(b,a){this._text=b+" ";this._maxIndex=b.length;this._index=a;this._col=this._line=0;this.next()};CueCard.QueryTokenizer.prototype.token=function(){return this._token};
CueCard.QueryTokenizer.prototype.index=function(){return this._index};CueCard.QueryTokenizer._whitespaces=" \t\r\n";
CueCard.QueryTokenizer.prototype.next=function(){this._token=null;if(this._index<this._maxIndex){var b=this._text.charAt(this._index),a=this._text.charAt(this._index+1),d=this,c=function(){d._index++;d._col++},f=function(){return new CueCard.TokenPos(d._index,d._line,d._col)},e=function(){var r=f();c();return r},g=function(r,n,k){var m=f();d._pos=m;d._token=new CueCard.Token(r,k||d._text.substring(n.offset,m.offset),n,m)},j=function(){for(var r=f();d._index<d._maxIndex;){var n=d._text.charAt(d._index);
if(CueCard.QueryTokenizer._whitespaces.indexOf(n)<0)break;if(n=="\n"){d._line++;d._col=0}else d._col++;d._index++}g(CueCard.Token.Types.whitespace,r)},h=function(r){var n=f();b=="u"&&c();c();for(var k="";d._index<d._maxIndex;){b=d._text.charAt(d._index);if(b==r){c();break}else if(b=="\r"||b=="\n")break;if(b=="\\"){c();k+=d._text.charAt(d._index)}else k+=b;c()}g(CueCard.Token.Types.stringLiteral,n,k)},l=function(){var r=f();if(b=="+")c();else b=="-"&&c();for(;d._index<d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c();
if(d._index<d._maxIndex&&d._text.charAt(d._index)==".")for(c();d._index<d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c();if(d._index<d._maxIndex&&d._text.charAt(d._index)=="e"){c();b=d._text.charAt(d._index);if(b=="+"||b=="-")c();for(;d._index<d._maxIndex&&CueCard.QueryTokenizer._isDigit(d._text.charAt(d._index));)c()}g(CueCard.Token.Types.numberLiteral,r)},o=function(){for(var r=f();d._index<d._maxIndex&&CueCard.QueryTokenizer._identifierPrefix.indexOf(d._text.charAt(d._index))>=
0;)c();var n=false;if(d._index<d._maxIndex-2){var k=d._text.substr(d._index,2);if(k==">="||k=="<="||k=="~="){c();c();n=true}}if(!n&&d._index<d._maxIndex-1){k=d._text.substr(d._index,1);if(k==">"||k=="<")c()}n=f();k=d._text.substring(r.offset,n.offset);d._pos=n;d._token=k=="null"||k=="None"?new CueCard.Token(CueCard.Token.Types.nullLiteral,k,r,n):k=="true"||k=="True"||k=="false"||k=="False"?new CueCard.Token(CueCard.Token.Types.booleanLiteral,k,r,n):new CueCard.Token(CueCard.Token.Types.identifier,
k,r,n)};if(CueCard.QueryTokenizer._whitespaces.indexOf(b)>=0)j();else if("[{}],:".indexOf(b)>=0)g(CueCard.Token.Types.delimiter,e());else if(b=='"'||b=="'")h(b);else if(b=="u"&&(a=='"'||a=="'"))h(a);else if(b=="-"||b=="+"||CueCard.QueryTokenizer._isDigit(b))l();else if(b=="*")g(CueCard.Token.Types.identifier,e());else CueCard.QueryTokenizer._identifierPrefix.indexOf(b)>=0?o():g(CueCard.Token.Types.unrecognized,e())}return this._token};
CueCard.QueryTokenizer._isDigit=function(b){return"0123456789".indexOf(b)>=0};CueCard.QueryTokenizer._identifierPrefix="#!/_-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";CueCard.TokenPos=function(b,a,d){this.offset=b;this.line=a;this.col=d};CueCard.Token=function(b,a,d,c){this.type=b;this.content=a;this.start=d;this.end=c};CueCard.Token.Types={unrecognized:-1,phantom:0,whitespace:1,delimiter:2,nullLiteral:3,numberLiteral:4,stringLiteral:5,booleanLiteral:6,identifier:7};
CueCard.QueryNode=function(b){this.type=b;this.value=null;this.isArray=false;this.endToken=this.startToken=null;this.links=[]};CueCard.QueryNode.TYPE_MISSING=-1;CueCard.QueryNode.TYPE_TERMINAL=0;CueCard.QueryNode.TYPE_NONTERMINAL=1;CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY=2;CueCard.QueryNode.prototype.toQueryJson=function(b){b=b||{};if(!("qualifyAllProperties"in b))b.qualifyAllProperties=false;if(!("excludeChild"in b))b.excludeChild=-1;return this._toQueryJson(b)};
CueCard.QueryNode.prototype._toQueryJson=function(b){var a={qualifyAllProperties:b.qualifyAllProperties,excludeChild:-1};if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray){b=[];for(var d=0;d<this.value.length;d++){var c=this.value[d];b.push(c!=null?c._toQueryJson(a):null)}return b}else return this.startToken.type==CueCard.Token.Types.identifier?{__identifier__:this.value}:this.value;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){b=[];for(d=0;d<this.elements.length;d++)b.push(this.elements[d]._toQueryJson(a));
return b}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){c={};var f=false,e=0;for(d=0;d<this.links.length;d++)if(d!=b.excludeChild){var g=this.links[d];if(g.path.length>0){var j=g.getPath(b.qualifyAllProperties);if(j in c&&g.namespace.length==0)for(;j in c;){g.namespace="ns"+e++ +":";j=g.getPath(b.qualifyAllProperties)}var h=g.value!=null?g.value._toQueryJson(a):null;c[j]=h;if(g.getUnnamespacedQualifiedPath()=="/type/object/type"&&h!=null&&(!(h instanceof Array)||h.length>0))f=true}}if(!f&&
"expectedTypes"in b&&b.expectedTypes.length>0){a=[];for(d=0;d<b.expectedTypes.length;d++){f=b.expectedTypes[d];f!="/type/object"&&f!="/common/topic"&&a.push(f)}if(a.length==1)c.type=a[0];else if(a.length>1)c["type|="]=a}return c}else return null};CueCard.QueryNode.isMqlKeyword=function(b){switch(b){case "limit":case "sort":case "*":case "return":case "count":case "estimate-count":case "optional":case "create":case "connect":return true}return false};
CueCard.QueryNode.prototype.getDeclaredTypes=function(b){var a=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)a=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)a=this.elements[0].links;if(a!=null)for(var d=0;d<a.length;d++){var c=a[d];c.qualifiedProperty=="/type/object/type"&&!c.reverse&&c.getValuesOfType(b,"string")}};
CueCard.QueryNode.prototype.getDeclaredIDs=function(b){var a=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)a=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)a=this.elements[0].links;if(a!=null)for(var d=0;d<a.length;d++){var c=a[d];c.qualifiedProperty=="/type/object/id"&&!c.reverse&&c.getValuesOfType(b,"string")}};
CueCard.QueryNode.prototype.getDeclaredGUIDs=function(b){var a=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)a=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)a=this.elements[0].links;if(a!=null)for(var d=0;d<a.length;d++){var c=a[d];c.qualifiedProperty=="/type/object/guid"&&!c.reverse&&c.getValuesOfType(b,"string")}};CueCard.QueryNode.prototype.qualifyAllProperties=function(b){this._qualifyAllProperties([],{},b)};
CueCard.QueryNode.prototype._qualifyAllProperties=function(b,a,d){if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var c=[],f=false,e=[],g=[],j=[],h=0;h<this.links.length;h++){var l=this.links[h];if(l.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||l.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY||l.value.type==CueCard.QueryNode.TYPE_MISSING)c.push(l);if(l.qualifiedProperty=="/type/object/type"&&!l.reverse)l.getValuesOfType(e,"string");else if(l.qualifiedProperty=="/type/object/id"&&!l.reverse)l.getValuesOfType(g,
"string");else if(l.qualifiedProperty=="/type/object/guid"&&!l.reverse)l.getValuesOfType(j,"string");else if(l.qualifiedProperty!=null&&l.qualifiedProperty.length>0){var o=l.qualifiedProperty.lastIndexOf("/");o>0&&e.push(l.qualifiedProperty.substr(0,o))}else CueCard.QueryNode.isMqlKeyword(l.property)||(f=true)}e=e.concat(b);l={};for(h=e.length-1;h>=0;h--)l[e[h]]=true;e=[];for(var r in l)e.push(r);if(!f&&c.length==0)d.onDone(a);else{var n=this;f=[];e.length>0&&f.push("t="+encodeURIComponent(e.join(",")));
g.length>0&&f.push("i="+encodeURIComponent(g.join(",")));j.length>0&&f.push("g="+encodeURIComponent(j.join(",")));e=CueCard.helper+"qualify-properties?"+f.join("&");CueCard.JsonpQueue.call(e,function(m){var p=m.properties;m=m.qualifications;for(var s=0;s<n.links.length;s++){var t=n.links[s];if(t.qualifiedProperty.length==0&&!CueCard.QueryNode.isMqlKeyword(t.property))t.qualifiedProperty=m[t.property]||t.property}for(var v in p)a[v]=p[v];(function(){if(c.length==0)d.onDone(a);else{var u=c.shift(),
y=[];if(u.qualifiedProperty in p)for(var z=p[u.qualifiedProperty].expectedTypes,A=0;A<z.length;A++)y.push(z[A].id);y.push("/common/topic");y.push("/type/object");if(u.value.type==CueCard.QueryNode.TYPE_NONTERMINAL)u.value.expectedTypes=y;else if(u.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){z=u.value.elements;for(A=0;A<z.length;A++)z[A].expectedTypes=y}u.value._qualifyAllProperties(y,a,{onDone:arguments.callee,onError:d.onError})}})()},d.onError)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){h=
0;var k=this.elements;(function(){h<k.length?k[h++]._qualifyAllProperties(b,a,{onDone:arguments.callee,onError:d.onError}):d.onDone(a)})()}else d.onDone()};CueCard.QueryNode.prototype.getCursorFromContext=function(b){return this._getCursorFromContext(b,0)};
CueCard.QueryNode.prototype._getCursorFromContext=function(b,a){var d=b[a];if(this.type==CueCard.QueryNode.TYPE_MISSING){var c=this.startToken;return{line:c.start.line,col:c.start.col}}else if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray)if(d.relative=="inside")if(d.child<this.value.length)return this.value[d.child]._getCursorFromContext(b,a+1);else{c=this.endToken;return{line:c.start.line,col:c.start.col}}else if(d.child<this.value.length){d=this.value[d.child];c=d.startToken;return{line:c.start.line,
col:c.start.col}}else{c=this.startToken;return{line:c.end.line,col:c.end.col}}else{c=this.startToken;return{line:c.start.line,col:c.start.col+("offset"in d?d.offset:0)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if(d.relative=="inside")if(d.child<this.elements.length)return this.elements[d.child]._getCursorFromContext(b,a+1);else{c=this.endToken;return{line:c.start.line,col:c.start.col}}else if(d.child<this.elements.length){d=this.elements[d.child];c=d.startToken;return{line:c.start.line,
col:c.start.col}}else{c=this.startToken;return{line:c.end.line,col:c.end.col}}else if(d.relative=="inside")if(d.child<this.links.length)return this.links[d.child].value._getCursorFromContext(b,a+1);else{c=this.endToken;return{line:c.start.line,col:c.start.col}}else if(d.relative=="before")if(d.child<this.links.length){d=this.links[d.child].value;c=d.startToken;return{line:c.start.line,col:c.start.col}}else{c=this.startToken;return{line:c.end.line,col:c.end.col}}else if(d.child<this.links.length)if(d.relative==
"path"){c=this.links[d.child].token;return{line:c.start.line,col:c.start.col+("offset"in d?d.offset:0)}}else{c=this.links[d.child].value.startToken;return{line:c.start.line,col:c.start.col}}else{c=this.endToken;return{line:c.end.line,col:c.end.col}}};CueCard.QueryNode.prototype.toInsideOutQueryJson=function(b,a){var d=this;this.qualifyAllProperties({onDone:function(){a.onDone(d._toInsideOutQueryJson(b,0,null,null))},onError:a.onError})};
CueCard.QueryNode.prototype._toInsideOutQueryJson=function(b,a,d,c){if(d!=null&&!(c instanceof Array))c=[c];if(a<b.length){var f=b[a];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in f&&f.relative=="inside"){var e=f.child;if(e<this.links.length){f=this.links[e];if(f.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||f.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){var g=f.getInverseQualifiedPath();e=this.toQueryJson({excludeChild:e});if(d!=null)if(e instanceof Array)e[0][d]=c;else e[d]=
c;return f.value._toInsideOutQueryJson(b,a+1,g,e)}}}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in f&&f.relative=="inside"){e=f.child;if(this.elements.length>1)throw new Error("Cannot turn a query inside out if a query node has siblings");else if(e==0){b=this.elements[e]._toInsideOutQueryJson(b,a+1,d,c);return b instanceof Array?b:[b]}else return null}}b=this.toQueryJson({expectedTypes:"expectedTypes"in this?this.expectedTypes:[]});if(d!=null)if(typeof b==Array)b[0][d]=
c;else b[d]=c;return b};CueCard.QueryNode.prototype.locateInnerMostNonTerminal=function(b,a){var d=this;this.qualifyAllProperties({onDone:function(){var c=d._locateInnerMostNonTerminal(b,0);a.onDone(c!=null?c:{node:d,property:null,reverse:false})},onError:a.onError})};
CueCard.QueryNode.prototype._locateInnerMostNonTerminal=function(b,a){if(a<b.length){var d=b[a];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in d&&d.relative=="inside"){d=d.child;if(d<this.links.length){var c=this.links[d];if(c.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||c.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){d=c.value._locateInnerMostNonTerminal(b,a+1);if(d==null)d={node:c.value};if(!("property"in d)){d.property=c.qualifiedProperty;d.reverse=c.reverse}return d}}}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in d&&d.relative=="inside"){d=d.child;if(d<this.elements.length){c=this.elements[d];d=c._locateInnerMostNonTerminal(b,a+1);if(d==null)d={node:c};return d}}}return null};
CueCard.QueryNodeLink=function(b,a){this.path=b;this.token=a;this.reverse=false;this.suffix=this.qualifiedProperty=this.originalProperty=this.property=this.namespace="";this.value=null;if(b.length>0)if(b.charAt(0)=="!"){this.reverse=true;b=b.substr(1)}if(b.length>0){var d=b.indexOf(":");if(d>=0){this.namespace=b.substr(0,d+1);b=b.substr(d+1);if(b.length>0&&b.charAt(0)=="!"){this.reverse=true;b=b.substr(1)}}}if(b.length>=2){d=b.substr(b.length-2);if(d==">="||d=="<="||d=="~="){this.suffix=d;b=b.substr(0,
b.length-2)}}if(b.length>1&&this.suffix==""){d=b.substr(b.length-1);if(d=="<"||d==">"){this.suffix=d;b=b.substr(0,b.length-1)}}this.originalProperty=b;if(b.length>0)if(b.charAt(0)=="/"){this.qualifiedProperty=b;d=b.lastIndexOf("/");this.property=b.substr(d+1)}else this.property=b;if(this.qualifiedProperty=="")if(this.property=="type")this.qualifiedProperty="/type/object/type";else if(this.property=="id")this.qualifiedProperty="/type/object/id";else if(this.property=="guid")this.qualifiedProperty=
"/type/object/guid";else if(this.property=="name")this.qualifiedProperty="/type/object/name";else if(this.property=="lang")this.qualifiedProperty="/type/text/lang";else if(CueCard.QueryNode.isMqlKeyword(this.property))this.qualifiedProperty=this.property};CueCard.QueryNodeLink.prototype.getQualifiedPath=function(){return(this.reverse?"!":"")+this.namespace+this.qualifiedProperty+this.suffix};
CueCard.QueryNodeLink.prototype.getInverseQualifiedPath=function(){return(this.reverse?"":"!")+this.namespace+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getUnnamespacedQualifiedPath=function(){return(this.reverse?"!":"")+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getPath=function(b){return(this.reverse?"!":"")+this.namespace+(b&&this.qualifiedProperty.length>0?this.qualifiedProperty:this.originalProperty)+this.suffix};
CueCard.QueryNodeLink.prototype.getValuesOfType=function(b,a){var d=function(g){if(g.isArray){g=g.value;for(var j=0;j<g.length;j++){var h=g[j];h.type==CueCard.QueryNode.TYPE_TERMINAL&&h.value!=null&&typeof h.value==a&&b.push(h.value)}}else g.value!=null&&typeof g.value==a&&b.push(g.value)},c=this.value;if(c.type==CueCard.QueryNode.TYPE_TERMINAL)d(c);else if(c.type==CueCard.QueryNode.TYPE_NONTERMINAL||c.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){c=c.type==CueCard.QueryNode.TYPE_NONTERMINAL?c.links:
c.elements[0].links;for(var f=0;f<c.length;f++){var e=c[f];e.qualifiedProperty=="/type/value/value"&&e.value.type==CueCard.QueryNode.TYPE_TERMINAL&&d(e.value)}}};CueCard.UI={};CueCard.UI.reportError=function(b){try{console.log(b)}catch(a){alert(b)}};CueCard.UI.createBlockingContinuations=function(b,a){return new CueCard.UI.Cont(b,a)};
CueCard.UI.Cont=function(b,a){var d=this;this._onDone=b;this._onError=a||CueCard.UI.reportError;this._progressUI=null;this._cleanedUp=this._canceled=false;this.cleanUp=function(){if(!d._cleanedUp){d._cleanedUp=true;if(d._progressUI!=null){d._progressUI.remove();d._progressUI=null}}};this.cancel=function(){if(!d._canceled){d._canceled=true;d.cleanUp()}};this.onError=function(){d.cleanUp();d._onError()};this.onDone=function(){var c=false;if(!d._canceled){c=[d];for(var f=0;f<arguments.length;f++)c.push(arguments[f]);
c=d._onDone.apply(null,c)}c||d.cleanUp()};window.setTimeout(function(){if(!d._cleanedUp)d._progressUI=$('<div class="cuecard-progress">Working...</div>').appendTo($(document.body))},300)};CueCard.UI.Cont.prototype.isCanceled=function(){return this._canceled};CueCard.UI.Cont.prototype.extend=function(b,a){this._onDone=b;this._onError=a||this._onError;return this};
CueCard.Popup=function(b,a,d,c,f){this._left=b;this._top=a;this._height=d;this._windows=c;this._handlers=f||{};this._pendingContinuations=[];this.elmt=$('<div class="cuecard-popup-container"></div>').css("top",this._top+this._height+"px").css("left",this._left+"px").appendTo("body");this._addEventHandlers()};CueCard.Popup.prototype.addPendingContinuation=function(b){this._pendingContinuations.push(b)};
CueCard.Popup.prototype.reposition=function(){var b=this.elmt.height(),a=this.elmt.width();this._top+this._height+b>=$(window).height()?this.elmt.css("top",this._top-b-5+"px"):this.elmt.css("top",this._top+this._height+"px");this._left+a>=$(window).width()?this.elmt.css("left",$(window).width()-a-25+"px"):this.elmt.css("left",this._left+"px")};CueCard.Popup.prototype.close=function(){this._remove();this._pendingContinuations=null};
CueCard.Popup.prototype.cancel=function(){if(this.elmt!=null){this._remove();this._cancelPendingContinuations();this._pendingContinuations=null}};CueCard.Popup.prototype._remove=function(){this._removeEventHandlers();this.elmt.remove();this.elmt=null};CueCard.Popup.prototype._cancelPendingContinuations=function(){for(var b=0;b<this._pendingContinuations.length;b++)try{this._pendingContinuations[b].cancel()}catch(a){}this._pendingContinuations=[]};
CueCard.Popup.prototype._addEventHandlers=function(){var b=this;this._handleKeyDown=function(f){return b._onKeyDown(f)};this._handleMouseDown=function(f){return b._onMouseDown(f)};for(var a=0;a<this._windows.length;a++){var d=this._windows[a];try{$(d.document).keydown(this._handleKeyDown).mousedown(this._handleMouseDown)}catch(c){alert("Unable to install keyup handler on codemirror window")}}};
CueCard.Popup.prototype._removeEventHandlers=function(){for(var b=0;b<this._windows.length;b++){var a=this._windows[b];try{$(a.document).unbind("keydown",this._handleKeyDown).unbind("mousedown",this._handleMouseDown)}catch(d){alert("Unable to install keyup handler on codemirror window")}}};CueCard.Popup.prototype._onKeyDown=function(b){if(b.keyCode==27){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("key")}};
CueCard.Popup.prototype._onMouseDown=function(b){if(this.mouseEventOutsidePopup(b)){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("mouse")}};CueCard.Popup.prototype.mouseEventOutsidePopup=function(b){if(b.currentTarget!=this.elmt[0].ownerDocument)return true;else{var a=this.elmt.offset();if(b.pageX<a.left||b.pageX>a.left+this.elmt.width()||b.pageY<a.top||b.pageY>a.top+this.elmt.height())return true}return false};
CueCard.TypeBasedTopicSuggestor=function(b,a,d,c,f){this._popup=b;this._defaultSuggestions=a;this._expectedTypes=d;this._desiredProperty=c;this._onCommit=f;this._popup.elmt.addClass("cuecard-popup-container-wide")};
CueCard.TypeBasedTopicSuggestor.prototype.getSuggestions=function(b,a){b=b.toLowerCase();if(b.length==0){for(var d=[],c=0;c<this._defaultSuggestions.length;c++)d.push(this._defaultSuggestions[c]);a(d)}else{var f=this;d=CueCard.UI.createBlockingContinuations(function(e,g){for(var j=[],h=0;h<g.result.length;h++){var l=g.result[h],o=null;if("/common/topic/image"in l&&l["/common/topic/image"]!=null&&l["/common/topic/image"].length>0)o=CueCard.freebaseServiceUrl+"api/trans/image_thumb"+l["/common/topic/image"][0].id+
"?mode=fillcrop&maxwidth=40&maxheight=40";j.push({result:l[f._desiredProperty],elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}"><table cellpadding="0" cellspacing="0"><tr valign="top"><td valign="top">'+(o==null?'<div class="cuecard-suggestion-thumbnail-empty"> </div>':'<img src="'+o+'" />')+'</td><td valign="top">'+l.name+'<div class="cuecard-suggestion-id">'+l[f._desiredProperty]+"</div></td></tr></table></a>")})}a(j)});this._popup.addPendingContinuation(d);c=CueCard.helper+"suggest-values-of-types?t="+
encodeURIComponent(this._expectedTypes.join(","))+"&q="+encodeURIComponent(b);CueCard.JsonpQueue.call(c,d.onDone,d.onError)}};CueCard.TypeBasedTopicSuggestor.prototype.commit=function(b){this._onCommit(b)};CueCard.StaticChoicesSuggestor=function(b,a){this._defaultSuggestions=b;this._onCommit=a};
CueCard.StaticChoicesSuggestor.prototype.getSuggestions=function(b,a){b=b.toLowerCase();for(var d=[],c=0;c<this._defaultSuggestions.length;c++){var f=this._defaultSuggestions[c];if(b.length==0||f.label.toLowerCase().indexOf(b)>=0)d.push(f)}a(d)};CueCard.StaticChoicesSuggestor.prototype.commit=function(b){this._onCommit(b)};CueCard.PropertySuggestor=function(b,a,d,c){this._popup=b;this._defaultSuggestions=a;this._entries=d;this._onCommit=c};
CueCard.PropertySuggestor.prototype.getSuggestions=function(b,a){b=b.toLowerCase();for(var d=[],c={},f=0;f<this._entries.length;f++){var e=this._entries[f];if(b.length==0)d.push(e);else if(e.label.toLowerCase().indexOf(b)>=0)d.push(e);else for(var g=0;g<e.expectedTypes.length;g++){var j=e.expectedTypes[g];if(j.name.toLowerCase().indexOf(b)>=0){d.push({label:e.label,hint:e.hint+" &rarr; type "+j.id,qualifiedProperty:e.qualifiedProperty,result:e.result,offset:e.offset,extent:e.extent});c[e.qualifiedProperty]=
true;break}}}for(f=0;f<this._defaultSuggestions.length;f++){e=this._defaultSuggestions[f];if(b.length==0||e.label.toLowerCase().indexOf(b)>=0)d.push(e)}if(b.length<3&&d.length>3)a(d);else{f=CueCard.UI.createBlockingContinuations(function(h,l){for(var o=0;o<l.result.length;o++){var r=l.result[o];if(!(r.id in c)&&"/type/property/schema"in r&&r["/type/property/schema"]!=null&&r["/type/property/schema"].length>0&&"key"in r&&r.key!=null&&r.key.length>0){var n="/type/property/expected_type"in r&&r["/type/property/expected_type"]!=
null?r["/type/property/expected_type"]:[],k={label:r.key[0],hint:"of type "+r["/type/property/schema"][0].id,qualifiedProperty:r.id,expectedTypes:n};CueCard.QueryEditor.setPropertySuggestionSuffix(n.length>0?n[0]:"",k,k["/type/property/unique"],'"'+r.id+'" : ');d.push(k)}}a(d)});this._popup.addPendingContinuation(f);e=CueCard.helper+"suggest-arbitrary-properties?q="+encodeURIComponent(b);CueCard.JsonpQueue.call(e,f.onDone,f.onError)}};CueCard.PropertySuggestor.prototype.commit=function(b){this._onCommit(b)};
CueCard.TypeSuggestor=function(){};CueCard.TypeSuggestor.prototype.getSuggestions=function(){};
CueCard.SuggestionController=function(b,a,d,c){this._popup=b;this._suggestor=d;this._lastText=c;this._selectedIndex=-1;this._suggestions=[];this._input=$('<input value="'+c+'" />');this._suggestionContainer=$('<div class="cuecard-suggestion-container"></div>');$(a).append($('<div class="cuecard-suggestion-input-container"></div>').append(this._input)).append(this._suggestionContainer);var f=this;this._onKeyUp=function(e){if(!e.shiftKey&&!e.metaKey&&!e.ctrlKey){if(e.keyCode==36||e.keyCode==38||e.keyCode==
40)return f._cancelEvent(e);e=f._input[0].value;if(e!=f._lastText){f._lastText=e;f._updateSuggestions()}}};this._onKeyDown=function(e){for(;!e.shiftKey&&!e.metaKey&&!e.ctrlKey;){if(e.keyCode==13||e.keyCode==9)f._commitSelectedSuggestion();else if(e.keyCode==36)f._suggestions.length>0&&f._selectSuggestion(0,true);else if(e.keyCode==38)f._selectedIndex>0&&f._selectSuggestion(f._selectedIndex-1,true);else if(e.keyCode==40)f._selectedIndex<f._suggestions.length-1&&f._selectSuggestion(f._selectedIndex+
1,true);else break;return f._cancelEvent(e)}if("onKeyDown"in f._suggestor)return f._suggestor.onKeyDown(e,f._input[0].value)};this._input.keyup(this._onKeyUp).keydown(this._onKeyDown);b=this._input[0];if(b.setSelectionRange){b.focus();b.setSelectionRange(c.length,c.length)}else if(b.createTextRange){b=b.createTextRange();b.collapse(true);b.moveEnd("character",c.length);b.moveStart("character",c.length);b.select()}this._input[0].focus();this._updateSuggestions()};
CueCard.SuggestionController.prototype._updateSuggestions=function(){this._suggestionContainer.empty();this._suggestionContainer.html('<div class="cuecard-suggestion-progress">Please wait...</div>');this._selectedIndex=-1;this._suggestions.length=0;var b=this;this._suggestor.getSuggestions(this._lastText,function(a){b._renderSuggestions(a,b._lastText)})};
CueCard.SuggestionController.prototype._renderSuggestions=function(b){var a=this._suggestionContainer;a.empty();var d=this,c=function(e,g){("elmt"in e?e.elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}">'+e.label+("hint"in e?' <span class="cuecard-suggestion-hint">'+e.hint+"</span>":"")+"</a>")).mouseover(function(){d._selectSuggestion(g,false)}).click(function(){d._commitSelectedSuggestion()}).appendTo(a)};this._suggestions=b;for(var f=0;f<b.length;f++)c(b[f],f);this._suggestions.length>
0?this._selectSuggestion(0,false):$('<div class="cuecard-suggestion-noEntryMessage">No suggestion available.<br/>Press Enter to keep what you have typed,<br/>ESC to discard it.</div>').appendTo(a);this._popup.reposition()};
CueCard.SuggestionController.prototype._selectSuggestion=function(b,a){this._selectedIndex>=0&&this._getSuggestion(this._selectedIndex).removeClass("cuecard-suggestion-selected");this._selectedIndex=b;this._getSuggestion(this._selectedIndex).addClass("cuecard-suggestion-selected");a&&this._getSuggestion(this._selectedIndex)[0].scrollIntoView(false)};
CueCard.SuggestionController.prototype._commitSelectedSuggestion=function(){this._selectedIndex>=0?this._suggestor.commit(this._suggestions[this._selectedIndex]):this._suggestor.commit(this._input[0].value)};CueCard.SuggestionController.prototype._getSuggestion=function(b){return $(this._suggestionContainer.children()[b])};CueCard.SuggestionController.prototype._cancelEvent=function(b){b.returnValue=false;b.cancelBubble=true;"preventDefault"in b&&b.preventDefault();return false};
CueCard.QueryEditor=function(b,a){this._container=b;this._options=a;this._controlPane=this._outputPane=null;this._assistKeyComboDetected=this._warnWrites=false;this._popup=null;var d=this,c="[{\n  \n}]",f=1,e=2;if("content"in a){c=a.content;e=f=0}c={basefiles:[],parserfile:[fb.acre.libs.codemirror],stylesheet:[fb.acre.libs.codemirror_css],parserConfig:{json:true},height:"100%",autoMatchParens:true,textWrapping:false,highlightActiveLine:true,readOnly:"readOnly"in a?a.readOnly:false,content:c,passDelay:100,
undoDelay:250,initCallback:function(){d._onReady();try{var g=d._editor.nthLine(f+1);d._editor.selectLines(g,e,g,e)}catch(j){}"onReady"in a&&a.onReady();a.focusOnReady&&d.focus()}};if("onChange"in a)c.onChange=a.onChange;a.codeMirror&&$.extend(c,a.codeMirror);this._overflowInput=$("<input></input>").css("position","absolute").css("left","-500px").css("top","0px").appendTo(document.body);$(this._container).acre(fb.acre.apps.cuecard+"/query-editor.mjt","query_editor",[this,c])};
CueCard.QueryEditor.nativeTypes={"/type/int":true,"/type/float":true,"/type/boolean":true,"/type/rawstring":true,"/type/uri":true,"/type/datetime":true,"/type/bytestring":true,"/type/value":true,"/type/text":true,"/type/enumeration":true};
CueCard.QueryEditor.prototype.dispose=function(){this._cancelPopup();$(this._editor._top_element).remove();this._overflowInput.remove();this._controlTopContainer.remove();this._controlBottomContainer.remove();this._iframeContainer.remove();this._iframeContainer=this._controlBottomContainer=this._controlTopContainer=this._overflowInput=this._editor=null};CueCard.QueryEditor.prototype._addCodemirror=function(b,a){this._editor=new CodeMirror(function(d){b.append(d)},a)};
CueCard.QueryEditor.prototype.setOutputPane=function(b){this._outputPane=b};CueCard.QueryEditor.prototype.getOutputPane=function(){return this._outputPane};CueCard.QueryEditor.prototype.setControlPane=function(b){this._controlPane=b};CueCard.QueryEditor.prototype.getControlPane=function(){return this._controlPane};CueCard.QueryEditor.prototype.focus=function(){this._editor.focus();return this};
CueCard.QueryEditor.prototype.content=function(b){if(b==undefined)return this._editor.getCode();else{if(this._editor.getCode()!=b){var a=this._editor.editor;a.history.push(null,null,this._editor.win.fixSpaces(b.replace(/\t/g,"  ").replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n"));a.addDirtyNode();a.scheduleHighlight();a.history.onChange&&a.history.onChange()}return this}};
CueCard.QueryEditor.prototype.getUnresolvedQuery=function(){var b=this.getQueryModelAndContext().model.toQueryJson();return CueCard.jsonize(b,this.getJsonizingSettings({breakLines:false,omitWhitespace:true,variables:this._getVariables(),resolveVariables:false}))};CueCard.QueryEditor.prototype.getResolvedQueryEnvelope=function(b){return this._getResolvedQueryEnvelope(false,b)};
CueCard.QueryEditor.prototype.getJsonizingSettings=function(b){if(this._controlPane)return this._controlPane.getJsonizingSettings(b);else{b=b||{};if(!("indentCount"in b))b.indentCount=2;return b}};CueCard.QueryEditor.prototype._getVariables=function(){return this._controlPane?this._controlPane.getVariables():{}};CueCard.QueryEditor.prototype._getQueryEnvelope=function(){return this._controlPane?this._controlPane.getQueryEnvelope():{}};
CueCard.QueryEditor.prototype._getResolvedQueryEnvelope=function(b,a){a=a||{};var d=this.getQueryModelAndContext(),c=d.model.toQueryJson();a.isWriteQuery=this._isWriteQuery(c);var f=this._getQueryEnvelope(),e=this._getVariables();if(b){this.content(CueCard.jsonize(c,this.getJsonizingSettings({variables:e,resolveVariables:false})));try{var g=this.getQueryModelAndContext().model.getCursorFromContext(d.context);this._editor.selectLines(this._editor.nthLine(g.line+1),g.col)}catch(j){}}f.query=c;return CueCard.jsonize(f,
this.getJsonizingSettings({breakLines:false,variables:e,resolveVariables:true}))};CueCard.QueryEditor.prototype._isWriteQuery=function(b){var a=function(d){if(d!=null)if(d instanceof Array){if(d.length>0&&typeof d[0]=="object")for(var c=0;c<d.length;c++)if(a(d[c]))return true}else if(typeof d=="object")for(c in d)if(c=="connect"||c=="create"||a(d[c]))return true;return false};return a(b)};
CueCard.QueryEditor.prototype._confirmWriteQuery=function(b){return b.isWriteQuery&&!this._warnWrites&&CueCard.apiProxy.base.indexOf("sandbox")<0};CueCard.QueryEditor.prototype.getMqlReadURL=function(){var b={},a=this.getResolvedQueryEnvelope(b);b=CueCard.freebaseServiceUrl+"api/service/"+(b.isWriteQuery?"mqlwrite":"mqlread");if("service"in this._options&&this._options.service!=null)b=this._options.service;return b+"?query="+encodeURIComponent(a)};
CueCard.QueryEditor.prototype.run=function(b){if(this._outputPane!=null){var a={};b=this._getResolvedQueryEnvelope(b||this._controlPane&&this._controlPane.getSetting("cleanup"),a);if(this._confirmWriteQuery(a))if(window.confirm("Your query will write data into Freebase.\nAre you sure you want to do that?"))this._warnWrites=true;else return;var d=CueCard.apiProxy.base+CueCard.apiProxy[a.isWriteQuery?"write":"read"]+("emql"in this._options&&this._options.emql?"emql=1&":"")+("debug"in this._options?
"debug="+this._options.debug+"&":"")+("service"in this._options&&this._options.service!=null?"service="+encodeURIComponent(this._options.service)+"&":""),c=this,f=function(g){if(g.error=="unauthorized"){c._outputPane.setStatus("Query editor is not authorized to write on your behalf.");c._options.onUnauthorizedMqlWrite()}else{c._outputPane.renderResponseHeaders(g.headers);var j={};if(c._controlPane!=null&&c._controlPane.getSetting("multilineErrorMessages")&&"code"in g.body&&g.body.code=="/api/status/error"&&
"messages"in g.body&&g.body.messages!=null)j.encodeJavascriptString=function(h){return h};c._outputPane.setJSONContent(g.body,c.getJsonizingSettings(j))}},e=function(g){alert(g)};this._outputPane.setStatus("Querying...");a.isWriteQuery||b.length>1024?$.post(d,{query:b},f,"json"):CueCard.JsonpQueue.call(d+"query="+encodeURIComponent(b),f,e)}"onRun"in this._options&&this._options.onRun()};
CueCard.QueryEditor.prototype.getQueryModelAndContext=function(){var b=this._editor.cursorPosition(false),a=this._editor.lineNumber(b.line)-1;b=b.character;return CueCard.QueryParser.parseForContext(this._editor.getCode(),0,a,b)};
CueCard.QueryEditor.prototype._onReady=function(){var b=this;try{$(this._editor.win.document).keyup(function(d){return b._onEditorKeyUp(d)}).keydown(function(d){return b._onEditorKeyDown(d)}).mousedown(function(d){return b._onEditorMouseDown(d)})}catch(a){alert("Unable to install keyup handler on codemirror window")}if("cleanUp"in this._options&&this._options.cleanUp){this._editor.getCode();this._onCleanUp()}};CueCard.QueryEditor.prototype._onRun=function(b){this.run(b)};
CueCard.QueryEditor.prototype._onCleanUp=function(){var b=this.getQueryModelAndContext().model.toQueryJson(),a=this._getVariables();this.content(CueCard.jsonize(b,this.getJsonizingSettings({variables:a,resolveVariables:false})))};CueCard.QueryEditor.prototype._onEditorMouseDown=function(){};
CueCard.QueryEditor.prototype._onEditorKeyDown=function(b){if(b.keyCode==9||b.keyCode==32&&(b.ctrlKey||b.metaKey||b.altKey)){this._assistKeyComboDetected=true;b.preventDefault();return false}else{this._assistKeyComboDetected=false;if((b.metaKey||b.ctrlKey)&&b.keyCode==13)this._onRun(b.shiftKey)}};CueCard.QueryEditor.prototype._onEditorKeyUp=function(b){if(this._assistKeyComboDetected){this._assistKeyComboDetected=false;this.startAssistAtCursor();b.preventDefault();return false}};
CueCard.QueryEditor.prototype.startAssistAtCursor=function(){var b=this._editor.cursorPosition(false),a=this._editor.lineNumber(b.line)-1,d=b.character;this._editor.lineContent(b.line);var c=this._editor.win.document.body.firstChild;c=b.line||c;for(var f=c.nextSibling,e=d;e>0&&f!=null&&f.tagName.toLowerCase()!="br"&&f.firstChild!=null&&f.firstChild.nodeValue.length>=e;){e-=f.firstChild.nodeValue.length;c=f;f=f.nextSibling}if(f==null||f.tagName.toLowerCase()=="br"){if(f!=null){b=$(f).offset();if($.browser.msie&&
c!=null&&c.tagName.toLowerCase()!="br"){e=c.offsetWidth;c=c.offsetHeight}else{e=b.left;c=f.offsetHeight}}else{b=$(c).offset();var g=c.firstChild?c.firstChild.nodeValue.length:0;e=b.left+(g==0?0:e*c.offsetWidth/g);c=c.offsetHeight}this._startAssist(a,d,{left:e,top:b.top,height:c})}else{b=$(f).offset();g=f.firstChild?f.firstChild.nodeValue.length:0;this._startAssist(a,d,{left:b.left+(g==0?0:e*f.offsetWidth/g),top:b.top,height:f.offsetHeight})}};
CueCard.QueryEditor.prototype._startAssist=function(b,a,d){this._cancelPopup();if(d!=null){var c=$(this._iframeContainer).offset();c.left-=this._editor.win.document.body.scrollLeft+document.body.scrollLeft;c.top-=this._editor.win.document.body.scrollTop+document.body.scrollTop;var f=this;this._popup=new CueCard.Popup(Math.round(c.left+d.left),Math.round(c.top+d.top),Math.round(d.height),[window,this._editor.win],{onCancel:function(j){j=="key"&&f.focus()}});this._popup.elmt.html('<div class="cuecard-popup-message">Please wait...</div>');
d=this.getQueryModelAndContext();if(d.context.length>0){c=d.context[d.context.length-1];if("relative"in c)if(c.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)if(c.relative=="path"||c.relative=="before"){this._startSuggestProperties(b,a,d,c);return}else{if(c.relative=="space"){var e=c.node.links[c.child];this._startSuggestValues(b,a,d,c,e);return}}else{if(c.node.type==CueCard.QueryNode.TYPE_TERMINAL){e=null;if(d.context.length>1){var g=d.context[d.context.length-2];e=g.node.links[g.child]}this._startSuggestValues(b,
a,d,c,e);return}}else{e=null;if(d.context.length>1){g=d.context[d.context.length-2];if(g.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)e=g.node.links[g.child];else if(d.context.length>2){g=d.context[d.context.length-3];e=g.node.links[g.child]}}this._startSuggestValues(b,a,d,c,e);return}}}this._popup.elmt.html('<div class="cuecard-popup-message">Sorry, we don\'t know how to assist you here. Send us a link to this exact query using the links at the upper right corner and we will investigate. Thank you!</div>')};
CueCard.QueryEditor.prototype._cancelPopup=function(){if(this._popup!=null){this._popup.cancel();this._popup=null}};
CueCard.QueryEditor.prototype._startSuggestProperties=function(b,a,d,c){var f=this;c=c.relative=="path"?c.node.links[c.child].token:null;this._startBufferInput();this._prepareQueryForSuggestions(d,b,a,c,function(e,g,j){var h=function(l,o){f._suggestProperties(d,o,g+f._stopBufferInput(),j)};d.model.locateInnerMostNonTerminal(d.context,e.extend(function(l,o){var r=[],n=[],k=[];o.node.getDeclaredTypes(r);o.node.getDeclaredIDs(n);o.node.getDeclaredGUIDs(k);var m=[];r.length>0&&m.push("t="+encodeURIComponent(r.join(",")));
n.length>0&&m.push("i="+encodeURIComponent(n.join(",")));k.length>0&&m.push("g="+encodeURIComponent(k.join(",")));if(o.property!=null){m.push("p="+encodeURIComponent(o.property));m.push("r="+o.reverse)}r=CueCard.helper+"suggest-properties?"+m.join("&");CueCard.JsonpQueue.call(r,l.extend(h).onDone,e.onError);return true}));return true})};CueCard.QueryEditor.prototype._startBufferInput=function(){this._overflowInput[0].value="";this._overflowInput[0].focus()};
CueCard.QueryEditor.prototype._stopBufferInput=function(){return this._overflowInput[0].value};
CueCard.QueryEditor.prototype._suggestProperties=function(b,a,d,c){this._popup.elmt.empty();this._popup.elmt.html("<div></div>");b=[];for(var f in a.properties){var e=a.properties[f],g=f.lastIndexOf("/"),j=f.substr(g+1);g=f.substr(0,g);var h=e.explicit;if("parentProperty"in e){h='"'+e.parentProperty+'" : [{ "'+j+'" : ';var l=e.unique?"null":"[]";b.push({label:j,hint:"of type "+g+" (through "+e.parentProperty+")",qualifiedProperty:f,result:h+l+" }]",offset:h.length,extent:l.length,expectedTypes:e.expectedTypes})}else{g=
{label:j,hint:"of type "+g,qualifiedProperty:f,expectedTypes:e.expectedTypes};CueCard.QueryEditor.setPropertySuggestionSuffix(e.expectedTypes.length>0?e.expectedTypes[0].id:"",g,e.unique,'"'+(h?j:f)+'" : ');b.push(g)}}a=new CueCard.PropertySuggestor(this._popup,CueCard.MqlSyntax.KeywordSuggestions,b,c);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,a,d)};
CueCard.QueryEditor.setPropertySuggestionSuffix=function(b,a,d,c){var f=null;if(b=="/common/image"||b=="/common/document"){f='{ "id" : null, "optional" : true, "limit" : 3 }';d||(f="["+f+"]")}else if(b=="/measurement_unit/dated_integer"){f='{ "number" : null, "date" : null }';if(d)f="["+f+"]"}else if(b=="/measurement_unit/dated_money_value"){f='{ "amount" : null, "valid_date" : null, "currency" : null }';if(d)f="["+f+"]"}else f=b.indexOf("/type/")==0?d?"null":"[]":d?"{}":"[{}]";a.result=c+f;a.offset=
c.length;a.extent=f.length};
CueCard.QueryEditor.prototype._startSuggestValues=function(b,a,d,c,f){var e=this,g="token"in c?c.token:null;this._startBufferInput();this._prepareQueryForSuggestions(d,b,a,g,function(j,h,l,o){h+=e._stopBufferInput();if(f!=null&&!f.reverse&&CueCard.QueryNode.isMqlKeyword(f.path))e._suggestValuesForKeyword(b,a,d,c,f.path,h,l);else{var r=function(){e._popup.elmt.empty();e._popup.elmt.html('<div></div><div class="cuecard-suggestion-hint-message">Keep typing to search for topics of types fitting this point in the query.</div>')},n=
f.qualifiedProperty,k=f.reverse;if(!k&&(n=="/type/object/id"||n=="/type/object/guid"||n=="/type/object/name")){d.model.locateInnerMostNonTerminal(d.context,j.extend(function(s,t){r();var v=[];t.node.getDeclaredTypes(v);if("property"in t&&t.property!=null){var u=t.property;if(k)v.push(u.substr(0,u.lastIndexOf("/")));else if(u in o){u=o[u].expectedTypes;for(var y=0;y<u.length;y++)v.push(u[y].id)}}v=new CueCard.TypeBasedTopicSuggestor(e._popup,CueCard.MqlSyntax.SingleValueSuggestions,v,f.property,l);
new CueCard.SuggestionController(e._popup,e._popup.elmt[0].firstChild,v,h)}));return true}else{r();var m=false;if(k)j=[n.substr(0,n.lastIndexOf("/"))];else if(n=="/type/object/type")j=["/type/type"];else if(n in o){m=o[n].unique;j=[];n=o[n].expectedTypes;for(var p=0;p<n.length;p++)j.push(n[p].id)}else j=n=="/type/text/lang"?["/type/lang"]:[];n=j.length==1?j[0]:null;j=n!==null&&n in CueCard.QueryEditor.nativeTypes?new CueCard.StaticChoicesSuggestor(CueCard.MqlSyntax[n=="/type/text"?m?"UniqueStringLiteralValueSuggestions":
"StringLiteralValueSuggestions":m?"UniqueLiteralValueSuggestions":"LiteralValueSuggestions"],l):new CueCard.TypeBasedTopicSuggestor(e._popup,CueCard.MqlSyntax[m?"UniqueTopicValueSuggestions":"TopicValueSuggestions"],j,"id",l);new CueCard.SuggestionController(e._popup,e._popup.elmt[0].firstChild,j,h)}}})};
CueCard.QueryEditor.prototype._suggestValuesForKeyword=function(b,a,d,c,f,e,g){this._popup.elmt.empty();b=CueCard.MqlSyntax.KeywordValueHints[f];if("html"in b){this._popup.elmt.html('<div class="cuecard-suggestion-hint-message">'+b.html+"</div>");this.focus()}else{this._popup.elmt.html("<div></div>");g=new CueCard.StaticChoicesSuggestor(b.choices,g);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,g,e)}};
CueCard.QueryEditor.prototype._prepareQueryForSuggestions=function(b,a,d,c,f){var e=this,g="",j,h=function(k,m,p,s,t){p=s===undefined||typeof p!=="string"?CueCard.jsonize(p,{breakLines:false}):p;m=m+(typeof s=="number"?s:p.length);t=m+(typeof t=="number"?t:0);e._editor.editor.replaceSelection(p);k=e._editor.nthLine(k+1);e._editor.selectLines(k,m,k,t)};if(c!=null){a=0;var l=c.start.col;if(/^['"]/.test(c.content))a=1;g=c.content.substring(a,d-l).replace(/['"]$/,"");j=function(k,m,p){var s=e._editor.nthLine(c.start.line+
1);e._editor.selectLines(s,c.start.col,s,c.end.col);h(c.start.line,c.start.col,k,m,p)}}else{d=this._editor.cursorPosition(true);var o=this._editor.lineNumber(d.line)-1,r=d.character;j=function(k,m,p){var s=e._editor.nthLine(o+1);e._editor.selectLines(s,r,s,r);h(o,r,k,m,p)}}var n=function(k){e._popup.close();typeof k=="string"?j(k):j(k.result,k.offset,k.extent)};d=CueCard.UI.createBlockingContinuations(function(k,m){return f(k,g,n,m||{})});this._popup.addPendingContinuation(d);b.model.qualifyAllProperties(d)};
CueCard.QueryEditor.prototype._showExamples=function(){var b=this;CueCard.showDialog("examples",{onDone:function(a){b.content(a);b._onRun(false)}})};CueCard.OutputPane=function(b,a){this._elmt=$(b);this._options=a||{};this._jsonResult=null;this._lastJsonOutputMode=$.cookie("cc_op_mode")=="text"?"text":"tree";this._treeConstructed=false;this._constructUI()};CueCard.OutputPane.prototype.dispose=function(){};
CueCard.OutputPane.prototype._constructUI=function(){var b=this,a=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.apps.cuecard+"/output-pane.mjt","tabs",[a,this]);var d=$("#"+a+" > .section-tabset");d.tabs("#"+a+" > .tabbed-content > .cuecard-outputPane-tabBody",{initialIndex:this._lastJsonOutputMode=="tree"?0:1,onBeforeClick:function(c,f){window.__cc_tree_disposePopup();if(f==0){b._lastJsonOutputMode="tree";b._jsonResult!=null&&!b._treeConstructed&&b._constructTree()}else if(f==
1)b._lastJsonOutputMode="text";$.cookie("cc_op_mode",b._lastJsonOutputMode,{expires:365})}});this._tabs=d.data("tabs");this._tree=this._getTab("tree").find("div");this._json=this._getTab("json").find("div");this._status=this._getTab("status").find("div");this._json_iframe=document.createElement("iframe");this._json.append(this._json_iframe)};CueCard.OutputPane.prototype._getTab=function(b){return $("#"+this._idPrefix+"-"+b)};
CueCard.OutputPane.prototype._setIFrameText=function(b){b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var a=this._json_iframe.contentWindow.document;a.open();a.write("<pre style='white-space:pre-wrap;'>"+b+"</pre>");a.close()};
CueCard.OutputPane.prototype.setJSONContent=function(b,a){this._jsonResult=b;this._setIFrameText(CueCard.jsonize(b,a||{indentCount:2}));var d;if(this._lastJsonOutputMode=="tree"){this._constructTree();d=0}else{this._tree.empty();this._treeConstructed=false;d=1}var c=this;window.setTimeout(function(){c._tabs.click(d)},100)};
CueCard.OutputPane.prototype.setStatus=function(b){this._tabs.click(2);this._status.html(b);this._jsonResult=null;this._setIFrameText("");this._tree.empty();this._treeConstructed=false};CueCard.OutputPane.prototype.getJson=function(){return this._jsonResult};CueCard.OutputPane.prototype.renderResponseHeaders=function(b){this.setStatus($.acre(fb.acre.apps.cuecard+"/output-pane.mjt","status",[b]))};
CueCard.OutputPane.prototype._constructTree=function(){this._treeConstructed=true;var b=[],a=function(j,h){return'<img class="cuecard-outputPane-tree-toggle" onclick="__cc_tree_toggle(this);" src="'+CueCard.urlPrefix+j+'" '+(h?"":' style="display: none;"')+"/>"},d=function(j){b.push(j)},c=function(j){return"<a class='cuecard-outputPane-tree-explore' target='_blank' href='"+CueCard.freebaseServiceUrl+"tools/explore"+j+"'>xp</a>"},f=function(j,h,l){if(j=="image"||j=="/common/topic/image")d("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)' fbid='"+h+"'>"+l+"</a>"+c(h));else j=="article"||j=="/common/topic/article"?d("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverArticle(this)' onmouseout='__cc_tree_mouseOutArticle(this)' fbid='"+h+"'>"+l+"</a>"+c(h)):d("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+h+"' onmouseover='__cc_tree_mouseOverTopic(this)' onmouseout='__cc_tree_mouseOutTopic(this)' fbid='"+h+"'>"+l+"</a>"+c(h))},e=function(j,h){return j.length>h.length&&j.substr(0,h.length)==h},g=function(j,h,l){if(j==null){h.startBody(false);d("<span>"+JSON.stringify(j)+"</span>");h.endBody(false)}else if(typeof j!="object"){h.startBody(false);var o=l[0];l=l.length>1?l[1]:"";if(o=="id"||o=="/type/object/id")f(l,j,JSON.stringify(j));else if(o=="guid"||o=="/type/object/guid")f(l,
"/guid/"+j.substr(1),JSON.stringify(j));else if(o=="type"||o=="/type/object/type")d("<a target='_blank' href='"+CueCard.freebaseServiceUrl+"type/schema"+j+"'>"+JSON.stringify(j)+"</a>"+c(j));else if(typeof j=="string"&&(e(j,"http://")||e(j,"https://")||e(j,"ftp://")))e(j,"http://chart.apis.google.com/chart?")?d("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+j+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)'>"+JSON.stringify(j)+"</a>"):
d("<a target='_blank' href='"+j+"'>"+JSON.stringify(j)+"</a>");else d("<span>"+JSON.stringify(j)+"</span>");h.endBody(false)}else if(j instanceof Array)if(j.length==0){h.startBody(false);d("<span>[]</span>");h.endBody(false)}else{o=j.length>1&&typeof j[0]=="object"?"":' style="display: none;"';h.startBody(true,'<span cc:mode="normal">[ <a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_expandAll(this);"'+o+'>expand all</a><span class="cuecard-outputPane-tree-toggles"'+
o+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_collapseAll(this);"'+o+'>collapse all</a><span class="cuecard-outputPane-tree-toggles"'+o+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_flip(this);"'+o+">1-by-1</a></span>",'<span style="display: none;">[ '+(j.length>1?j.length+" elements":"1 element")+" ]</span>");d('<div class="cuecard-outputPane-tree-arrayBody cuecard-outputPane-tree-normalMode">');
o=function(n,k,m){return{startBody:function(p,s,t){p?d('<div class="cuecard-outputPane-tree-arrayElement">'+a("expanded.png",true)+a("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+n+":</span> "+s+t+"<span>"+(k?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipPrevious(this);">previous</a> ':"")+(m?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipNext(this);">next</a>':"")+"</span>"):d('<div class="cuecard-outputPane-tree-arrayElement"><span class="cuecard-outputPane-tree-memberName">'+
n+":</span> ")},endBody:function(){d("</div>")}}};for(var r=0;r<j.length;r++)g(j[r],o(r,r>0,r<j.length-1),l);d("</div>");h.endBody(true)}else{h.startBody(true,"<span>{</span>",'<span style="display: none;">{...}</span>');d('<div class="cuecard-outputPane-tree-objectBody cuecard-outputPane-tree-normalMode">');o=function(n){return{startBody:function(k,m,p){k?d('<div class="cuecard-outputPane-tree-objectField">'+a("expanded.png",true)+a("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+
n+":</span> "+m+p+"<span></span>"):d('<div class="cuecard-outputPane-tree-objectField"><span class="cuecard-outputPane-tree-memberName">'+n+":</span> ")},endBody:function(){d("</div>")}}};for(r in j)g(j[r],o(r),[r].concat(l));d("</div>");h.endBody(true)}};g(this._jsonResult,{startBody:function(){},endBody:function(){}},["__root__"]);this._tree.html(b.join(""))};window.__cc_tree_toggle=function(b){var a=b.src.indexOf("expanded.png")>0;b=b.parentNode;a?window.__cc_tree_collapse(b):window.__cc_tree_expand(b)};
window.__cc_tree_expand=function(b){if(b.firstChild.tagName.toLowerCase()=="img"){var a=b.lastChild;a.style.display="block";b.childNodes[0].style.display="inline";b.childNodes[1].style.display="none";b=a.previousSibling.previousSibling;b.previousSibling.style.display="inline";b.style.display="none"}};
window.__cc_tree_collapse=function(b){if(b.firstChild.tagName.toLowerCase()=="img"){var a=b.lastChild;a.style.display="none";b.childNodes[0].style.display="none";b.childNodes[1].style.display="inline";b=a.previousSibling.previousSibling;b.previousSibling.style.display="none";b.style.display="inline"}};
(function(){var b=function(a){var d=a.parentNode.getAttribute("cc:mode"),c=a.parentNode.nextSibling.nextSibling.nextSibling;if(d=="flip"){for(d=0;d<c.childNodes.length;d++)c.childNodes[d].style.display="block";a.parentNode.setAttribute("cc:mode","normal");$(a.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").addClass("cuecard-outputPane-tree-normalMode").removeClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_expandAll=function(a){b(a);a=a.parentNode.nextSibling.nextSibling.nextSibling;
for(var d=0;d<a.childNodes.length;d++)__cc_tree_expand(a.childNodes[d])};window.__cc_tree_collapseAll=function(a){b(a);a=a.parentNode.nextSibling.nextSibling.nextSibling;for(var d=0;d<a.childNodes.length;d++)__cc_tree_collapse(a.childNodes[d])};window.__cc_tree_flip=function(a){var d=a.parentNode.getAttribute("cc:mode"),c=a.parentNode.nextSibling.nextSibling.nextSibling;if(d=="normal"){for(d=0;d<c.childNodes.length;d++){var f=c.childNodes[d];f.style.display=d==0?"block":"none";__cc_tree_expand(f)}a.parentNode.setAttribute("cc:mode",
"flip");$(a.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").removeClass("cuecard-outputPane-tree-normalMode").addClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_flipPrevious=function(a){a=a.parentNode.parentNode;a.style.display="none";a.previousSibling.style.display="block"};window.__cc_tree_flipNext=function(a){a=a.parentNode.parentNode;a.style.display="none";a.nextSibling.style.display="block"};window.__cc_tree_mouseOverTopic=function(a){var d=a.getAttribute("fbid");
$.getJSON("http://hotshot.dfhuynh.user.dev.freebaseapps.com/html?id="+d+"&callback=?",function(c){var f=__cc_tree_createPopup(a);$(f).addClass("cuecard-outputPane-tree-popup-topic").html(c)})};window.__cc_tree_mouseOutTopic=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverImage=function(a){var d=a.getAttribute("fbid");d=d!=null&&d.length>0?CueCard.freebaseServiceUrl+"api/trans/image_thumb"+d+"?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100":a.href;__cc_tree_createPopup(a).innerHTML=
"<img src='"+d+"' />"};window.__cc_tree_mouseOutImage=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverArticle=function(a){var d=a.getAttribute("fbid");$.getJSON(CueCard.freebaseServiceUrl+"api/trans/blurb"+d+"?callback=?",function(c){c=c.result.body;var f=__cc_tree_createPopup(a);$(f).addClass("cuecard-outputPane-tree-popup-article").html(c)})};window.__cc_tree_mouseOutArticle=function(){__cc_tree_disposePopup()};window.__cc_tree_createPopup=function(a){var d=document.getElementById("cuecard-outputPane-tree-popup");
if(d==null){d=document.createElement("div");d.id="cuecard-outputPane-tree-popup";d.className="cuecard-outputPane-tree-popup";d.onmouseover=window.__cc_tree_disposePopup;document.body.appendChild(d)}var c=$(a).offset();d.style.top=c.top+a.offsetHeight+10+"px";d.style.left=c.left+"px";return d};window.__cc_tree_disposePopup=function(){var a=document.getElementById("cuecard-outputPane-tree-popup");a!=null&&a.parentNode.removeChild(a)}})();
CueCard.ControlPane=function(b,a){this._elmt=$(b);this._options=a||{};this._constructUI()};CueCard.ControlPane.prototype.dispose=function(){};CueCard.ControlPane.prototype._constructUI=function(){var b=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.apps.cuecard+"/control-pane.mjt","tabs",[b,this]);$("#"+b+" > .section-tabset").tabs("#"+b+" > .tabbed-content > .cuecard-controlPane-tabBody",{initialIndex:0})};
CueCard.ControlPane.prototype._getDefaults=function(){var b=this._options,a=b.env||{},d={};d.extended=b.extended||a.extended;d.extended=d.extended===1?true:false;d.as_of_time=b.as_of_time||a.as_of_time||null;d.use_permission_of=b.use_permission_of||a.use_permission_of||null;delete a.extended;delete a.as_of_time;delete a.use_permission_of;return d};CueCard.ControlPane.prototype._getTab=function(b){return $("#"+this._idPrefix+"-"+b)};
CueCard.ControlPane.prototype._redangle=function(){var b=this,a=this._options.queryEditor.getQueryModelAndContext();a.model.toInsideOutQueryJson(a.context,CueCard.UI.createBlockingContinuations(function(d,c){b._setOutputJSON(c)}))};CueCard.ControlPane.prototype._qualify=function(){var b=this,a=this._options.queryEditor.getQueryModelAndContext().model;a.qualifyAllProperties(CueCard.UI.createBlockingContinuations(function(){b._setOutputJSON(a.toQueryJson({qualifyAllProperties:true}))}))};
CueCard.ControlPane.prototype._generateCode=function(){var b=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson();b=CueCard.CodeGeneration.generate(b,CueCard.CodeGeneration.serializers["acre-template"],{variables:this.getVariables()});CueCard.showDialog("acre_template",b)};
CueCard.ControlPane.prototype._oneLiner=function(){var b=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),a=this.getJsonizingSettings({variables:this.getVariables(),resolveVariables:false});a.breakLines=false;this._options.queryEditor.content(CueCard.jsonize(b,a))};
CueCard.ControlPane.prototype._setOutputJSON=function(b){switch(this._getTab("tools").find("input[name='tools-result']:checked").val()){case "replace":this._options.queryEditor.content(CueCard.jsonize(b,this.getJsonizingSettings()));break;case "output":this._options.outputPane.setJSONContent(b,this.getJsonizingSettings());break}};
CueCard.ControlPane.prototype._runPage=function(b){var a=this._getTab("envelope").find("input[name='page']"),d=a.val();d=parseInt(d)||1;d+=b;if(d<1)a.val("1");else{a.val(d);this._options.queryEditor!=null&&this._options.queryEditor.run()}};
CueCard.ControlPane.prototype._runCursor=function(b){if(this._options.outputPane!=null){var a=this._options.outputPane.getJson();if(a!==undefined&&a!==null&&"cursor"in a){this._getTab("envelope").find("input[name='cursor']").val(a.cursor);this._getTab("envelope").find("input[name='cursor-opt'][value='custom']").attr("checked","checked");this._options.queryEditor!=null&&b&&this._options.queryEditor.run()}}};
CueCard.ControlPane.prototype.getQueryEnvelopeSetting=function(b){switch(b){case "extended":return this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;case "as_of_time":b=this._getTab("envelope").find("input[name='as_of_time']").val();if(b.length>0)return b;break}return null};
CueCard.ControlPane.prototype.getQueryEnvelope=function(b,a){b=b||{};if(this.getSetting("extended")==1)b.extended=1;var d=this._getTab("envelope").find("input[name='as_of_time']").val();if(d.length>0)b.as_of_time=d;d=this._getTab("envelope").find("input[name='use_permission_of']").val();if(d.length>0)b.use_permission_of=d;var c=this._getTab("envelope").find("select");d=function(g){return c[g].options[c[g].selectedIndex].value};var f=d(0);if(f.length>0)b.lang=f;f=d(1);if(f.length>0)b.escape=f=="false"?
false:f;d=d(2);if(d.length>0)b.uniqueness_failure=d;if(!a){d=this._getTab("envelope").find("input[name='page']").val();if(d.length>0)try{b.page=parseInt(d)}catch(e){}switch(this._getTab("envelope").find("input[name='cursor-opt']:checked").val()){case "true":b.cursor=true;break;case "custom":b.cursor=this._getTab("envelope").find("input[name='cursor']").val();break}}this.getCustomEnvelope(b);return b};
CueCard.ControlPane.prototype.getCustomEnvelope=function(b){b=b||{};for(var a=this._getTab("customEnvelope").find("table")[0],d=1;d<a.rows.length;d++){var c=a.rows[d],f=c.cells[0].firstChild.value;c=c.cells[1].firstChild.value;if(f.length>0){try{c=JSON.parse(c)}catch(e){}b[f]=c}}return b};
CueCard.ControlPane.prototype.getSetting=function(b){var a=this._getTab("settings").find("input");switch(b){case "cleanup":b=a[0].checked;$.cookie("cc_cp_clean",b?"1":"0",{expires:365});return b;case "alignJSONPropertyValues":b=a[1].checked;$.cookie("cc_cp_align",b?"1":"0",{expires:365});return b;case "liveQuery":b=a[2].checked;$.cookie("cc_cp_live",b?"1":"0",{expires:365});return b;case "multilineErrorMessages":b=a[3].checked;$.cookie("cc_cp_multi",b?"1":"0",{expires:365});return b;case "extended":b=
this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;$.cookie("cc_cp_extended",b,{expires:365});return b}return false};CueCard.ControlPane.prototype.getJsonizingSettings=function(b){b=b||{};b.indentCount=2;b.alignFieldValues=this.getSetting("alignJSONPropertyValues");return b};
CueCard.ControlPane.prototype.getVariables=function(){for(var b={},a=this._getTab("variables").find("table")[0],d=1;d<a.rows.length;d++){var c=a.rows[d],f=c.cells[0].firstChild.value;c=c.cells[1].firstChild.value;try{c=JSON.parse(c)}catch(e){}b[f]=c}return b};CueCard.CodeGeneration={serializers:{}};
CueCard.CodeGeneration.generate=function(b,a,d){var c="",f={_variables:{},createVariable:function(o){if(o in this._variables)return o+this._variables[o]++;else{this._variables[o]=1;return o}}},e=f.createVariable("q"),g=f.createVariable("o"),j=new CueCard.SerializingContext(null);j.setProperty("indentString","indentString"in d?d.indentString:"  ");j.setProperty("indentLevel","indentLevel"in d?d.indentLevel:0);j.setProperty("stream",{append:function(o){c+=o}});a.prepareRootContext(j,d);var h=new CueCard.IndentWriter(j),
l=a.generateQueryCall(j,h,f,b,d.variables,e,g);j.setProperty("start",function(){return l});j.setProperty("stop",function(){});CueCard.CodeGeneration._processNode(b,a,j,h,f);return c};
CueCard.CodeGeneration._deriveElementName=function(b,a){if(b==null){var d=a.getProperty("path");if(d!=null)if(d.charAt(0)=="!"){d=d.substr(Math.max(d.indexOf(":")+1,1)).split("/");return d[Math.max(0,d.length-2)]}else{d=d.substr(d.indexOf(":")+1).split("/");return d[d.length-1]}}else{d=b.split("/");return d[d.length-1]}return"entry"};CueCard.CodeGeneration._isImagePath=function(b){if(b.charAt(0)=="!")return false;b=b.substr(b.indexOf(":")+1);return b=="/common/topic/image"||b=="image"};
CueCard.CodeGeneration._isImageNode=function(b){if(b==null||typeof b!="object")return false;if(b instanceof Array)if(b.length==1&&typeof b[0]=="object")b=b[0];else return false;for(var a in b)if(a!="id"&&a!="guid"&&!CueCard.QueryNode.isMqlKeyword(a))return false;return true};
CueCard.CodeGeneration._processNode=function(b,a,d,c,f){if(b==null){var e=d.getProperty("start")(true,false);a.outputSimpleFieldValue(e,d,c);d.getProperty("stop")(true,false)}else if(typeof b=="object")if(b instanceof Array)if(b.length==0){e=CueCard.CodeGeneration._deriveElementName(null,d);var g=f.createVariable(e),j=f.createVariable(e.charAt(0));e=d.getProperty("start")(false,false);a.openNodeArray(d,c,f,e,g,j,"values");a.outputSimpleFieldValue(g,d,c);a.closeNodeArray(d,c,f,e,g,j,"values");d.getProperty("stop")(false,
false)}else{if(!(b.length>1||typeof b[0]!="object"||"__identifier__"in b)){g=new CueCard.SerializingContext(d);g.setProperty("in-array",true);arguments.callee(b[0],a,g,c,f)}}else if(b.optional!="forbidden"){g=null;e=0;for(j in b)if(b.hasOwnProperty(j)&&j!="*"&&!CueCard.QueryNode.isMqlKeyword(j)){e++;var h=b[j];if(j.charAt(0)!="!"){var l=j.substr(j.indexOf(":")+1);if(l=="type"||l=="/type/object/type")if(h!=null&&typeof h=="string")g=h}}CueCard.CodeGeneration._processTypedObjectNode(b,g,e,a,d,c,f)}};
CueCard.CodeGeneration._processTypedObjectNode=function(b,a,d,c,f,e,g){function j(){var t=CueCard.CodeGeneration._deriveElementName(a,f);l=g.createVariable(t);if(f.getProperty("in-array"))o=g.createVariable(t.charAt(0))}var h=null,l=null,o=null,r,n,k="optional"in b&&b.optional===true;if(f.getProperty("in-array")){var m=d>0&&!("*"in b);r=function(){if(h==null){h=f.getProperty("start")(false,k);j();c.openNodeArray(f,e,g,h,l,o,m?"fields":"object")}return l};n=function(){if(h!=null){c.closeNodeArray(f,
e,g,h,l,o,m?"fields":"object");f.getProperty("stop")(false,k)}}}else{r=function(){if(h==null){h=f.getProperty("start")(false,k);j();c.openNode(f,e,g,h,l)}return l};n=function(){if(h!=null){c.closeNode(f,e,g,h,l);f.getProperty("stop")(false,k)}}}if(d==0||"*"in b)c.generateEmptyObjectNode(f,e,g,r());else{for(var p in b)if(b.hasOwnProperty(p)&&p!="*"&&!CueCard.QueryNode.isMqlKeyword(p)){d=b[p];if(CueCard.CodeGeneration._isImagePath(p)&&CueCard.CodeGeneration._isImageNode(d))c.generateImageField(f,e,
g,p,d,r);else{var s=c.createFieldContext(f,e,g,p,r);s.setProperty("path",p);CueCard.CodeGeneration._processNode(d,c,s,e,g)}}if("*"in b){d=b["*"];s=c.openWildcardField(f,e,g,r,d);CueCard.CodeGeneration._processNode(d,c,s,e,g);c.closeWildcardField(f,e,g,r,d)}}n()};
CueCard.CodeGeneration.serializers["acre-template"]={prepareRootContext:function(){},generateQueryCall:function(b,a,d,c,f,e,g){a.appendIndent();a.append("<acre:script>");a.appendLineBreak();a.indent();a.appendIndent();a.append("var "+e+" = ");CueCard.jsonize(c,{context:b,variables:f,resolveVariables:false});a.append(";");a.appendLineBreak();a.appendIndent();a.appendLineBreak();a.appendIndent();a.append("var "+g+" = acre.freebase.mqlread("+e+");");a.appendLineBreak();a.unindent();a.appendIndent();
a.append("</acre:script>");a.appendLineBreak();return g+".result"},outputSimpleFieldValue:function(b,a,d){d.append("${"+b+"}")},openNodeArray:function(b,a,d,c,f,e,g){a.appendLineBreak();a.appendIndent();a.append('<ul acre:if="'+c+'.length != 0">');a.appendLineBreak();a.indent();a.appendIndent();a.append('<li acre:for="'+e+", "+f+" in "+c+'">');g=="fields"&&a.append("<table>");if(g=="fields"||g=="object"){a.appendLineBreak();a.indent()}},closeNodeArray:function(b,a,d,c,f,e,g){if(g=="fields"||g=="object"){a.unindent();
a.appendIndent()}g=="fields"&&a.append("</table>");a.append("</li>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</ul>");a.appendLineBreak();a.appendIndent();a.append('<div acre:else=""><ins>[no element]</ins></div>');a.appendLineBreak();a.appendLineBreak()},openNode:function(b,a,d,c,f){a.appendIndent();a.append("<acre:script>var "+f+" = "+c+";</acre:script>");a.appendLineBreak();a.appendIndent();a.append("<table>");a.appendLineBreak();a.indent()},closeNode:function(b,a){a.unindent();
a.appendIndent();a.append("</table>");a.appendLineBreak()},createFieldContext:function(b,a,d,c,f){b=new CueCard.SerializingContext(b);b.setProperty("in-array",false);b.setProperty("start",function(e,g){var j=f();a.appendIndent();a.append("<tr><th>"+c+":</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append("<td"+(g?" acre:if=\"'"+c+"' in "+j+" && "+j+"['"+c+"'] != null\"":"")+">");if(!e){a.appendLineBreak();a.indent()}return j+"['"+c+"']"});b.setProperty("stop",function(e,g){if(!e){a.unindent();
a.appendIndent()}a.append("</td>");a.appendLineBreak();if(g){a.appendIndent();a.append('<td acre:else=""><ins>[no value]</ins></td>');a.appendLineBreak()}a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()});return b},generateImageField:function(b,a,d,c,f,e){e=e();b=e+"['"+c+"']";a.appendIndent();a.append("<tr><th>"+c+":</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append("<td acre:if=\"'"+c+"' in "+e+" && "+b+' != null">');a.appendLineBreak();a.indent();c=f instanceof
Array;a.appendIndent();if(c){f=f[0];c=d.createVariable("image");d=d.createVariable("i");a.append('<img acre:for="'+d+", "+c+" in "+b+'" src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in f?"/guid/${"+c+".guid.substr(1)}":"${"+c+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>')}else a.append('<img src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in f?"/guid/${"+b+".guid.substr(1)}":"${"+b+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>');
a.appendLineBreak();a.unindent();a.appendIndent();a.append('<td acre:else=""><ins>[no image]</ins></td>');a.appendLineBreak();a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()},openWildcardField:function(b,a,d,c){c=c();var f=d.createVariable("field"),e=d.createVariable("value");a.appendIndent();a.append('<tr acre:for="'+f+", "+e+" in "+c+'"><td>${'+f+"}:</td>");a.appendLineBreak();a.indent();b=new CueCard.SerializingContext(b);b.setProperty("in-array",false);b.setProperty("start",
function(g){a.appendIndent();a.append("<td>");if(!g){a.appendLineBreak();a.indent()}return e});b.setProperty("stop",function(g){if(!g){a.unindent();a.appendIndent()}a.append("</td>");a.appendLineBreak()});return b},closeWildcardField:function(b,a){a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak()},generateEmptyObjectNode:function(b,a,d,c){b=d.createVariable("field");d=d.createVariable("value");a.appendIndent();a.append("<table>");a.appendLineBreak();a.indent();a.appendIndent();a.append('<tr acre:for="'+
b+", "+d+" in "+c+'"><th>${'+b+"}:</th>");a.appendLineBreak();a.indent();a.appendIndent();a.append('<td acre:if="'+d+' instanceof Array">${'+d+".join(', ')}</td>");a.appendLineBreak();a.appendIndent();a.append('<td acre:else="">${'+d+"}</td>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</tr>");a.appendLineBreak();a.unindent();a.appendIndent();a.append("</table>");a.appendLineBreak()}};
CueCard.ExampleTechniques=["all","basic","sorting","text search","range constraint","date query","multiple constraints on same property","limiting number of results","geographic location","compound value type (CVT)","schema inspection","attribution","adding data"];
CueCard.Examples=[{name:"Vietnamese restaurants in Aspen, Colorado",query:[{"/business/business_location/address":{citytown:"Aspen",state_province_region:"Colorado"},cuisine:"Vietnamese",name:null,id:null,type:"/dining/restaurant"}],techniques:["basic","geographic location"]},{name:"Properties of /music/artist",query:[{id:"/music/artist",properties:[{}],type:"/type/type"}],techniques:["schema inspection"]},{name:"All types created by the user jamie",query:[{creator:"/user/jamie",name:null,id:null,
type:"/type/type"}],techniques:["attribution"]},{name:"Cloud classifications sorted by name",query:[{clouds:[],name:null,id:null,sort:"name",type:"/meteorology/cloud_classification"}],techniques:["basic","sorting"]},{name:"U.S. states containing cities whose names start with 'Blue' or 'Red'",query:[{"a:contains":[{name:null,id:null,"name~=":"^Red",type:"/location/citytown"}],"b:contains":[{name:null,id:null,"name~=":"^Blue",type:"/location/citytown"}],"b:type":"/location/us_state",name:null,id:null,
type:"/location/location"}],techniques:["text search","multiple constraints on same property"]},{name:"2 of The Police's albums and their tracks",query:{album:[{id:null,limit:2,name:null,track:[]}],id:null,name:"The Police",type:"/music/artist"},techniques:["basic","limiting number of results"]},{name:"25 Songs with the word 'love' in their titles, with release date, album and artist",query:[{album:{artist:[],name:null,id:null,release_date:null},limit:25,name:null,"name~=":"Love*",type:"/music/track"}],
techniques:["text search","limiting number of results","date query"]},{name:"Films starring both Joe Pesci and Robert de Niro, showing their full cast",query:[{"a:starring":[{actor:"Joe Pesci"}],"b:starring":[{actor:"Robert de Niro"}],name:null,id:null,starring:[{actor:null}],type:"/film/film"}],techniques:["multiple constraints on same property","compound value type (CVT)"]},{name:"32 actors born in the 1960s, with two films of each actor",query:[{"/people/person/date_of_birth":null,"/people/person/date_of_birth<":"1970",
"/people/person/date_of_birth>=":"1960",film:[{film:null,id:null,limit:2}],limit:35,name:null,id:null,type:"/film/actor"}],techniques:["multiple constraints on same property","date query","limiting number of results","range constraint"]},{name:"Directors who have directed both Parker Posey and any actor named Robert (in possibly different films)",query:[{"a:film":[{name:null,id:null,starring:{actor:"Parker Posey"}}],"b:film":[{name:null,id:null,starring:{actor:null,"actor~=":"Robert*"}}],name:null,
id:null,type:"/film/director"}],techniques:["multiple constraints on same property","text search","compound value type (CVT)"]},{name:"Music artists with albums containing a track called 'One Tree Hill'",query:[{album:[{name:null,id:null,track:[{length:null,name:"One Tree Hill"}]}],name:null,id:null,type:"/music/artist"}],techniques:["compound value type (CVT)","basic"]},{name:"Everything about 'Jimi Hendrix'",query:{"*":null,name:"Jimi Hendrix",type:"/music/artist"},techniques:["basic"]},{name:"Kevin Bacon's films, with cast, producers, music, etc.",
query:[{film:[{film:{imdb_id:[],music:[],name:null,id:null,produced_by:[],starring:[{actor:[{}]}],type:[]}}],name:"Kevin Bacon",type:"/film/actor"}],techniques:["basic","compound value type (CVT)"]},{name:"When 'Star Wars Episode IV' was added to the database, and by whom",query:[{creator:null,id:"/wikipedia/en/Star_Wars_Episode_IV",name:null,timestamp:null,type:"/film/film"}],techniques:["attribution"]},{name:"Tracks on Synchronicity longer than 300 seconds",query:[{artist:"The Police",name:"Synchronicity",
track:[{length:null,"length>":300,name:null}],type:"/music/album"}],techniques:["range constraint"]},{name:"Properties of a particular type (/government/politician)",query:{id:"/government/politician",properties:[],type:"/type/type"},techniques:["schema inspection"]},{name:"Properties of a particular property (/type/object/name)",query:{"*":null,id:"/type/object/name",type:"/type/property"},techniques:["schema inspection"]},{name:"Types in a particular domain (/music)",query:{id:"/music",type:"/type/domain",
types:[]},techniques:["schema inspection"]},{name:"Creating a new topic given a name and a type",query:{create:"unless_exists",name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,guid:null},techniques:["adding data"]},{name:"Setting a basic unique property to a topic",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,basic_property:{value:42,connect:"update"}},techniques:["adding data"]},{name:"Connecting one topic to another",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",
id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"insert"}},techniques:["adding data"]},{name:"Deleting a link between two topics",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"delete"}},techniques:["adding data"]}];CueCard.ExampleTechniqueMap={all:[]};
for(var i=0;i<CueCard.Examples.length;i++){var example=CueCard.Examples[i];CueCard.ExampleTechniqueMap.all.push(i);for(var x=0;x<example.techniques.length;x++){var technique=example.techniques[x];if(technique in CueCard.ExampleTechniqueMap)CueCard.ExampleTechniqueMap[technique].push(i);else CueCard.ExampleTechniqueMap[technique]=[i]}}
CueCard.Languages=[{name:"Afrikaans",id:"/lang/af"},{name:"Akkadian",id:"/lang/kk"},{name:"Albanian",id:"/lang/sq"},{name:"Amharic",id:"/lang/am"},{name:"Arabic",id:"/lang/ar"},{name:"Armenian",id:"/lang/hy"},{name:"Artificial",id:"/lang/art"},{name:"Asturian",id:"/lang/ast"},{name:"Australian languages",id:"/lang/aus"},{name:"Azerbaijani",id:"/lang/az"},{name:"Balinese",id:"/lang/ban"},{name:"Bambara",id:"/lang/bm"},{name:"Bantu",id:"/lang/bnt"},{name:"Basque",id:"/lang/eu"},{name:"Batak",id:"/lang/btk"},
{name:"Belarusian",id:"/lang/be"},{name:"Bengali",id:"/lang/bn"},{name:"Bhojpuri",id:"/lang/bho"},{name:"Bosnian",id:"/lang/bs"},{name:"Breton",id:"/lang/br"},{name:"Bulgarian",id:"/lang/bg"},{name:"Buriat",id:"/lang/bua"},{name:"Catalan",id:"/lang/ca"},{name:"Cebuano",id:"/lang/ceb"},{name:"Cherokee",id:"/lang/chr"},{name:"Chichewa",id:"/lang/ny"},{name:"Chinese",id:"/lang/zh"},{name:"Cornish",id:"/lang/kw"},{name:"Corsican",id:"/lang/co"},{name:"Cree",id:"/lang/cr"},{name:"Creoles",id:"/lang/cpf"},
{name:"Croatian",id:"/lang/hr"},{name:"Czech",id:"/lang/cs"},{name:"Danish",id:"/lang/da"},{name:"Duala",id:"/lang/dua"},{name:"Dutch",id:"/lang/nl"},{name:"English",id:"/lang/en"},{name:"Esperanto",id:"/lang/eo"},{name:"Estonian",id:"/lang/et"},{name:"Faroese",id:"/lang/fo"},{name:"Filipino",id:"/lang/fil"},{name:"Finnish",id:"/lang/fi"},{name:"French",id:"/lang/fr"},{name:"Frisian",id:"/lang/fy"},{name:"Friulian",id:"/lang/fur"},{name:"Fulah",id:"/lang/ff"},{name:"Ga",id:"/lang/gaa"},{name:"Gaelic",
id:"/lang/gd"},{name:"Gallegan",id:"/lang/gl"},{name:"Georgian",id:"/lang/ka"},{name:"German",id:"/lang/de"},{name:"Germanic",id:"/lang/gem"},{name:"Greek",id:"/lang/el"},{name:"Guarani",id:"/lang/gn"},{name:"Haitian",id:"/lang/ht"},{name:"Hausa",id:"/lang/ha"},{name:"Hawaiian",id:"/lang/haw"},{name:"Hebrew",id:"/lang/he"},{name:"Hindi",id:"/lang/hi"},{name:"Hungarian",id:"/lang/hu"},{name:"Icelandic",id:"/lang/is"},{name:"Indonesian",id:"/lang/id"},{name:"Inuktitut",id:"/lang/ku"},{name:"Inuktitut",
id:"/lang/iu"},{name:"Irish",id:"/lang/ga"},{name:"Italian",id:"/lang/it"},{name:"Japanese",id:"/lang/ja"},{name:"Judeo-Arabic",id:"/lang/jrb"},{name:"Kalaallisut",id:"/lang/kl"},{name:"Khmer",id:"/lang/km"},{name:"Kinyarwanda",id:"/lang/rw"},{name:"Klingon",id:"/lang/tlh"},{name:"Kongo",id:"/lang/kg"},{name:"Korean",id:"/lang/ko"},{name:"Ladino",id:"/lang/lad"},{name:"Latin",id:"/lang/la"},{name:"Latvian",id:"/lang/lv"},{name:"Limburgan",id:"/lang/li"},{name:"Lingala",id:"/lang/ln"},{name:"Lithuanian",
id:"/lang/lt"},{name:"Low German",id:"/lang/nds"},{name:"Luxembourgish",id:"/lang/lb"},{name:"Macedonian",id:"/lang/mk"},{name:"Malagasy",id:"/lang/mg"},{name:"Malay",id:"/lang/ms"},{name:"Malayalam",id:"/lang/ml"},{name:"Maltese",id:"/lang/mt"},{name:"Mandingo",id:"/lang/man"},{name:"Manx",id:"/lang/gv"},{name:"Maori",id:"/lang/mi"},{name:"Marathi",id:"/lang/mr"},{name:"Mohawk",id:"/lang/moh"},{name:"Moldavian",id:"/lang/mo"},{name:"Mongolian",id:"/lang/mn"},{name:"Nahuatl",id:"/lang/nah"},{name:"Navajo",
id:"/lang/nv"},{name:"Neapolitan",id:"/lang/nap"},{name:"Nepali",id:"/lang/ne"},{name:"Norse,",id:"/lang/non"},{name:"Northern Sami",id:"/lang/se"},{name:"Norwegian",id:"/lang/no"},{name:"Norwegian Nynorsk",id:"/lang/nn"},{name:"Occitan",id:"/lang/oc"},{name:"Panjabi",id:"/lang/pa"},{name:"Papiamento",id:"/lang/pap"},{name:"Persian",id:"/lang/fa"},{name:"Polish",id:"/lang/pl"},{name:"Portuguese",id:"/lang/pt"},{name:"Pushto",id:"/lang/ps"},{name:"Quechua",id:"/lang/qu"},{name:"Raeto-Romance",id:"/lang/rm"},
{name:"Romanian",id:"/lang/ro"},{name:"Romany",id:"/lang/rom"},{name:"Russian",id:"/lang/ru"},{name:"Sakha",id:"/lang/sah"},{name:"Sanskrit",id:"/lang/sa"},{name:"Sardinian",id:"/lang/sc"},{name:"Scots",id:"/lang/sco"},{name:"Serbian",id:"/lang/sr"},{name:"Shona",id:"/lang/sn"},{name:"Sicilian",id:"/lang/scn"},{name:"Slovak",id:"/lang/sk"},{name:"Slovenian",id:"/lang/sl"},{name:"Songhai",id:"/lang/son"},{name:"Spanish",id:"/lang/es"},{name:"Sundanese",id:"/lang/su"},{name:"Swahili",id:"/lang/sw"},
{name:"Swedish",id:"/lang/sv"},{name:"Syriac",id:"/lang/syr"},{name:"Tagalog",id:"/lang/tl"},{name:"Tahitian",id:"/lang/ty"},{name:"Tajik",id:"/lang/tg"},{name:"Tamashek",id:"/lang/tmh"},{name:"Tamil",id:"/lang/ta"},{name:"Telugu",id:"/lang/te"},{name:"Thai",id:"/lang/th"},{name:"Tibetan",id:"/lang/bo"},{name:"Tonga",id:"/lang/to"},{name:"Turkish",id:"/lang/tr"},{name:"Turkmen",id:"/lang/tk"},{name:"Tuvinian",id:"/lang/tyv"},{name:"Ukrainian",id:"/lang/uk"},{name:"Urdu",id:"/lang/ur"},{name:"Uzbek",
id:"/lang/uz"},{name:"Vietnamese",id:"/lang/vi"},{name:"Welsh",id:"/lang/cy"},{name:"Wolof",id:"/lang/wo"},{name:"Xhosa",id:"/lang/xh"},{name:"Yiddish",id:"/lang/yi"},{name:"Yoruba",id:"/lang/yo"},{name:"Zulu",id:"/lang/zu"}];
CueCard.XMetawebCosts={tu:{meaning:"time/user",subsystem:"graphd"},ts:{meaning:"time/system",subsystem:"graphd"},tr:{meaning:"time/real",subsystem:"graphd"},te:{meaning:"time/overall",subsystem:"graphd"},pr:{meaning:"page reclaims",subsystem:"graphd"},pf:{meaning:"page faults",subsystem:"graphd"},dw:{meaning:"primitive data writes",subsystem:"graphd"},dr:{meaning:"primitive data reads",subsystem:"graphd"},"in":{meaning:"index size reads",subsystem:"graphd"},ir:{meaning:"index element reads",subsystem:"graphd"},
iw:{meaning:"index element write",subsystem:"graphd"},va:{meaning:"value allocation",subsystem:"graphd"},dt:{meaning:"total time spent in the session",subsystem:"client/me"},mr:{meaning:"number of mql requests (independent of caches)",subsystem:"client/me"},ch:{meaning:"cache/hit (memcache, not Squid)",subsystem:"client/me",important:true},cm:{meaning:"cache/miss (memcache, not Squid)",subsystem:"client/me"},cr:{meaning:"cache/read (memcache, not Squid)",subsystem:"client/me"},cs:{meaning:"cache skip (browser shift+reload skips memcache)",
subsystem:"client/me"},lh:{meaning:"lojson-cache/hit",subsystem:"client/me"},lm:{meaning:"lojson-cache/miss",subsystem:"client/me"},lr:{meaning:"lojson-cache/read",subsystem:"client/me"},nreqs:{meaning:"graph requests",subsystem:"client/me",important:true},tf:{meaning:"time/formatted",subsystem:"client/me"},tg:{meaning:"time/graph",subsystem:"client/me",important:true},rt:{meaning:"relevance/time",subsystem:"client/me"},cc:{meaning:"cpu time (utime + stime)",subsystem:"client/me"},mcu:{meaning:"mql user time",
subsystem:"client/me"},mcs:{meaning:"mql system time",subsystem:"client/me"},tm:{meaning:"mql real time",subsystem:"client/me",important:true},utime:{meaning:"time in user mode (float)",subsystem:"client/me"},stime:{meaning:"time in system mode (float)",subsystem:"client/me"},maxrss:{meaning:"maximum resident set size",subsystem:"client/me"},ixrss:{meaning:"shared memory size",subsystem:"client/me"},idrss:{meaning:"unshared memory size",subsystem:"client/me"},isrss:{meaning:"unshared stack size",
subsystem:"client/me"},minflt:{meaning:"page faults not requiring I/O",subsystem:"client/me"},majflt:{meaning:"page faults requiring I/O",subsystem:"client/me"},nswap:{meaning:"number of swap outs",subsystem:"client/me"},inblock:{meaning:"block input operations",subsystem:"client/me"},oublock:{meaning:"block output operations",subsystem:"client/me"},msgsnd:{meaning:"messages sent",subsystem:"client/me"},msgrcv:{meaning:"messages received",subsystem:"client/me"},nsignals:{meaning:"signals received",
subsystem:"client/me"},nvcsw:{meaning:"voluntary context switches",subsystem:"client/me"},nivcsw:{meaning:"involuntary context switches",subsystem:"client/me"},br:{meaning:"number of blob requests",subsystem:"client/me"},bctn:{meaning:"cdb thumbnail time - from blobclient POV",subsystem:"client/me"},rt:{meaning:"relevance/time (FIX: same name, different semantics?)",subsystem:"gix"},pt:{meaning:"postgres time",subsystem:"gix"},qt:{meaning:"actual postgres query time",subsystem:"gix"},ct:{meaning:"postgres connect time",
subsystem:"gix"},mt:{meaning:"MQL time",subsystem:"gix"},tt:{meaning:"total time",subsystem:"other"},mt:{meaning:"total MQL time: mql_output + mql_filter",subsystem:"other"},mft:{meaning:"MQL filter time (total time, ie. not per invocation)",subsystem:"other"},mfc:{meaning:"number of mql_filter invocations",subsystem:"other"},sh:{meaning:"squid/hit",subsystem:"cache"},st:{meaning:"squid/total time",subsystem:"cache"},so:{meaning:"squid/origin server time",subsystem:"cache"}};
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",source:{def:function(){var b=function(){var a=this.tpackage,d=this.exports,c=a._template_fragments,f=a.runtime.new_markuplist(),e=0;f[e++]=c[0];var g=function(j){var h=a.runtime.new_markuplist(),l=0;h[l++]=c[1];h[l++]=j;h[l++]=c[2];return h};g=a.runtime.tfunc_factory("acre_template(t)",g,a,undefined,false);d.acre_template=g;g.source_microdata=null;f[e++]=
c[3];e=function(j){var h=a.runtime.new_markuplist(),l=0;h[l++]=c[4];var o=function(n){var k=a.runtime.new_markuplist(),m=0;k[m++]=c[5];a.runtime.foreach(this,CueCard.ExampleTechniques,function(p,s){for(var t=1;t;){k[m++]=c[6];k[m++]=a.runtime.make_attr_safe(s===n?"cuecard-examples-technique-selected":"cuecard-examples-technique");k[m++]=c[7];k[m++]=a.runtime.make_attr_safe(s);k[m++]=c[8];k[m++]=s;k[m++]=c[9];k[m++]=CueCard.ExampleTechniqueMap[s].length;k[m++]=c[10];t--}return t?a.runtime._break_token:
a.runtime._continue_token});k[m++]=c[11];return k};o=a.runtime.tfunc_factory("list_techniques(selected_technique)",o,a,undefined,false);o.source_microdata=null;h[l++]=c[12];var r=function(n){var k=a.runtime.new_markuplist(),m=0;k[m++]=c[13];a.runtime.foreach(this,CueCard.Examples,function(p,s){for(var t=1;t;){if(n!=="all"?s.techniques.indexOf(n)!==-1:true){k[m++]=c[14];k[m++]=a.runtime.make_attr_safe(p);k[m++]=c[15];k[m++]=a.runtime.make_attr_safe(p);k[m++]=c[16];k[m++]=s.name;k[m++]=c[17]}t--}return t?
a.runtime._break_token:a.runtime._continue_token});k[m++]=c[18];return k};r=a.runtime.tfunc_factory("list_examples(technique)",r,a,undefined,false);r.source_microdata=null;h[l++]=c[19];a.runtime.ondomready(function(){var n=$("#dialog-examples").height()-$("#dialog-examples .modal-title").height()-$("#dialog-examples .modal-buttons").height();$("#cuecard-examples-dialog").height(n-50);selectTechnique=function(k){k=k||"all";$(".cuecard-examples-dialog-columnBody.cuecard-examples-dialog-column-0").acre(o(k));
$(".cuecard-examples-dialog-columnBody.cuecard-examples-dialog-column-1").acre(r(k));return false};selectExample=function(k){$(".cuecard-examples-example").removeClass("cuecard-examples-example-selected");$("#cuecard-example-"+k).addClass("cuecard-examples-example-selected");$("#cuecard-examples-dialog").find("textarea").val(CueCard.jsonize(CueCard.Examples[k].query,{indentCount:2}));return false};selectTechnique();$("#examples-submit").click(function(){var k=$("#cuecard-examples-dialog").find("textarea").val();
j.onDone(k)})},this);h[l++]=c[20];return h};e=a.runtime.tfunc_factory("examples(opts)",e,a,undefined,false);d.examples=e;e.source_microdata=null;return f};b.source_microdata=null;return b}(),info:{file:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",stringtable:["",'\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Generated Acre Template</span>\n    </h1>\n    <div class="modal-content">\n      <textarea id="template-code" wrap="off">','</textarea>\n    </div>\n  </div>\n  <div class="modal-buttons">\n    <button class="button button-cancel">OK</button>\n  </div>',
"","","",'\n    <a class="','" href="javascript:selectTechnique(\'',"')\">\n      "," (",")\n    </a>","","","",'\n    <a class="cuecard-examples-example" href="javascript:selectExample(\'','\')" id="cuecard-example-','">\n      ',"\n    </a>","",'\n\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Examples</span>\n    </h1>\n    <div class="modal-content" id="cuecard-examples-dialog">\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-0">Techniques</div>\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-1">Examples</div>\n      <div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-2">Query</div>\n      <div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-0"></div>\n      <div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-1"></div>\n      <textarea class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-2 cuecard-examples-query" readonly="true" wrap="off">\n    </textarea></div>\n  </div>\n  \n  <div class="modal-buttons">\n    <button class="button button-submit" id="examples-submit" type="submit">Paste &amp; Run</button>\n    <button class="button button-cancel">Cancel</button>\n  </div>',
""],debug_locs:[1,1,1,1,1,1,6,6,6,6,12,12,12,12,12,12,12,12,18,18,18,18,18,18,18,18,18,18,18,20,20,20,20,22,22,22,22,24,24,24,24,24,24,24,24,24,25,25,25,25,25,26,26,26,26,26,26,27,27,27,27,27,29,29,29,29,31,31,31,31,31,31,31,31,31,31,32,32,32,33,33,33,33,33,33,33,34,34,34,34,34,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,81,81,81,81,81,81,81,81],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",source:{def:function(){var b=function(){var a=this.tpackage,d=this.exports,c=a._template_fragments,f=a.runtime.new_markuplist(),e=0;f[e++]=c[0];e=function(g,j){var h=a.runtime.new_markuplist(),l=0;h[l++]=c[1];var o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._showExamples()};h[l++]=c[2];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[3];
o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._editor.editor.history.undo()};h[l++]=c[4];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[5];o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._editor.editor.history.redo()};h[l++]=c[6];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[7];o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g.content("");g.focus()};h[l++]=c[8];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[9];o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g.startAssistAtCursor()};
h[l++]=c[10];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[11];o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._onCleanUp()};h[l++]=c[12];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[13];o=a.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._onRun(false)};h[l++]=c[14];h[l++]=a.runtime.make_attr_safe(o);h[l++]=c[15];a.runtime.ondomready(function(){var r=$(g._container);g._controlTopContainer=r.find(".cuecard-queryEditor-controls-top");g._iframeContainer=r.find(".cuecard-queryEditor-content");
g._controlBottomContainer=r.find(".cuecard-queryEditor-controls-bottom");g._addCodemirror(r.find(".cuecard-queryEditor-content"),j);g.layout=function(){var n=r.height()-g._controlTopContainer[0].offsetHeight-g._controlBottomContainer[0].offsetHeight;g._iframeContainer.height(n).css("top",g._controlTopContainer[0].offsetHeight)};g.layout()},this);h[l++]=c[16];return h};e=a.runtime.tfunc_factory("query_editor(queryEditor, codeMirrorOptions)",e,a,undefined,false);d.query_editor=e;e.source_microdata=
null;return f};b.source_microdata=null;return b}(),info:{file:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",stringtable:["",'\n\n  <div class="cuecard-queryEditor-inner">\n    <div class="cuecard-queryEditor-controls-top">\n      <table cellpadding="0" cellspacing="0" width="100%"><tr>\n        <td class="cuecard-queryEditor-controls-leftAligned">','\n          <button class="button cuecard-queryEditor-examples" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Examples...\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-leftAligned">\n          <span>\n            <a href="http://www.freebase.com/docs/data" target="_blank">MQL\u00a0Tutorial</a>\u00a0\u2022\u00a0<a href="http://www.freebase.com/docs/mql" target="_blank">MQL\u00a0Reference</a>\n          </span>\n        </td>\n        <td width="99%"></td>\n        <td class="cuecard-queryEditor-controls-rightAligned">',
'\n          <button class="button cuecard-queryEditor-undo" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Undo\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button cuecard-queryEditor-redo" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Redo\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button cuecard-queryEditor-redo" onclick="return mjt._eventcb.',
'.apply(this, [event])">\n            Clear\n          </button>\n        </td>\n      </tr></table>\n    </div>\n    <div class="cuecard-queryEditor-content"></div>\n    <div class="cuecard-queryEditor-controls-bottom">\n      <table cellpadding="0" cellspacing="0" width="100%"><tr>\n        <td class="cuecard-queryEditor-controls-leftAligned">','\n          <button class="button button-primary cuecard-queryEditor-queryAssist" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Query\u00a0Assist\n          </button>\n          <span class="cuecard-queryEditor-buttonHint">Tab</span>\n        </td>\n        <td width="90%"></td>\n        <td class="cuecard-queryEditor-controls-rightAligned">',
'\n          <button class="button cuecard-queryEditor-cleanUp" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Clean\u00a0Up\n          </button>\n        </td>\n        <td class="cuecard-queryEditor-controls-rightAligned">','\n          <button class="button button-primary cuecard-queryEditor-run" onclick="return mjt._eventcb.','.apply(this, [event])">\n            Run\n          </button>\n          <span class="cuecard-queryEditor-buttonHint">Ctrl-Enter</span>\n        </td>\n      </tr></table>\n    </div>\n  </div>',
""],debug_locs:[1,1,1,1,1,1,7,7,7,7,14,14,14,14,14,14,14,14,14,14,14,14,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,32,32,32,32,32,32,32,32,32,32,32,38,38,38,38,38,38,38,38,38,38,38,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,57,57,57,57,57,57,57,57,57,57,57,57,57,63,63,63,63,63,63,63,63,63,63,63,72,72,72,72,72,72,72,72,72,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,90,90,90,90,90,90,90,90,90],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",source:{def:function(){var b=function(){var a=this.tpackage,d=this.exports,c=a._template_fragments,f=a.runtime.new_markuplist(),e=0;f[e++]=c[0];var g=function(n,k){var m=a.runtime.new_markuplist(),p=0;m[p++]=c[1];var s=[{name:"Tools",template:j,key:"tools"},{name:"Variables",template:h,key:"variables"},{name:"Envelope",template:l,key:"envelope"},
{name:"Custom Envelope",template:o,key:"customEnvelope"},{name:"Settings",template:r,key:"settings"}];m[p++]=c[2];m[p++]=a.runtime.make_attr_safe(n);m[p++]=c[3];a.runtime.foreach(this,s,function(t,v){for(var u=1;u;){m[p++]=c[4];m[p++]=a.runtime.make_attr_safe(n);m[p++]=c[5];m[p++]=a.runtime.make_attr_safe(v.key);m[p++]=c[6];m[p++]=v.name;m[p++]=c[7];u--}return u?a.runtime._break_token:a.runtime._continue_token});m[p++]=c[8];a.runtime.foreach(this,s,function(t,v){for(var u=1;u;){m[p++]=c[9];m[p++]=
a.runtime.make_attr_safe(n);m[p++]=c[10];m[p++]=a.runtime.make_attr_safe(v.key);m[p++]=c[11];m[p++]=v.template(k);m[p++]=c[12];u--}return u?a.runtime._break_token:a.runtime._continue_token});m[p++]=c[13];a.runtime.ondomready(function(){k.layout=function(){var t=this._elmt,v=t.find(".section-tabs").innerHeight()-t.find(".section-tabset").outerHeight();t.find(".cuecard-controlPane-tabBody").css("height",v)};k.layout()},this);m[p++]=c[14];return m};g=a.runtime.tfunc_factory("tabs(id, controlPane)",g,
a,undefined,false);d.tabs=g;g.source_microdata=null;f[e++]=c[15];var j=function(n){var k=a.runtime.new_markuplist(),m=0;k[m++]=c[16];k[m++]=c[17];a.runtime.foreach(this,[{label:"Qualify All Properties",command:"_qualify",hint:'Expand all properties to their full IDs (e.g., "id" \u2192 "/type/object/id").'},{label:"Turn Inside Out",command:"_redangle",hint:"Take the inner most query node {...} that contains the text cursor and make it the outermost query node."},{label:"Generate Acre Template",command:"_generateCode",
hint:"Generate an ACRE template that can render the result of this query."},{label:"One-liner",command:"_oneLiner",hint:"Reformat query into a one-liner."}],function(p,s){for(var t=1;t;){k[m++]=c[18];var v=a.runtime.uniqueid("onclick");mjt._eventcb[v]=function(){n[s.command]()};k[m++]=c[19];k[m++]=a.runtime.make_attr_safe(s.label);k[m++]=c[20];k[m++]=a.runtime.make_attr_safe(v);k[m++]=c[21];k[m++]=s.hint;k[m++]=c[22];t--}return t?a.runtime._break_token:a.runtime._continue_token});k[m++]=c[23];return k};
j=a.runtime.tfunc_factory("tools(controlPane)",j,a,undefined,false);d.tools=j;j.source_microdata=null;f[e++]=c[24];var h=function(n){var k=a.runtime.new_markuplist(),m=0;k[m++]=c[25];var p=function(){var t=a.runtime.new_markuplist(),v=0;t[v++]=c[26];if(this.subst_id)t[v++]=a.runtime.bless(' id="'+this.subst_id+'"');t[v++]=c[27];var u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){$(this).closest(".cuecard-controlPane-variables-row").remove()};t[v++]=c[28];t[v++]=a.runtime.make_attr_safe(u);
t[v++]=c[29];return t};p=a.runtime.tfunc_factory("add_row()",p,a,undefined,false);p.source_microdata=null;k[m++]=c[30];k[m++]=p();k[m++]=c[31];var s=a.runtime.uniqueid("onclick");mjt._eventcb[s]=function(){n._getTab("variables").find(".cuecard-controlPane-variables").append($.acre(p()))};k[m++]=c[32];k[m++]=a.runtime.make_attr_safe(s);k[m++]=c[33];return k};h=a.runtime.tfunc_factory("variables(controlPane)",h,a,undefined,false);d.variables=h;h.source_microdata=null;f[e++]=c[34];var l=function(n){var k=
a.runtime.new_markuplist(),m=0;k[m++]=c[35];var p=n._getDefaults();k[m++]=c[36];a.runtime.foreach(this,[{name:"extended",hint:"Enable MQL extensions"},{name:"as_of_time",hint:"Resolve the query based on data in Freebase as of the given time in ISO8601 format, e.g., 2009-02-28, 2009-03-13T22:16:40"},{name:"use_permission_of",hint:'Specify the id of an object (typically a user, domain or type) whose permission you want to copy (<a href="http://freebaseapps.com/docs/mql/ch06.html#id2972357" target="_blank">more details</a>).'},
{name:"page",hint:'Page number starting from 1 if there is a "limit" property in the top level query node.'},{name:"cursor",hint:""},{name:"lang",hint:"Return text values in the given language (specified with the language's Freebase ID)"},{name:"escape",hint:""},{name:"uniqueness_failure",hint:""}],function(s,t){for(var v=1;v;){k[m++]=c[37];k[m++]=t.name;k[m++]=c[38];switch(t.name){case "extended":k[m++]=c[39];var u=p.extended?{checked:""}:{};"name"in u||(k[m++]=c[40]);"type"in u||(k[m++]=c[41]);
for(var y in u){k[m++]=" "+y;k[m++]=a.runtime.bless('="');k[m++]=a.runtime.htmlencode(""+u[y]);k[m++]=a.runtime.bless('"')}k[m++]=c[42];break;case "as_of_time":k[m++]=c[43];k[m++]=a.runtime.make_attr_safe(p.as_of_time||"");k[m++]=c[44];break;case "use_permission_of":k[m++]=c[45];k[m++]=a.runtime.make_attr_safe(p.use_permission_of||"");k[m++]=c[46];break;case "page":k[m++]=c[47];u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){n._runPage(-1)};k[m++]=c[48];k[m++]=a.runtime.make_attr_safe(u);
k[m++]=c[49];u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){n._runPage(1)};k[m++]=c[50];k[m++]=a.runtime.make_attr_safe(u);k[m++]=c[51];break;case "cursor":k[m++]=c[52];u=a.runtime.uniqueid("onchange");mjt._eventcb[u]=function(){n._getTab("envelope").find("input[name='cursor'][value='custom']").attr("checked","checked")};k[m++]=c[53];k[m++]=a.runtime.make_attr_safe(u);k[m++]=c[54];u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){n._runCursor(false)};k[m++]=c[55];k[m++]=a.runtime.make_attr_safe(u);
k[m++]=c[56];u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){n._runCursor(true)};k[m++]=c[57];k[m++]=a.runtime.make_attr_safe(u);k[m++]=c[58];break;case "lang":k[m++]=c[59];a.runtime.foreach(this,CueCard.Languages,function(z,A){for(var q=1;q;){k[m++]=c[60];k[m++]=a.runtime.make_attr_safe(A.id);k[m++]=c[61];k[m++]=A.name;k[m++]=c[62];k[m++]=A.id;k[m++]=c[63];q--}return q?a.runtime._break_token:a.runtime._continue_token});k[m++]=c[64];break;case "escape":k[m++]=c[65];break;case "uniqueness_failure":k[m++]=
c[66];break}k[m++]=c[67];if(t.hint.length>0){k[m++]=c[68];k[m++]=mjt.bless(t.hint);k[m++]=c[69]}k[m++]=c[70];v--}return v?a.runtime._break_token:a.runtime._continue_token});k[m++]=c[71];return k};l=a.runtime.tfunc_factory("envelope(controlPane)",l,a,undefined,false);d.envelope=l;l.source_microdata=null;f[e++]=c[72];var o=function(n){var k=a.runtime.new_markuplist(),m=0;k[m++]=c[73];var p="env"in n._options?n._options.env:{},s=false;k[m++]=c[74];var t=function(v,u,y){var z=a.runtime.new_markuplist(),
A=0;z[A++]=c[75];if(this.subst_id)z[A++]=a.runtime.bless(' id="'+this.subst_id+'"');z[A++]=c[76];z[A++]=a.runtime.make_attr_safe(u||"");z[A++]=c[77];z[A++]=a.runtime.make_attr_safe(y||"");z[A++]=c[78];u=a.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){$(this).closest(".cuecard-controlPane-customEnvelope-row").remove()};z[A++]=c[79];z[A++]=a.runtime.make_attr_safe(u);z[A++]=c[80];v||a.runtime.ondomready(function(){},this);z[A++]=c[81];return z};t=a.runtime.tfunc_factory("add_row(dontFocus, name, value)",
t,a,undefined,false);t.source_microdata=null;k[m++]=c[82];a.runtime.foreach(this,p,function(v,u){for(var y=1;y;){k[m++]=c[83];s=true;k[m++]=c[84];k[m++]=t(true,v,JSON.stringify(u));k[m++]=c[85];y--}return y?a.runtime._break_token:a.runtime._continue_token});k[m++]=c[86];if(!s){k[m++]=c[87];k[m++]=t(true);k[m++]=c[88]}k[m++]=c[89];p=a.runtime.uniqueid("onclick");mjt._eventcb[p]=function(){n._getTab("customEnvelope").find(".cuecard-controlPane-customEnvelope").append($.acre(t()))};k[m++]=c[90];k[m++]=
a.runtime.make_attr_safe(p);k[m++]=c[91];return k};o=a.runtime.tfunc_factory("custom_envelope(controlPane)",o,a,undefined,false);d.custom_envelope=o;o.source_microdata=null;f[e++]=c[92];var r=function(){var n=a.runtime.new_markuplist(),k=0;n[k++]=c[93];var m=$.cookie("cc_cp_clean")=="1"?{checked:""}:{};"type"in m||(n[k++]=c[94]);for(var p in m){n[k++]=" "+p;n[k++]=a.runtime.bless('="');n[k++]=a.runtime.htmlencode(""+m[p]);n[k++]=a.runtime.bless('"')}n[k++]=c[95];m=$.cookie("cc_cp_align")=="1"?{checked:""}:
{};"type"in m||(n[k++]=c[96]);for(var s in m){n[k++]=" "+s;n[k++]=a.runtime.bless('="');n[k++]=a.runtime.htmlencode(""+m[s]);n[k++]=a.runtime.bless('"')}n[k++]=c[97];s=$.cookie("cc_cp_multi")=="1"?{checked:""}:{};"type"in s||(n[k++]=c[98]);for(var t in s){n[k++]=" "+t;n[k++]=a.runtime.bless('="');n[k++]=a.runtime.htmlencode(""+s[t]);n[k++]=a.runtime.bless('"')}n[k++]=c[99];return n};r=a.runtime.tfunc_factory("settings(controlPane)",r,a,undefined,false);d.settings=r;r.source_microdata=null;f[e++]=
c[100];return f};b.source_microdata=null;return b}(),info:{file:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",stringtable:["","",'\n\n  <div class="cuecard-controlPane section-tabs">\n    <div id="','">\n      <ul class="section-tabset clear">','\n        <li class="section-tab tab">\n          <a href="#',"-",'"><span>',"</span></a>\n        </li>",'\n      </ul>\n      <div class="tabbed-content">','\n        <div class="cuecard-controlPane-tabBody" id="',"-",'">\n          ',
"\n        </div>","\n      </div>\n    </div>\n  </div>","","","",'\n\n  <div class="cuecard-controlPane-section">\n    <table><tr valign="top">\n      <td>','\n        <div class="cuecard-controlPane-powerTool">','\n          <input class="button" type="submit" value="','" onclick="return mjt._eventcb.','.apply(this, [event])">\n          <div class="cuecard-controlPane-powerTool-hint">',"</div>\n        </div>",'\n      </td>\n      <td width="40%">\n        Results of tools<br>\n        <input checked="true" name="tools-result" type="radio" value="replace"> replace query (undo-able)<br>\n        <input name="tools-result" type="radio" value="output"> go into output pane\n      </td>\n    </tr></table>\n  </div>',
"",'\n  <table class="cuecard-controlPane-variables">\n    <tr>\n      <th width="30%">name</th>\n      <th width="50%">value</th>\n      <th></th>\n    </tr>','<tr class="cuecard-controlPane-variables-row"',">\n      <td><input></td>\n      <td><input></td>\n      <td>",'\n        <input class="button" type="submit" value="Remove" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>\n    </tr>',"\n    ","\n  </table>\n  <div>",'\n    <input class="button" type="submit" value="Add" onclick="return mjt._eventcb.',
'.apply(this, [event])">\n  </div>',"","",'\n  \n  <div class="cuecard-controlPane-explanation">\n    The query envelope contains directives to the query engine, specifying how to execute the query or how to return the results.\n  </div>\n  <table class="cuecard-controlPane-configurations">',"\n    <tr>\n      <td>","</td>\n      <td>","<input",' name="extended"',' type="checkbox"',">",'<input name="as_of_time" value="','">','<input name="use_permission_of" value="','">','<div class="cuecard-controlPane-configurations-page">\n            <input name="page" type="text">',
'\n            <input class="button" type="submit" value="Previous" onclick="return mjt._eventcb.','.apply(this, [event])">','\n            <input class="button" type="submit" value="Next" onclick="return mjt._eventcb.','.apply(this, [event])">\n          </div>','\n            <div>\n              <input checked="" name="cursor-opt" type="radio" value="">\n              unspecified (return all results, possibly time-out)\n            </div>\n            <div>\n              <input name="cursor-opt" type="radio" value="true">\n              true (start pagination with page size equal "limit" option in query)\n            </div>\n            <div>\n              <input name="cursor-opt" type="radio" value="custom">\n              continue from cursor: \n              <div class="cuecard-controlPane-configurations-cursor">',
'\n                <input name="cursor" type="text" onchange="return mjt._eventcb.','.apply(this, [event])">','\n                <input class="button" type="submit" value="Paste from Last Result" onclick="return mjt._eventcb.','.apply(this, [event])"> ','\n                <input class="button" type="submit" value="Paste &amp; Run" onclick="return mjt._eventcb.','.apply(this, [event])">\n              </div>\n            </div>','<select class="cuecard-controlPane-configurations-languages">\n            <option value="">--</option>',
'\n            <option value="','">'," (",")</option>","\n          </select>",'<select>\n            <option value="">--</option>\n            <option value="html">html</option>\n            <option value="false">false</option>\n          </select>','<select>\n            <option value="">--</option>\n            <option value="soft">soft</option>\n          </select>',"",'\n        <div class="cuecard-controlPane-hint">',"</div>","\n      </td>\n    </tr>","\n  </table>","","",'\n  \n  <table class="cuecard-controlPane-customEnvelope">\n    <tr>\n      <th width="30%">name</th>\n      <th width="50%">value</th>\n      <th></th>\n    </tr>',
'<tr class="cuecard-controlPane-customEnvelope-row"','>\n      <td><input value="','"></td>\n      <td><input value="','"></td>\n      <td>','\n        <input class="button" type="submit" value="Remove" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>',"\n    </tr>","","","\n      ","","","\n      ","","\n  </table>\n  <div>",'\n    <input class="button" type="submit" value="Add" onclick="return mjt._eventcb.','.apply(this, [event])">\n  </div>',"","\n  <div>\n    <input",' type="checkbox"',
">\n    Always clean up query before running\n  </div>\n  <div>\n    <input",' type="checkbox"','>\n    Align JSON property values with spaces\n  </div>\n  <div style="display: none;">\n    <input type="checkbox">\n    Try running query as you edit\n  </div>\n  <div>\n    <input',' type="checkbox"',">\n    Show error messages with multiple lines on multiple lines\n  </div>",""],debug_locs:[1,1,1,1,1,1,7,7,7,7,9,9,10,11,12,13,14,15,16,17,20,20,20,20,20,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,
24,24,24,24,27,27,27,27,27,27,27,27,27,27,27,28,28,28,29,29,29,29,29,29,34,34,34,34,34,34,35,36,37,38,39,40,41,42,44,44,44,44,44,44,46,46,46,46,48,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,76,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,77,77,78,78,78,79,79,79,79,79,79,89,89,89,89,89,89,89,89,89,89,89,89,89,89,92,92,92,92,99,99,99,99,99,99,99,99,99,99,99,99,104,104,104,104,104,104,104,104,104,104,106,106,106,106,106,106,106,107,107,107,111,111,111,111,111,111,111,111,
111,113,113,113,113,113,113,113,116,116,116,116,118,118,119,120,121,122,123,124,125,126,127,128,129,130,131,137,137,137,137,137,137,137,137,137,138,138,138,138,140,140,140,140,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,144,144,144,144,144,146,146,146,146,146,150,150,150,150,150,150,150,150,151,151,151,151,151,151,151,152,152,152,152,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,169,169,169,169,169,169,169,172,172,172,172,
172,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,177,177,177,177,183,183,183,183,183,183,183,188,188,188,188,188,188,191,191,191,191,191,191,191,193,193,193,193,193,193,193,196,196,196,196,196,196,196,199,199,199,199,200,200,201,202,203,211,211,211,211,211,211,211,211,211,211,211,211,211,212,212,212,213,213,213,216,216,216,216,216,216,216,216,218,218,218,218,218,219,220,221,221,222,222,222,222,222,222,222,222,222,222,223,223,225,225,225,226,226,226,226,226,226,226,227,227,227,
228,228,232,232,232,232,232,232,232,232,232,234,234,234,234,234,234,234,237,237,237,237,239,239,239,239,239,239,239,239,239,239,239,239,239,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,254,254,254,254,254,254,254,254,255,255,255,255],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",source:{def:function(){var b=function(){var a=this.tpackage,d=this.exports,c=a._template_fragments,f=a.runtime.new_markuplist(),e=0;f[e++]=c[0];var g=function(j,h){var l=a.runtime.new_markuplist(),o=0;l[o++]=c[1];var r=[{name:"Tree",key:"tree"},{name:"Text",key:"json"},{name:"Status",key:"status"}];l[o++]=c[2];l[o++]=a.runtime.make_attr_safe(j);l[o++]=
c[3];a.runtime.foreach(this,r,function(n,k){for(var m=1;m;){l[o++]=c[4];l[o++]=a.runtime.make_attr_safe(j);l[o++]=c[5];l[o++]=a.runtime.make_attr_safe(k.key);l[o++]=c[6];l[o++]=k.name;l[o++]=c[7];m--}return m?a.runtime._break_token:a.runtime._continue_token});l[o++]=c[8];a.runtime.foreach(this,r,function(n,k){for(var m=1;m;){l[o++]=c[9];l[o++]=a.runtime.make_attr_safe(j);l[o++]=c[10];l[o++]=a.runtime.make_attr_safe(k.key);l[o++]=c[11];l[o++]=a.runtime.make_attr_safe(k.key);l[o++]=c[12];m--}return m?
a.runtime._break_token:a.runtime._continue_token});l[o++]=c[13];a.runtime.ondomready(function(){h.layout=function(){var n=this._elmt,k=n.innerHeight()-n.find(".section-tab").outerHeight()-(h._options.verticalPadding||12),m=n.find(".section-tabs").innerWidth()-(h._options.horizontalPadding||0),p=k-20,s=m-20;n.find(".cuecard-outputPane-tabBody, .cuecard-outputPane-textarea").height(k).width(m);n.find(".cuecard-outputPane-status, .cuecard-outputPane-tree").css("padding",10).height(p).width(s)};h.layout()},
this);l[o++]=c[14];return l};g=a.runtime.tfunc_factory("tabs(id, outputPane)",g,a,undefined,false);d.tabs=g;g.source_microdata=null;f[e++]=c[15];g=function(j){var h=a.runtime.new_markuplist(),l=0;h[l++]=c[16];if(j["x-metaweb-tid"]){h[l++]=c[17];var o=j["x-metaweb-tid"];h[l++]=c[18];h[l++]=a.runtime.make_attr_safe(encodeURIComponent(o));h[l++]=c[19];h[l++]=o;h[l++]=c[20]}h[l++]=c[21];if(j["x-metaweb-cost"]){h[l++]=c[22];o=j["x-metaweb-cost"].split(",");var r=true;h[l++]=c[23];a.runtime.foreach(this,
o,function(n,k){for(var m=1;m;){h[l++]=c[24];var p=k.split("=");p[0]=p[0].replace(/^\s+/,"").replace(/\s+$/,"");var s=CueCard.XMetawebCosts[p[0]],t=(n%2?"cuecard-outputPane-odd":"cuecard-outputPane-even")+(s!==undefined&&"important"in s&&s.important?" cuecard-outputPane-cost-important":"");h[l++]=c[25];h[l++]=a.runtime.make_attr_safe(t);h[l++]=c[26];h[l++]=p[0];h[l++]=c[27];h[l++]=p[1];h[l++]=c[28];if(s!==undefined){h[l++]=c[29];h[l++]=s.meaning;h[l++]=c[30]}else h[l++]=c[31];h[l++]=c[32];if(s!==
undefined){h[l++]=c[33];h[l++]=s.subsystem;h[l++]=c[34]}else h[l++]=c[35];h[l++]=c[36];m--}return m?a.runtime._break_token:a.runtime._continue_token});h[l++]=c[37]}h[l++]=c[38];r=true;h[l++]=c[39];a.runtime.foreach(this,j,function(n,k){for(var m=1;m;){if(n!="x-metaweb-cost"&&n!="x-metaweb-tid"){h[l++]=c[40];var p=r?{"class":"cuecard-outputPane-odd"}:{"class":"cuecard-outputPane-even"};for(var s in p){h[l++]=" "+s;h[l++]=a.runtime.bless('="');h[l++]=a.runtime.htmlencode(""+p[s]);h[l++]=a.runtime.bless('"')}h[l++]=
c[41];h[l++]=n;h[l++]=c[42];h[l++]=k;h[l++]=c[43];r=!r;h[l++]=c[44]}m--}return m?a.runtime._break_token:a.runtime._continue_token});h[l++]=c[45];return h};g=a.runtime.tfunc_factory("status(headers)",g,a,undefined,false);d.status=g;g.source_microdata=null;f[e++]=c[46];return f};b.source_microdata=null;return b}(),info:{file:"//3d.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",stringtable:["","",'\n  \n  <div class="cuecard-outputPane section-tabs">\n    <div id="','">\n      <ul class="section-tabset clear">',
'\n        <li class="section-tab tab">\n          <a href="#',"-",'"><span>',"</span></a>\n        </li>",'\n      </ul>\n      <div class="tabbed-content">','\n        <div class="cuecard-outputPane-tabBody" id="',"-",'">\n          <div class="cuecard-outputPane-','"></div>\n        </div>',"\n      </div>\n    </div>\n  </div>","","",'\n  <div class="cuecard-outputPane-responseHeaders">',"",'\n      <h3>x-metaweb-tid (transaction ID)</h3>\n      <div>\n        <a href="http://stats.metaweb.com/query/transaction?tid=',
'" target="_blank">\n          ',"\n        </a>\n      </div>","","","\n      <h3>x-metaweb-cost header components</h3>\n      <table>\n        <tr><th>code</th><th>value</th><th>meaning</th><th>subsystem</th></tr>","",'\n          <tr class="','">\n            <td>',"</td>\n            <td>","</td>","\n            <td>","</td>","<td>--</td>","","\n            <td>","</td>","<td>--</td>","\n          </tr>","\n      </table>","\n\n    <h3>response headers</h3>\n    <table>","","\n        <tr",">\n          <td>",
"</td>\n          <td>","</td>\n        </tr>","","\n    </table>\n\n  </div>",""],debug_locs:[1,1,1,1,1,1,6,6,6,6,8,8,9,10,11,12,13,14,17,17,17,17,17,19,19,19,19,19,20,20,20,20,20,20,20,20,21,21,21,21,21,21,24,24,24,24,24,24,24,24,24,24,24,25,25,25,26,26,26,26,26,26,31,31,31,31,31,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,48,48,48,48,48,48,50,50,50,50,53,53,53,54,54,57,57,57,57,57,58,58,58,61,61,61,61,63,63,64,64,65,66,67,71,71,71,71,71,71,71,72,72,73,74,75,76,77,78,78,78,79,79,79,80,80,80,
81,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,82,82,84,84,84,84,84,84,86,86,86,90,90,90,90,90,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,93,93,93,94,94,94,96,96,96,98,98,98,98,98,98,102,102,102,102,102,102,102,102,102,103,103,103,103],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
