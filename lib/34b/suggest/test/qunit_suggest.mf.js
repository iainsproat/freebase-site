
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
if(!("JSON"in window&&window.JSON)){if(!this.JSON)this.JSON={};(function(){function c(i){return i<10?"0"+i:i}function g(i){a.lastIndex=0;return a.test(i)?'"'+i.replace(a,function(k){var m=j[k];return typeof m==="string"?m:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+i+'"'}function d(i,k){var m,l,p,q,n=b,r,o=k[i];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(i);if(typeof h==="function")o=h.call(k,i,o);switch(typeof o){case "string":return g(o);case "number":return isFinite(o)?
String(o):"null";case "boolean":case "null":return String(o);case "object":if(!o)return"null";b+=f;r=[];if(Object.prototype.toString.apply(o)==="[object Array]"){q=o.length;for(m=0;m<q;m+=1)r[m]=d(m,o)||"null";p=r.length===0?"[]":b?"[\n"+b+r.join(",\n"+b)+"\n"+n+"]":"["+r.join(",")+"]";b=n;return p}if(h&&typeof h==="object"){q=h.length;for(m=0;m<q;m+=1){l=h[m];if(typeof l==="string")if(p=d(l,o))r.push(g(l)+(b?": ":":")+p)}}else for(l in o)if(Object.hasOwnProperty.call(o,l))if(p=d(l,o))r.push(g(l)+
(b?": ":":")+p);p=r.length===0?"{}":b?"{\n"+b+r.join(",\n"+b)+"\n"+n+"}":"{"+r.join(",")+"}";b=n;return p}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,f,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(i,k,m){var l;f=b="";if(typeof m==="number")for(l=0;l<m;l+=1)f+=" ";else if(typeof m==="string")f=m;if((h=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw new Error("JSON.stringify");return d("",
{"":i})};if(typeof JSON.parse!=="function")JSON.parse=function(i,k){function m(p,q){var n,r,o=p[q];if(o&&typeof o==="object")for(n in o)if(Object.hasOwnProperty.call(o,n)){r=m(o,n);if(r!==undefined)o[n]=r;else delete o[n]}return k.call(p,q,o)}var l;i=String(i);e.lastIndex=0;if(e.test(i))i=i.replace(e,function(p){return"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(i.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+i+")");return typeof k==="function"?m({"":l},""):l}throw new SyntaxError("JSON.parse");}})()}
(function(c,g){if(!("console"in window)){var d=window.console={};d.log=d.warn=d.error=d.debug=function(){}}c(function(){var a=c("<div>");c(document.body).append(a);var b=setTimeout(function(){if(c.cleanData){var f=c.cleanData;c.cleanData=function(h){for(var i=0,k;(k=h[i])!=null;i++)c(k).triggerHandler("remove");f(h)}}else{var j=c.fn.remove;c.fn.remove=function(h,i){return this.each(function(){if(!i)if(!h||c.filter(h,[this]).length)c("*",this).add([this]).each(function(){c(this).triggerHandler("remove")});
return j.call(c(this),h,i)})}}},1);a.bind("remove",function(){clearTimeout(b)});a.remove()});c.suggest=function(a,b){c.fn[a]=function(f){this.length||console.warn("Suggest: invoked on empty element set");return this.each(function(){if(this.nodeName)if(this.nodeName.toUpperCase()==="INPUT")this.type&&this.type.toUpperCase()!=="TEXT"&&console.warn("Suggest: unsupported INPUT type: "+this.type);else console.warn("Suggest: unsupported DOM element: "+this.nodeName);var j=c.data(this,a);j&&j._destroy();
c.data(this,a,new c.suggest[a](this,f))._init()})};c.suggest[a]=function(f,j){var h=this,i=this.options=c.extend(true,{},c.suggest.defaults,c.suggest[a].defaults,j),k=i.css_prefix=i.css_prefix||"",m=i.css;this.name=a;c.each(m,function(n){m[n]=k+m[n]});i.ac_param={};c.each(["key","filter","mql_filter","as_of_time"],function(n,r){var o=i[r];if(!(o===null||o==="")){if(typeof o==="object")o=JSON.stringify(o);i.ac_param[r]=o}});this._status={START:"",LOADING:"",SELECT:"",ERROR:""};if(i.status&&i.status instanceof
Array&&i.status.length>=3){this._status.START=i.status[0]||"";this._status.LOADING=i.status[1]||"";this._status.SELECT=i.status[2]||"";if(i.status.length===4)this._status.ERROR=i.status[3]||""}var l=this.status=c('<div style="display:none;">').addClass(m.status),p=this.list=c("<ul>").addClass(m.list),q=this.pane=c('<div style="display:none;" class="fbs-reset">').addClass(m.pane);q.append(l).append(p);if(i.parent)c(i.parent).append(q);else{q.css("position","absolute");i.zIndex&&q.css("z-index",i.zIndex);
c(document.body).append(q)}q.bind("mousedown",function(n){h.input.data("dont_hide",true);n.stopPropagation()}).bind("mouseup",function(n){h.input.data("dont_hide")&&h.input.focus();h.input.removeData("dont_hide");n.stopPropagation()}).bind("click",function(n){n.stopPropagation();if(n=h.get_selected()){h.onselect(n,true);h.hide_all()}});p.hover(function(n){h.hoverover_list(n)},function(n){h.hoverout_list(n)});this.input=c(f).attr("autocomplete","off").unbind(".suggest").bind("remove.suggest",function(){h._destroy()}).bind("keydown.suggest",
function(n){h.keydown(n)}).bind("keypress.suggest",function(n){h.keypress(n)}).bind("keyup.suggest",function(n){h.keyup(n)}).bind("blur.suggest",function(n){h.blur(n)}).bind("textchange.suggest",function(){h.textchange()}).bind("focus.suggest",function(n){h.focus(n)}).bind(c.browser.msie?"paste.suggest":"input.suggest",function(){clearTimeout(h.paste_timeout);h.paste_timeout=setTimeout(function(){h.textchange()},0)});this.onresize=function(){h.invalidate_position();if(q.is(":visible")){h.position();
if(i.flyout&&h.flyoutpane&&h.flyoutpane.is(":visible")){var n=h.get_selected();n&&h.flyout_position(n)}}};c(window).bind("resize.suggest",this.onresize).bind("scroll.suggest",this.onresize)};c.suggest[a].prototype=c.extend({},c.suggest.prototype,b)};c.suggest.prototype={_init:function(){},_destroy:function(){this.pane.remove();this.list.remove();this.input.unbind(".suggest");c(window).unbind("resize.suggest",this.onresize).unbind("scroll.suggest",this.onresize);this.input.removeData("data.suggest")},
invalidate_position:function(){self._position=null},status_start:function(){this.hide_all();this.status.siblings().hide();if(this._status.START){this.status.text(this._status.START).show();if(!this.pane.is(":visible")){this.position();this.pane_show()}}this._status.LOADING&&this.status.removeClass("loading")},status_loading:function(){this.status.siblings().show();if(this._status.LOADING){this.status.addClass("loading").text(this._status.LOADING).show();if(!this.pane.is(":visible")){this.position();
this.pane_show()}}else this.status.hide()},status_select:function(){this.status.siblings().show();this._status.SELECT?this.status.text(this._status.SELECT).show():this.status.hide();this._status.LOADING&&this.status.removeClass("loading")},status_error:function(){this.status.siblings().show();this._status.ERROR?this.status.text(this._status.ERROR).show():this.status.hide();this._status.LOADING&&this.status.removeClass("loading")},focus:function(a){this.input.val()===""?this.status_start():this.focus_hook(a)},
focus_hook:function(){if(!this.input.data("data.suggest")&&!this.pane.is(":visible")&&c("."+this.options.css.item,this.list).length){this.position();this.pane_show()}},keydown:function(a){var b=a.keyCode;if(b===9)this.tab(a);else if(b===38||b===40)a.shiftKey||a.preventDefault()},keypress:function(a){var b=a.keyCode;if(b===38||b===40)a.shiftKey||a.preventDefault();else b===13&&this.enter(a)},keyup:function(a){var b=a.keyCode;if(b===38){a.preventDefault();this.up(a)}else if(b===40){a.preventDefault();
this.down(a)}else if(a.ctrlKey&&b===77)c(".fbs-more-link",this.pane).click();else if(c.suggest.is_char(a)){clearTimeout(this.keypress.timeout);var f=this;this.keypress.timeout=setTimeout(function(){f.textchange()},0)}else b===27&&this.escape(a);return true},blur:function(a){if(!this.input.data("dont_hide")){this.input.data("data.suggest")||this.check_required(a);this.hide_all()}},tab:function(a){if(!(a.shiftKey||a.metaKey||a.ctrlKey)){a=this.options;a=this.pane.is(":visible")&&c("."+a.css.item,this.list).length;
var b=this.get_selected();if(a&&b){this.onselect(b);this.hide_all()}}},enter:function(a){var b=this.options;if(this.pane.is(":visible"))if(a.shiftKey){this.shift_enter(a);a.preventDefault()}else if(c("."+b.css.item,this.list).length){var f=this.get_selected();if(f){this.onselect(f);this.hide_all();a.preventDefault()}else{f=this.input.data("data.suggest");if(b.soft)f||this.check_required(a);else if(c("."+this.options.css.item+":visible",this.list).length){this.updown(false);a.preventDefault()}else f||
this.check_required(a)}}},shift_enter:function(){},escape:function(){this.hide_all()},up:function(a){this.updown(true,a.ctrlKey||a.shiftKey)},down:function(a){this.updown(false,null,a.ctrlKey||a.shiftKey)},updown:function(a,b,f){var j=this.options.css,h=this.list;if(this.pane.is(":visible")){var i=c("."+j.item+":visible",h);if(i.length){h=c(i[0]);i=c(i[i.length-1]);var k=this.get_selected()||[];clearTimeout(this.ignore_mouseover.timeout);this._ignore_mouseover=false;if(a)if(b)this._goto(h);else if(k.length)if(k[0]==
h[0]){h.removeClass(j.selected);this.input.val(this.input.data("original.suggest"));this.hoverout_list()}else this._goto(k.prevAll("."+j.item+":visible:first"));else this._goto(i);else if(f)this._goto(i);else if(k.length)if(k[0]==i[0]){i.removeClass(j.selected);this.input.val(this.input.data("original.suggest"));this.hoverout_list()}else this._goto(k.nextAll("."+j.item+":visible:first"));else this._goto(h)}}else a||this.textchange()},_goto:function(a){a.trigger("mouseover.suggest");var b=a.data("data.suggest");
this.input.val(b?b.name:this.input.data("original.suggest"));this.scroll_to(a)},scroll_to:function(a){var b=this.list,f=b.scrollTop(),j=f+b.innerHeight(),h=a.outerHeight();a=a.prevAll().length*h;h=a+h;if(a<f){this.ignore_mouseover();b.scrollTop(a)}else if(h>j){this.ignore_mouseover();b.scrollTop(f+h-j)}},textchange:function(){this.input.removeData("data.suggest");this.input.trigger("fb-textchange",this);var a=this.input.val();if(a==="")this.status_start();else{this.status_loading();this.request(a)}},
request:function(){},response:function(a){if(a){"cost"in a&&this.trackEvent(this.name,"response","cost",a.cost);if(this.check_response(a)){var b=[];if(c.isArray(a))b=a;else if("result"in a)b=a.result;var f=c.map(arguments,function(m){return m});this.response_hook.apply(this,f);var j=null,h=this,i=this.options;c.each(b,function(m,l){if(!l.id&&l.mid)l.id=l.mid;var p=h.create_item(l,a).bind("mouseover.suggest",function(q){h.mouseover_item(q)}).data("data.suggest",l);h.list.append(p);if(m===0)j=p});this.input.data("original.suggest",
this.input.val());if(c("."+i.css.item,this.list).length===0&&i.nomatch){b=c('<li class="fbs-nomatch">');if(typeof i.nomatch==="string")b.text(i.nomatch);else{i.nomatch.title&&b.append(c('<em class="fbs-nomatch-text">').text(i.nomatch.title));i.nomatch.heading&&b.append(c("<h3>").text(i.nomatch.heading));if((i=i.nomatch.tips)&&i.length){var k=c('<ul class="fbs-search-tips">');c.each(i,function(m,l){k.append(c("<li>").text(l))});b.append(k)}}b.bind("click.suggest",function(m){m.stopPropagation()});
this.list.append(b)}f.push(j);this.show_hook.apply(this,f);this.position();this.pane_show()}}},pane_show:function(){var a=false;if(c("> li",this.list).length)a=true;a||this.pane.children(":not(."+this.options.css.list+")").each(function(){if(c(this).css("display")!="none"){a=true;return false}});if(a)if(this.options.animate){var b=this;this.pane.slideDown("fast",function(){b.input.trigger("fb-pane-show",b)})}else{this.pane.show();this.input.trigger("fb-pane-show",this)}else{this.pane.hide();this.input.trigger("fb-pane-hide",
this)}},create_item:function(a){var b=this.options.css,f=c("<li>").addClass(b.item);a=c("<label>").text(a.name);f.append(c("<div>").addClass(b.item_name).append(a));return f},mouseover_item:function(a){if(!this._ignore_mouseover){a=a.target;if(a.nodeName.toLowerCase()!=="li")a=c(a).parents("li:first");var b=c(a),f=this.options.css;c("."+f.item,this.list).each(function(){this!==b[0]&&c(this).removeClass(f.selected)});if(!b.hasClass(f.selected)){b.addClass(f.selected);this.mouseover_item_hook(b)}}},
mouseover_item_hook:function(){},hoverover_list:function(){},hoverout_list:function(){},check_response:function(){return true},response_hook:function(){this.list.empty()},show_hook:function(){this.status_select()},position:function(){var a=this.pane,b=this.options;if(!b.parent){if(!self._position){var f=this.input,j=f.offset(),h=f.outerWidth(true),i=f.outerHeight(true);j.top+=i;var k=a.outerWidth(),m=a.outerHeight(),l=j.top+m/2,p=c(window).scrollLeft();f=c(window).scrollTop();var q=c(window).width(),
n=c(window).height()+f,r=true;if("left"==b.align)r=true;else if("right"==b.align)r=false;else if(j.left>p+q/2)r=false;if(!r){r=j.left-(k-h);if(r>p)j.left=r}if(l>n){b=j.top-i-m;if(b>f)j.top=b}this._position=j}a.css({top:this._position.top,left:this._position.left})}},ignore_mouseover:function(){this._ignore_mouseover=true;var a=this;this.ignore_mouseover.timeout=setTimeout(function(){a.ignore_mouseover_reset()},1E3)},ignore_mouseover_reset:function(){this._ignore_mouseover=false},get_selected:function(){var a=
null,b=this.options.css.selected;c("li",this.list).each(function(){var f=c(this);if(f.hasClass(b)&&f.is(":visible")){a=f;return false}});return a},onselect:function(a){var b=a.data("data.suggest");if(b){this.input.val(b.name).data("data.suggest",b).trigger("fb-select",b);this.trackEvent(this.name,"fb-select","index",a.prevAll().length)}},trackEvent:function(a,b,f,j){this.input.trigger("fb-track-event",{category:a,action:b,label:f,value:j})},check_required:function(a){var b=this.options.required;if(b===
true){if(this.input.val()!==""){this.input.trigger("fb-required",{domEvent:a});return false}}else if(b==="always"){this.input.trigger("fb-required",{domEvent:a});return false}return true},hide_all:function(){this.pane.hide();this.input.trigger("fb-pane-hide",this)}};c.extend(c.suggest,{defaults:{status:["Start typing to get suggestions...","Searching...","Select an item from the list:","Sorry, something went wrong. Please try again later"],required:false,soft:false,nomatch:"no matches",css:{pane:"fbs-pane",
list:"fbs-list",item:"fbs-item",item_name:"fbs-item-name",selected:"fbs-selected",status:"fbs-status"},css_prefix:null,parent:null,animate:false,zIndex:null},$$:function(a,b){return c("."+a,b)},use_jsonp:function(a){if(!a)return false;var b=window.location.href;b=b.substr(0,b.length-window.location.pathname.length);if(b===a)return false;return true},strongify:function(a,b){var f,j=a.toLowerCase().indexOf(b.toLowerCase());if(j>=0){var h=b.length;f=document.createTextNode(a.substring(0,j));var i=c("<strong>").text(a.substring(j,
j+h));j=document.createTextNode(a.substring(j+h));f=c("<div>").append(f).append(i).append(j)}else f=c("<div>").text(a);return f},keyCode:{CAPS_LOCK:20,CONTROL:17,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ENTER:108,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,OPTION:18,APPLE:224},is_char:function(a){if(a.type==="keypress")if((a.metaKey||a.ctrlKey)&&a.charCode===118)return true;else{if("isChar"in a)return a.isChar}else{var b=c.suggest.keyCode.not_char;if(!b){b=
{};c.each(c.suggest.keyCode,function(f,j){b[""+j]=1});c.suggest.keyCode.not_char=b}return!(""+a.keyCode in b)}}});var e={_destroy:c.suggest.prototype._destroy,show_hook:c.suggest.prototype.show_hook};c.suggest("suggest",{_init:function(){var a=this,b=this.options;if(!b.flyout_service_url)b.flyout_service_url=b.service_url;this.jsonp=true;if(!c.suggest.cache)c.suggest.cache={};if(b.flyout){this.flyoutpane=c('<div style="display:none;" class="fbs-reset">').addClass(b.css.flyoutpane);if(b.flyout_parent)c(b.flyout_parent).append(this.flyoutpane);
else{this.flyoutpane.css("position","absolute");b.zIndex&&this.flyoutpane.css("z-index",b.zIndex);c(document.body).append(this.flyoutpane)}this.flyoutpane.hover(function(f){a.hoverover_list(f)},function(f){a.hoverout_list(f)}).bind("mousedown.suggest",function(f){f.stopPropagation();a.pane.click()});if(!c.suggest.flyout)c.suggest.flyout={};if(!c.suggest.flyout.cache)c.suggest.flyout.cache={}}},_destroy:function(){e._destroy.call(this);this.flyoutpane&&this.flyoutpane.remove();this.input.removeData("request.count.suggest");
this.input.removeData("flyout.request.count.suggest")},shift_enter:function(a){if(this.options.suggest_new){this.suggest_new();this.hide_all()}else this.check_required(a)},hide_all:function(){this.pane.hide();this.flyoutpane&&this.flyoutpane.hide();this.input.trigger("fb-pane-hide",this);this.input.trigger("fb-flyoutpane-hide",this)},request:function(a,b){var f=this,j=this.options;if(this.ac_xhr){this.ac_xhr.abort();this.ac_xhr=null}var h={query:a,prefixed:true,format:"ac"};if(b)h.cursor=b;c.extend(h,
j.ac_param);var i=j.service_url+j.service_path+"?"+c.param(h),k=c.suggest.cache[i];if(k)this.response(k,b?b:-1,true);else{clearTimeout(this.request.timeout);var m={url:j.service_url+j.service_path,data:h,beforeSend:function(){var l=f.input.data("request.count.suggest")||0;l||f.trackEvent(f.name,"start_session");l+=1;f.trackEvent(f.name,"request","count",l);f.input.data("request.count.suggest",l)},success:function(l){c.suggest.cache[i]=l;l.prefix=a;f.response(l,b?b:-1)},error:function(l){f.status_error();
f.trackEvent(f.name,"request","error",{url:this.url,response:l?l.responseText:""});f.input.trigger("fb-error",Array.prototype.slice.call(arguments))},complete:function(l){l&&f.trackEvent(f.name,"request","tid",l.getResponseHeader("X-Metaweb-TID"))},dataType:f.jsonp?"jsonp":"json",cache:true};this.request.timeout=setTimeout(function(){f.ac_xhr=c.ajax(m)},j.xhr_delay)}},create_item:function(a,b){var f=this.options.css,j=c("<li>").addClass(f.item),h=c("<div>").addClass(f.item_name).append(c("<label>").append(c.suggest.strongify(a.name||
a.guid,b.prefix)));j.append(h);var i=a.notable;f=c("<div>").addClass(f.item_type);i&&i.name&&f.text(i.name);h.prepend(f);return j},mouseover_item_hook:function(a){a=a.data("data.suggest");this.options.flyout&&a&&this.flyout_request(a)},check_response:function(a){return a.prefix===this.input.val()},response_hook:function(a,b){this.flyoutpane&&this.flyoutpane.hide();b>0?c(".fbs-more",this.pane).remove():this.list.empty()},show_hook:function(a,b,f){e.show_hook.apply(this,[a]);var j=this.options,h=this,
i=this.pane,k=this.list,m=a.result,l=c(".fbs-more",i),p=c(".fbs-suggestnew",i);if(m&&m.length&&"cursor"in a){if(!l.length){m=c('<a class="fbs-more-link" href="#" title="(Ctrl+m)">view more</a>');l=c('<div class="fbs-more">').append(m);m.bind("click.suggest",function(q){q.preventDefault();q.stopPropagation();q=c(this).parent(".fbs-more");h.more(q.data("cursor.suggest"))});k.after(l)}l.data("cursor.suggest",a.cursor);l.show()}else l.remove();if(j.suggest_new){if(!p.length){a=c('<button class="fbs-suggestnew-button">');
a.text(j.suggest_new);p=c('<div class="fbs-suggestnew">').append('<div class="fbs-suggestnew-description">Your item not in the list?</div>').append(a).append('<span class="fbs-suggestnew-shortcut">(Shift+Enter)</span>').bind("click.suggest",function(q){q.stopPropagation();h.suggest_new(q)});i.append(p)}p.show()}else p.remove();if(f&&f.length&&b>0){b=f.prevAll().length*f.outerHeight();k.scrollTop();k.animate({scrollTop:b},"slow",function(){f.trigger("mouseover.suggest")})}},suggest_new:function(){var a=
this.input.val();if(a!==""){this.input.data("data.suggest",a).trigger("fb-select-new",a);this.trackEvent(this.name,"fb-select-new","index","new");this.hide_all()}},more:function(a){if(a){var b=this.input.data("original.suggest");b!==null&&this.input.val(b);this.request(this.input.val(),a);this.trackEvent(this.name,"more","cursor",a)}return false},flyout_request:function(a){var b=this;if(this.flyout_xhr){this.flyout_xhr.abort();this.flyout_xhr=null}var f=this.options,j=this.flyoutpane.data("data.suggest");
if(j&&a.id===j.id){if(!this.flyoutpane.is(":visible")){this.flyout_position(this.get_selected());this.flyoutpane.show();this.input.trigger("fb-flyoutpane-show",this)}}else if((j=c.suggest.flyout.cache[a.id])&&j.id&&j.html)this.flyout_response(j);else{var h={id:a.id};if(f.as_of_time)h.as_of_time=f.as_of_time;var i={url:f.flyout_service_url+f.flyout_service_path,data:h,beforeSend:function(){var k=b.input.data("flyout.request.count.suggest")||0;k+=1;b.trackEvent(b.name,"flyout.request","count",k);b.input.data("flyout.request.count.suggest",
k)},success:function(k){k=b.jsonp?k:{id:h.id,html:k};c.suggest.flyout.cache[k.id]=k;b.flyout_response(k)},error:function(k){b.trackEvent(b.name,"flyout","error",{url:this.url,response:k?k.responseText:""})},complete:function(k){k&&b.trackEvent(b.name,"flyout","tid",k.getResponseHeader("X-Metaweb-TID"))},dataType:b.jsonp?"jsonp":"html",cache:true};clearTimeout(this.flyout_request.timeout);this.flyout_request.timeout=setTimeout(function(){b.flyout_xhr=c.ajax(i)},f.xhr_delay);this.input.trigger("fb-request-flyout",
i)}},flyout_response:function(a){var b=this.pane,f=this.get_selected()||[];if(b.is(":visible")&&f.length)if((b=f.data("data.suggest"))&&a.id===b.id&&a.html){this.flyoutpane.html(a.html);this.flyout_position(f);this.flyoutpane.show().data("data.suggest",b);this.input.trigger("fb-flyoutpane-show",this)}},flyout_position:function(a){if(!this.options.flyout_parent){var b=this.pane,f=this.flyoutpane,j=this.options.css,h=g,i={top:parseInt(f.css("top"),10),left:parseInt(f.css("left"),10)},k=b.offset(),m=
b.outerWidth(),l=f.outerHeight(),p=f.outerWidth();if(this.options.flyout==="bottom"){h=k;m=this.input.offset();if(k.top<m.top)h.top-=l;else h.top+=b.outerHeight();f.addClass(j.flyoutpane+"-bottom")}else{h=a.offset();a=a.outerHeight();h.left+=m;var q=h.left+p;b=c(document.body).scrollLeft();var n=c(window).width()+b;h.top=h.top+a-l;if(h.top<k.top)h.top=k.top;if(q>n){k=h.left-(m+p);if(k>b)h.left=k}f.removeClass(j.flyoutpane+"-bottom")}h.top===i.top&&h.left===i.left||f.css({top:h.top,left:h.left})}},
hoverout_list:function(){this.flyoutpane&&!this.get_selected()&&this.flyoutpane.hide()}});c.extend(c.suggest.suggest,{defaults:{mql_filter:null,as_of_time:null,filter:null,key:null,service_url:"https://www.googleapis.com",service_path:"/freebase/v1/search",align:null,flyout:true,flyout_service_url:"http://www.freebase.com",flyout_service_path:"/private/flyout",flyout_parent:null,suggest_new:null,nomatch:{title:"No suggested matches",heading:"Tips on getting better suggestions:",tips:["Enter more or fewer characters",
"Add words related to your original search","Try alternate spellings","Check your spelling"]},css:{item_type:"fbs-item-type",flyoutpane:"fbs-flyout-pane"},xhr_delay:200}});document.createElement("input")})(jQuery);
(function(c){c.fn.extend({simulate:function(g,d){return this.each(function(){var e=c.extend({},c.simulate.defaults,d||{});new c.simulate(this,g,e)})}});c.simulate=function(g,d,e){this.target=g;this.options=e;/^drag$/.test(d)?this[d].apply(this,[this.target,e]):this.simulateEvent(g,d,e)};c.extend(c.simulate.prototype,{simulateEvent:function(g,d,e){var a=this.createEvent(d,e);this.dispatchEvent(g,d,a,e);return a},createEvent:function(g,d){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(g))return this.mouseEvent(g,
d);else if(/^key(up|down|press)$/.test(g))return this.keyboardEvent(g,d)},mouseEvent:function(g,d){var e,a=c.extend({bubbles:true,cancelable:g!="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},d);c(a.relatedTarget);if(c.isFunction(document.createEvent)){e=document.createEvent("MouseEvents");e.initMouseEvent(g,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,
a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget||document.body.parentNode)}else if(document.createEventObject){e=document.createEventObject();c.extend(e,a);e.button={0:1,1:4,2:2}[e.button]||e.button}return e},keyboardEvent:function(g,d){var e,a=c.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},d);if(c.isFunction(document.createEvent))try{e=document.createEvent("KeyEvents");e.initKeyEvent(g,a.bubbles,a.cancelable,
a.view,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode)}catch(b){e=document.createEvent("Events");e.initEvent(g,a.bubbles,a.cancelable);c.extend(e,{view:a.view,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey,keyCode:a.keyCode,charCode:a.charCode})}else if(document.createEventObject){e=document.createEventObject();c.extend(e,a)}if(c.browser.msie||c.browser.opera){e.keyCode=a.charCode>0?a.charCode:a.keyCode;e.charCode=undefined}return e},dispatchEvent:function(g,
d,e){if(g.dispatchEvent)g.dispatchEvent(e);else g.fireEvent&&g.fireEvent("on"+d,e);return e},drag:function(){var g=this.findCenter(this.target),d=this.options,e=Math.floor(g.x);g=Math.floor(g.y);var a=d.dx||0;d=d.dy||0;var b=this.target,f={clientX:e,clientY:g};this.simulateEvent(b,"mousedown",f);f={clientX:e+1,clientY:g+1};this.simulateEvent(document,"mousemove",f);f={clientX:e+a,clientY:g+d};this.simulateEvent(document,"mousemove",f);this.simulateEvent(document,"mousemove",f);this.simulateEvent(b,
"mouseup",f)},findCenter:function(g){g=c(this.target);var d=g.offset();return{x:d.left+g.outerWidth()/2,y:d.top+g.outerHeight()/2}}});c.extend(c.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})})(jQuery);var test_input1,test_input2,test_input3,test_input4;$(function(){test_input1=$("#test1");test_input2=$("#test2");test_input3=$("#test3");test_input4=$("#test4")});
var module_options={setup:function(){},teardown:function(){$.suggest.cache={};if($.suggest.flyout)$.suggest.flyout.cache={};$.each([test_input1,test_input2,test_input3,test_input4],function(c,g){g.unbind();var d=get_instance(g);d&&d._destroy();g.val("")})}},default_options={service_path:"/freebase/v1-sandbox/search",key:"AIzaSyBk_TTTJQ_QaBKP1SmwzOb5-YwXQwmBOOA"},test_value="bob dyla",bob_dylan_id="/m/01vrncs",position_threshold=10;
function get_instance(c){c=c||test_input1;return c.data("suggest")}function test_timeout(){return setTimeout(function(){ok(false,"test_timeout");start()},1E4)}function simulate_keypress(c,g){var d=g;if(typeof d!=="object")d={keyCode:d};c.simulate("keydown",d);c.simulate("keyup",d);c.simulate("keypress",d)}function simulate_mouseclick(c){c.simulate("mousedown").simulate("mouseup").simulate("mouseclick").click()}
$(function(){function c(d){var e=get_instance();ok(e.pane.hasClass(d.pane),"css.pane");ok(e.status.hasClass(d.status),"css.status");ok(e.list.hasClass(d.list),"css.list");ok(e.flyoutpane.hasClass(d.flyoutpane),"css.flyoutpane");stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);$(">li",e.list).each(function(){$(this).hasClass(d.item);var b=$("."+d.item_name,this);equals(b.length,1);b=$("."+d.item_type,b);equals(b.length,1)});start()}}).val("css").trigger("textchange")}
function g(d,e,a){d=$.extend({},default_options,d);test_input1.suggest(d);var b=get_instance();stop();var f=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",b.list).length){clearTimeout(f);var j=$("li:first",b.list).data("data.suggest").id;typeof a==="function"?ok(a(j)):equals(j,a);start()}}).val(e).trigger("textchange")}module("options",module_options);test("css_prefix",function(){var d=$.extend({},default_options,{css_prefix:"test-"});test_input1.suggest(d);var e={};d=$.extend(true,
{},$.suggest.defaults.css,$.suggest.suggest.defaults.css);$.each(d,function(a,b){e[a]="test-"+b});c(e)});test("css",function(){var d={pane:"my-pane",list:"my-list",item:"my-item",item_name:"my-item-name",selected:"my-selected",status:"my-status",item_type:"my-item-type",flyoutpane:"my-flyout-pane"},e=$.extend({},default_options,{css:d});test_input1.suggest(e);c(d)});test("parent",1,function(){var d=$('<div id="parent">');$(document.body).append(d);var e=$.extend({},default_options,{parent:"#parent"});
test_input1.suggest(e);var a=get_instance();stop();var b=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",a.list).length){clearTimeout(b);equals(a.pane.parent()[0],d[0]);start()}}).val("bob dyl").trigger("textchange")});test("flyout_parent",1,function(){var d=$('<div id="flyout_parent">');$(document.body).append(d);var e=$.extend({},default_options,{flyout_parent:"#flyout_parent"});test_input1.suggest(e);var a=get_instance();stop();var b=test_timeout();test_input1.bind("fb-pane-show",
function(){$("li:first",a.list).trigger("mouseover")}).bind("fb-flyoutpane-show",function(){clearTimeout(b);equals(a.flyoutpane.parent()[0],d[0]);start()}).val("stephen colb").trigger("textchange")});test("status[0]",1,function(){var d=$.extend({},default_options,{status:["0","1","2","3"]});test_input1.suggest(d);d=get_instance();test_input1.val("").trigger("textchange");equals(d.status.text(),"0")});test("status[1]",1,function(){var d=$.extend({},default_options,{status:["0","1","2","3"]});test_input1.suggest(d);
d=get_instance();test_input1.val("obama").trigger("textchange");equals(d.status.text(),"1")});test("status[2]",1,function(){var d=$.extend({},default_options,{status:["0","1","2","3"]});test_input1.suggest(d);var e=get_instance();stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);equals(e.status.text(),"2");start()}}).val("hillary cli").trigger("textchange")});test("status[3]",1,function(){var d=$.extend({},default_options,{status:["0",
"1","2","3"]});test_input1.suggest(d);d=get_instance();d.status_error();equals(d.status.text(),"3")});test("required=true",1,function(){var d=$.extend({},default_options,{required:true});test_input1.suggest(d);d=get_instance();stop();var e=test_timeout();test_input1.bind("fb-required",function(){clearTimeout(e);ok(true);start()}).val("sakuragi hana").trigger("textchange");d.blur()});test("required=always",1,function(){var d=$.extend({},default_options,{required:"always"});test_input1.suggest(d);d=
get_instance();stop();var e=test_timeout();test_input1.bind("fb-required",function(){clearTimeout(e);ok(true);start()}).val("").trigger("textchange");d.blur()});test("zIndex",1,function(){var d=$.extend({},default_options,{zIndex:1E3});test_input1.suggest(d);var e=get_instance();stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){clearTimeout(a);equals(e.pane.css("z-index"),1E3);start()}).val("shohoku").trigger("textchange")});test("flyout=false",1,function(){var d=$.extend({},
default_options,{flyout:false});test_input1.suggest(d);var e=get_instance();stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);$("li:first",e.list).trigger("mouseover");a=setTimeout(function(){ok(true,"flyout not shown");start()},5E3)}}).bind("fb-flyoutpane-show",function(){clearTimeout(a);fail("flyout shown when flyout=false");start()}).val("avatar").trigger("textchange")});test("flyout=bottom",1,function(){var d=$.extend({},default_options,
{flyout:"bottom"});test_input1.suggest(d);var e=get_instance();stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){$("li:first",e.list).trigger("mouseover")}).bind("fb-flyoutpane-show",function(){clearTimeout(a);var b=e.pane.offset(),f=e.flyoutpane.offset();ok(Math.abs(f.top-(b.top+e.pane.height()))<position_threshold);start()}).val("avatar").trigger("textchange")});test("align=left",1,function(){var d=$.extend({},default_options,{align:"left"});test_input1.suggest(d);var e=get_instance();
stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);ok(Math.abs(e.pane.offset().left-test_input1.offset().left)<position_threshold);start()}}).val("lady ga").trigger("textchange")});test("align=right",1,function(){var d=$.extend({},default_options,{align:"right"});test_input3.suggest(d);var e=get_instance(test_input3);stop();var a=test_timeout();test_input3.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);var b=
e.pane.offset().left+e.pane.width(),f=test_input3.offset().left+test_input3.width();ok(Math.abs(b-f)<position_threshold);start()}}).val("jessica alb").trigger("textchange")});test("suggest_new",1,function(){var d=$.extend({},default_options,{suggest_new:"suggest_new"});test_input1.suggest(d);var e=get_instance();stop();var a=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){clearTimeout(a);equals($("button:first",e.pane).text(),"suggest_new");start()}}).val("aplusk").trigger("textchange")});
$.each(["(any type:/music/artist)","(any type:/people/person type:/music/artist)","(all type:/music/artist)","(all type:/people/person type:/music/artist)","(should type:/music/artist)","(should type:/people/person)"],function(d,e){test("filter="+e,1,function(){g({filter:e},"bob dylan",bob_dylan_id)})});$.each([[{"/film/film/directed_by":"Steven Spielberg"}],JSON.stringify([{"/film/film/directed_by":{id:"/m/06pj8"}}])],function(d,e){if(typeof e!=="string")e=JSON.stringify(e);test("mql_filter="+e,
1,function(){g({filter:"(any type:/film/film)",mql_filter:e},"saving","/m/07024")})})});
$(function(){module("events",module_options);test("fb-pane-show",1,function(){test_input1.suggest(default_options);var c=get_instance();stop();var g=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",c.list).length){clearTimeout(g);ok(true,"got fb-pane-show");start()}}).focus().val("bob dylan").trigger("textchange")});test("fb-flyoutpane-show",1,function(){test_input1.suggest(default_options);var c=get_instance();stop();var g=test_timeout();test_input1.bind("fb-flyoutpane-show",
function(){clearTimeout(g);ok(true,"got fb-flyoutpane-show");start()}).bind("fb-pane-show",function(){$(">li",c.list).length&&$("li:first",c.list).simulate("mouseover")}).focus().val("bob dylan").trigger("textchange")});test("fb-select",2,function(){var c=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(c);var g=get_instance();stop();var d=test_timeout();test_input1.bind("fb-select",function(e,a){clearTimeout(d);ok(a);equals(a.id,bob_dylan_id);start()}).bind("fb-pane-show",
function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("fb-select-new",1,function(){var c=$.extend({},default_options,{suggest_new:"new"});test_input1.suggest(c);var g=get_instance();stop();var d=test_timeout();test_input1.bind("fb-select-new",function(e,a){clearTimeout(d);equals(a,"bob dylan");start()}).bind("fb-pane-show",function(){$(">li",g.list).length&&$(".fbs-suggestnew",
g.pane).click()}).focus().val("bob dylan").trigger("textchange")});test("fb-textchange",1,function(){test_input1.suggest(default_options);stop();var c=test_timeout();test_input1.bind("fb-textchange",function(){clearTimeout(c);ok(true,"got fb-textchange");start()}).focus();simulate_keypress(test_input1,68)})});
$(function(){function c(g,d){test("select: "+g,2,function(){var e=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(e);var a=get_instance();stop();var b=test_timeout();test_input1.bind("fb-select",function(f,j){clearTimeout(b);ok(j);equals(j.id,bob_dylan_id);start()}).bind("fb-pane-show",function(){$(">li",a.list).length&&d()}).focus().val("bob dylan").trigger("textchange")})}module("ux",module_options);c("MOUSEOVER MOUSECLICK",function(){var g=get_instance();g=
$("li:first",g.list).simulate("mouseover");simulate_mouseclick(g)});c("MOUSEOVER ENTER",function(){var g=get_instance();$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)});c("ENTER ENTER",function(){simulate_keypress(test_input1,$.simulate.VK_ENTER);simulate_keypress(test_input1,$.simulate.VK_ENTER)});c("DOWN ENTER",function(){simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_ENTER)});c("UP DOWN DOWN ENTER",function(){simulate_keypress(test_input1,
$.simulate.VK_UP);simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_ENTER)});c("CTRL+UP ENTER",function(){simulate_keypress(test_input1,{keyCode:$.simulate.VK_UP,ctrlKey:true});simulate_keypress(test_input1,$.simulate.VK_ENTER)});c("CTRL+DOWN DOWN DOWN ENTER",function(){simulate_keypress(test_input1,{keyCode:$.simulate.VK_DOWN,ctrlKey:true});simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,
$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_ENTER)});test("select: flyout",2,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance();stop();var e=test_timeout();test_input1.bind("fb-select",function(a,b){clearTimeout(e);ok(b);equals(b.id,bob_dylan_id);start()}).bind("fb-flyoutpane-show",function(){simulate_mouseclick(d.flyoutpane)}).bind("fb-pane-show",function(){$(">li",d.list).length&&simulate_keypress(test_input1,
$.simulate.VK_DOWN)}).focus().val("bob dylan").trigger("textchange")});test("suggest_new: SHIFT+ENTER",1,function(){var g=$.extend({},default_options,{suggest_new:"new"});test_input1.suggest(g);var d=get_instance();stop();var e=test_timeout();test_input1.bind("fb-select-new",function(a,b){clearTimeout(e);equals(b,"bob dylan");start()}).bind("fb-pane-show",function(){$(">li",d.list).length&&simulate_keypress(test_input1,{keyCode:$.simulate.VK_ENTER,shiftKey:true})}).focus().val("bob dylan").trigger("textchange")});
test("more: CLICK",1,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance(),e=false,a=0;stop();var b=test_timeout();test_input1.bind("fb-pane-show",function(){if(e){clearTimeout(b);ok($(">li",d.list).length>a,"got more");start()}else if(a=$(">li",d.list).length){$(".fbs-more-link",d.pane).click();e=true}}).focus().val("bob dylan").trigger("textchange")});test("more: CTRL+M",1,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});
test_input1.suggest(g);var d=get_instance(),e=false,a=0;stop();var b=test_timeout();test_input1.bind("fb-pane-show",function(){if(e){clearTimeout(b);ok($(">li",d.list).length>a,"got more");start()}else if(a=$(">li",d.list).length){simulate_keypress(test_input1,{keyCode:77,ctrlKey:true});e=true}}).focus().val("bob dylan").trigger("textchange")});test("cancel: ESC",2,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance();stop();
var e=test_timeout();test_input1.bind("fb-pane-show",function(){if($(">li",d.list).length){clearTimeout(e);ok(d.pane.is(":visible"),"pane visible");simulate_keypress(test_input1,$.simulate.VK_ESC);ok(!d.pane.is(":visible"),"pane NOT visible");start()}}).focus().val("bob dylan").trigger("textchange")})});
$(function(){module("functional",module_options);test("remove",function(){var c=$.extend({},default_options,{type:"/music/artist"});test_input4.suggest(c);c=get_instance(test_input4);var g=c.pane,d=c.flyoutpane;ok(c,"suggest initialized");test_input4.remove();ok(!g.parent().is("body"),"suggest pane not removed");ok(!d.parent().is("body"),"suggest flyoutpane not removed")});test("flyout abort (CLI-10009)",function(){test_input1.suggest(default_options);var c=get_instance();stop();var g=test_timeout();
test_input1.bind("fb-flyoutpane-show",function(){clearTimeout(g);ok(true,"got fb-flyoutpane-show");ok(c.flyoutpane.html(),"got non-empty flyout pane");start()}).bind("fb-request-flyout",function(d,e){console.log("fb-request-flyout",e);clearTimeout(c.flyout_request.timeout);var a=e.data.id;$.suggest.flyout.cache[a]={id:a};test_input1.unbind("fb-request-flyout").trigger("textchange")}).bind("fb-pane-show",function(){$(">li",c.list).length&&$("li:first",c.list).simulate("mouseover")}).focus().val("bob dylan").trigger("textchange")})});
$(function(){var c={teardown:module_options.teardown,response:$.suggest.suggest.prototype.response};module("xss",$.extend({},module_options,{teardown:function(){c.teardown.apply();$.suggest.suggest.prototype.response=c.response}}));test("script_injection",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=function(e){var a=e.result;if(a&&a.length)a[0].name="<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>";return c.response.apply(this,
arguments)};stop();var d=test_timeout();test_input1.bind("fb-select",function(e,a){clearTimeout(d);ok(a);equals(a.name,"<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>");var b=$("#xss");ok(!b.length,"script injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("script_injection strongified",function(){test_input1.suggest(default_options);
var g=get_instance();$.suggest.suggest.prototype.response=function(e){var a=e.result;if(a&&a.length)a[0].name="bob dylan<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>";return c.response.apply(this,arguments)};stop();var d=test_timeout();test_input1.bind("fb-select",function(e,a){clearTimeout(d);ok(a);equals(a.name,"bob dylan<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>");var b=$("#xss");ok(!b.length,"script injection!");start()}).bind("fb-pane-show",
function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("link_injection",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=function(e){var a=e.result;if(a&&a.length)a[0].name='<a href="javascript:alert("XSS");">click me</a>';return c.response.apply(this,arguments)};stop();var d=test_timeout();test_input1.bind("fb-select",
function(e,a){clearTimeout(d);ok(a);equals(a.name,'<a href="javascript:alert("XSS");">click me</a>');var b=$("li:first",g.list);b=$("a",b);ok(!b.length,"link injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("link_injection strongified",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=
function(e){var a=e.result;if(a&&a.length)a[0].name='<a href="javascript:alert("XSS");">click me</a>bob dylan';return c.response.apply(this,arguments)};stop();var d=test_timeout();test_input1.bind("fb-select",function(e,a){clearTimeout(d);ok(a);equals(a.name,'<a href="javascript:alert("XSS");">click me</a>bob dylan');var b=$("li:first",g.list);b=$("a",b);ok(!b.length,"link injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,
$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")})});
