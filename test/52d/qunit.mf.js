
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
(function(n){function y(){if(e.doneTimer&&n.clearTimeout){n.clearTimeout(e.doneTimer);e.doneTimer=null}if(e.queue.length)e.doneTimer=n.setTimeout(function(){e.queue.length?u(y):y()},13);else{e.autorun=true;e.currentModule&&j.moduleDone(e.currentModule,e.moduleStats.bad,e.moduleStats.all);var b=o("qunit-banner"),c=o("qunit-tests"),d=["Tests completed in ",+new Date-e.started,' milliseconds.<br/><span class="passed">',e.stats.all-e.stats.bad,'</span> tests of <span class="total">',e.stats.all,'</span> passed, <span class="failed">',
e.stats.bad,"</span> failed."].join("");if(b)b.className=e.stats.bad?"qunit-fail":"qunit-pass";if(c){b=o("qunit-testresult");if(!b){b=document.createElement("p");b.id="qunit-testresult";b.className="result";c.parentNode.insertBefore(b,c.nextSibling)}b.innerHTML=d}j.done(e.stats.bad,e.stats.all)}}function F(b){var c=e.filters.length,d=false;if(!c)return true;for(;c--;){var f=e.filters[c],i=f.charAt(0)=="!";if(i)f=f.slice(1);if(b.indexOf(f)!==-1)return!i;if(i)d=true}return d}function z(b){return(b===
null?"":b+"").replace(/[\&"<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return'"';case "<":return"&lt;";case ">":return"&gt;";default:return c}})}function v(b,c,d,f){f=z(f)||(b?"okay":"failed");f='<span class="test-message">'+f+"</span>";d=z(j.jsDump.parse(d));c=z(j.jsDump.parse(c));f=f+', expected: <span class="test-expected">'+d+"</span>";if(c!=d)f+=' result: <span class="test-actual">'+c+"</span>, diff: "+j.diff(d,c);j.log(b,f);e.assertions.push({result:!!b,
message:f})}function u(b){e.queue.push(b);e.autorun&&!e.blocking&&A()}function A(){for(var b=(new Date).getTime();e.queue.length&&!e.blocking;)if(e.updateRate<=0||(new Date).getTime()-b<e.updateRate)e.queue.shift()();else{setTimeout(A,13);break}}function B(){e.pollution=[];if(e.noglobals)for(var b in n)e.pollution.push(b)}function C(b,c){for(var d=b.slice(),f=0;f<d.length;f++)for(var i=0;i<c.length;i++)if(d[f]===c[i]){d.splice(f,1);f--;break}return d}function D(b,c,d){if(typeof console!=="undefined"&&
console.error&&console.warn){console.error(b);console.error(c);console.warn(d.toString())}else n.opera&&opera.postError&&opera.postError(b,c,d.toString)}function t(b,c){for(var d in c)b[d]=c[d];return b}function w(b,c,d){if(b.addEventListener)b.addEventListener(c,d,false);else b.attachEvent?b.attachEvent("on"+c,d):d()}function o(b){return!!(typeof document!=="undefined"&&document&&document.getElementById)&&document.getElementById(b)}function E(b){for(var c="",d,f=0;b[f];f++){d=b[f];if(d.nodeType===
3||d.nodeType===4)c+=d.nodeValue;else if(d.nodeType!==8)c+=E(d.childNodes)}return c}var j={module:function(b,c){e.currentModule=b;u(function(){e.currentModule&&j.moduleDone(e.currentModule,e.moduleStats.bad,e.moduleStats.all);e.currentModule=b;e.moduleTestEnvironment=c;e.moduleStats={all:0,bad:0};j.moduleStart(b,c)})},asyncTest:function(b,c,d){if(arguments.length===2){d=c;c=0}j.test(b,c,d,true)},test:function(b,c,d,f){var i='<span class="test-name">'+b+"</span>",g,a;if(arguments.length===2){d=c;c=
null}if(c&&typeof c==="object"){a=c;c=null}if(e.currentModule)i='<span class="module-name">'+e.currentModule+"</span>: "+i;if(F(e.currentModule+": "+b)){u(function(){g=t({setup:function(){},teardown:function(){}},e.moduleTestEnvironment);a&&t(g,a);j.testStart(b,g);j.current_testEnvironment=g;e.assertions=[];e.expected=c;var h=o("qunit-tests");if(h){var k=document.createElement("strong");k.innerHTML="Running "+i;var l=document.createElement("li");l.appendChild(k);l.id="current-test-output";h.appendChild(l)}try{e.pollution||
B();g.setup.call(g)}catch(m){j.ok(false,"Setup failed on "+i+": "+m.message)}});u(function(){f&&j.stop();try{d.call(g)}catch(h){D("Test "+i+" died, exception and test follows",h,d);j.ok(false,"Died on test #"+(e.assertions.length+1)+": "+h.message);B();e.blocking&&start()}});u(function(){try{var h=e.pollution;B();var k=C(h,e.pollution);if(k.length>0){ok(false,"Introduced global variable(s): "+k.join(", "));e.expected++}var l=C(e.pollution,h);if(l.length>0){ok(false,"Deleted global variable(s): "+
l.join(", "));e.expected++}g.teardown.call(g)}catch(m){j.ok(false,"Teardown failed on "+i+": "+m.message)}});u(function(){try{j.reset()}catch(h){D("reset() failed, following Test "+i+", exception and reset fn follows",h,j.reset)}e.expected&&e.expected!=e.assertions.length&&j.ok(false,"Expected "+e.expected+" assertions, but "+e.assertions.length+" were run");var k=0,l=0,m=o("qunit-tests");e.stats.all+=e.assertions.length;e.moduleStats.all+=e.assertions.length;if(m){m=document.createElement("ol");
for(var p=0;p<e.assertions.length;p++){var s=e.assertions[p],r=document.createElement("li");r.className=s.result?"pass":"fail";r.innerHTML=s.message||"(no message)";m.appendChild(r);if(s.result)k++;else{l++;e.stats.bad++;e.moduleStats.bad++}}if(l==0)m.style.display="none";var x=document.createElement("strong");x.innerHTML=i+" <b class='counts'>(<b class='failed'>"+l+"</b>, <b class='passed'>"+k+"</b>, "+e.assertions.length+")</b>";w(x,"click",function(){var q=x.nextSibling;q.style.display=q.style.display===
"none"?"block":"none"});w(x,"dblclick",function(q){q=q&&q.target?q.target:n.event.srcElement;if(q.nodeName.toLowerCase()=="span"||q.nodeName.toLowerCase()=="b")q=q.parentNode;if(n.location&&q.nodeName.toLowerCase()==="strong")n.location.search="?"+encodeURIComponent(E([q]).replace(/\(.+\)$/,"").replace(/(^\s*|\s*$)/g,""))});r=o("current-test-output");r.id="";r.className=l?"fail":"pass";r.removeChild(r.firstChild);r.appendChild(x);r.appendChild(m);if(l)if(k=o("qunit-testrunner-toolbar")){k.style.display=
"block";o("qunit-filter-pass").disabled=null;o("qunit-filter-missing").disabled=null}}else for(p=0;p<e.assertions.length;p++)if(!e.assertions[p].result){l++;e.stats.bad++;e.moduleStats.bad++}j.testDone(b,l,e.assertions.length);!n.setTimeout&&!e.queue.length&&y()});u(y)}},expect:function(b){e.expected=b},ok:function(b,c){c=z(c);j.log(b,c);e.assertions.push({result:!!b,message:c})},equal:function(b,c,d){v(c==b,b,c,d)},notEqual:function(b,c,d){v(c!=b,b,c,d)},deepEqual:function(b,c,d){v(j.equiv(b,c),
b,c,d)},notDeepEqual:function(b,c,d){v(!j.equiv(b,c),b,c,d)},strictEqual:function(b,c,d){v(c===b,b,c,d)},notStrictEqual:function(b,c,d){v(c!==b,b,c,d)},raises:function(b,c){try{b();ok(false,c)}catch(d){ok(true,c)}},start:function(){if(n.setTimeout)n.setTimeout(function(){e.timeout&&clearTimeout(e.timeout);e.blocking=false;A()},13);else{e.blocking=false;A()}},stop:function(b){e.blocking=true;if(b&&n.setTimeout)e.timeout=n.setTimeout(function(){j.ok(false,"Test timed out");j.start()},b)}};j.equals=
j.equal;j.same=j.deepEqual;var e={queue:[],blocking:true};(function(){for(var b=n.location||{search:"",protocol:"file:"},c=b.search.slice(1).split("&"),d=0;d<c.length;d++){c[d]=decodeURIComponent(c[d]);if(c[d]==="noglobals"){c.splice(d,1);d--;e.noglobals=true}else if(c[d].search("=")>-1){c.splice(d,1);d--}}e.filters=c;j.isLocal=b.protocol==="file:"})();if(typeof exports==="undefined"||typeof require==="undefined"){t(n,j);n.QUnit=j}else{t(exports,j);exports.QUnit=j}t(j,{config:e,init:function(){t(e,
{stats:{all:0,bad:0},moduleStats:{all:0,bad:0},started:+new Date,updateRate:1E3,blocking:false,autostart:true,autorun:false,assertions:[],filters:[],queue:[]});var b=o("qunit-tests"),c=o("qunit-banner"),d=o("qunit-testresult");if(b)b.innerHTML="";if(c)c.className="";d&&d.parentNode.removeChild(d)},reset:function(){n.jQuery&&jQuery("#main, #qunit-fixture").html(e.fixture)},triggerEvent:function(b,c,d){if(document.createEvent){d=document.createEvent("MouseEvents");d.initMouseEvent(c,true,true,b.ownerDocument.defaultView,
0,0,0,0,0,false,false,false,false,0,null);b.dispatchEvent(d)}else b.fireEvent&&b.fireEvent("on"+c)},is:function(b,c){return j.objectType(c)==b},objectType:function(b){if(typeof b==="undefined")return"undefined";if(b===null)return"null";var c=Object.prototype.toString.call(b).match(/^\[object\s(.*)\]$/)[1]||"";switch(c){case "Number":return isNaN(b)?"nan":"number";case "String":case "Boolean":case "Array":case "Date":case "RegExp":case "Function":return c.toLowerCase()}if(typeof b==="object")return"object"},
begin:function(){},done:function(){},log:function(){},testStart:function(){},testDone:function(){},moduleStart:function(){},moduleDone:function(){}});if(typeof document==="undefined"||document.readyState==="complete")e.autorun=true;w(n,"load",function(){j.begin();var b=t({},e);j.init();t(e,b);e.blocking=false;if(b=o("qunit-userAgent"))b.innerHTML=navigator.userAgent;if(b=o("qunit-header"))b.innerHTML='<a href="'+location.href+'">'+b.innerHTML+"</a>";if(b=o("qunit-testrunner-toolbar")){b.style.display=
"none";var c=document.createElement("input");c.type="checkbox";c.id="qunit-filter-pass";c.disabled=true;w(c,"click",function(){for(var i=document.getElementsByTagName("li"),g=0;g<i.length;g++)if(i[g].className.indexOf("pass")>-1)i[g].style.display=c.checked?"none":""});b.appendChild(c);var d=document.createElement("label");d.setAttribute("for","qunit-filter-pass");d.innerHTML="Hide passed tests";b.appendChild(d);var f=document.createElement("input");f.type="checkbox";f.id="qunit-filter-missing";f.disabled=
true;w(f,"click",function(){for(var i=document.getElementsByTagName("li"),g=0;g<i.length;g++)if(i[g].className.indexOf("fail")>-1&&i[g].innerHTML.indexOf("missing test - untested code is broken code")>-1)i[g].parentNode.parentNode.style.display=f.checked?"none":"block"});b.appendChild(f);d=document.createElement("label");d.setAttribute("for","qunit-filter-missing");d.innerHTML="Hide missing tests (untested code is broken code)";b.appendChild(d)}if(b=o("main")||o("qunit-fixture"))e.fixture=b.innerHTML;
e.autostart&&j.start()});j.equiv=function(){var b,c=[],d=[],f=function(){function i(g,a){return g instanceof a.constructor||a instanceof g.constructor?a==g:a===g}return{string:i,"boolean":i,number:i,"null":i,undefined:i,nan:function(g){return isNaN(g)},date:function(g,a){return j.objectType(g)==="date"&&a.valueOf()===g.valueOf()},regexp:function(g,a){return j.objectType(g)==="regexp"&&a.source===g.source&&a.global===g.global&&a.ignoreCase===g.ignoreCase&&a.multiline===g.multiline},"function":function(){var g=
c[c.length-1];return g!==Object&&typeof g!=="undefined"},array:function(g,a){var h,k,l,m;if(j.objectType(g)!=="array")return false;m=a.length;if(m!==g.length)return false;d.push(a);for(h=0;h<m;h++){l=false;for(k=0;k<d.length;k++)if(d[k]===a[h])l=true;if(!l&&!b(a[h],g[h])){d.pop();return false}}d.pop();return true},object:function(g,a){var h,k,l,m=true,p=[],s=[];if(a.constructor!==g.constructor)return false;c.push(a.constructor);d.push(a);for(h in a){l=false;for(k=0;k<d.length;k++)if(d[k]===a[h])l=
true;p.push(h);if(!l&&!b(a[h],g[h])){m=false;break}}c.pop();d.pop();for(h in g)s.push(h);return m&&b(p.sort(),s.sort())}}}();return b=function(){var i=Array.prototype.slice.apply(arguments);if(i.length<2)return true;var g;if(i[0]===i[1])g=true;else{if(i[0]===null||i[1]===null||typeof i[0]==="undefined"||typeof i[1]==="undefined"||j.objectType(i[0])!==j.objectType(i[1]))g=false;else{g=[i[1],i[0]];var a=j.objectType(i[0]);g=a?j.objectType(f[a])==="function"?f[a].apply(f,g):f[a]:void 0}g=g}return g&&
arguments.callee.apply(this,i.splice(1,i.length-1))}}();j.jsDump=function(){function b(a){return'"'+a.toString().replace(/"/g,'\\"')+'"'}function c(a){return a+""}function d(a,h,k){var l=g.separator(),m=g.indent(),p=g.indent(1);if(h.join)h=h.join(","+l+p);if(!h)return a+k;return[a,p+h,m+k].join(l)}function f(a){var h=a.length,k=Array(h);for(this.up();h--;)k[h]=this.parse(a[h]);this.down();return d("[",k,"]")}var i=/^function (\w+)/,g={parse:function(a,h){var k=this.parsers[h||this.typeOf(a)];h=typeof k;
return h=="function"?k.call(this,a):h=="string"?k:this.parsers.error},typeOf:function(a){return a===null?"null":typeof a==="undefined"?"undefined":j.is("RegExp",a)?"regexp":j.is("Date",a)?"date":j.is("Function",a)?"function":a.setInterval&&a.document&&!a.nodeType?"window":a.nodeType===9?"document":a.nodeType?"node":typeof a==="object"&&typeof a.length==="number"&&a.length>=0?"array":typeof a},separator:function(){return this.multiline?this.HTML?"<br />":"\n":this.HTML?"&nbsp;":" "},indent:function(a){if(!this.multiline)return"";
var h=this.indentChar;if(this.HTML)h=h.replace(/\t/g,"   ").replace(/ /g,"&nbsp;");return Array(this._depth_+(a||0)).join(h)},up:function(a){this._depth_+=a||1},down:function(a){this._depth_-=a||1},setParser:function(a,h){this.parsers[a]=h},quote:b,literal:c,join:d,_depth_:1,parsers:{window:"[Window]",document:"[Document]",error:"[ERROR]",unknown:"[Unknown]","null":"null",undefined:"undefined","function":function(a){var h="function",k="name"in a?a.name:(i.exec(a)||[])[1];if(k)h+=" "+k;h+="(";h=[h,
this.parse(a,"functionArgs"),"){"].join("");return d(h,this.parse(a,"functionCode"),"}")},array:f,nodelist:f,arguments:f,object:function(a){var h=[];this.up();for(var k in a)h.push(this.parse(k,"key")+": "+this.parse(a[k]));this.down();return d("{",h,"}")},node:function(a){var h=this.HTML?"&lt;":"<",k=this.HTML?"&gt;":">",l=a.nodeName.toLowerCase(),m=h+l;for(var p in this.DOMAttrs){var s=a[this.DOMAttrs[p]];if(s)m+=" "+p+"="+this.parse(s,"attribute")}return m+k+h+"/"+l+k},functionArgs:function(a){a=
a.length;if(!a)return"";for(var h=Array(a);a--;)h[a]=String.fromCharCode(97+a);return" "+h.join(", ")+" "},key:b,functionCode:"[code]",attribute:b,string:b,date:b,regexp:c,number:c,"boolean":c},DOMAttrs:{id:"id",name:"name","class":"className"},HTML:false,indentChar:"   ",multiline:false};return g}();j.diff=function(){return function(b,c){b=b.replace(/\s+$/,"");c=c.replace(/\s+$/,"");var d;d=b==""?[]:b.split(/\s+/);for(var f=c==""?[]:c.split(/\s+/),i={},g={},a=0;a<f.length;a++){if(i[f[a]]==null)i[f[a]]=
{rows:[],o:null};i[f[a]].rows.push(a)}for(a=0;a<d.length;a++){if(g[d[a]]==null)g[d[a]]={rows:[],n:null};g[d[a]].rows.push(a)}for(a in i)if(i[a].rows.length==1&&typeof g[a]!="undefined"&&g[a].rows.length==1){f[i[a].rows[0]]={text:f[i[a].rows[0]],row:g[a].rows[0]};d[g[a].rows[0]]={text:d[g[a].rows[0]],row:i[a].rows[0]}}for(a=0;a<f.length-1;a++)if(f[a].text!=null&&f[a+1].text==null&&f[a].row+1<d.length&&d[f[a].row+1].text==null&&f[a+1]==d[f[a].row+1]){f[a+1]={text:f[a+1],row:f[a].row+1};d[f[a].row+1]=
{text:d[f[a].row+1],row:a+1}}for(a=f.length-1;a>0;a--)if(f[a].text!=null&&f[a-1].text==null&&f[a].row>0&&d[f[a].row-1].text==null&&f[a-1]==d[f[a].row-1]){f[a-1]={text:f[a-1],row:f[a].row-1};d[f[a].row-1]={text:d[f[a].row-1],row:a-1}}d={o:d,n:f};f="";i=b.match(/\s+/g);if(i==null)i=[" "];else i.push(" ");g=c.match(/\s+/g);if(g==null)g=[" "];else g.push(" ");if(d.n.length==0)for(a=0;a<d.o.length;a++)f+="<del>"+d.o[a]+i[a]+"</del>";else{if(d.n[0].text==null)for(c=0;c<d.o.length&&d.o[c].text==null;c++)f+=
"<del>"+d.o[c]+i[c]+"</del>";for(a=0;a<d.n.length;a++)if(d.n[a].text==null)f+="<ins>"+d.n[a]+g[a]+"</ins>";else{var h="";for(c=d.n[a].row+1;c<d.o.length&&d.o[c].text==null;c++)h+="<del>"+d.o[c]+i[c]+"</del>";f+=" "+d.n[a].text+g[a]+h}}return f}}()})(this);
