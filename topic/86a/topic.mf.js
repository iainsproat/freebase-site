
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(b){function h(){if(b.browser.msie){var a=b(document).height(),d=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,20>a-d?d:a]}return[b(document).width(),b(document).height()]}function f(a){if(a)return a.call(b.mask)}b.tools=b.tools||{version:"@VERSION"};var e;e=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var c,d,a,j,g;b.mask={load:function(i,k){if(a)return this;"string"==typeof i&&(i={color:i});i=i||j;j=i=b.extend(b.extend({},e.conf),i);c=b("#"+i.maskId);c.length||(c=b("<div/>").attr("id",i.maskId),b("body").append(c));var o=h();c.css({position:"absolute",top:0,left:0,width:o[0],height:o[1],display:"none",opacity:i.startOpacity,zIndex:i.zIndex});i.color&&c.css("backgroundColor",i.color);if(!1===f(i.onBeforeLoad))return this;i.closeOnEsc&&b(document).bind("keydown.mask",function(a){a.keyCode==
27&&b.mask.close(a)});i.closeOnClick&&c.bind("click.mask",function(a){b.mask.close(a)});b(window).bind("resize.mask",function(){b.mask.fit()});k&&k.length&&(g=k.eq(0).css("zIndex"),b.each(k,function(){var a=b(this);/relative|absolute|fixed/i.test(a.css("position"))||a.css("position","relative")}),d=k.css({zIndex:Math.max(i.zIndex+1,"auto"==g?0:g)}));c.css({display:"block"}).fadeTo(i.loadSpeed,i.opacity,function(){b.mask.fit();f(i.onLoad)});a=!0;return this},close:function(){if(a){if(!1===f(j.onBeforeClose))return this;
c.fadeOut(j.closeSpeed,function(){f(j.onClose);d&&d.css({zIndex:g})});b(document).unbind("keydown.mask");c.unbind("click.mask");b(window).unbind("resize.mask");a=!1}return this},fit:function(){if(a){var b=h();c.css({width:b[0],height:b[1]})}},getMask:function(){return c},isLoaded:function(){return a},getConf:function(){return j},getExposed:function(){return d}};b.fn.mask=function(a){b.mask.load(a);return this};b.fn.expose=function(a){b.mask.load(a,this);return this}})(jQuery);
(function(b){function h(c,d){var a=this,j=c.add(a),g=b(window),i,k,h,n=b.tools.expose&&(d.mask||d.expose),l=Math.random().toString().slice(10);n&&("string"==typeof n&&(n={color:n}),n.closeOnClick=n.closeOnEsc=!1);var m=d.target||c.attr("rel");k=m?b(m):c;if(!k.length)throw"Could not find Overlay: "+m;c&&-1==c.index(k)&&c.click(function(b){a.load(b);return b.preventDefault()});b.extend(a,{load:function(c){if(a.isOpened())return a;var i=e[d.effect];if(!i)throw'Overlay: cannot find effect : "'+d.effect+
'"';d.oneInstance&&b.each(f,function(){this.close(c)});c=c||b.Event();c.type="onBeforeLoad";j.trigger(c);if(c.isDefaultPrevented())return a;h=true;n&&b(k).expose(n);var m=d.top,p=d.left,s=k.outerWidth({margin:true}),q=k.outerHeight({margin:true});typeof m=="string"&&(m=m=="center"?Math.max((g.height()-q)/2,0):parseInt(m,10)/100*g.height());p=="center"&&(p=Math.max((g.width()-s)/2,0));i[0].call(a,{top:m,left:p},function(){if(h){c.type="onLoad";j.trigger(c)}});if(n&&d.closeOnClick)b.mask.getMask().one("click",
a.close);d.closeOnClick&&b(document).bind("click."+l,function(t){b(t.target).parents(k).length||a.close(t)});d.closeOnEsc&&b(document).bind("keydown."+l,function(b){b.keyCode==27&&a.close(b)});return a},close:function(c){if(!a.isOpened())return a;c=c||b.Event();c.type="onBeforeClose";j.trigger(c);if(!c.isDefaultPrevented()){h=false;e[d.effect][1].call(a,function(){c.type="onClose";j.trigger(c)});b(document).unbind("click."+l).unbind("keydown."+l);n&&b.mask.close();return a}},getOverlay:function(){return k},
getTrigger:function(){return c},getClosers:function(){return i},isOpened:function(){return h},getConf:function(){return d}});b.each(["onBeforeLoad","onStart","onLoad","onBeforeClose","onClose"],function(c,e){b.isFunction(d[e])&&b(a).bind(e,d[e]);a[e]=function(c){b(a).bind(e,c);return a}});i=k.find(d.close||".close");!i.length&&!d.close&&(i=b('<a class="close"></a>'),k.prepend(i));i.click(function(b){a.close(b)});d.load&&a.load()}b.tools=b.tools||{version:"@VERSION"};b.tools.overlay={addEffect:function(b,
d,a){e[b]=[d,a]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!b.browser.msie||6<b.browser.version,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var f=[],e={};b.tools.overlay.addEffect("default",function(c,d){var a=this.getConf(),e=b(window);a.fixed||(c.top+=e.scrollTop(),c.left+=e.scrollLeft());c.position=a.fixed?"fixed":"absolute";this.getOverlay().css(c).fadeIn(a.speed,d)},function(b){this.getOverlay().fadeOut(this.getConf().closeSpeed,
b)});b.fn.overlay=function(c){var d=this.data("overlay");if(d)return d;b.isFunction(c)&&(c={onBeforeLoad:c});c=b.extend(!0,{},b.tools.overlay.conf,c);this.each(function(){d=new h(b(this),c);f.push(d);b(this).data("overlay",d)});return c.api?d:this}})(jQuery);
(function(b){var h="undefined"!=typeof window.innerWidth?function(){return{w:window.innerWidth,h:window.innerHeight}}:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}};window.kbs=
function(f){b(".kbs.current",f).removeClass("current");var e=b(".domain-section:first",f),c=b(".domain-section:last",f),d=this.scroll_to=function(a){var c=b(document).scrollTop();b(document).height();var d=h().h,d=c+d,e=a.offset().top,a=e+a.height();e<c?b(document).scrollTop(e):a>d&&b(document).scrollTop(c+(a-d))},a=this.get_current=function(){return b(".kbs.current:first",f)},j=this.set_next=function(b,c,e){b=b||a();c.length&&(b.removeClass("current"),c.addClass("current"),e||d(c))},g=this.next_domain=
function(b){var c=a(),d=i(c);d&&(d=d.find(".kbs:first"),j(c,d,b))},i=this._next_domain=function(a){if(!a||!a.length)return b(".domain-section:first",f);a=a.closest(".domain-section");return!a.length||a[0]===c[0]?e:a.next(".domain-section")},k=this.prev_domain=function(){var b=a(),c=o(b);c&&(c=c.find(".kbs:first"),j(b,c))},o=this._prev_domain=function(a){if(!a||!a.length)return b(".domain-section:last",f);var d=a.closest(".domain-section");return a.closest(".property-section").length||a.closest(".type-section").length?
d:!d.length||d[0]===e[0]?c:d.prev(".domain-section")},n=this.next_type=function(){var b=a(),c=l(b);c&&(c=c.find(".kbs:first"),j(b,c))},l=this._next_type=function(a){if(!a||!a.length)return b(".type-section:first",f);var c=a.closest(".domain-section"),a=a.closest(".type-section"),a=a.length?a.next(".type-section"):c.find(".type-section:first");if(!a||!a.length){var d=i(c);if(d)for(;d.get(0)!==c.get(0);){a=d.find(".type-section:first");if(a.length)break;d=i(d)}}return a},m=this.prev_type=function(){var b=
a(),c=r(b);c&&(c=c.find(".kbs:first"),j(b,c))},r=this._prev_type=function(a){if(!a||!a.length)return b(".type-section:last",f);var c=a.closest(".domain-section"),d=a.closest(".type-section");if(a.closest(".property-section").length)return d;var e;d.length&&(e=d.prev(".type-section"));if(!e||!e.length)if(a=o(c))for(;a.get(0)!==c.get(0);){e=a.find(".type-section:last");if(e.length)break;a=o(a)}return e},u=this.next_prop=function(){var b=a(),c=v(b);c&&(c=c.find(".kbs:first"),j(b,c))},v=this._next_prop=
function(a){if(!a||!a.length)return b(".property-section:first",f);var c=a.closest(".domain-section"),d=a.closest(".type-section"),e=a.closest(".property-section"),c=e.length?e.next(".property-section"):d.length?d.find(".property-section:first"):c.find(".property-section:first");if(!c||!c.length)if(a=l(a))for(;a.get(0)!==d.get(0);){c=a.find(".property-section:first");if(c.length)break;null==d.get(0)&&(d=a);a=l(a)}return c},p=this.prev_prop=function(){var b=a(),c=s(b);c&&(c=c.find(".kbs:first"),j(b,
c))},s=this._prev_prop=function(a){if(!a||!a.length)return b(".property-section:last",f);var c=a.closest(".domain-section"),d=a.closest(".type-section"),e=a.closest(".property-section");if(a.closest(".data-section").length)return e;var g;e.length&&(g=e.prev(".property-section"));if(!g||!g.length)if(m=d.length?r(d):r(c))for(;m.get(0)!==d.get(0);){g=m.find(".property-section:last");if(g.length)break;null==d.get(0)&&(d=m);m=r(m)}return g};this.next=function(){var c=a();if(c&&c.length){var d=this._next(c);
if(d){j(c,d);return}}c=b(".kbs:visible:first",f);j(c,c)};this._next=function(a){if(!a||!a.length)return b(".domain-section:first .kbs:first",f);var d=a.closest(".domain-section"),g=a.closest(".type-section"),j=a.closest(".property-section");if(a.closest(".data-section").length){a=a.next(".kbs");if(a.length)return a;a=j.next(".property-section").find(".kbs:first");if(a.length)return a;a=g.next(".type-section").find(".kbs:first")}else if(j.length){a=j.find(".data-section:first .kbs:first");if(a.length)return a;
a=j.next(".property-section").find(".kbs:first");if(a.length)return a;a=g.next(".type-section").find(".kbs:first")}else if(g.length){a=g.find(".property-section:first .kbs:first");if(a.length)return a;a=g.next(".type-section").find(".kbs:first")}else a=d.find(".type-section:first .kbs:first");return a.length?a:d.get(0)===c.get(0)?e.find(".kbs:first"):d.next(".domain-section").find(".kbs:first")};this.prev=function(){var b=a(),c=this._prev(b);c&&j(b,c)};this._prev=function(a){if(!a||!a.length)return a=
b(".data-section:last .kbs:last",f),a.length||(a=b(".property-section:last .kbs:first",f)),a.length||(a=b(".type-section:last .kbs:first",f)),a.length||(a=b(".domain-section:last .kbs:first",f)),a;var d=a.closest(".domain-section"),g=a.closest(".type-section"),j=a.closest(".property-section");return a.closest(".data-section").length?(a=a.prev(".kbs"),a.length?a:j.find(".kbs:first")):j.length?(a=j.prev(".property-section").find(".kbs:last"),a.length?a:g.find(".kbs:first")):g.length?(a=g.prev(".type-section").find(".kbs:last"),
a.length?a:d.find(".kbs:first")):d.get(0)===e.get(0)?c.find(".kbs:last"):d.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var q=this;b(document).unbind(".kbs").bind("keydown.kbs",function(a){var c=a.target;if(c==document.body||c==document||c==window||c==b("html")[0])c=a.keyCode,68===c?a.shiftKey?k():g():84===c?a.shiftKey?m():n():80===c?a.shiftKey?p():u():74===c?q.next():75===c?q.prev():69===c&&q.edit()})}})(jQuery);
(function(b,h){var f=window.propbox={init:function(e,c){c=b.extend({lang:"/lang/en"},c);if(!c.base_ajax_url)throw Error("base_ajax_url required in propbox options");if(!c.base_static_url)throw Error("base_static_url required in propbox options");if(!c.id)throw Error("topic id required in propbox options");if(!c.lang)throw Error("lang required in propbox options");f.options=c;f.kbs=new h(e);b(".kbs",e).live("click",function(){var c=f.kbs.get_current();f.kbs.set_next(c,b(this),!0)}).live("edit",function(){var c=
b(this).find(".headmenu:first").data("submenu");c&&b("li:first a:first",c).click()});f.init_menus(e)},init_menus:function(e,c){e=b(e||document);c&&b(".nicemenu",e).nicemenu();var d;d=e&&e.is(".hover-row")?e:b(".hover-row",e);d.hover(f.row_menu_hoverover,f.row_menu_hoverout);d.dblclick(function(){var a=b(".nicemenu .default-action",this);a.length||(a=b(".nicemenu:first .submenu:first a:first",this));var c=a.attr("href");c&&("#"==c||0==c.indexOf("javascript:void(0)"))&&b(a).click()});b(".nicemenu .headmenu",
e).add(b(".nicemenu .default-action",e)).click("click",function(){if(f.kbs){var a=f.kbs.get_current();a&&f.kbs.set_next(a,b(this).parents(".kbs:first"),!0)}return!1})},row_menu_hoverover:function(){b(this).addClass("row-hover")},row_menu_hoverout:function(){b(this).removeClass("row-hover")},get_script:function(e,c){var d=f.get_script.cache;d||(d=f.get_script.cache={});var a=d[e];a?1===a.state?a.callbacks.push(c):4===a.state&&c():(a=d[e]={state:0,callbacks:[c]},b.ajax({url:f.options.base_static_url+
e,dataType:"script",cache:!0,beforeSend:function(){a.state=1},success:function(){a.state=4;b.each(a.callbacks,function(a,b){b()})},error:function(){a.state=-1}}))},prop_edit:function(e,c){var d=b(e).parents(".property-section");d.length||(d=b(e).parents(".submenu").data("headmenu").parents(".property-section"));d=d.find(".data-section .data-row:first:visible .nicemenu:first .headmenu:first a");d.length?d.click():f.prop_add(e,c);return!1},prop_add:function(e,c){var d=b(e).parents(".property-section");
d.length||(d=b(e).parents(".submenu").data("headmenu").parents(".property-section"));f.get_script("/propbox-edit.mf.js",function(){f.edit.prop_add_begin(d,c)});return!1},value_edit:function(e){var c=b(e).parents(".submenu").data("headmenu").parents(".data-row:first"),d=c.parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.value_edit_begin(d,c)});return!1},value_delete:function(e){var c=b(e).parents(".submenu").data("headmenu").parents(".data-row:first"),d=c.parents(".property-section");
f.get_script("/propbox-edit.mf.js",function(){f.edit.value_delete_begin(d,c)});return!1},remove_type:function(e){var e=b(e),c=e.parents(".type-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.remove_type_begin(e,c)});return!1},add_type:function(e,c,d){var e=b(e),a=e.parents(".type-section"),j=f.options.incompatible_types;j?j.search(f.options.id,c,d,{compatible:function(){f.add_type_submit(e,a)},incompatible:j.overlay_incompatible_callback({onConfirm:function(){f.add_type_submit(e,a)}})}):
f.add_type_submit(e,a);return!1},add_type_submit:function(b,c){f.get_script("/propbox-edit.mf.js",function(){f.edit.add_type_submit(b,c)})},add_has_no_value:function(e){var c=b(e).parents(".submenu").data("headmenu").parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.add_has_no_value(c)});return!1},add_has_value:function(e){var c=b(e).parents(".submenu").data("headmenu").parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.add_has_value(c)});
return!1},remove_has_no_value:function(e){var c=b(e).parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.remove_has_no_value(c)});return!1},remove_has_value:function(e){var c=b(e).parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.remove_has_value(c)});return!1},more:function(e,c,d){var a=b(e).parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.more(a,c,d)})}}})(jQuery,window.kbs);
(function(b){b.factory("lrulist",{init:function(){this.options.key?this.update():console.error("$.lrulist","A localstore key is required.")},update:function(h){var f=this.options,e=b.localstore(f.key);null==e&&(e=[]);if(null!=h){var c=e.indexOf(h);-1!==c&&e.splice(c,1);e.unshift(h)}e=e.slice(0,f.max);if(e.length){b.localstore(f.key,e,!1);var d=this.element.empty(),a=f.template,j=b.type(a);b.each(e,function(c,e){var k=null,k="function"===j?a(e):"string"===j?b(a).text(e):document.createTextNode(e);
null!=k&&(f.separator&&0<c&&d.append(f.separator),d.append(k))})}},clear:function(){b.localstore(this.options.key,null,!1);this.element.empty()}});b.extend(!0,b.lrulist,{defaults:{max:10,key:null,separator:", ",onclick:b.noop}})})(jQuery);
(function(b,h,f){function e(a){return a.replace(/\//g,"\\/")}function c(){this.init()}var d=h.topic={facet:null,init:function(){d.facet=new c;b("#recent-filters-container").lrulist({key:"topic.filters",max:10,separator:'<span class="sep">|</span>',template:d.recent_filter});b("#page-content").on("click","a.schema-name",function(){var a=b(this).attr("name");d.add_filter(a);return!1});b("#pill-filter-box").click(function(){b("#pill-filter-suggest").focus()});f.init("#topic-data",{id:h.c.id,base_ajax_url:h.h.ajax_url("lib/propbox"),
base_static_url:h.h.static_url("lib/propbox"),lang:h.lang||"/lang/en",suggest_impl:h.suggest_options,incompatible_types:h.incompatible_types});b.localstore("types_expanded")&&d.toggle_types(b("#types-toggle > a"));b.localstore("topic.show_all")&&b("#show-all").attr("checked","checked");d.update_facet();var a=b("#pill-filter-suggest").suggest(b.extend({scoring:"schema",output:"(type)"},h.suggest_options.any("type:/type/domain","type:/type/type","type:/type/property"))).bind("fb-select",function(a,
c){var e=b(this),f=null;c.output&&(c.output.type&&c.output.type["/type/object/type"])&&b.each(c.output.type["/type/object/type"],function(a,b){return"/type/domain"===b.id||"/type/type"===b.id||"/type/property"===b.id?(f=b.id,!1):!0});d.add_filter(c.id,f);e.val("").trigger("textchange")}).focus(function(){b("#pill-filter-box").addClass("focused")}).blur(function(){b("#pill-filter-box").removeClass("focused")}).keydown(function(a){8===a.keyCode&&""===b(this).val()&&b("#pill-filter-box").find(".pill-x:last").click()});
h.keyboard_shortcut.add("f",function(){a.focus()});h.topic.kbs_overlay_trigger=b(".keyboard-shortcuts").overlay({close:".modal-buttons .button.cancel",closeOnClick:!1,fixed:!1,mask:{color:"#000",loadSpeed:200,opacity:0.5}})},init_nav_scrolling:function(a){function c(){var d=b(window).scrollTop();if(d>h){var g=b(window).innerHeight()-50;d>e.top&&(f<g?(a.offset({top:d}),a.addClass("fixed-nav")):(g=d+g,a.offset().top+f<g&&(a.offset({top:g-f,left:e.left}),a.addClass("fixed-nav"))))}else d>e.top?d<a.offset().top&&
(a.offset({top:d}),a.addClass("fixed-nav")):(a.removeClass("fixed-nav"),a.css({top:"",left:""}));h=d}function d(){a.offset();a.removeClass("fixed-nav");a.css({top:"",left:""});e=a.offset();f=a.outerHeight();h=0;b(window).trigger("scroll")}if(!a.data("init_nav_scrolling")){var e=a.offset(),f=a.outerHeight(),h=0,n=null,l=null;b(window).scroll(function(){clearTimeout(n);n=setTimeout(c,100)}).resize(function(){clearTimeout(l);l=setTimeout(d,0)});a.data("init_nav_scrolling",!0);b(window).trigger("scroll")}},
toggle_types:function(a){a?(a=b(".nav.column").width()+20,b.localstore("types_expanded",1,!1),b(".data.column").animate({marginRight:a},function(){b(".nav.column").slideDown(function(){d.init_nav_scrolling(b(".nav-module",this))})})):(b.localstore("types_expanded",0,!1),b(".nav.column").slideUp(function(){b(".data.column").animate({marginRight:0})}))},recent_filter:function(a){return b('<a href="#">').text(a).click(d.click_filter)},click_filter:function(){d.add_filter(b(this).text());return!1},add_filter:function(a,
c){b("#recent-filters-container").lrulist("update",a);var g=e(a);b("#pill-filter-box").find("input[value="+g+"]").length||(d.facet.contains(a)?(g=d.pill(a),b("#pill-filter-suggest").before(g),d.update_facet(!0),b(".toc-link",g).click()):"/type/type"===c?d.load_filter(a):"/type/property"===c?d.load_filter(null,a):h.status.info("The filter does not apply to this topic: "+a))},load_filter:function(a,c){var e={id:h.c.id,lang:h.lang};if(a)e.type=a;else if(c)e.property=c;else return;h.get_script(h.h.static_url("lib/propbox")+
"/propbox-edit.mf.js",function(){b.ajax(b.extend(window.formlib.default_begin_ajax_options(),{url:h.h.ajax_url("type_section.ajax"),data:e,onsuccess:function(b){d.load_filter_callback(a||c,b)}}))})},load_filter_callback:function(a,c){var g=b(c.result.html),i=b(c.result.toc),k=g.attr("data-id");g.find(".status").is(".commons");f.init_menus(g,!0);b(".nicemenu-item.edit",g).show();var h=g.find(".type-section");d.facet.contains(k)?(g=d.facet.get(k),g.section.append(h),g.toc_types.append(b(".toc-type",
i))):(b("#topic-data").prepend(g),b("#toc").prepend(i));d.facet.init();i=b("#pill-filter-box").find(".pill-value[value="+e(a)+"]");i.length||(i=d.pill(a),b("#pill-filter-suggest").before(i));d.update_facet(!0);b(".toc-link",i).click();c.result.assert_type_modal&&(i=b(c.result.assert_type_modal),formlib.init_modal_form({event_prefix:"topic.assert_type.modal.",init:d.init_assert_type_modal,validate:function(){return true},submit:d.submit_assert_type_modal,form:i,type_section:h}))},init_assert_type_modal:function(a){window.formlib.enable_submit(a);
b("button.cancel").focus()},submit_assert_type_modal:function(a){window.formlib.cancel_modal_form(a);a.type_section.find("a.assert-type").click()},remove_filter:function(a){b(a).parent(".pill").remove();d.update_facet(!0);return!1},update_facet:function(a){var c=b("#show-all"),e=d.get_filters();if(e.length)d.facet.filter(e),h.disable(c);else{var f=c.is(":checked");d.facet.show_all(f);h.enable(c)}a&&d.update_window_history(e);b(window).trigger("resize")},get_filters:function(){var a=[];b("#pill-filter-box").find(".pill:visible").each(function(){a.push(b(this).find(".pill-value").val())});
return a},show_all:function(a){b.localstore("topic.show_all",!0==a,!1);d.update_facet(!0);return!1},update_window_history:function(a){null==a&&(a=d.get_filters());var c=b("#show-all").is(":checked"),e={props:"",lang:h.h.lang_code(h.lang)};a.length&&(e.filter=a);!0===c&&(e.all=!0);a=window.location.href.split("?")[0];a=h.h.build_url(a,e);a!=window.location.href&&("function"===typeof history.replaceState?history.replaceState(null,"",a):window.loaction.href=a)},PILL_HTML:b("#pill-template").html(),pill:function(a){var c=
b(d.PILL_HTML);b(".pill-text",c).text(a)[0].href="#"+a;b(".pill-value",c).val(a);return c}};c.prototype.init=function(){var a=this.domains={commons:[],not_commons:[]},c=this.schemas={},d=b("#toc");b("#topic-data");b(".toc-domain",d).each(function(){var d=b(this),f=d.attr("data-id"),g=b(".domain-section[data-id="+e(f)+"]"),h=d.next(".toc-types"),l={id:f,toc:d,toc_types:h,section:g,types:[],bare_types:[],is:"domain"};d.is(".commons")?a.commons.push(l):a.not_commons.push(l);c[f]=l;b(".toc-type",h).each(function(){var a=
b(this),d=a.attr("data-id"),f=b(".type-section[data-id="+e(d)+"]"),g={id:d,toc:a,section:f,is:"type",domain:l,properties:[]};a.is(".bare")?l.bare_types.push(g):l.types.push(g);c[d]=g;b(".property-section",f).each(function(){var a=b(this),d=a.attr("data-id"),a={id:d,section:a,is:"property",schema:g};g.properties.push(a);c[d]=a})})})};c.prototype.filter=function(a){if(!a||0===a.length)throw Error("Empty filter is not allowed.");var a=c.reduce_filters(a),d=this.schemas,e={},f={},h={};b.each(a,function(a,
b){var c=d[b];c&&("domain"===c.is?e[b]=!0:"type"===c.is?f[b]=!0:"property"===c.is&&(h[b]=!0))});a=this.domains.commons.concat(this.domains.not_commons);b.each(a,function(a,c){var d=!1,j=c.types.concat(c.bare_types);b.each(j,function(a,c){var j=!1;b.each(c.properties,function(a,b){h[b.id]||f[b.schema.id]||e[b.schema.domain.id]?(j=!0,b.section.show()):b.section.hide()});(j=j||f[c.id])?(d=!0,c.section.show(),c.toc.show()):(c.section.hide(),c.toc.hide())});(d=d||e[c.id])?(c.section.show(),c.toc.show(),
c.toc_types.show()):(c.section.hide(),c.toc.hide(),c.toc_types.hide())})};c.reduce_filters=function(a){var b=[];a.sort();for(var c=0,d=a.length;c<d;c++){var e=a[c];0===c?b.push(e):0!==e.indexOf(b[b.length-1])&&b.push(e)}return b};c.prototype.show_all=function(a){a?(a=this.domains.commons.concat(this.domains.not_commons),b.each(a,function(a,c){var d=c.types.concat(c.bare_types);b.each(d,function(a,c){b.each(c.properties,function(a,b){"/type/object/type"===b.id||"/type/object/key"===b.id||"/common/topic/article"===
b.id?b.section.hide():b.section.show()});c.section.show();c.toc.show()});c.section.show();c.toc_types.show();c.toc.show()})):(b.each(this.domains.not_commons,function(a,b){b.section.hide();b.toc_types.hide();b.toc.hide()}),b.each(this.domains.commons,function(a,c){b.each(c.types,function(a,c){b.each(c.properties,function(a,b){"/common/topic/article"===b.id?b.section.hide():b.section.show()});c.section.show();c.toc.show()});b.each(c.bare_types,function(a,b){b.section.hide();b.toc.hide()});c.types.length?
(c.section.show(),c.toc_types.show(),c.toc.show()):(c.section.hide(),c.toc_types.hide(),c.toc.hide())}))};c.prototype.contains=function(a){return null!=this.schemas[a]};c.prototype.get=function(a){return this.schemas[a]};b(d.init)})(jQuery,window.freebase,window.propbox);
