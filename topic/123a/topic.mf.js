
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION / Expose - Dim the lights

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/toolbox/expose.html

 Since: Mar 2010
 Date: @DATE 
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
(function(c){function h(){if(c.browser.msie){var a=c(document).height(),g=c(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,20>a-g?g:a]}return[c(document).width(),c(document).height()]}function e(a){if(a)return a.call(c.mask)}c.tools=c.tools||{version:"@VERSION"};var f;f=c.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,
onClose:null}};var b,d,a,g,i;c.mask={load:function(j,k){if(a)return this;"string"==typeof j&&(j={color:j});j=j||g;g=j=c.extend(c.extend({},f.conf),j);b=c("#"+j.maskId);b.length||(b=c("<div/>").attr("id",j.maskId),c("body").append(b));var o=h();b.css({position:"absolute",top:0,left:0,width:o[0],height:o[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex});j.color&&b.css("backgroundColor",j.color);if(!1===e(j.onBeforeLoad))return this;j.closeOnEsc&&c(document).bind("keydown.mask",function(a){a.keyCode==
27&&c.mask.close(a)});j.closeOnClick&&b.bind("click.mask",function(a){c.mask.close(a)});c(window).bind("resize.mask",function(){c.mask.fit()});k&&k.length&&(i=k.eq(0).css("zIndex"),c.each(k,function(){var a=c(this);/relative|absolute|fixed/i.test(a.css("position"))||a.css("position","relative")}),d=k.css({zIndex:Math.max(j.zIndex+1,"auto"==i?0:i)}));b.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){c.mask.fit();e(j.onLoad)});a=!0;return this},close:function(){if(a){if(!1===e(g.onBeforeClose))return this;
b.fadeOut(g.closeSpeed,function(){e(g.onClose);d&&d.css({zIndex:i})});c(document).unbind("keydown.mask");b.unbind("click.mask");c(window).unbind("resize.mask");a=!1}return this},fit:function(){if(a){var c=h();b.css({width:c[0],height:c[1]})}},getMask:function(){return b},isLoaded:function(){return a},getConf:function(){return g},getExposed:function(){return d}};c.fn.mask=function(a){c.mask.load(a);return this};c.fn.expose=function(a){c.mask.load(a,this);return this}})(jQuery);
(function(c){function h(b,d){var a=this,g=b.add(a),i=c(window),j,k,h,n=c.tools.expose&&(d.mask||d.expose),l=Math.random().toString().slice(10);n&&("string"==typeof n&&(n={color:n}),n.closeOnClick=n.closeOnEsc=!1);var m=d.target||b.attr("rel");k=m?c(m):b;if(!k.length)throw"Could not find Overlay: "+m;b&&-1==b.index(k)&&b.click(function(c){a.load(c);return c.preventDefault()});c.extend(a,{load:function(b){if(a.isOpened())return a;var j=f[d.effect];if(!j)throw'Overlay: cannot find effect : "'+d.effect+
'"';d.oneInstance&&c.each(e,function(){this.close(b)});b=b||c.Event();b.type="onBeforeLoad";g.trigger(b);if(b.isDefaultPrevented())return a;h=true;n&&c(k).expose(n);var m=d.top,p=d.left,s=k.outerWidth({margin:true}),q=k.outerHeight({margin:true});typeof m=="string"&&(m=m=="center"?Math.max((i.height()-q)/2,0):parseInt(m,10)/100*i.height());p=="center"&&(p=Math.max((i.width()-s)/2,0));j[0].call(a,{top:m,left:p},function(){if(h){b.type="onLoad";g.trigger(b)}});if(n&&d.closeOnClick)c.mask.getMask().one("click",
a.close);d.closeOnClick&&c(document).bind("click."+l,function(t){c(t.target).parents(k).length||a.close(t)});d.closeOnEsc&&c(document).bind("keydown."+l,function(c){c.keyCode==27&&a.close(c)});return a},close:function(b){if(!a.isOpened())return a;b=b||c.Event();b.type="onBeforeClose";g.trigger(b);if(!b.isDefaultPrevented()){h=false;f[d.effect][1].call(a,function(){b.type="onClose";g.trigger(b)});c(document).unbind("click."+l).unbind("keydown."+l);n&&c.mask.close();return a}},getOverlay:function(){return k},
getTrigger:function(){return b},getClosers:function(){return j},isOpened:function(){return h},getConf:function(){return d}});c.each(["onBeforeLoad","onStart","onLoad","onBeforeClose","onClose"],function(g,b){c.isFunction(d[b])&&c(a).bind(b,d[b]);a[b]=function(g){c(a).bind(b,g);return a}});j=k.find(d.close||".close");!j.length&&!d.close&&(j=c('<a class="close"></a>'),k.prepend(j));j.click(function(c){a.close(c)});d.load&&a.load()}c.tools=c.tools||{version:"@VERSION"};c.tools.overlay={addEffect:function(c,
d,a){f[c]=[d,a]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!c.browser.msie||6<c.browser.version,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var e=[],f={};c.tools.overlay.addEffect("default",function(b,d){var a=this.getConf(),g=c(window);a.fixed||(b.top+=g.scrollTop(),b.left+=g.scrollLeft());b.position=a.fixed?"fixed":"absolute";this.getOverlay().css(b).fadeIn(a.speed,d)},function(c){this.getOverlay().fadeOut(this.getConf().closeSpeed,
c)});c.fn.overlay=function(b){var d=this.data("overlay");if(d)return d;c.isFunction(b)&&(b={onBeforeLoad:b});b=c.extend(!0,{},c.tools.overlay.conf,b);this.each(function(){d=new h(c(this),b);e.push(d);c(this).data("overlay",d)});return b.api?d:this}})(jQuery);
(function(c){var h="undefined"!=typeof window.innerWidth?function(){return{w:window.innerWidth,h:window.innerHeight}}:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}};window.kbs=
function(e){c(".kbs.current",e).removeClass("current");var f=c(".domain-section:first",e),b=c(".domain-section:last",e),d=this.scroll_to=function(a){var g=c(document).scrollTop();c(document).height();var b=h().h,b=g+b,d=a.offset().top,a=d+a.height();d<g?c(document).scrollTop(d):a>b&&c(document).scrollTop(g+(a-b))},a=this.get_current=function(){return c(".kbs.current:first",e)},g=this.set_next=function(c,g,b){c=c||a();g.length&&(c.removeClass("current"),g.addClass("current"),b||d(g))},i=this.next_domain=
function(c){var b=a(),d=j(b);d&&(d=d.find(".kbs:first"),g(b,d,c))},j=this._next_domain=function(a){if(!a||!a.length)return c(".domain-section:first",e);a=a.closest(".domain-section");return!a.length||a[0]===b[0]?f:a.next(".domain-section")},k=this.prev_domain=function(){var c=a(),b=o(c);b&&(b=b.find(".kbs:first"),g(c,b))},o=this._prev_domain=function(a){if(!a||!a.length)return c(".domain-section:last",e);var g=a.closest(".domain-section");return a.closest(".property-section").length||a.closest(".type-section").length?
g:!g.length||g[0]===f[0]?b:g.prev(".domain-section")},n=this.next_type=function(){var c=a(),b=l(c);b&&(b=b.find(".kbs:first"),g(c,b))},l=this._next_type=function(a){if(!a||!a.length)return c(".type-section:first",e);var b=a.closest(".domain-section"),a=a.closest(".type-section"),a=a.length?a.next(".type-section"):b.find(".type-section:first");if(!a||!a.length){var g=j(b);if(g)for(;g.get(0)!==b.get(0);){a=g.find(".type-section:first");if(a.length)break;g=j(g)}}return a},m=this.prev_type=function(){var c=
a(),b=r(c);b&&(b=b.find(".kbs:first"),g(c,b))},r=this._prev_type=function(a){if(!a||!a.length)return c(".type-section:last",e);var b=a.closest(".domain-section"),g=a.closest(".type-section");if(a.closest(".property-section").length)return g;var d;g.length&&(d=g.prev(".type-section"));if(!d||!d.length)if(a=o(b))for(;a.get(0)!==b.get(0);){d=a.find(".type-section:last");if(d.length)break;a=o(a)}return d},u=this.next_prop=function(){var c=a(),b=v(c);b&&(b=b.find(".kbs:first"),g(c,b))},v=this._next_prop=
function(a){if(!a||!a.length)return c(".property-section:first",e);var b=a.closest(".domain-section"),g=a.closest(".type-section"),d=a.closest(".property-section"),b=d.length?d.next(".property-section"):g.length?g.find(".property-section:first"):b.find(".property-section:first");if(!b||!b.length)if(a=l(a))for(;a.get(0)!==g.get(0);){b=a.find(".property-section:first");if(b.length)break;null==g.get(0)&&(g=a);a=l(a)}return b},p=this.prev_prop=function(){var c=a(),b=s(c);b&&(b=b.find(".kbs:first"),g(c,
b))},s=this._prev_prop=function(a){if(!a||!a.length)return c(".property-section:last",e);var b=a.closest(".domain-section"),g=a.closest(".type-section"),d=a.closest(".property-section");if(a.closest(".data-section").length)return d;var i;d.length&&(i=d.prev(".property-section"));if(!i||!i.length)if(m=g.length?r(g):r(b))for(;m.get(0)!==g.get(0);){i=m.find(".property-section:last");if(i.length)break;null==g.get(0)&&(g=m);m=r(m)}return i};this.next=function(){var b=a();if(b&&b.length){var d=this._next(b);
if(d){g(b,d);return}}b=c(".kbs:visible:first",e);g(b,b)};this._next=function(a){if(!a||!a.length)return c(".domain-section:first .kbs:first",e);var g=a.closest(".domain-section"),d=a.closest(".type-section"),i=a.closest(".property-section");if(a.closest(".data-section").length){a=a.next(".kbs");if(a.length)return a;a=i.next(".property-section").find(".kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else if(i.length){a=i.find(".data-section:first .kbs:first");if(a.length)return a;
a=i.next(".property-section").find(".kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else if(d.length){a=d.find(".property-section:first .kbs:first");if(a.length)return a;a=d.next(".type-section").find(".kbs:first")}else a=g.find(".type-section:first .kbs:first");return a.length?a:g.get(0)===b.get(0)?f.find(".kbs:first"):g.next(".domain-section").find(".kbs:first")};this.prev=function(){var c=a(),b=this._prev(c);b&&g(c,b)};this._prev=function(a){if(!a||!a.length)return a=
c(".data-section:last .kbs:last",e),a.length||(a=c(".property-section:last .kbs:first",e)),a.length||(a=c(".type-section:last .kbs:first",e)),a.length||(a=c(".domain-section:last .kbs:first",e)),a;var g=a.closest(".domain-section"),d=a.closest(".type-section"),i=a.closest(".property-section");return a.closest(".data-section").length?(a=a.prev(".kbs"),a.length?a:i.find(".kbs:first")):i.length?(a=i.prev(".property-section").find(".kbs:last"),a.length?a:d.find(".kbs:first")):d.length?(a=d.prev(".type-section").find(".kbs:last"),
a.length?a:g.find(".kbs:first")):g.get(0)===f.get(0)?b.find(".kbs:last"):g.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var q=this;c(document).unbind(".kbs").bind("keydown.kbs",function(a){var b=a.target;if(b==document.body||b==document||b==window||b==c("html")[0])b=a.keyCode,68===b?a.shiftKey?k():i():84===b?a.shiftKey?m():n():80===b?a.shiftKey?p():u():74===b?q.next():75===b?q.prev():69===b&&q.edit()})}})(jQuery);
(function(c,h){var e=window.propbox={init:function(f,b){b=c.extend({lang:"/lang/en"},b);if(!b.base_ajax_url)throw Error("base_ajax_url required in propbox options");if(!b.base_static_url)throw Error("base_static_url required in propbox options");if(!b.id)throw Error("topic id required in propbox options");if(!b.lang)throw Error("lang required in propbox options");e.options=b;e.kbs=new h(f);c(".kbs",f).live("click",function(){var b=e.kbs.get_current();e.kbs.set_next(b,c(this),!0)}).live("edit",function(){var b=
c(this).find(".headmenu:first").data("submenu");b&&c("li:first a:first",b).click()});e.init_menus(f);c.tablesorter&&c(".data-table").addClass("table-sortable").tablesorter()},init_menus:function(f,b){f=c(f||document);b&&c(".nicemenu",f).nicemenu();var d;d=f&&f.is(".hover-row")?f:c(".hover-row",f);d.hover(e.row_menu_hoverover,e.row_menu_hoverout);d.dblclick(function(){var a=c(".nicemenu .default-action",this);a.length||(a=c(".nicemenu:first .submenu:first a:first",this));var b=a.attr("href");b&&("#"==
b||0==b.indexOf("javascript:void(0)"))&&c(a).click()});c(".nicemenu .headmenu",f).add(c(".nicemenu .default-action",f)).click("click",function(){if(e.kbs){var a=e.kbs.get_current();a&&e.kbs.set_next(a,c(this).parents(".kbs:first"),!0)}return!1})},row_menu_hoverover:function(){c(this).addClass("row-hover")},row_menu_hoverout:function(){c(this).removeClass("row-hover")},get_script:function(f,b){var d=e.get_script.cache;d||(d=e.get_script.cache={});var a=d[f];a?1===a.state?a.callbacks.push(b):4===a.state&&
b():(a=d[f]={state:0,callbacks:[b]},c.ajax({url:e.options.base_static_url+f,dataType:"script",cache:!0,beforeSend:function(){a.state=1},success:function(){a.state=4;c.each(a.callbacks,function(a,c){c()})},error:function(){a.state=-1}}))},prop_edit:function(f,b){var d=c(f).parents(".property-section");d.length||(d=c(f).parents(".submenu").data("headmenu").parents(".property-section"));d=d.find(".data-section .data-row:first:visible .nicemenu:first .headmenu");d.length?d.data("submenu").find("a:first").click():
e.prop_add(f,b);return!1},prop_add:function(f,b){var d=c(f).parents(".property-section");d.length||(d=c(f).parents(".submenu").data("headmenu").parents(".property-section"));e.get_script("/propbox-edit.mf.js",function(){e.edit.prop_add_begin(d,b)});return!1},value_edit:function(f){var b=c(f).parents(".submenu").data("headmenu").parents(".data-row:first"),d=b.parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.value_edit_begin(d,b)});return!1},value_delete:function(f){var b=
c(f).parents(".submenu").data("headmenu").parents(".data-row:first"),d=b.parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.value_delete_begin(d,b)});return!1},remove_type:function(f){var f=c(f),b=f.parents(".type-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.remove_type_begin(f,b)});return!1},add_type:function(f,b,d){var f=c(f),a=f.parents(".type-section"),g=e.options.incompatible_types;g?g.search(e.options.id,b,d,{compatible:function(){e.add_type_submit(f,
a)},incompatible:g.overlay_incompatible_callback({onConfirm:function(){e.add_type_submit(f,a)}})}):e.add_type_submit(f,a);return!1},add_type_submit:function(c,b){e.get_script("/propbox-edit.mf.js",function(){e.edit.add_type_submit(c,b)})},add_has_no_value:function(f){var b=c(f).parents(".submenu").data("headmenu").parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.add_has_no_value(b)});return!1},add_has_value:function(f){var b=c(f).parents(".submenu").data("headmenu").parents(".property-section");
e.get_script("/propbox-edit.mf.js",function(){e.edit.add_has_value(b)});return!1},add_is_reviewed:function(f){var b=c(f).parents(".submenu").data("headmenu").parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.add_is_reviewed(b)});return!1},remove_has_no_value:function(f){var b=c(f).parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.remove_has_no_value(b)});return!1},remove_has_value:function(f){var b=c(f).parents(".property-section");e.get_script("/propbox-edit.mf.js",
function(){e.edit.remove_has_value(b)});return!1},more:function(f,b,d,a){var g=c(f).parents(".property-section");e.get_script("/propbox-edit.mf.js",function(){e.edit.more(g,b,d,function(b){c.tablesorter&&b.find(".data-table").toggleClass("table-sortable",!0).tablesorter();a&&a(b)})})},more_and_sort:function(f,b,d,a){c(f).parents(".property-section");e.more(f,d,a,function(g){var i=g.find(".data-table");i.length?i.trigger("sorton",[[[b,0]]]):e.sort_values(c(":first-child",g),b,d,a)})},sort_values:function(f){var f=
c(f).parents(".property-section"),b=f.hasClass("column-header-desc"),d=f.find(".data-list"),a=d.find("li.data-row");a.sort(function(a,d){var f=c(a).find(".property-value").text(),e=c(d).find(".property-value").text();return f.toLowerCase()<e.toLowerCase()?b?1:-1:b?-1:1});d.empty().html(a);f.toggleClass("column-header-desc",!b).toggleClass("column-header-asc",b);e.init_menus(f,!0)}}})(jQuery,window.kbs);
(function(c,h,e){if(h)if(e){var f=h.suggest.prototype._init,b=h.suggest.prototype.show_hook,d=h.suggest.prototype.focus;h("suggest_lrulist",c.extend({},h.suggest.prototype,{_init:function(){f.call(this);this.options.localstore_key?this.options.disabled_key=this.options.localstore_key+".disabled":console.error("$.suggest_lrulist","A localstore key is required.")},focus:function(a){if(this.is_enabled()){var c=this.get_items_();if(c.length){if(this.pane.is(":visible"))return;this.response({lrulist:!0,
prefix:this.input.val(),result:c});return}}d.call(this,a)},create_item:function(a){var b=this.options.css,d=c("<li>").addClass(b.item),a=c("<label>").text(a.id||a.mid),b=c("<div>").addClass(b.item_name).append(a);d.append(b);return d},show_hook:function(a){b.apply(this,arguments);var g=this;if(a.lrulist){var d=c('<div style="float:right">'),f=c('<a href="#">clear list</a>').bind("click.suggest",function(a){a.preventDefault();a.stopPropagation();g.clear_items();g.input.trigger("textchange")}),e=c('<label title="Uncheck to disable recently used list."><input type="checkbox" checked>on</label>');
c(":checkbox",e).bind("change.suggest",function(){g.disable();g.input.trigger("textchange")});d.append(f).append("&nbsp;").append(e);this.status.empty().append("Recently used ").append(d).show()}this.is_disabled()&&(e=c('<label title="Check to remember recently used items."style="float:right;"><input type="checkbox">on</label>').bind("change.suggest",function(){g.enable()}),this.status.append(e))},get_items_:function(){return e(this.options.localstore_key)||[]},clear_items:function(){e(this.options.localstore_key,
null,!1)},disable:function(){this.clear_items();e(this.options.disabled_key,1,!1)},enable:function(){e(this.options.disabled_key,null,!1)},is_enabled:function(){return!this.is_disabled()},is_disabled:function(){return 1==e(this.options.disabled_key)},update:function(a){var b=this.get_items_(),b=c.grep(b,function(c){return a.mid&&a.mid==c.mid||a.id&&a.id==c.id?!1:!0});b.unshift(a);b=b.slice(0,this.options.max);e(this.options.localstore_key,b,!1)}}));c.extend(h.suggest_lrulist,{defaults:c.extend(!0,
{max:10,localstore_key:"$.suggest_lrulist"},h.suggest.defaults)})}else console.error("$.localstore is required");else console.error("$.suggest is required")})(jQuery,jQuery.suggest,jQuery.localstore);
(function(c,h,e){function f(a){return a.replace(/\//g,"\\/")}function b(){this.init()}var d=h.topic={facet:null,init:function(){d.facet=new b;c("#page-content").on("mouseenter","span.property-header, a.schema-name",h.hover.show).on("mouseleave","span.property-header, a.schema-name",h.hover.hide).on("click","a.schema-name",function(){var a=c(this).attr("name");d.add_filter(a);return!1}).on("propbox-change",function(a){d.init_hilite(a.target)});c("#pill-filter-box").click(function(){c("#pill-filter-suggest").focus()});
e.init("#topic-data",{id:h.c.id,base_ajax_url:h.h.ajax_url("lib/propbox"),base_static_url:h.h.static_url("lib/propbox"),lang:h.lang||"/lang/en",suggest_impl:h.suggest_options,incompatible_types:h.incompatible_types});c(document.body).is(".embed")?d.toggle_types(!1):d.toggle_types(c.localstore("fb.topic.types.collapsed"));c("#add-type-input").suggest(h.suggest_options.cotype()).bind("fb-select",function(a,b){d.add_filter(b.id,"/type/type");c(this).val("").trigger("textchange")});c.localstore("topic.show_all")&&
c("#show-all").attr("checked","checked");d.update_facet();var a=c("#pill-filter-suggest").suggest_lrulist(c.extend({localstore_key:"fb.topic.recent_filters",scoring:"schema",output:"(type)"},h.suggest_options.any("type:/type/domain","type:/type/type","type:/type/property"))).bind("fb-select",function(a,b){var e=c(this),f=null;b.output&&(b.output.type&&b.output.type["/type/object/type"])&&c.each(b.output.type["/type/object/type"],function(a,c){return"/type/domain"===c.id||"/type/type"===c.id||"/type/property"===
c.id?(f=c.id,!1):!0});d.add_filter(b.id,f);e.val("").trigger("textchange")}).focus(function(){c("#pill-filter-box").addClass("focused")}).blur(function(){c("#pill-filter-box").removeClass("focused")}).keydown(function(a){8===a.keyCode&&""===c(this).val()&&c("#pill-filter-box").find(".pill-x:last").click()});h.keyboard_shortcut.add("f",function(){a.focus()});h.topic.kbs_overlay_trigger=c(".keyboard-shortcuts").overlay({close:".modal-buttons .button.cancel",closeOnClick:!1,fixed:!1,mask:{color:"#000",
loadSpeed:200,opacity:0.5}});d.init_hilite()},init_hilite:function(a){for(var b={},d=window.location.search&&window.location.search.substr(1),d=d?d.split("&"):[],e=0;e<d.length;e++){var f=d[e].split("=");b[f[0]]=f[1]&&0===f[1].indexOf("/")?f[1]:"/m/0jsjgs5"}if(b.hilite){var o={usergroup_id:b.hilite};h.get_script(h.h.static_url("lib/propbox")+"/propbox-edit.mf.js",function(){c.ajax(c.extend(window.formlib.default_begin_ajax_options(),{url:h.h.ajax_url("usergroup_members.ajax"),data:o,onsuccess:function(b){if(b&&
b.result){var d={};c.each(b.result,function(a,c){d[c.id]=!0;d[c.mid]=!0});(a?c(a).find(".property-value[data-creator]"):c(".property-value[data-creator]")).each(function(a,b){creator=c(b).attr("data-creator");d[creator]&&c(b).closest(".data-list li").toggleClass("hilite",!0)})}}}))})}},init_nav_scrolling:function(a){function b(){var d=c(window).scrollTop();if(d>h){var g=c(window).innerHeight()-50;d>e.top&&(f<g?(a.offset({top:d}),a.addClass("fixed-nav")):(g=d+g,a.offset().top+f<g&&(a.offset({top:g-
f,left:e.left}),a.addClass("fixed-nav"))))}else d>e.top?d<a.offset().top&&(a.offset({top:d}),a.addClass("fixed-nav")):(a.removeClass("fixed-nav"),a.css({top:"",left:""}));h=d}function d(){a.offset();a.removeClass("fixed-nav");a.css({top:"",left:""});e=a.offset();f=a.outerHeight();h=0;c(window).trigger("scroll")}if(!a.data("init_nav_scrolling")){var e=a.offset(),f=a.outerHeight(),h=0,n=null,l=null;c(window).scroll(function(){clearTimeout(n);n=setTimeout(b,100)}).resize(function(){clearTimeout(l);l=
setTimeout(d,0)});a.data("init_nav_scrolling",!0);c(window).trigger("scroll")}},toggle_types:function(a){a?(c.localstore("fb.topic.types.collapsed",1,!1),c(".nav.column").slideUp(function(){c(".data.column").animate({marginRight:0})})):(a=c(".nav.column").width()+20,c.localstore("fb.topic.types.collapsed",0,!1),c(".data.column").animate({marginRight:a},function(){c(".nav.column").slideDown(function(){d.init_nav_scrolling(c(".nav-module",this))})}))},click_filter:function(){d.add_filter(c(this).text());
return!1},add_filter:function(a,b){var e=c("#pill-filter-suggest").data("suggest_lrulist");e&&e.update({id:a});e=f(a);c("#pill-filter-box").find("input[value="+e+"]").length||(d.facet.contains(a)?(e=d.pill(a),c("#pill-filter-suggest").before(e),d.update_facet(!0)):"/type/type"===b?d.load_filter(a):"/type/property"===b?d.load_filter(null,a):h.status.info("The filter does not apply to this topic: "+a))},load_filter:function(a,b){var e={id:h.c.id,lang:h.lang};if(a)e.type=a;else if(b)e.property=b;else return;
h.get_script(h.h.static_url("lib/propbox")+"/propbox-edit.mf.js",function(){c.ajax(c.extend(window.formlib.default_begin_ajax_options(),{url:h.h.ajax_url("type_section.ajax"),data:e,onsuccess:function(c){d.load_filter_callback(a||b,c)}}))})},load_filter_callback:function(a,b){var i=c(b.result.html),j=c(b.result.toc),h=i.attr("data-id");i.find(".status").is(".commons");e.init_menus(i,!0);c(".nicemenu-item.edit",i).show();var o=i.find(".type-section");d.facet.contains(h)?(i=d.facet.get(h),i.section.append(o),
i.toc_types.append(c(".toc-type",j))):(c("#topic-data").prepend(i),c("#toc").prepend(j));d.facet.init();j=c("#pill-filter-box").find(".pill-value[value="+f(a)+"]");j.length||(j=d.pill(a),c("#pill-filter-suggest").before(j));d.update_facet(!0);c(".toc-link",j).click();b.result.assert_type_modal&&(j=c(b.result.assert_type_modal),formlib.init_modal_form({event_prefix:"topic.assert_type.modal.",init:d.init_assert_type_modal,validate:function(){return true},submit:d.submit_assert_type_modal,form:j,type_section:o}))},
init_assert_type_modal:function(a){window.formlib.enable_submit(a);c("button.cancel").focus()},submit_assert_type_modal:function(a){window.formlib.cancel_modal_form(a);a.type_section.find("a.assert-type").click()},remove_filter:function(a){c(a).parent(".pill").remove();d.update_facet(!0);return!1},update_facet:function(a){var b=c("#show-all"),e=d.get_filters();if(e.length)d.facet.filter(e),h.disable(b);else{var f=b.is(":checked");d.facet.show_all(f);h.enable(b)}a&&d.update_window_history(e);c(window).trigger("resize")},
get_filters:function(){var a=[];c("#pill-filter-box").find(".pill:visible").each(function(){a.push(c(this).find(".pill-value").val())});return a},show_all:function(a){c.localstore("topic.show_all",!0==a,!1);d.update_facet(!0);return!1},update_window_history:function(a){null==a&&(a=d.get_filters());var b=c("#show-all").is(":checked"),e={props:"",lang:h.h.lang_code(h.lang)};a.length&&(e.filter=a);!0===b&&(e.all=!0);a=window.location.href.split("#");b=a[0].split("?")[0];b=h.h.build_url(b,e);1<a.length&&
(b+="#"+a[1]);b!=window.location.href&&("function"===typeof history.replaceState?history.replaceState(null,"",b):window.location.href=b)},PILL_HTML:c("#pill-template").html(),pill:function(a){var b=c(d.PILL_HTML);c(".pill-text",b).text(a)[0].href="#"+a;c(".pill-value",b).val(a);return b}};b.prototype.init=function(){var a=this.domains={commons:[],not_commons:[]},b=this.schemas={},d=c("#toc");c("#topic-data");c(".toc-domain",d).each(function(){var d=c(this),e=d.attr("data-id"),i=c(".domain-section[data-id="+
f(e)+"]"),h=d.next(".toc-types"),l={id:e,toc:d,toc_types:h,section:i,types:[],bare_types:[],is:"domain"};d.is(".commons")?a.commons.push(l):a.not_commons.push(l);b[e]=l;c(".toc-type",h).each(function(){var a=c(this),d=a.attr("data-id"),e=c(".type-section[data-id="+f(d)+"]"),i={id:d,toc:a,section:e,is:"type",domain:l,properties:[]};a.is(".bare")?l.bare_types.push(i):l.types.push(i);b[d]=i;c(".property-section",e).each(function(){var a=c(this),d=a.attr("data-id"),a={id:d,section:a,is:"property",schema:i};
i.properties.push(a);b[d]=a})})})};b.prototype.filter=function(a){if(!a||0===a.length)throw Error("Empty filter is not allowed.");var a=b.reduce_filters(a),d=this.schemas,e={},f={},h={};c.each(a,function(a,c){var b=d[c];b&&("domain"===b.is?e[c]=!0:"type"===b.is?f[c]=!0:"property"===b.is&&(h[c]=!0))});a=this.domains.commons.concat(this.domains.not_commons);c.each(a,function(a,b){var d=!1,g=b.types.concat(b.bare_types);c.each(g,function(a,b){var g=!1;c.each(b.properties,function(a,b){h[b.id]||f[b.schema.id]||
e[b.schema.domain.id]?(g=!0,b.section.show()):b.section.hide()});(g=g||f[b.id])?(d=!0,b.section.show(),b.toc.show()):(b.section.hide(),b.toc.hide())});(d=d||e[b.id])?(b.section.show(),b.toc.show(),b.toc_types.show()):(b.section.hide(),b.toc.hide(),b.toc_types.hide())})};b.reduce_filters=function(a){var b=[];a.sort();for(var c=0,d=a.length;c<d;c++){var e=a[c];0===c?b.push(e):0!==e.indexOf(b[b.length-1])&&b.push(e)}return b};b.prototype.show_all=function(a){a?(a=this.domains.commons.concat(this.domains.not_commons),
c.each(a,function(a,b){var d=b.types.concat(b.bare_types);c.each(d,function(a,b){c.each(b.properties,function(a,b){"/type/object/type"===b.id||"/type/object/key"===b.id||"/common/topic/article"===b.id?b.section.hide():b.section.show()});b.section.show();b.toc.show()});b.section.show();b.toc_types.show();b.toc.show()})):(c.each(this.domains.not_commons,function(a,b){b.section.hide();b.toc_types.hide();b.toc.hide()}),c.each(this.domains.commons,function(a,b){c.each(b.types,function(a,b){c.each(b.properties,
function(a,b){"/common/topic/article"===b.id?b.section.hide():b.section.show()});b.section.show();b.toc.show()});c.each(b.bare_types,function(a,b){b.section.hide();b.toc.hide()});b.types.length?(b.section.show(),b.toc_types.show(),b.toc.show()):(b.section.hide(),b.toc_types.hide(),b.toc.hide())}))};b.prototype.contains=function(a){return null!=this.schemas[a]};b.prototype.get=function(a){return this.schemas[a]};c(d.init)})(jQuery,window.freebase,window.propbox);
