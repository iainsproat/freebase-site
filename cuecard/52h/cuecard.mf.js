
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
"CueCard"in window||function(){window.CueCard={loaded:false,version:"trunk",loadingScriptsCount:0,error:null,helper:"http://www.freebase.com/cuecard/",apiProxy:{base:"http://www.freebase.com/cuecard/",read:"mqlread?",write:"mqlwrite?"},freebaseServiceUrl:"http://www.freebase.com/",params:{bundle:true,externals:true}};CueCard.findScript=function(c,b){for(var d=c.documentElement.getElementsByTagName("head"),f=0;f<d.length;f++)for(var e=d[f].firstChild;e!=null;){if(e.nodeType==1&&e.tagName.toLowerCase()==
"script"){var g=e.src;if(g.indexOf(b)>=0)return g}e=e.nextSibling}return null};CueCard.parseURLParameters=function(c,b,d){b=b||{};d=d||{};if(typeof c=="undefined")c=location.href;var f=c.indexOf("?");if(f<0)return b;c=(c+"#").slice(f+1,c.indexOf("#"));var e=c.split("&"),g;c={};var h=window.decodeURIComponent||unescape;for(f=0;g=e[f];f++){var i=g.indexOf("="),j=h(g.slice(0,i).replace(/\+/g," ")),l=c[j];if(typeof l=="undefined")l=[];else l instanceof Array||(l=[l]);c[j]=l.concat(h(g.slice(i+1).replace(/\+/g,
" ")))}for(f in c)if(c.hasOwnProperty(f)){e=d[f]||String;g=c[f];g instanceof Array||(g=[g]);b[f]=e===Boolean&&g[0]=="false"?false:e.apply(this,g)}return b};if(typeof CueCard_urlPrefix=="string")CueCard.urlPrefix=CueCard_urlPrefix;else{var a=CueCard.findScript(document,"cuecard-api.js");if(a==null){CueCard.error=new Error("Failed to derive URL prefix for CueCard API code files");return}CueCard.urlPrefix=a.substr(0,a.indexOf("cuecard-api.js"))}CueCard.parseURLParameters(a,CueCard.params,{bundle:Boolean,
externals:Boolean});CueCard.loaded=true}();
CueCard.createComposition=function(a){var c=new CueCard.QueryEditor(a.queryEditorElement,a.queryEditorOptions),b=null,d=null;if("outputPaneElement"in a){b=a.outputPaneOptions||{};b.queryEditor=c;b=new CueCard.OutputPane(a.outputPaneElement,b);c.setOutputPane(b)}if("controlPaneElement"in a){d=a.controlPaneOptions||{};d.queryEditor=c;if(b!=null)d.outputPane=b;d=new CueCard.ControlPane(a.controlPaneElement,d);c.setControlPane(d)}return{queryEditor:c,outputPane:b,controlPane:d}};CueCard.MqlSyntax={};
CueCard.MqlSyntax.KeywordSuggestions=[{label:"*",hint:"(keyword)",qualifiedProperty:"*",result:"*"},{label:"connect",hint:"(keyword)",qualifiedProperty:"connect",result:"connect"},{label:"create",hint:"(keyword)",qualifiedProperty:"create",result:"create"},{label:"estimate-count",hint:"(keyword)",qualifiedProperty:"estimate-count",result:"estimate-count"},{label:"limit",hint:"(keyword)",qualifiedProperty:"limit",result:"limit"},{label:"optional",hint:"(keyword)",qualifiedProperty:"optional",result:"optional"},
{label:"return",hint:"(keyword)",qualifiedProperty:"return",result:"return"},{label:"sort",hint:"(keyword)",qualifiedProperty:"sort",result:"sort"}];
CueCard.MqlSyntax.KeywordValueHints={"*":{choices:[{label:"null",hint:"return a single value",result:null},{label:"[]",hint:"return a list of values",result:[],offset:1},{label:"{}",hint:"return a single object",result:{},offset:1},{label:"[{}]",hint:"return a list of objects",result:[{}],offset:2}]},connect:{choices:[{label:"insert",hint:"attach a value or object to a non-unique property, or attach the first value or object to a unique property",result:"insert"},{label:"update",hint:"attach a value or object to a unique property replacing any value or object that was previously connected",
result:"update"},{label:"replace",hint:"update unique properties and performs an insert for non-unique properties",result:"replace"},{label:"delete",hint:"detach a value or object from any property",result:"delete"}]},create:{choices:[{label:"unless_exists",hint:"look for a matching object and create it if it doesn't exist",result:"unless_exists"},{label:"unless_connected",hint:"look for a matching object connected to the parent query, and create and connect it if it doesn't exist",result:"unless_connected"},
{label:"unconditional",hint:"create the specified object without looking for a match (dangerous; ues carefully)",result:"unconditional"}]},"estimate-count":{choices:[{label:"null",hint:"(keyword)",result:null}]},limit:{html:'Use a positive integer to limit how many results to return, or <span class="cuecard-code">0</span> for all available results.'},optional:{choices:[{label:"true",hint:"(keyword)",result:true},{label:"false",hint:"(keyword)",result:false},{label:"required",hint:"(keyword)",result:"required"},
{label:"forbidden",hint:"(keyword)",result:"forbidden"}]},"return":{choices:[{label:"count",hint:"(keyword)",result:"count"},{label:"estimate-count",hint:"(keyword)",result:"estimate-count"}]},sort:{html:'Use a property name in the same query node. Prefix it with <span class="cuecard-code">-</span> to sort in descending order. For more complex ordering, see <a href="">this documentation</a>.'}};
CueCard.MqlSyntax.UniqueTopicValueSuggestions=[{label:"null",hint:"returns a single topic ID",result:null},{label:"{}",hint:"returns a single topic object with a default set of properties",result:{},offset:1},{label:'{ "id" : null, "name" : null }',hint:"returns a single topic object with id and name",result:{id:null,name:null}}];
CueCard.MqlSyntax.TopicValueSuggestions=[{label:"[]",hint:"returns a list of topic IDs or topic names",result:[],offset:1},{label:"[{}]",hint:"returns a list of topic objects with a default set of properties",result:[{}],offset:2},{label:'[{ "id" : null, "name" : null, "optional" : true, "limit" : 10 }]',hint:"returns an optional, limited list of topic objects with id and name",result:[{id:null,name:null,optional:true,limit:10}]}];
CueCard.MqlSyntax.SingleValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "type" : null }',hint:"returns a value with type",result:{value:null,type:null}}];CueCard.MqlSyntax.UniqueStringLiteralValueSuggestions=[{label:"null",hint:"returns a single string",result:null},{label:'{ "value" : null, "lang" : null, "optional" : true }',hint:"returns a single string with more options",result:{value:null,lang:null,optional:true}}];
CueCard.MqlSyntax.StringLiteralValueSuggestions=[{label:"[]",hint:"returns a list of strings",result:null},{label:'[{ "value" : null, "lang" : null, "optional" : true }]',hint:"returns a list of strings with more options",result:[{value:null,lang:null,optional:true}]}];CueCard.MqlSyntax.UniqueLiteralValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "optional" : true }',hint:"returns a single value with more options",result:{value:null,optional:true}}];
CueCard.MqlSyntax.LiteralValueSuggestions=[{label:"[]",hint:"returns a list of values",result:null},{label:'[{ "value" : null, "optional" : true }]',hint:"returns a list of values with more options",result:[{value:null,optional:true}]}];CueCard.SerializingContext=function(a){this._parent=a;this._root=a==null?this:a.getRoot();this._properties={}};
CueCard.SerializingContext.prototype={getProperty:function(a){return a in this._properties?this._properties[a]:this._parent!=null?this._parent.getProperty(a):null},setProperty:function(a,c){this._properties[a]=c},getRoot:function(){return this._root},getRootProperty:function(a){return this.getRoot().getProperty(a)},setRootProperty:function(a,c){return this.getRoot().setProperty(a,c)},create:function(){return new SerializingContext(this)}};
CueCard.IndentWriter=function(a){this._context=a;this._stream=a.getProperty("stream")};
CueCard.IndentWriter.prototype={appendLineBreak:function(){this._stream.append("\n")},appendIndent:function(){for(var a=this._context.getRootProperty("indentLevel"),c=this._context.getRootProperty("indentString"),b=0;b<a;b++)this._stream.append(c)},indent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")+1)},unindent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")-1)},append:function(a){this._stream.append(a)}};
(function(){function a(g){return/["\\\x00-\x1f]/.test(g)?g.replace(/([\x00-\x1f\\"])/g,function(h,i){var j=f[i];if(j)return j;j=i.charCodeAt();return"\\u00"+Math.floor(j/16).toString(16)+(j%16).toString(16)}):g}function c(g){return g!=null&&typeof g=="object"&&!(g instanceof Array)&&!("__identifier__"in g)}function b(g){for(var h in g)if(g.hasOwnProperty(h))return true;return false}function d(g){return g.length==0||g.length==1&&c(g[0])&&!b(g[0])}var f={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},e=CueCard.jsonize=function(g,h){h=h?h:{};var i="",j="quoteAllFieldNames"in h?h.quoteAllFieldNames:true,l="variables"in h?h.variables:{},n="resolveVariables"in h?h.resolveVariables:false;if("context"in h)var m=new CueCard.SerializingContext(h.context);else{var o="indentCount"in h?h.indentCount:4,p="";for(m=0;m<o;m++)p+=" ";m=new CueCard.SerializingContext(null);m.setProperty("indentCount",o);m.setProperty("indentString",p);m.setProperty("indentLevel",0);
m.setProperty("stream",{append:function(q){i+=q}})}m.setProperty("omitWhitespace","omitWhitespace"in h?h.omitWhitespace:false);m.setProperty("maxFieldLength","maxFieldLength"in h?h.maxFieldLength:15);m.setProperty("breakLines","breakLines"in h?h.breakLines:true);m.setProperty("alignFieldValues","alignFieldValues"in h?h.alignFieldValues:true);m.setProperty("collapseSingleObjectArray","collapseSingleObjectArray"in h?h.collapseSingleObjectArray:true);m.setProperty("variables",l);m.setProperty("resolveVariables",
n);m.setProperty("encodeJavascriptString","encodeJavascriptString"in h?h.encodeJavascriptString:a);m.setRootProperty("fieldNameEncoder",{_m:{},encode:function(q){if(q in this._m)return this._m[q];else{var s=a(q);return this._m[q]=s=j||/\W/.test(s)?'"'+s+'"':s}}});m.setProperty("path",[]);m.setRootProperty("contextualize","contextualize"in h?h.contextualize:function(q){return q});l=new CueCard.IndentWriter(m);e.converters.anything(g,m,l);return i};e.converters={anything:function(g,h,i){if(g==null)e.converters["null"](g,
h,i);else if(g instanceof Array)e.converters.array(g,h,i);else g instanceof Object?e.converters.object(g,h,i):e.converters[typeof g](g,h,i)},array:function(g,h,i){var j=h.getProperty("omitWhitespace"),l=h.getProperty("breakLines");if(g.length==0)i.append("[]");else{if(g.length==1)if(c(g[0]))if(b(g[0])){if(h.getProperty("collapseSingleObjectArray")){i.append("[");var n=g[0];e.converters.object(n,h,i);i.append("]");return}}else{i.append("[{}]");return}i.append("[");if(l){i.appendLineBreak();i.indent()}else j||
i.append(" ");for(var m=g.length,o=0;o<m;o++){n=g[o];var p=e.converters[n==null?"null":typeof n];if(p){l&&i.appendIndent();p(n,h,i);o<m-1&&i.append(",");if(l)i.appendLineBreak();else j||i.append(" ")}}if(l){i.unindent();i.appendIndent()}i.append("]")}},"boolean":function(g,h,i){i.append(String(g))},"null":function(g,h,i){i.append("null")},undefined:function(g,h,i){i.append("undefined")},number:function(g,h,i){i.append(isFinite(g)?String(g):"null")},object:function(g,h,i){if(g instanceof Array)e.converters.array(g,
h,i);else if("__identifier__"in g){g=g.__identifier__;var j=h.getProperty("resolveVariables"),l=h.getProperty("variables");if(g in l)if(j){j=l[g];e.converters.anything(j,h,i)}else i.append(g);else e.converters.anything(g,h,i)}else{l=h.getRootProperty("contextualize");var n=h.getProperty("path"),m=h.getProperty("omitWhitespace"),o=h.getProperty("breakLines"),p=h.getProperty("alignFieldValues");i.append("{");if(o){i.appendLineBreak();i.indent()}else m||i.append(" ");var q=0,s=0,t=h.getRootProperty("fieldNameEncoder");
for(var u in g)if(g.hasOwnProperty(u)){j=g[u];q++;if(!c(j)&&(!(j!=null&&j instanceof Array)||d(j)))s=Math.max(s,t.encode(u).length)}s=Math.min(s,h.getProperty("maxFieldLength"));for(u in g)if(g.hasOwnProperty(u)){j=g[u];var w=e.converters[j==null?"null":typeof j],x=t.encode(u);o&&i.appendIndent();i.append(x);i.append(m?":":": ");if(!m&&o&&p&&!c(j)&&(!(j!=null&&j instanceof Array)||d(j)))for(x=x.length;x<s;x++)i.append(" ");n.unshift({field:u});w(j,l(h,n),i);n.shift();q--;q>0&&i.append(",");if(o)i.appendLineBreak();
else m||i.append(" ")}if(o){i.unindent();i.appendIndent()}i.append("}")}},string:function(g,h,i){i.append('"'+h.getProperty("encodeJavascriptString")(g)+'"')},"null":function(g,h,i){i.append("null")}}})();CueCard.JsonpQueue={pendingCallIDs:{},callInProgress:0};CueCard.JsonpQueue.cancelAll=function(){CueCard.JsonpQueue.pendingCallIDs={}};
CueCard.JsonpQueue.call=function(a,c,b,d){if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="progress";CueCard.JsonpQueue.callInProgress++;var f=(new Date).getTime()+"x"+Math.floor(Math.random()*1E3),e=document.createElement("script");e.setAttribute("onerror","err"+f+"();");a+=(a.indexOf("?")<0?"?":"&")+"callback=cb"+f;e.setAttribute("src",a);var g=function(){CueCard.JsonpQueue.callInProgress--;if(CueCard.JsonpQueue.callInProgress==0)document.body.style.cursor="auto";d||e.parentNode.removeChild(e);
try{delete window["cb"+f];delete window["err"+f]}catch(h){window["cb"+f]=undefined;window["err"+f]=undefined}if(f in CueCard.JsonpQueue.pendingCallIDs){delete CueCard.JsonpQueue.pendingCallIDs[f];return true}else return false};window["cb"+f]=function(h){if(g())try{c(h)}catch(i){}};window["err"+f]=function(){if(g())if(typeof b=="function")try{b(a)}catch(h){}};CueCard.JsonpQueue.pendingCallIDs[f]=true;document.getElementsByTagName("head")[0].appendChild(e)};
CueCard.JsonpQueue.queryOne=function(a,c,b,d){CueCard.JsonpQueue.queryOneEnvelope({query:a},c,b,d)};CueCard.JsonpQueue.queryOneEnvelope=function(a,c,b,d){a=CueCard.jsonize({q1:a},{breakLines:false});a=CueCard.freebaseServiceUrl+"api/service/mqlread?queries="+encodeURIComponent(a);CueCard.JsonpQueue.call(a,function(f){if(f.q1.code=="/api/status/error")typeof b=="function"&&b(f.q1);else c(f.q1)},function(){typeof b=="function"&&b("Unknown")},d)};CueCard.QueryParser={};
CueCard.QueryParser.parseForContext=function(a,c,b,d){var f=new CueCard.QueryTokenizer(a,c),e=f.token(),g=[],h=CueCard.Token.Types,i=function(){e=g.length==0?f.next():g.shift()},j=function(k){if(k==0)return e;else{for(;k>g.length;)g.push(f.next());return g[k-1]}},l=function(){for(;e!=null&&(e.type==h.whitespace||e.type==h.unrecognized);)i()},n=function(k){return new CueCard.Token(CueCard.Token.Types.phantom,"",k.start,k.start)},m=function(){return e!=null?e:new CueCard.Token(CueCard.Token.Types.phantom,
"",f.index(),f.index())},o=function(){var k=new CueCard.QueryNode(CueCard.QueryNode.TYPE_MISSING);k.startToken=k.endToken=n(m());return k},p=function(k){k=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL);k.startToken=e;for(e!=null&&e.type==h.delimiter&&e.content=="{"&&i();e!=null;){l();if(e==null)break;var r=null,v=null,y=null;if(e.type==h.identifier){r=e.content;v=e;i();l()}else if(e.type==h.stringLiteral){r=e.content.replace(/^['"]/,"").replace(/['"]$/,"");v=e;i();l()}else v=n(e);if(e!=
null&&e.type==h.delimiter&&(e.content==":"||e.content==";")){i();l()}if(e!=null)y=t(false);if(r!=null||y!=null){r=new CueCard.QueryNodeLink(r!=null?r:"",v);r.value=y!=null?y:o();k.links.push(r)}l();if(e==null||e.type==h.delimiter&&(e.content=="}"||e.content=="]"))break;e.type==h.delimiter&&e.content==","&&i()}if(e!=null&&e.type==h.delimiter&&e.content=="}"){k.endToken=e;i()}if(k.endToken==null)k.endToken=m();return k},q=function(){var k=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY);
k.startToken=e;k.elements=[];for(e!=null&&e.type==h.delimiter&&e.content=="["&&i();e!=null;){l();if(e==null||e.type==h.delimiter&&e.content=="]")break;k.elements.push(p());l();e!=null&&e.type==h.delimiter&&e.content==","&&i()}if(e!=null&&e.type==h.delimiter&&e.content=="]"){k.endToken=e;i()}if(k.endToken==null)k.endToken=m();return k},s=function(){for(var k=1,r;(r=j(k))!=null&&(r.type==h.whitespace||r.type==h.unrecognized);)k++;if(r!=null)if(r.type==h.delimiter&&r.content=="{")return q();else if(r.type==
h.identifier||r.type==h.stringLiteral){for(k++;(r=j(k))!=null&&(r.type==h.whitespace||r.type==h.unrecognized);)k++;if(r!=null&&r.type==h.delimiter&&r.content==":")return q()}k=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);k.startToken=e;k.isArray=true;k.value=[];for(e!=null&&e.type==h.delimiter&&e.content=="["&&i();e!=null;){l();if(e==null||e.type==h.delimiter&&e.content=="]")break;r=t(false);if(r==null)break;k.value.push(r);l();e!=null&&e.type==h.delimiter&&e.content==","&&i()}if(e!=null&&
e.type==h.delimiter&&e.content=="]"){k.endToken=e;i()}if(k.endToken==null)k.endToken=m();return k},t=function(k){l();if(e==null)k=o();else{if(e.type==h.delimiter)k=e.content=="["?s():e.content=="{"?p():o();else{if(k)k=q();else a:{k=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);k.startToken=k.endToken=e;k.isArray=false;if(e.type==h.numberLiteral)k.value=parseFloat(e.content);else if(e.type==h.stringLiteral)k.value=e.content.replace(/^['"]/,"").replace(/['"]$/,"");else if(e.type==h.booleanLiteral)k.value=
e.content=="true"||e.content=="True";else if(e.type==h.nullLiteral)k.value=null;else if(e.type==h.delimiter){k=null;break a}else k.value=e.content;i();k=k}k=k}k=k}return k},u=function(k){return b<k.start.line||b==k.start.line&&d<=k.start.col},w=function(k){return b>k.start.line||b==k.start.line&&d>=k.start.col},x=function(k){return b<k.end.line||b==k.end.line&&d<=k.end.col};u=function(k){return b<k.start.line||b==k.start.line&&d<=k.start.col};var A=function(k){return k.startToken==k.endToken?w(k.startToken)&&
x(k.startToken):w(k.startToken)&&u(k.endToken)},z=function(k,r){if(k.type==CueCard.QueryNode.TYPE_TERMINAL)if(k.isArray){for(var v=0;v<k.value.length;v++){var y=k.value[v];if(u(y.startToken)){r.push({child:v,relative:"before",node:k});return}else if(A(y)){r.push({child:v,relative:"inside",node:k});z(y,r);return}}r.push({child:k.value.length,relative:"before",node:k})}else r.push({token:k.startToken,node:k,offset:d-k.startToken.start.col});else if(k.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){for(v=
0;v<k.elements.length;v++){y=k.elements[v];if(u(y.startToken)){r.push({child:v,relative:"before",node:k});return}else if(A(y)){r.push({child:v,relative:"inside",node:k});z(y,r);return}}r.push({child:k.elements.length,relative:"before",node:k})}else if(k.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(v=0;v<k.links.length;v++){y=k.links[v];if(u(y.token)){r.push({child:v,relative:"before",node:k});return}else if(x(y.token)){r.push({child:v,relative:"path",node:k,offset:d-y.token.start.col});return}else if(w(y.value.startToken)){if(x(y.value.endToken)){r.push({child:v,
relative:"inside",node:k});z(y.value,r);return}}else{r.push({child:v,relative:"space",node:k});return}}r.push({child:k.links.length,relative:"before",node:k})}else r.push({token:k.startToken,node:k})};l();a={model:t(true),context:[]};z(a.model,a.context);return a};CueCard.QueryTokenizer=function(a,c){this._text=a+" ";this._maxIndex=a.length;this._index=c;this._col=this._line=0;this.next()};CueCard.QueryTokenizer.prototype.token=function(){return this._token};
CueCard.QueryTokenizer.prototype.index=function(){return this._index};CueCard.QueryTokenizer._whitespaces=" \t\r\n";
CueCard.QueryTokenizer.prototype.next=function(){this._token=null;if(this._index<this._maxIndex){var a=this._text.charAt(this._index),c=this._text.charAt(this._index+1),b=this,d=function(){b._index++;b._col++},f=function(){return new CueCard.TokenPos(b._index,b._line,b._col)},e=function(){var n=f();d();return n},g=function(n,m,o){var p=f();b._pos=p;b._token=new CueCard.Token(n,o||b._text.substring(m.offset,p.offset),m,p)},h=function(){for(var n=f();b._index<b._maxIndex;){var m=b._text.charAt(b._index);
if(CueCard.QueryTokenizer._whitespaces.indexOf(m)<0)break;if(m=="\n"){b._line++;b._col=0}else b._col++;b._index++}g(CueCard.Token.Types.whitespace,n)},i=function(n){var m=f();a=="u"&&d();d();for(var o="";b._index<b._maxIndex;){a=b._text.charAt(b._index);if(a==n){d();break}else if(a=="\r"||a=="\n")break;if(a=="\\"){d();o+=b._text.charAt(b._index)}else o+=a;d()}g(CueCard.Token.Types.stringLiteral,m,o)},j=function(){var n=f();if(a=="+")d();else a=="-"&&d();for(;b._index<b._maxIndex&&CueCard.QueryTokenizer._isDigit(b._text.charAt(b._index));)d();
if(b._index<b._maxIndex&&b._text.charAt(b._index)==".")for(d();b._index<b._maxIndex&&CueCard.QueryTokenizer._isDigit(b._text.charAt(b._index));)d();if(b._index<b._maxIndex&&b._text.charAt(b._index)=="e"){d();a=b._text.charAt(b._index);if(a=="+"||a=="-")d();for(;b._index<b._maxIndex&&CueCard.QueryTokenizer._isDigit(b._text.charAt(b._index));)d()}g(CueCard.Token.Types.numberLiteral,n)},l=function(){for(var n=f();b._index<b._maxIndex&&CueCard.QueryTokenizer._identifierPrefix.indexOf(b._text.charAt(b._index))>=
0;)d();var m=false;if(b._index<b._maxIndex-2){var o=b._text.substr(b._index,2);if(o==">="||o=="<="||o=="~="){d();d();m=true}}if(!m&&b._index<b._maxIndex-1){o=b._text.substr(b._index,1);if(o==">"||o=="<")d()}m=f();o=b._text.substring(n.offset,m.offset);b._pos=m;b._token=o=="null"||o=="None"?new CueCard.Token(CueCard.Token.Types.nullLiteral,o,n,m):o=="true"||o=="True"||o=="false"||o=="False"?new CueCard.Token(CueCard.Token.Types.booleanLiteral,o,n,m):new CueCard.Token(CueCard.Token.Types.identifier,
o,n,m)};if(CueCard.QueryTokenizer._whitespaces.indexOf(a)>=0)h();else if("[{}],:".indexOf(a)>=0)g(CueCard.Token.Types.delimiter,e());else if(a=='"'||a=="'")i(a);else if(a=="u"&&(c=='"'||c=="'"))i(c);else if(a=="-"||a=="+"||CueCard.QueryTokenizer._isDigit(a))j();else if(a=="*")g(CueCard.Token.Types.identifier,e());else CueCard.QueryTokenizer._identifierPrefix.indexOf(a)>=0?l():g(CueCard.Token.Types.unrecognized,e())}return this._token};
CueCard.QueryTokenizer._isDigit=function(a){return"0123456789".indexOf(a)>=0};CueCard.QueryTokenizer._identifierPrefix="#!/_-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";CueCard.TokenPos=function(a,c,b){this.offset=a;this.line=c;this.col=b};CueCard.Token=function(a,c,b,d){this.type=a;this.content=c;this.start=b;this.end=d};CueCard.Token.Types={unrecognized:-1,phantom:0,whitespace:1,delimiter:2,nullLiteral:3,numberLiteral:4,stringLiteral:5,booleanLiteral:6,identifier:7};
CueCard.QueryNode=function(a){this.type=a;this.value=null;this.isArray=false;this.endToken=this.startToken=null;this.links=[]};CueCard.QueryNode.TYPE_MISSING=-1;CueCard.QueryNode.TYPE_TERMINAL=0;CueCard.QueryNode.TYPE_NONTERMINAL=1;CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY=2;CueCard.QueryNode.prototype.toQueryJson=function(a){a=a||{};if(!("qualifyAllProperties"in a))a.qualifyAllProperties=false;if(!("excludeChild"in a))a.excludeChild=-1;return this._toQueryJson(a)};
CueCard.QueryNode.prototype._toQueryJson=function(a){var c={qualifyAllProperties:a.qualifyAllProperties,excludeChild:-1};if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray){a=[];for(var b=0;b<this.value.length;b++){var d=this.value[b];a.push(d!=null?d._toQueryJson(c):null)}return a}else return this.startToken.type==CueCard.Token.Types.identifier?{__identifier__:this.value}:this.value;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){a=[];for(b=0;b<this.elements.length;b++)a.push(this.elements[b]._toQueryJson(c));
return a}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){d={};var f=false,e=0;for(b=0;b<this.links.length;b++)if(b!=a.excludeChild){var g=this.links[b];if(g.path.length>0){var h=g.getPath(a.qualifyAllProperties);if(h in d&&g.namespace.length==0)for(;h in d;){g.namespace="ns"+e++ +":";h=g.getPath(a.qualifyAllProperties)}var i=g.value!=null?g.value._toQueryJson(c):null;d[h]=i;if(g.getUnnamespacedQualifiedPath()=="/type/object/type"&&i!=null&&(!(i instanceof Array)||i.length>0))f=true}}if(!f&&
"expectedTypes"in a&&a.expectedTypes.length>0){c=[];for(b=0;b<a.expectedTypes.length;b++){f=a.expectedTypes[b];f!="/type/object"&&f!="/common/topic"&&c.push(f)}if(c.length==1)d.type=c[0];else if(c.length>1)d["type|="]=c}return d}else return null};CueCard.QueryNode.isMqlKeyword=function(a){switch(a){case "limit":case "sort":case "*":case "return":case "count":case "estimate-count":case "optional":case "create":case "connect":return true}return false};
CueCard.QueryNode.prototype.getDeclaredTypes=function(a){var c=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)c=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)c=this.elements[0].links;if(c!=null)for(var b=0;b<c.length;b++){var d=c[b];d.qualifiedProperty=="/type/object/type"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredIDs=function(a){var c=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)c=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)c=this.elements[0].links;if(c!=null)for(var b=0;b<c.length;b++){var d=c[b];d.qualifiedProperty=="/type/object/id"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredGUIDs=function(a){var c=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)c=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)c=this.elements[0].links;if(c!=null)for(var b=0;b<c.length;b++){var d=c[b];d.qualifiedProperty=="/type/object/guid"&&!d.reverse&&d.getValuesOfType(a,"string")}};CueCard.QueryNode.prototype.qualifyAllProperties=function(a){this._qualifyAllProperties([],{},a)};
CueCard.QueryNode.prototype._qualifyAllProperties=function(a,c,b){if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var d=[],f=false,e=[],g=[],h=[],i=0;i<this.links.length;i++){var j=this.links[i];if(j.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||j.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY||j.value.type==CueCard.QueryNode.TYPE_MISSING)d.push(j);if(j.qualifiedProperty=="/type/object/type"&&!j.reverse)j.getValuesOfType(e,"string");else if(j.qualifiedProperty=="/type/object/id"&&!j.reverse)j.getValuesOfType(g,
"string");else if(j.qualifiedProperty=="/type/object/guid"&&!j.reverse)j.getValuesOfType(h,"string");else if(j.qualifiedProperty!=null&&j.qualifiedProperty.length>0){var l=j.qualifiedProperty.lastIndexOf("/");l>0&&e.push(j.qualifiedProperty.substr(0,l))}else CueCard.QueryNode.isMqlKeyword(j.property)||(f=true)}e=e.concat(a);j={};for(i=e.length-1;i>=0;i--)j[e[i]]=true;e=[];for(var n in j)e.push(n);if(!f&&d.length==0)b.onDone(c);else{var m=this;f=[];e.length>0&&f.push("t="+encodeURIComponent(e.join(",")));
g.length>0&&f.push("i="+encodeURIComponent(g.join(",")));h.length>0&&f.push("g="+encodeURIComponent(h.join(",")));e=CueCard.helper+"qualify-properties?"+f.join("&");CueCard.JsonpQueue.call(e,function(p){var q=p.properties;p=p.qualifications;for(var s=0;s<m.links.length;s++){var t=m.links[s];if(t.qualifiedProperty.length==0&&!CueCard.QueryNode.isMqlKeyword(t.property))t.qualifiedProperty=p[t.property]||t.property}for(var u in q)c[u]=q[u];(function(){if(d.length==0)b.onDone(c);else{var w=d.shift(),
x=[];if(w.qualifiedProperty in q)for(var A=q[w.qualifiedProperty].expectedTypes,z=0;z<A.length;z++)x.push(A[z].id);x.push("/common/topic");x.push("/type/object");if(w.value.type==CueCard.QueryNode.TYPE_NONTERMINAL)w.value.expectedTypes=x;else if(w.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){A=w.value.elements;for(z=0;z<A.length;z++)A[z].expectedTypes=x}w.value._qualifyAllProperties(x,c,{onDone:arguments.callee,onError:b.onError})}})()},b.onError)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){i=
0;var o=this.elements;(function(){i<o.length?o[i++]._qualifyAllProperties(a,c,{onDone:arguments.callee,onError:b.onError}):b.onDone(c)})()}else b.onDone()};CueCard.QueryNode.prototype.getCursorFromContext=function(a){return this._getCursorFromContext(a,0)};
CueCard.QueryNode.prototype._getCursorFromContext=function(a,c){var b=a[c];if(this.type==CueCard.QueryNode.TYPE_MISSING){var d=this.startToken;return{line:d.start.line,col:d.start.col}}else if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray)if(b.relative=="inside")if(b.child<this.value.length)return this.value[b.child]._getCursorFromContext(a,c+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(b.child<this.value.length){b=this.value[b.child];d=b.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else{d=this.startToken;return{line:d.start.line,col:d.start.col+("offset"in b?b.offset:0)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if(b.relative=="inside")if(b.child<this.elements.length)return this.elements[b.child]._getCursorFromContext(a,c+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(b.child<this.elements.length){b=this.elements[b.child];d=b.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(b.relative=="inside")if(b.child<this.links.length)return this.links[b.child].value._getCursorFromContext(a,c+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(b.relative=="before")if(b.child<this.links.length){b=this.links[b.child].value;d=b.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(b.child<this.links.length)if(b.relative==
"path"){d=this.links[b.child].token;return{line:d.start.line,col:d.start.col+("offset"in b?b.offset:0)}}else{d=this.links[b.child].value.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.endToken;return{line:d.end.line,col:d.end.col}}};CueCard.QueryNode.prototype.toInsideOutQueryJson=function(a,c){var b=this;this.qualifyAllProperties({onDone:function(){c.onDone(b._toInsideOutQueryJson(a,0,null,null))},onError:c.onError})};
CueCard.QueryNode.prototype._toInsideOutQueryJson=function(a,c,b,d){if(b!=null&&!(d instanceof Array))d=[d];if(c<a.length){var f=a[c];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in f&&f.relative=="inside"){var e=f.child;if(e<this.links.length){f=this.links[e];if(f.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||f.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){var g=f.getInverseQualifiedPath();e=this.toQueryJson({excludeChild:e});if(b!=null)if(e instanceof Array)e[0][b]=d;else e[b]=
d;return f.value._toInsideOutQueryJson(a,c+1,g,e)}}}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in f&&f.relative=="inside"){e=f.child;if(this.elements.length>1)throw new Error("Cannot turn a query inside out if a query node has siblings");else if(e==0){a=this.elements[e]._toInsideOutQueryJson(a,c+1,b,d);return a instanceof Array?a:[a]}else return null}}a=this.toQueryJson({expectedTypes:"expectedTypes"in this?this.expectedTypes:[]});if(b!=null)if(typeof a==Array)a[0][b]=
d;else a[b]=d;return a};CueCard.QueryNode.prototype.locateInnerMostNonTerminal=function(a,c){var b=this;this.qualifyAllProperties({onDone:function(){var d=b._locateInnerMostNonTerminal(a,0);c.onDone(d!=null?d:{node:b,property:null,reverse:false})},onError:c.onError})};
CueCard.QueryNode.prototype._locateInnerMostNonTerminal=function(a,c){if(c<a.length){var b=a[c];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in b&&b.relative=="inside"){b=b.child;if(b<this.links.length){var d=this.links[b];if(d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){b=d.value._locateInnerMostNonTerminal(a,c+1);if(b==null)b={node:d.value};if(!("property"in b)){b.property=d.qualifiedProperty;b.reverse=d.reverse}return b}}}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in b&&b.relative=="inside"){b=b.child;if(b<this.elements.length){d=this.elements[b];b=d._locateInnerMostNonTerminal(a,c+1);if(b==null)b={node:d};return b}}}return null};
CueCard.QueryNodeLink=function(a,c){this.path=a;this.token=c;this.reverse=false;this.suffix=this.qualifiedProperty=this.originalProperty=this.property=this.namespace="";this.value=null;if(a.length>0)if(a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}if(a.length>0){var b=a.indexOf(":");if(b>=0){this.namespace=a.substr(0,b+1);a=a.substr(b+1);if(a.length>0&&a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}}}if(a.length>=2){b=a.substr(a.length-2);if(b==">="||b=="<="||b=="~="){this.suffix=b;a=a.substr(0,
a.length-2)}}if(a.length>1&&this.suffix==""){b=a.substr(a.length-1);if(b=="<"||b==">"){this.suffix=b;a=a.substr(0,a.length-1)}}this.originalProperty=a;if(a.length>0)if(a.charAt(0)=="/"){this.qualifiedProperty=a;b=a.lastIndexOf("/");this.property=a.substr(b+1)}else this.property=a;if(this.qualifiedProperty=="")if(this.property=="type")this.qualifiedProperty="/type/object/type";else if(this.property=="id")this.qualifiedProperty="/type/object/id";else if(this.property=="guid")this.qualifiedProperty=
"/type/object/guid";else if(this.property=="name")this.qualifiedProperty="/type/object/name";else if(this.property=="lang")this.qualifiedProperty="/type/text/lang";else if(CueCard.QueryNode.isMqlKeyword(this.property))this.qualifiedProperty=this.property};CueCard.QueryNodeLink.prototype.getQualifiedPath=function(){return(this.reverse?"!":"")+this.namespace+this.qualifiedProperty+this.suffix};
CueCard.QueryNodeLink.prototype.getInverseQualifiedPath=function(){return(this.reverse?"":"!")+this.namespace+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getUnnamespacedQualifiedPath=function(){return(this.reverse?"!":"")+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getPath=function(a){return(this.reverse?"!":"")+this.namespace+(a&&this.qualifiedProperty.length>0?this.qualifiedProperty:this.originalProperty)+this.suffix};
CueCard.QueryNodeLink.prototype.getValuesOfType=function(a,c){var b=function(g){if(g.isArray){g=g.value;for(var h=0;h<g.length;h++){var i=g[h];i.type==CueCard.QueryNode.TYPE_TERMINAL&&i.value!=null&&typeof i.value==c&&a.push(i.value)}}else g.value!=null&&typeof g.value==c&&a.push(g.value)},d=this.value;if(d.type==CueCard.QueryNode.TYPE_TERMINAL)b(d);else if(d.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){d=d.type==CueCard.QueryNode.TYPE_NONTERMINAL?d.links:
d.elements[0].links;for(var f=0;f<d.length;f++){var e=d[f];e.qualifiedProperty=="/type/value/value"&&e.value.type==CueCard.QueryNode.TYPE_TERMINAL&&b(e.value)}}};CueCard.UI={};CueCard.UI.reportError=function(a){try{console.log(a)}catch(c){alert(a)}};CueCard.UI.createBlockingContinuations=function(a,c){return new CueCard.UI.Cont(a,c)};
CueCard.UI.Cont=function(a,c){var b=this;this._onDone=a;this._onError=c||CueCard.UI.reportError;this._progressUI=null;this._cleanedUp=this._canceled=false;this.cleanUp=function(){if(!b._cleanedUp){b._cleanedUp=true;if(b._progressUI!=null){b._progressUI.remove();b._progressUI=null}}};this.cancel=function(){if(!b._canceled){b._canceled=true;b.cleanUp()}};this.onError=function(){b.cleanUp();b._onError()};this.onDone=function(){var d=false;if(!b._canceled){d=[b];for(var f=0;f<arguments.length;f++)d.push(arguments[f]);
d=b._onDone.apply(null,d)}d||b.cleanUp()};window.setTimeout(function(){if(!b._cleanedUp)b._progressUI=$('<div class="cuecard-progress">Working...</div>').appendTo($(document.body))},300)};CueCard.UI.Cont.prototype.isCanceled=function(){return this._canceled};CueCard.UI.Cont.prototype.extend=function(a,c){this._onDone=a;this._onError=c||this._onError;return this};
CueCard.Popup=function(a,c,b,d,f){this._left=a;this._top=c;this._height=b;this._windows=d;this._handlers=f||{};this._pendingContinuations=[];this.elmt=$('<div class="cuecard-popup-container"></div>').css("top",this._top+this._height+"px").css("left",this._left+"px").appendTo("body");this._addEventHandlers()};CueCard.Popup.prototype.addPendingContinuation=function(a){this._pendingContinuations.push(a)};
CueCard.Popup.prototype.reposition=function(){var a=this.elmt.height(),c=this.elmt.width();this._top+this._height+a>=$(window).height()?this.elmt.css("top",this._top-a-5+"px"):this.elmt.css("top",this._top+this._height+"px");this._left+c>=$(window).width()?this.elmt.css("left",$(window).width()-c-25+"px"):this.elmt.css("left",this._left+"px")};CueCard.Popup.prototype.close=function(){this._remove();this._pendingContinuations=null};
CueCard.Popup.prototype.cancel=function(){if(this.elmt!=null){this._remove();this._cancelPendingContinuations();this._pendingContinuations=null}};CueCard.Popup.prototype._remove=function(){this._removeEventHandlers();this.elmt.remove();this.elmt=null};CueCard.Popup.prototype._cancelPendingContinuations=function(){for(var a=0;a<this._pendingContinuations.length;a++)try{this._pendingContinuations[a].cancel()}catch(c){}this._pendingContinuations=[]};
CueCard.Popup.prototype._addEventHandlers=function(){var a=this;this._handleKeyDown=function(f){return a._onKeyDown(f)};this._handleMouseDown=function(f){return a._onMouseDown(f)};for(var c=0;c<this._windows.length;c++){var b=this._windows[c];try{$(b.document).keydown(this._handleKeyDown).mousedown(this._handleMouseDown)}catch(d){alert("Unable to install keyup handler on codemirror window")}}};
CueCard.Popup.prototype._removeEventHandlers=function(){for(var a=0;a<this._windows.length;a++){var c=this._windows[a];try{$(c.document).unbind("keydown",this._handleKeyDown).unbind("mousedown",this._handleMouseDown)}catch(b){alert("Unable to install keyup handler on codemirror window")}}};CueCard.Popup.prototype._onKeyDown=function(a){if(a.keyCode==27){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("key")}};
CueCard.Popup.prototype._onMouseDown=function(a){if(this.mouseEventOutsidePopup(a)){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("mouse")}};CueCard.Popup.prototype.mouseEventOutsidePopup=function(a){if(a.currentTarget!=this.elmt[0].ownerDocument)return true;else{var c=this.elmt.offset();if(a.pageX<c.left||a.pageX>c.left+this.elmt.width()||a.pageY<c.top||a.pageY>c.top+this.elmt.height())return true}return false};
CueCard.TypeBasedTopicSuggestor=function(a,c,b,d,f){this._popup=a;this._defaultSuggestions=c;this._expectedTypes=b;this._desiredProperty=d;this._onCommit=f;this._popup.elmt.addClass("cuecard-popup-container-wide")};
CueCard.TypeBasedTopicSuggestor.prototype.getSuggestions=function(a,c){a=a.toLowerCase();if(a.length==0){for(var b=[],d=0;d<this._defaultSuggestions.length;d++)b.push(this._defaultSuggestions[d]);c(b)}else{var f=this;b=CueCard.UI.createBlockingContinuations(function(e,g){for(var h=[],i=0;i<g.result.length;i++){var j=g.result[i],l=null;if("/common/topic/image"in j&&j["/common/topic/image"]!=null&&j["/common/topic/image"].length>0)l=CueCard.freebaseServiceUrl+"api/trans/image_thumb"+j["/common/topic/image"][0].id+
"?mode=fillcrop&maxwidth=40&maxheight=40";h.push({result:j[f._desiredProperty],elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}"><table cellpadding="0" cellspacing="0"><tr valign="top"><td valign="top">'+(l==null?'<div class="cuecard-suggestion-thumbnail-empty"> </div>':'<img src="'+l+'" />')+'</td><td valign="top">'+j.name+'<div class="cuecard-suggestion-id">'+j[f._desiredProperty]+"</div></td></tr></table></a>")})}c(h)});this._popup.addPendingContinuation(b);d=CueCard.helper+"suggest-values-of-types?t="+
encodeURIComponent(this._expectedTypes.join(","))+"&q="+encodeURIComponent(a);CueCard.JsonpQueue.call(d,b.onDone,b.onError)}};CueCard.TypeBasedTopicSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.StaticChoicesSuggestor=function(a,c){this._defaultSuggestions=a;this._onCommit=c};
CueCard.StaticChoicesSuggestor.prototype.getSuggestions=function(a,c){a=a.toLowerCase();for(var b=[],d=0;d<this._defaultSuggestions.length;d++){var f=this._defaultSuggestions[d];if(a.length==0||f.label.toLowerCase().indexOf(a)>=0)b.push(f)}c(b)};CueCard.StaticChoicesSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.PropertySuggestor=function(a,c,b,d){this._popup=a;this._defaultSuggestions=c;this._entries=b;this._onCommit=d};
CueCard.PropertySuggestor.prototype.getSuggestions=function(a,c){a=a.toLowerCase();for(var b=[],d={},f=0;f<this._entries.length;f++){var e=this._entries[f];if(a.length==0)b.push(e);else if(e.label.toLowerCase().indexOf(a)>=0)b.push(e);else for(var g=0;g<e.expectedTypes.length;g++){var h=e.expectedTypes[g];if(h.name.toLowerCase().indexOf(a)>=0){b.push({label:e.label,hint:e.hint+" &rarr; type "+h.id,qualifiedProperty:e.qualifiedProperty,result:e.result,offset:e.offset,extent:e.extent});d[e.qualifiedProperty]=
true;break}}}for(f=0;f<this._defaultSuggestions.length;f++){e=this._defaultSuggestions[f];if(a.length==0||e.label.toLowerCase().indexOf(a)>=0)b.push(e)}if(a.length<3&&b.length>3)c(b);else{f=CueCard.UI.createBlockingContinuations(function(i,j){for(var l=0;l<j.result.length;l++){var n=j.result[l];if(!(n.id in d)&&"/type/property/schema"in n&&n["/type/property/schema"]!=null&&n["/type/property/schema"].length>0&&"key"in n&&n.key!=null&&n.key.length>0){var m="/type/property/expected_type"in n&&n["/type/property/expected_type"]!=
null?n["/type/property/expected_type"]:[],o={label:n.key[0],hint:"of type "+n["/type/property/schema"][0].id,qualifiedProperty:n.id,expectedTypes:m};CueCard.QueryEditor.setPropertySuggestionSuffix(m.length>0?m[0]:"",o,o["/type/property/unique"],'"'+n.id+'" : ');b.push(o)}}c(b)});this._popup.addPendingContinuation(f);e=CueCard.helper+"suggest-arbitrary-properties?q="+encodeURIComponent(a);CueCard.JsonpQueue.call(e,f.onDone,f.onError)}};CueCard.PropertySuggestor.prototype.commit=function(a){this._onCommit(a)};
CueCard.TypeSuggestor=function(){};CueCard.TypeSuggestor.prototype.getSuggestions=function(){};
CueCard.SuggestionController=function(a,c,b,d){this._popup=a;this._suggestor=b;this._lastText=d;this._selectedIndex=-1;this._suggestions=[];this._input=$('<input value="'+d+'" />');this._suggestionContainer=$('<div class="cuecard-suggestion-container"></div>');$(c).append($('<div class="cuecard-suggestion-input-container"></div>').append(this._input)).append(this._suggestionContainer);var f=this;this._onKeyUp=function(e){if(!e.shiftKey&&!e.metaKey&&!e.ctrlKey){if(e.keyCode==36||e.keyCode==38||e.keyCode==
40)return f._cancelEvent(e);e=f._input[0].value;if(e!=f._lastText){f._lastText=e;f._updateSuggestions()}}};this._onKeyDown=function(e){for(;!e.shiftKey&&!e.metaKey&&!e.ctrlKey;){if(e.keyCode==13||e.keyCode==9)f._commitSelectedSuggestion();else if(e.keyCode==36)f._suggestions.length>0&&f._selectSuggestion(0,true);else if(e.keyCode==38)f._selectedIndex>0&&f._selectSuggestion(f._selectedIndex-1,true);else if(e.keyCode==40)f._selectedIndex<f._suggestions.length-1&&f._selectSuggestion(f._selectedIndex+
1,true);else break;return f._cancelEvent(e)}if("onKeyDown"in f._suggestor)return f._suggestor.onKeyDown(e,f._input[0].value)};this._input.keyup(this._onKeyUp).keydown(this._onKeyDown);a=this._input[0];if(a.setSelectionRange){a.focus();a.setSelectionRange(d.length,d.length)}else if(a.createTextRange){a=a.createTextRange();a.collapse(true);a.moveEnd("character",d.length);a.moveStart("character",d.length);a.select()}this._input[0].focus();this._updateSuggestions()};
CueCard.SuggestionController.prototype._updateSuggestions=function(){this._suggestionContainer.empty();this._suggestionContainer.html('<div class="cuecard-suggestion-progress">Please wait...</div>');this._selectedIndex=-1;this._suggestions.length=0;var a=this;this._suggestor.getSuggestions(this._lastText,function(c){a._renderSuggestions(c,a._lastText)})};
CueCard.SuggestionController.prototype._renderSuggestions=function(a){var c=this._suggestionContainer;c.empty();var b=this,d=function(e,g){("elmt"in e?e.elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}">'+e.label+("hint"in e?' <span class="cuecard-suggestion-hint">'+e.hint+"</span>":"")+"</a>")).mouseover(function(){b._selectSuggestion(g,false)}).click(function(){b._commitSelectedSuggestion()}).appendTo(c)};this._suggestions=a;for(var f=0;f<a.length;f++)d(a[f],f);this._suggestions.length>
0?this._selectSuggestion(0,false):$('<div class="cuecard-suggestion-noEntryMessage">No suggestion available.<br/>Press Enter to keep what you have typed,<br/>ESC to discard it.</div>').appendTo(c);this._popup.reposition()};
CueCard.SuggestionController.prototype._selectSuggestion=function(a,c){this._selectedIndex>=0&&this._getSuggestion(this._selectedIndex).removeClass("cuecard-suggestion-selected");this._selectedIndex=a;this._getSuggestion(this._selectedIndex).addClass("cuecard-suggestion-selected");c&&this._getSuggestion(this._selectedIndex)[0].scrollIntoView(false)};
CueCard.SuggestionController.prototype._commitSelectedSuggestion=function(){this._selectedIndex>=0?this._suggestor.commit(this._suggestions[this._selectedIndex]):this._suggestor.commit(this._input[0].value)};CueCard.SuggestionController.prototype._getSuggestion=function(a){return $(this._suggestionContainer.children()[a])};CueCard.SuggestionController.prototype._cancelEvent=function(a){a.returnValue=false;a.cancelBubble=true;"preventDefault"in a&&a.preventDefault();return false};
CueCard.QueryEditor=function(a,c){this._container=a;this._options=c;this._controlPane=this._outputPane=null;this._assistKeyComboDetected=this._warnWrites=false;this._popup=null;var b=this;this._overflowInput=$("<input></input>").css("position","absolute").css("left","-500px").css("top","0px").appendTo(document.body);this._container.innerHTML='<div class="cuecard-queryEditor-inner"></div>';this._controlTopContainer=$('<div class="cuecard-queryEditor-controls-top"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="99%"></td></tr></table></div>').appendTo(this._container.firstChild);
this._iframeContainer=$('<div class="cuecard-queryEditor-content"></div>').appendTo(this._container.firstChild);this._controlBottomContainer=$('<div class="cuecard-queryEditor-controls-bottom"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="90%"></td></tr><tr><td width="90%"></td></tr></table></div>').appendTo(this._container.firstChild);this._constructButtons();this.layout();var d="[{\n  \n}]",f=1,e=2;if("content"in c){d=c.content;e=f=0}d={basefiles:[],parserfile:[SERVER.libs.codemirror],
stylesheet:[SERVER.libs.codemirror_css],parserConfig:{json:true},height:"100%",autoMatchParens:true,textWrapping:false,highlightActiveLine:true,readOnly:"readOnly"in c?c.readOnly:false,content:d,passDelay:100,undoDelay:250,initCallback:function(){b._onReady();try{var g=b._editor.nthLine(f+1);b._editor.selectLines(g,e,g,e)}catch(h){}"onReady"in c&&c.onReady();c.focusOnReady&&b.focus()}};if("onChange"in c)d.onChange=c.onChange;c.codeMirror&&$.extend(d,c.codeMirror);this._editor=new CodeMirror(function(g){b._iframeContainer.append(g)},
d)};CueCard.QueryEditor.nativeTypes={"/type/int":true,"/type/float":true,"/type/boolean":true,"/type/rawstring":true,"/type/uri":true,"/type/datetime":true,"/type/bytestring":true,"/type/value":true,"/type/text":true,"/type/enumeration":true};
CueCard.QueryEditor.prototype.dispose=function(){this._cancelPopup();$(this._editor._top_element).remove();this._overflowInput.remove();this._controlTopContainer.remove();this._controlBottomContainer.remove();this._iframeContainer.remove();this._iframeContainer=this._controlBottomContainer=this._controlTopContainer=this._overflowInput=this._editor=null};
CueCard.QueryEditor.prototype.layout=function(){var a=this._container.offsetHeight-this._controlTopContainer[0].offsetHeight-this._controlBottomContainer[0].offsetHeight;this._iframeContainer.css("top",this._controlTopContainer[0].offsetHeight+"px").css("height",a+"px")};CueCard.QueryEditor.prototype.setOutputPane=function(a){this._outputPane=a};CueCard.QueryEditor.prototype.getOutputPane=function(){return this._outputPane};
CueCard.QueryEditor.prototype.setControlPane=function(a){this._controlPane=a};CueCard.QueryEditor.prototype.getControlPane=function(){return this._controlPane};
CueCard.QueryEditor.prototype._constructButtons=function(){var a=this,c=this._controlTopContainer.find("tr"),b=function(e,g,h){e=c[0].insertCell(e);e.className=g?"cuecard-queryEditor-controls-leftAligned":"cuecard-queryEditor-controls-rightAligned";e.appendChild(h)},d=this._controlBottomContainer.find("tr"),f=function(e,g,h,i){var j=d[0].insertCell(e);e=d[1].insertCell(e);j.className=g?"cuecard-queryEditor-controls-leftAligned":"cuecard-queryEditor-controls-rightAligned";e.className=j.className+" cuecard-queryEditor-buttonHint";
j.appendChild(h);e.appendChild($('<span class="cuecard-queryEditor-buttonHint">'+i+"</span>")[0])};b(0,true,$('<input type="submit" class="button cuecard-queryEditor-examples" value="Examples" />').click(function(){a._showExamples()})[0]);b(1,true,$('<span><a href="http://www.freebase.com/docs/data" target="_blank">MQL&nbsp;Tutorial</a>&nbsp;&bull;&nbsp;<a href="http://www.freebase.com/docs/mql" target="_blank">MQL&nbsp;Reference</a></span>')[0]);b(3,false,$('<input type="submit" class="button cuecard-queryEditor-undo" value="Undo" />').click(function(){a._editor.editor.history.undo()})[0]);
b(4,false,$('<input type="submit" class="button cuecard-queryEditor-redo" value="Redo" />').click(function(){a._editor.editor.history.redo()})[0]);b(5,false,$('<input type="submit" class="button cuecard-queryEditor-redo" value="Clear" />').click(function(){a.content("");a.focus()})[0]);f(0,true,$('<input type="submit" class="button cuecard-queryEditor-queryAssist" value="Query Assist" />').click(function(){a.startAssistAtCursor()})[0],"Tab");f(1,true,$('<input type="submit" class="button cuecard-queryEditor-explainQuery" value="Explain Query" />').click(function(){alert("Not Yet Implemented")}).hide()[0],
"");f(3,false,$('<input type="submit" class="button cuecard-queryEditor-cleanUp" value="Clean Up" />').click(function(){a._onCleanUp()})[0],"");f(4,false,$('<input type="submit" class="button button-primary cuecard-queryEditor-run" value="Run" />').click(function(){a._onRun(false)})[0],"Ctrl-Enter")};CueCard.QueryEditor.prototype.focus=function(){this._editor.focus();return this};
CueCard.QueryEditor.prototype.content=function(a){if(a==undefined)return this._editor.getCode();else{if(this._editor.getCode()!=a){var c=this._editor.editor;c.history.push(null,null,this._editor.win.fixSpaces(a.replace(/\t/g,"  ").replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n"));c.addDirtyNode();c.scheduleHighlight();c.history.onChange&&c.history.onChange()}return this}};
CueCard.QueryEditor.prototype.getUnresolvedQuery=function(){var a=this.getQueryModelAndContext().model.toQueryJson();return CueCard.jsonize(a,this.getJsonizingSettings({breakLines:false,omitWhitespace:true,variables:this._getVariables(),resolveVariables:false}))};CueCard.QueryEditor.prototype.getResolvedQueryEnvelope=function(a){return this._getResolvedQueryEnvelope(false,a)};
CueCard.QueryEditor.prototype.getJsonizingSettings=function(a){if(this._controlPane)return this._controlPane.getJsonizingSettings(a);else{a=a||{};if(!("indentCount"in a))a.indentCount=2;return a}};CueCard.QueryEditor.prototype._getVariables=function(){return this._controlPane?this._controlPane.getVariables():{}};CueCard.QueryEditor.prototype._getQueryEnvelope=function(){return this._controlPane?this._controlPane.getQueryEnvelope():{}};
CueCard.QueryEditor.prototype._getResolvedQueryEnvelope=function(a,c){c=c||{};var b=this.getQueryModelAndContext(),d=b.model.toQueryJson();c.isWriteQuery=this._isWriteQuery(d);var f=this._getQueryEnvelope(),e=this._getVariables();if(a){this.content(CueCard.jsonize(d,this.getJsonizingSettings({variables:e,resolveVariables:false})));try{var g=this.getQueryModelAndContext().model.getCursorFromContext(b.context);this._editor.selectLines(this._editor.nthLine(g.line+1),g.col)}catch(h){}}f.query=d;return CueCard.jsonize(f,
this.getJsonizingSettings({breakLines:false,variables:e,resolveVariables:true}))};CueCard.QueryEditor.prototype._isWriteQuery=function(a){var c=function(b){if(b!=null)if(b instanceof Array){if(b.length>0&&typeof b[0]=="object")for(var d=0;d<b.length;d++)if(c(b[d]))return true}else if(typeof b=="object")for(d in b)if(d=="connect"||d=="create"||c(b[d]))return true;return false};return c(a)};
CueCard.QueryEditor.prototype._confirmWriteQuery=function(a){return a.isWriteQuery&&!this._warnWrites&&CueCard.apiProxy.base.indexOf("sandbox")<0};CueCard.QueryEditor.prototype.getMqlReadURL=function(){var a={},c=this.getResolvedQueryEnvelope(a);a=CueCard.freebaseServiceUrl+"api/service/"+(a.isWriteQuery?"mqlwrite":"mqlread");if("service"in this._options&&this._options.service!=null)a=this._options.service;return a+"?query="+encodeURIComponent(c)};
CueCard.QueryEditor.prototype.run=function(a){if(this._outputPane!=null){var c={};a=this._getResolvedQueryEnvelope(a||this._controlPane&&this._controlPane.getSetting("cleanup"),c);if(this._confirmWriteQuery(c))if(window.confirm("Your query will write data into Freebase.\nAre you sure you want to do that?"))this._warnWrites=true;else return;var b=CueCard.apiProxy.base+CueCard.apiProxy[c.isWriteQuery?"write":"read"]+("emql"in this._options&&this._options.emql?"emql=1&":"")+("debug"in this._options?
"debug="+this._options.debug+"&":"")+("service"in this._options&&this._options.service!=null?"service="+encodeURIComponent(this._options.service)+"&":""),d=this,f=function(g){if(g.error=="unauthorized"){d._outputPane.setStatus("Query editor is not authorized to write on your behalf.");d._options.onUnauthorizedMqlWrite()}else{d._outputPane.renderResponseHeaders(g.headers);var h={};if(d._controlPane!=null&&d._controlPane.getSetting("multilineErrorMessages")&&"code"in g.body&&g.body.code=="/api/status/error"&&
"messages"in g.body&&g.body.messages!=null)h.encodeJavascriptString=function(i){return i};d._outputPane.setJSONContent(g.body,d.getJsonizingSettings(h))}},e=function(g){alert(g)};this._outputPane.setStatus("Querying...");c.isWriteQuery||a.length>1024?$.post(b,{query:a},f,"json"):CueCard.JsonpQueue.call(b+"query="+encodeURIComponent(a),f,e)}"onRun"in this._options&&this._options.onRun()};
CueCard.QueryEditor.prototype.getQueryModelAndContext=function(){var a=this._editor.cursorPosition(false),c=this._editor.lineNumber(a.line)-1;a=a.character;return CueCard.QueryParser.parseForContext(this._editor.getCode(),0,c,a)};
CueCard.QueryEditor.prototype._onReady=function(){var a=this;try{$(this._editor.win.document).keyup(function(b){return a._onEditorKeyUp(b)}).keydown(function(b){return a._onEditorKeyDown(b)}).mousedown(function(b){return a._onEditorMouseDown(b)})}catch(c){alert("Unable to install keyup handler on codemirror window")}"cleanUp"in this._options&&this._options.cleanUp&&this._onCleanUp()};CueCard.QueryEditor.prototype._onRun=function(a){this.run(a)};
CueCard.QueryEditor.prototype._onCleanUp=function(){var a=this.getQueryModelAndContext().model.toQueryJson(),c=this._getVariables();this.content(CueCard.jsonize(a,this.getJsonizingSettings({variables:c,resolveVariables:false})))};CueCard.QueryEditor.prototype._onEditorMouseDown=function(){};
CueCard.QueryEditor.prototype._onEditorKeyDown=function(a){if(a.keyCode==9||a.keyCode==32&&(a.ctrlKey||a.metaKey||a.altKey)){this._assistKeyComboDetected=true;a.preventDefault();return false}else{this._assistKeyComboDetected=false;if((a.metaKey||a.ctrlKey)&&a.keyCode==13)this._onRun(a.shiftKey)}};CueCard.QueryEditor.prototype._onEditorKeyUp=function(a){if(this._assistKeyComboDetected){this._assistKeyComboDetected=false;this.startAssistAtCursor();a.preventDefault();return false}};
CueCard.QueryEditor.prototype.startAssistAtCursor=function(){var a=this._editor.cursorPosition(false),c=this._editor.lineNumber(a.line)-1,b=a.character;this._editor.lineContent(a.line);var d=this._editor.win.document.body.firstChild;d=a.line||d;for(var f=d.nextSibling,e=b;e>0&&f!=null&&f.tagName.toLowerCase()!="br"&&f.firstChild!=null&&f.firstChild.nodeValue.length>=e;){e-=f.firstChild.nodeValue.length;d=f;f=f.nextSibling}if(f==null||f.tagName.toLowerCase()=="br"){if(f!=null){a=$(f).offset();if($.browser.msie&&
d!=null&&d.tagName.toLowerCase()!="br"){e=d.offsetWidth;d=d.offsetHeight}else{e=a.left;d=f.offsetHeight}}else{a=$(d).offset();var g=d.firstChild?d.firstChild.nodeValue.length:0;e=a.left+(g==0?0:e*d.offsetWidth/g);d=d.offsetHeight}this._startAssist(c,b,{left:e,top:a.top,height:d})}else{a=$(f).offset();g=f.firstChild?f.firstChild.nodeValue.length:0;this._startAssist(c,b,{left:a.left+(g==0?0:e*f.offsetWidth/g),top:a.top,height:f.offsetHeight})}};
CueCard.QueryEditor.prototype._startAssist=function(a,c,b){this._cancelPopup();if(b!=null){var d=$(this._iframeContainer).offset();d.left-=this._editor.win.document.body.scrollLeft+document.body.scrollLeft;d.top-=this._editor.win.document.body.scrollTop+document.body.scrollTop;var f=this;this._popup=new CueCard.Popup(Math.round(d.left+b.left),Math.round(d.top+b.top),Math.round(b.height),[window,this._editor.win],{onCancel:function(h){h=="key"&&f.focus()}});this._popup.elmt.html('<div class="cuecard-popup-message">Please wait...</div>');
b=this.getQueryModelAndContext();if(b.context.length>0){d=b.context[b.context.length-1];if("relative"in d)if(d.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)if(d.relative=="path"||d.relative=="before"){this._startSuggestProperties(a,c,b,d);return}else{if(d.relative=="space"){var e=d.node.links[d.child];this._startSuggestValues(a,c,b,d,e);return}}else{if(d.node.type==CueCard.QueryNode.TYPE_TERMINAL){e=null;if(b.context.length>1){var g=b.context[b.context.length-2];e=g.node.links[g.child]}this._startSuggestValues(a,
c,b,d,e);return}}else{e=null;if(b.context.length>1){g=b.context[b.context.length-2];if(g.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)e=g.node.links[g.child];else if(b.context.length>2){g=b.context[b.context.length-3];e=g.node.links[g.child]}}this._startSuggestValues(a,c,b,d,e);return}}}this._popup.elmt.html('<div class="cuecard-popup-message">Sorry, we don\'t know how to assist you here. Send us a link to this exact query using the links at the upper right corner and we will investigate. Thank you!</div>')};
CueCard.QueryEditor.prototype._cancelPopup=function(){if(this._popup!=null){this._popup.cancel();this._popup=null}};
CueCard.QueryEditor.prototype._startSuggestProperties=function(a,c,b,d){var f=this;d=d.relative=="path"?d.node.links[d.child].token:null;this._startBufferInput();this._prepareQueryForSuggestions(b,a,c,d,function(e,g,h){var i=function(j,l){f._suggestProperties(b,l,g+f._stopBufferInput(),h)};b.model.locateInnerMostNonTerminal(b.context,e.extend(function(j,l){var n=[],m=[],o=[];l.node.getDeclaredTypes(n);l.node.getDeclaredIDs(m);l.node.getDeclaredGUIDs(o);var p=[];n.length>0&&p.push("t="+encodeURIComponent(n.join(",")));
m.length>0&&p.push("i="+encodeURIComponent(m.join(",")));o.length>0&&p.push("g="+encodeURIComponent(o.join(",")));if(l.property!=null){p.push("p="+encodeURIComponent(l.property));p.push("r="+l.reverse)}n=CueCard.helper+"suggest-properties?"+p.join("&");CueCard.JsonpQueue.call(n,j.extend(i).onDone,e.onError);return true}));return true})};CueCard.QueryEditor.prototype._startBufferInput=function(){this._overflowInput[0].value="";this._overflowInput[0].focus()};
CueCard.QueryEditor.prototype._stopBufferInput=function(){return this._overflowInput[0].value};
CueCard.QueryEditor.prototype._suggestProperties=function(a,c,b,d){this._popup.elmt.empty();this._popup.elmt.html("<div></div>");a=[];for(var f in c.properties){var e=c.properties[f],g=f.lastIndexOf("/"),h=f.substr(g+1);g=f.substr(0,g);var i=e.explicit;if("parentProperty"in e){i='"'+e.parentProperty+'" : [{ "'+h+'" : ';var j=e.unique?"null":"[]";a.push({label:h,hint:"of type "+g+" (through "+e.parentProperty+")",qualifiedProperty:f,result:i+j+" }]",offset:i.length,extent:j.length,expectedTypes:e.expectedTypes})}else{g=
{label:h,hint:"of type "+g,qualifiedProperty:f,expectedTypes:e.expectedTypes};CueCard.QueryEditor.setPropertySuggestionSuffix(e.expectedTypes.length>0?e.expectedTypes[0].id:"",g,e.unique,'"'+(i?h:f)+'" : ');a.push(g)}}c=new CueCard.PropertySuggestor(this._popup,CueCard.MqlSyntax.KeywordSuggestions,a,d);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,c,b)};
CueCard.QueryEditor.setPropertySuggestionSuffix=function(a,c,b,d){var f=null;if(a=="/common/image"||a=="/common/document"){f='{ "id" : null, "optional" : true, "limit" : 3 }';b||(f="["+f+"]")}else if(a=="/measurement_unit/dated_integer"){f='{ "number" : null, "date" : null }';if(b)f="["+f+"]"}else if(a=="/measurement_unit/dated_money_value"){f='{ "amount" : null, "valid_date" : null, "currency" : null }';if(b)f="["+f+"]"}else f=a.indexOf("/type/")==0?b?"null":"[]":b?"{}":"[{}]";c.result=d+f;c.offset=
d.length;c.extent=f.length};
CueCard.QueryEditor.prototype._startSuggestValues=function(a,c,b,d,f){var e=this,g="token"in d?d.token:null;this._startBufferInput();this._prepareQueryForSuggestions(b,a,c,g,function(h,i,j,l){i+=e._stopBufferInput();if(f!=null&&!f.reverse&&CueCard.QueryNode.isMqlKeyword(f.path))e._suggestValuesForKeyword(a,c,b,d,f.path,i,j);else{var n=function(){e._popup.elmt.empty();e._popup.elmt.html('<div></div><div class="cuecard-suggestion-hint-message">Keep typing to search for topics of types fitting this point in the query.</div>')},m=
f.qualifiedProperty,o=f.reverse;if(!o&&(m=="/type/object/id"||m=="/type/object/guid"||m=="/type/object/name")){b.model.locateInnerMostNonTerminal(b.context,h.extend(function(s,t){n();var u=[];t.node.getDeclaredTypes(u);if("property"in t&&t.property!=null){var w=t.property;if(o)u.push(w.substr(0,w.lastIndexOf("/")));else if(w in l){w=l[w].expectedTypes;for(var x=0;x<w.length;x++)u.push(w[x].id)}}u=new CueCard.TypeBasedTopicSuggestor(e._popup,CueCard.MqlSyntax.SingleValueSuggestions,u,f.property,j);
new CueCard.SuggestionController(e._popup,e._popup.elmt[0].firstChild,u,i)}));return true}else{n();var p=false;if(o)h=[m.substr(0,m.lastIndexOf("/"))];else if(m=="/type/object/type")h=["/type/type"];else if(m in l){p=l[m].unique;h=[];m=l[m].expectedTypes;for(var q=0;q<m.length;q++)h.push(m[q].id)}else h=m=="/type/text/lang"?["/type/lang"]:[];m=h.length==1?h[0]:null;h=m!==null&&m in CueCard.QueryEditor.nativeTypes?new CueCard.StaticChoicesSuggestor(CueCard.MqlSyntax[m=="/type/text"?p?"UniqueStringLiteralValueSuggestions":
"StringLiteralValueSuggestions":p?"UniqueLiteralValueSuggestions":"LiteralValueSuggestions"],j):new CueCard.TypeBasedTopicSuggestor(e._popup,CueCard.MqlSyntax[p?"UniqueTopicValueSuggestions":"TopicValueSuggestions"],h,"id",j);new CueCard.SuggestionController(e._popup,e._popup.elmt[0].firstChild,h,i)}}})};
CueCard.QueryEditor.prototype._suggestValuesForKeyword=function(a,c,b,d,f,e,g){this._popup.elmt.empty();a=CueCard.MqlSyntax.KeywordValueHints[f];if("html"in a){this._popup.elmt.html('<div class="cuecard-suggestion-hint-message">'+a.html+"</div>");this.focus()}else{this._popup.elmt.html("<div></div>");g=new CueCard.StaticChoicesSuggestor(a.choices,g);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,g,e)}};
CueCard.QueryEditor.prototype._prepareQueryForSuggestions=function(a,c,b,d,f){var e=this,g="",h,i=function(o,p,q,s,t){q=s===undefined||typeof q!=="string"?CueCard.jsonize(q,{breakLines:false}):q;p=p+(typeof s=="number"?s:q.length);t=p+(typeof t=="number"?t:0);e._editor.editor.replaceSelection(q);o=e._editor.nthLine(o+1);e._editor.selectLines(o,p,o,t)};if(d!=null){c=0;var j=d.start.col;if(/^['"]/.test(d.content))c=1;g=d.content.substring(c,b-j).replace(/['"]$/,"");h=function(o,p,q){var s=e._editor.nthLine(d.start.line+
1);e._editor.selectLines(s,d.start.col,s,d.end.col);i(d.start.line,d.start.col,o,p,q)}}else{b=this._editor.cursorPosition(true);var l=this._editor.lineNumber(b.line)-1,n=b.character;h=function(o,p,q){var s=e._editor.nthLine(l+1);e._editor.selectLines(s,n,s,n);i(l,n,o,p,q)}}var m=function(o){e._popup.close();typeof o=="string"?h(o):h(o.result,o.offset,o.extent)};b=CueCard.UI.createBlockingContinuations(function(o,p){return f(o,g,m,p||{})});this._popup.addPendingContinuation(b);a.model.qualifyAllProperties(b)};
CueCard.QueryEditor.prototype._showExamples=function(){var a=this;new CueCard.ExampleDialog({onDone:function(c){a.content(c);a._onRun(false)}})};CueCard.OutputPane=function(a,c){this._elmt=$(a);this._options=c||{};this._jsonResult=null;this._lastJsonOutputMode=$.cookie("cc_op_mode")=="text"?"text":"tree";this._treeConstructed=false;this._constructUI();this.layout()};CueCard.OutputPane.prototype.dispose=function(){};
CueCard.OutputPane.prototype.layout=function(){var a=this._elmt[0],c=a.offsetHeight-this._elmt[0].firstChild.firstChild.firstChild.firstChild.offsetHeight-("verticalPadding"in this._options?this._options.verticalPadding:12);a=a.offsetWidth-("horizontalPadding"in this._options?this._options.horizontalPadding:8);var b=c-($.support.boxModel?20:0),d=a-($.support.boxModel?20:0);try{this._elmt.find(".cuecard-outputPane-tabBody").css("padding","0px").width(a).height(c);this._elmt.find(".cuecard-outputPane-status, .cuecard-outputPane-tree").css("padding",
"10px").css("left","0px").css("top","0px").width(d).height(b);this._elmt.find(".cuecard-outputPane-textarea").css("padding","0px").css("left","0px").css("top","0px").width(a).height(c)}catch(f){}};
CueCard.OutputPane.prototype._constructUI=function(){function a(e,g){return'<li class="section-tab tab"><a href="#'+d+"-"+e+'">'+g+"</a></li>"}function c(e){return'<div class="cuecard-outputPane-tabBody" id="'+d+"-"+e+'"></div>'}var b=this,d=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.css("overflow","hidden");this._elmt.html('<div class="cuecard-outputPane section-tabs"><div id="'+d+'"><ul class="section-tabset clear">'+a(0,"Tree")+a(1,"Text")+a(2,"Status")+'</ul><div class="tabbed-content">'+
c(0)+c(1)+c(2)+"</div></div></div>");var f=this._elmt.find(".cuecard-outputPane-tabBody");this._treeTabBody=$(f[0]);this._textTabBody=$(f[1]);this._statusTabBody=$(f[2]);this._constructTextTabBody();this._constructTreeTabBody();this._constructStatusTabBody();f=$("#"+d+" > .section-tabset");f.tabs("#"+d+" > .tabbed-content > .cuecard-outputPane-tabBody",{initialIndex:this._lastJsonOutputMode=="tree"?0:1,onBeforeClick:function(e,g){window.__cc_tree_disposePopup();if(g==0){b._lastJsonOutputMode="tree";
b._jsonResult!=null&&!b._treeConstructed&&b._constructTree()}else if(g==1)b._lastJsonOutputMode="text";$.cookie("cc_op_mode",b._lastJsonOutputMode,{expires:365})}});this._tabs=f.data("tabs")};
CueCard.OutputPane.prototype.setJSONContent=function(a,c){this._jsonResult=a;this._textarea[0].value=CueCard.jsonize(a,c||{indentCount:2});var b;if(this._lastJsonOutputMode=="tree"){this._constructTree();b=0}else{this._tree.empty();this._treeConstructed=false;b=1}var d=this;window.setTimeout(function(){d._tabs.click(b)},100)};
CueCard.OutputPane.prototype.setStatus=function(a){this._tabs.click(2);this._statusTabBody[0].firstChild.innerHTML=a;this._jsonResult=null;this._textarea[0].value="";this._tree.empty();this._treeConstructed=false};CueCard.OutputPane.prototype.getJson=function(){return this._jsonResult};
CueCard.OutputPane.prototype.renderResponseHeaders=function(a){var c=[];c.push('<div class="cuecard-outputPane-responseHeaders">');var b=a["x-metaweb-tid"];c.push("<h3>x-metaweb-tid (transaction ID)</h3>");c.push('<div><a target="_blank" href="http://stats.metaweb.com/query/transaction?tid='+encodeURIComponent(b)+'">'+b+"</a></div>");if(b=a["x-metaweb-cost"]){b=b.split(",");c.push("<h3>x-metaweb-cost header components</h3>");c.push("<table>");c.push("<tr><th>code</th><th>value</th><th>meaning</th><th>subsystem</th></tr>");
for(var d=true,f=0;f<b.length;f++){var e=b[f].split("=");e[0]=e[0].replace(/^\s+/,"").replace(/\s+$/,"");var g=CueCard.XMetawebCosts[e[0]];c.push("<tr class='"+(d?"cuecard-outputPane-odd":"cuecard-outputPane-even")+(g!==undefined&&"important"in g&&g.important?" cuecard-outputPane-cost-important":"")+"'>");c.push("<td>"+e[0]+"</td>");c.push("<td>"+e[1]+"</td>");c.push("<td>"+(g!==undefined?g.meaning:"--")+"</td>");c.push("<td>"+(g!==undefined?g.subsystem:"--")+"</td>");c.push("</tr>");d=!d}c.push("</table>")}c.push("<h3>response headers</h3>");
c.push("<table>");d=true;for(var h in a)if(h!="x-metaweb-cost"&&h!="x-metaweb-tid"){c.push("<tr class='"+(d?"cuecard-outputPane-odd":"cuecard-outputPane-even")+"'><td>"+h+"</td><td>"+a[h]+"</td></tr>");d=!d}c.push("</table>");c.push("</div>");this.setStatus(c.join(""))};CueCard.OutputPane.prototype._constructTextTabBody=function(){this._textarea=$('<textarea readonly="true" wrap="off"></textarea>').addClass("cuecard-outputPane-textarea").appendTo(this._textTabBody)};
CueCard.OutputPane.prototype._constructTreeTabBody=function(){this._tree=$("<div></div>").addClass("cuecard-outputPane-tree").appendTo(this._treeTabBody)};CueCard.OutputPane.prototype._constructStatusTabBody=function(){this._statusTabBody.html('<div class="cuecard-outputPane-status"></div>')};CueCard.OutputPane.prototype._constructCustomTabBody=function(){};
CueCard.OutputPane.prototype._constructTree=function(){this._treeConstructed=true;var a=[],c=function(h,i){return'<img class="cuecard-outputPane-tree-toggle" onclick="__cc_tree_toggle(this);" src="'+CueCard.urlPrefix+h+'" '+(i?"":' style="display: none;"')+"/>"},b=function(h){a.push(h)},d=function(h){return"<a class='cuecard-outputPane-tree-explore' target='_blank' href='"+CueCard.freebaseServiceUrl+"tools/explore"+h+"'>xp</a>"},f=function(h,i,j){if(h=="image"||h=="/common/topic/image")b("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+i+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)' fbid='"+i+"'>"+j+"</a>"+d(i));else h=="article"||h=="/common/topic/article"?b("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+CueCard.freebaseServiceUrl+"view"+i+"' onmouseover='__cc_tree_mouseOverArticle(this)' onmouseout='__cc_tree_mouseOutArticle(this)' fbid='"+i+"'>"+j+"</a>"+d(i)):b("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+
CueCard.freebaseServiceUrl+"view"+i+"' onmouseover='__cc_tree_mouseOverTopic(this)' onmouseout='__cc_tree_mouseOutTopic(this)' fbid='"+i+"'>"+j+"</a>"+d(i))},e=function(h,i){return h.length>i.length&&h.substr(0,i.length)==i},g=function(h,i,j){if(h==null){i.startBody(false);b("<span>"+JSON.stringify(h)+"</span>");i.endBody(false)}else if(typeof h!="object"){i.startBody(false);var l=j[0];j=j.length>1?j[1]:"";if(l=="id"||l=="/type/object/id")f(j,h,JSON.stringify(h));else if(l=="guid"||l=="/type/object/guid")f(j,
"/guid/"+h.substr(1),JSON.stringify(h));else if(l=="type"||l=="/type/object/type")b("<a target='_blank' href='"+CueCard.freebaseServiceUrl+"type/schema"+h+"'>"+JSON.stringify(h)+"</a>"+d(h));else if(typeof h=="string"&&(e(h,"http://")||e(h,"https://")||e(h,"ftp://")))e(h,"http://chart.apis.google.com/chart?")?b("<a target='_blank' class='cuecard-outputPane-tree-dataLink' href='"+h+"' onmouseover='__cc_tree_mouseOverImage(this)' onmouseout='__cc_tree_mouseOutImage(this)'>"+JSON.stringify(h)+"</a>"):
b("<a target='_blank' href='"+h+"'>"+JSON.stringify(h)+"</a>");else b("<span>"+JSON.stringify(h)+"</span>");i.endBody(false)}else if(h instanceof Array)if(h.length==0){i.startBody(false);b("<span>[]</span>");i.endBody(false)}else{l=h.length>1&&typeof h[0]=="object"?"":' style="display: none;"';i.startBody(true,'<span cc:mode="normal">[ <a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_expandAll(this);"'+l+'>expand all</a><span class="cuecard-outputPane-tree-toggles"'+
l+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_collapseAll(this);"'+l+'>collapse all</a><span class="cuecard-outputPane-tree-toggles"'+l+'> &bull; </span><a href="javascript:{}" class="cuecard-outputPane-tree-all" onclick="__cc_tree_flip(this);"'+l+">1-by-1</a></span>",'<span style="display: none;">[ '+(h.length>1?h.length+" elements":"1 element")+" ]</span>");b('<div class="cuecard-outputPane-tree-arrayBody cuecard-outputPane-tree-normalMode">');
l=function(m,o,p){return{startBody:function(q,s,t){q?b('<div class="cuecard-outputPane-tree-arrayElement">'+c("expanded.png",true)+c("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+m+":</span> "+s+t+"<span>"+(o?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipPrevious(this);">previous</a> ':"")+(p?'<a href="javascript:{}" class="cuecard-outputPane-tree-flipControl" onclick="__cc_tree_flipNext(this);">next</a>':"")+"</span>"):b('<div class="cuecard-outputPane-tree-arrayElement"><span class="cuecard-outputPane-tree-memberName">'+
m+":</span> ")},endBody:function(){b("</div>")}}};for(var n=0;n<h.length;n++)g(h[n],l(n,n>0,n<h.length-1),j);b("</div>");i.endBody(true)}else{i.startBody(true,"<span>{</span>",'<span style="display: none;">{...}</span>');b('<div class="cuecard-outputPane-tree-objectBody cuecard-outputPane-tree-normalMode">');l=function(m){return{startBody:function(o,p,q){o?b('<div class="cuecard-outputPane-tree-objectField">'+c("expanded.png",true)+c("collapsed.png",false)+'<span class="cuecard-outputPane-tree-memberName">'+
m+":</span> "+p+q+"<span></span>"):b('<div class="cuecard-outputPane-tree-objectField"><span class="cuecard-outputPane-tree-memberName">'+m+":</span> ")},endBody:function(){b("</div>")}}};for(n in h)g(h[n],l(n),[n].concat(j));b("</div>");i.endBody(true)}};g(this._jsonResult,{startBody:function(){},endBody:function(){}},["__root__"]);this._tree.html(a.join(""))};window.__cc_tree_toggle=function(a){var c=a.src.indexOf("expanded.png")>0;a=a.parentNode;c?window.__cc_tree_collapse(a):window.__cc_tree_expand(a)};
window.__cc_tree_expand=function(a){if(a.firstChild.tagName.toLowerCase()=="img"){var c=a.lastChild;c.style.display="block";a.childNodes[0].style.display="inline";a.childNodes[1].style.display="none";a=c.previousSibling.previousSibling;a.previousSibling.style.display="inline";a.style.display="none"}};
window.__cc_tree_collapse=function(a){if(a.firstChild.tagName.toLowerCase()=="img"){var c=a.lastChild;c.style.display="none";a.childNodes[0].style.display="none";a.childNodes[1].style.display="inline";a=c.previousSibling.previousSibling;a.previousSibling.style.display="none";a.style.display="inline"}};
(function(){var a=function(c){var b=c.parentNode.getAttribute("cc:mode"),d=c.parentNode.nextSibling.nextSibling.nextSibling;if(b=="flip"){for(b=0;b<d.childNodes.length;b++)d.childNodes[b].style.display="block";c.parentNode.setAttribute("cc:mode","normal");$(c.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").addClass("cuecard-outputPane-tree-normalMode").removeClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_expandAll=function(c){a(c);c=c.parentNode.nextSibling.nextSibling.nextSibling;
for(var b=0;b<c.childNodes.length;b++)__cc_tree_expand(c.childNodes[b])};window.__cc_tree_collapseAll=function(c){a(c);c=c.parentNode.nextSibling.nextSibling.nextSibling;for(var b=0;b<c.childNodes.length;b++)__cc_tree_collapse(c.childNodes[b])};window.__cc_tree_flip=function(c){var b=c.parentNode.getAttribute("cc:mode"),d=c.parentNode.nextSibling.nextSibling.nextSibling;if(b=="normal"){for(b=0;b<d.childNodes.length;b++){var f=d.childNodes[b];f.style.display=b==0?"block":"none";__cc_tree_expand(f)}c.parentNode.setAttribute("cc:mode",
"flip");$(c.parentNode.parentNode).find("> div.cuecard-outputPane-tree-arrayBody").removeClass("cuecard-outputPane-tree-normalMode").addClass("cuecard-outputPane-tree-flipMode")}};window.__cc_tree_flipPrevious=function(c){c=c.parentNode.parentNode;c.style.display="none";c.previousSibling.style.display="block"};window.__cc_tree_flipNext=function(c){c=c.parentNode.parentNode;c.style.display="none";c.nextSibling.style.display="block"};window.__cc_tree_mouseOverTopic=function(c){var b=c.getAttribute("fbid");
$.getJSON("http://hotshot.dfhuynh.user.dev.freebaseapps.com/html?id="+b+"&callback=?",function(d){var f=__cc_tree_createPopup(c);$(f).addClass("cuecard-outputPane-tree-popup-topic").html(d)})};window.__cc_tree_mouseOutTopic=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverImage=function(c){var b=c.getAttribute("fbid");b=b!=null&&b.length>0?CueCard.freebaseServiceUrl+"api/trans/image_thumb"+b+"?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100":c.href;__cc_tree_createPopup(c).innerHTML=
"<img src='"+b+"' />"};window.__cc_tree_mouseOutImage=function(){__cc_tree_disposePopup()};window.__cc_tree_mouseOverArticle=function(c){var b=c.getAttribute("fbid");$.getJSON(CueCard.freebaseServiceUrl+"api/trans/blurb"+b+"?callback=?",function(d){d=d.result.body;var f=__cc_tree_createPopup(c);$(f).addClass("cuecard-outputPane-tree-popup-article").html(d)})};window.__cc_tree_mouseOutArticle=function(){__cc_tree_disposePopup()};window.__cc_tree_createPopup=function(c){var b=document.getElementById("cuecard-outputPane-tree-popup");
if(b==null){b=document.createElement("div");b.id="cuecard-outputPane-tree-popup";b.className="cuecard-outputPane-tree-popup";b.onmouseover=window.__cc_tree_disposePopup;document.body.appendChild(b)}var d=$(c).offset();b.style.top=d.top+c.offsetHeight+10+"px";b.style.left=d.left+"px";return b};window.__cc_tree_disposePopup=function(){var c=document.getElementById("cuecard-outputPane-tree-popup");c!=null&&c.parentNode.removeChild(c)}})();
CueCard.ControlPane=function(a,c){this._elmt=$(a);this._options=c||{};this._constructUI();this.layout()};CueCard.ControlPane.prototype.dispose=function(){};CueCard.ControlPane.prototype.layout=function(){var a=this._elmt[0].firstChild.offsetHeight-this._elmt[0].firstChild.firstChild.firstChild.offsetHeight-10+"px";this._elmt.find(".cuecard-controlPane-tabBody").css("height",a)};
CueCard.ControlPane.prototype._constructUI=function(){function a(f,e){return'<li class="section-tab tab"><a href="#'+b+"-"+f+'"><span>'+e+"</span></a></li>"}function c(f){return'<div class="cuecard-controlPane-tabBody" id="'+b+"-"+f+'"></div>'}var b=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.html('<div class="cuecard-controlPane section-tabs"><div id="'+b+'"><ul class="section-tabset clear">'+a(0,"Tools")+a(1,"Variables")+a(2,"Envelope")+a(3,"Custom Envelope")+a(4,"Settings")+'</ul><div class="tabbed-content">'+
c(0)+c(1)+c(2)+c(3)+c(4)+"</div></div></div>");$("#"+b+" > .section-tabset").tabs("#"+b+" > .tabbed-content > .cuecard-controlPane-tabBody",{initialIndex:0});var d=this._elmt.find(".cuecard-controlPane-tabBody");this._toolsTabBody=$(d[0]);this._variablesTabBody=$(d[1]);this._envelopeTabBody=$(d[2]);this._customEnvelopeTabBody=$(d[3]);this._settingsTabBody=$(d[4]);this._constructToolsTabBody();this._constructVariablesTabBody();this._constructEnvelopeTabBody();this._constructCustomEnvelopeTabBody();
this._constructSettingsTabBody()};
CueCard.ControlPane.prototype._constructToolsTabBody=function(){var a="r"+Math.floor(1E6*Math.random()),c=this,b=function(d,f,e){return'<div class="cuecard-controlPane-powerTool"><input type="submit" class="button" cc:command="'+d+'" value="'+f+'" /><div class="cuecard-controlPane-powerTool-hint">'+e+"</div></div>"};this._toolsTabBody.html('<div class="cuecard-controlPane-section"><table><tr valign="top"><td>'+b("qualify","Qualify All Properties",'Expand all properties to their full IDs (e.g., "id" &rarr; "/type/object/id").')+b("redangle",
"Turn Inside Out","Take the inner most query node {...} that contains the text cursor and make it the outermost query node.")+b("generate","Generate Acre Template","Generate an ACRE template that can render the result of this query.")+b("one-liner","One-liner","Reformat query into a one-liner.")+'</td><td width="40%">Results of tools<br/><input type="radio" name="'+a+'" value="replace" checked="true"> replace query (undo-able)<br/><input type="radio" name="'+a+'" value="output"> go into output pane</td></tr></table></div>');
this._toolsTabBody.find(".button").click(function(d){return c._onCommandClick(d,this,this.getAttribute("cc:command"))})};
CueCard.ControlPane.prototype._constructVariablesTabBody=function(){this._variablesTabBody.html('<table class="cuecard-controlPane-variables"><tr><th width="30%">name</th><th width="50%">value</th><th></th></tr></table><div><input type="submit" class="button" value="Add" /></div>');var a=this,c=function(b){var d=a._variablesTabBody.find("table")[0],f=d.insertRow(d.rows.length);d=f.insertCell(0);d.innerHTML="<input />";f.insertCell(1).innerHTML="<input />";var e=f.insertCell(2);e.innerHTML='<input type="submit" class="button" value="Remove" />';
$(e.firstChild).click(function(){$(f).remove()});b||d.firstChild.focus()};this._variablesTabBody.find(".button").click(c);c(true)};
CueCard.ControlPane.prototype._constructEnvelopeTabBody=function(){for(var a=function(h,i,j){return"<tr><td>"+h+"</td><td>"+i+(j.length>0?'<div class="cuecard-controlPane-hint">'+j+"</div>":"")+"</td></tr>"},c=['<option value="">--</option>'],b=0;b<CueCard.Languages.length;b++){var d=CueCard.Languages[b];c.push('<option value="'+d.id+'">'+d.name+" ("+d.id+")</option>")}this._envelopeExtendedID="i"+Math.floor(1E6*Math.random());this._envelopeAsOfTimeID="i"+Math.floor(1E6*Math.random());this._envelopeUsePermissionOfID=
"i"+Math.floor(1E6*Math.random());this._envelopeCursorID="i"+Math.floor(1E6*Math.random());this._envelopePageID="i"+Math.floor(1E6*Math.random());b="env"in this._options?this._options.env:{};d=("extended"in this._options?this._options.extended==1:false)||("extended"in b?b.extended==1:false);var f="as_of_time"in this._options?this._options.as_of_time:"as_of_time"in b?b.as_of_time:null,e="use_permission_of"in this._options?this._options.use_permission_of:"use_permission_of"in b?b.use_permission_of:
null;delete b.extended;delete b.as_of_time;delete b.use_permission_of;this._envelopeTabBody.html('<div class="cuecard-controlPane-explanation">The query envelope contains directives to the query engine, specifying how to execute the query or how to return the results.</div><table class="cuecard-controlPane-configurations">'+a("extended",'<input type="checkbox" name="'+this._envelopeExtendedID+'" '+(d?"checked":"")+"/>","Enable MQL extensions")+a("as_of_time",'<input name="'+this._envelopeAsOfTimeID+
'" '+(f!=null?'value="'+f+'"':"")+"/>","Resolve the query based on data in Freebase as of the given time in ISO8601 format, e.g., 2009-02-28, 2009-03-13T22:16:40")+a("use_permission_of",'<input name="'+this._envelopeUsePermissionOfID+'" '+(e!=null?'value="'+e+'"':"")+"/>",'Specify the id of an object (typically a user, domain or type) whose permission you want to copy (<a href="http://freebaseapps.com/docs/mql/ch06.html#id2972357" target="_blank">more details</a>).')+a("page",'<input name="'+this._envelopePageID+
'" /> <input type="submit" class="button cuecard-controlPane-configurations-page" value="Previous" /><input type="submit" class="button cuecard-controlPane-configurations-page" value="Next" />','Page number starting from 1 if there is a "limit" property in the top level query node.')+a("cursor",'<div><input type="radio" name="'+this._envelopeCursorID+'" checked value=""> unspecified (return all results, possibly time-out)</div><div><input type="radio" name="'+this._envelopeCursorID+'" value="true"> true (start pagination with page size equal "limit" option in query)</div><div><input type="radio" name="'+
this._envelopeCursorID+'" value="custom"> continue from cursor: <div class="cuecard-controlPane-configurations-cursor"><input type="text" name="'+this._envelopeCursorID+'" /><input type="submit" class="button cuecard-controlPane-configurations-cursor" value="Paste from Last Result" /> <input type="submit" class="button" cc:run="true" value="Paste &amp; Run" /></div></div>',"")+a("lang",'<select class="cuecard-controlPane-configurations-languages">'+c.join("")+"</select>","Return text values in the given language (specified with the language's Freebase ID)")+
a("escape",'<select><option value="">--</option><option value="html">html</option><option value="false">false</option></select>',"")+a("uniqueness_failure",'<select><option value="">--</option><option value="soft">soft</option></select>',"")+"</table>");var g=this;this._envelopeTabBody.find("input[type='text'][name='"+this._envelopeCursorID+"']").bind("change",function(){g._envelopeTabBody.find("input[type='radio'][value='custom']")[0].checked=true});this._envelopeTabBody.find(".button .cuecard-controlPane-configurations-cursor").click(function(){if(g._options.outputPane!=
null){var h=g._options.outputPane.getJson();if(h!==undefined&&h!==null&&"cursor"in h){g._envelopeTabBody.find("input[type='text'][name='"+g._envelopeCursorID+"']")[0].value=h.cursor;g._envelopeTabBody.find("input[type='radio'][value='custom']")[0].checked=true;g._options.queryEditor!=null&&this.getAttribute("cc:run")=="true"&&g._options.queryEditor.run()}}});this._envelopeTabBody.find(".button .cuecard-controlPane-configurations-page").click(function(){var h=g._envelopeTabBody.find("input[type='text'][name='"+
g._envelopePageID+"']")[0],i=h.value,j;try{j=parseInt(i)}catch(l){}if(typeof j!="number"||isNaN(j))j=1;if(this.innerHTML=="Previous")j--;else j++;if(j<1)h.value="1";else{h.value=j;g._options.queryEditor!=null&&g._options.queryEditor.run()}})};
CueCard.ControlPane.prototype._constructCustomEnvelopeTabBody=function(){var a="env"in this._options?this._options.env:{};this._customEnvelopeTabBody.html('<table class="cuecard-controlPane-customEnvelope"><tr><th width="30%">name</th><th width="50%">value</th><th></th></tr></table><div><input type="submit" class="button" value="Add" /></div>');var c=this,b=function(e,g,h){var i=c._customEnvelopeTabBody.find("table")[0],j=i.insertRow(i.rows.length);i=j.insertCell(0);i.innerHTML="<input />";if(g)i.firstChild.value=
g;g=j.insertCell(1);g.innerHTML="<input />";if(h)g.firstChild.value=h;h=j.insertCell(2);h.innerHTML='<input type="submit" class="button" value="Remove" />';$(h.firstChild).click(function(){$(j).remove()});e||i.firstChild.focus()};this._customEnvelopeTabBody.find(".button").click(b);var d=0;for(var f in a){d++;b(true,f,JSON.stringify(a[f]))}d==0&&b(true)};
CueCard.ControlPane.prototype._constructSettingsTabBody=function(){this._settingsTabBody.html('<div><input type="checkbox"'+($.cookie("cc_cp_clean")=="1"?" checked":"")+'> Always clean up query before running</div><div><input type="checkbox"'+($.cookie("cc_cp_align")=="0"?"":" checked")+'> Align JSON property values with spaces</div><div style="display: none;"><input type="checkbox"> Try running query as you edit</div><div><input type="checkbox"'+($.cookie("cc_cp_multi")=="0"?"":" checked")+"> Show error messages with multiple lines on multiple lines</div>")};
CueCard.ControlPane.prototype._onCommandClick=function(a,c,b){switch(b){case "redangle":this._redangle();break;case "qualify":this._qualify();break;case "generate":this._generateCode();break;case "one-liner":this._oneLiner();break}};CueCard.ControlPane.prototype._redangle=function(){var a=this,c=this._options.queryEditor.getQueryModelAndContext();c.model.toInsideOutQueryJson(c.context,CueCard.UI.createBlockingContinuations(function(b,d){a._setOutputJSON(d)}))};
CueCard.ControlPane.prototype._qualify=function(){var a=this,c=this._options.queryEditor.getQueryModelAndContext().model;c.qualifyAllProperties(CueCard.UI.createBlockingContinuations(function(){a._setOutputJSON(c.toQueryJson({qualifyAllProperties:true}))}))};
CueCard.ControlPane.prototype._generateCode=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson();a=CueCard.CodeGeneration.generate(a,CueCard.CodeGeneration.serializers["acre-template"],{variables:this.getVariables()});var c=$('<div title="Generated Acre Template"><textarea style="width: 100%; height: 100%; font-family: monospace; font-size: 12px;" wrap="off"></textarea></div>').appendTo(document.body);c.find("textarea")[0].value=a;c.find("textarea")[0].select();
c.dialog({modal:true,position:"center",width:800,height:500,buttons:{OK:function(){c.dialog("close");c.remove()}}})};CueCard.ControlPane.prototype._oneLiner=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),c=this.getJsonizingSettings({variables:this.getVariables(),resolveVariables:false});c.breakLines=false;this._options.queryEditor.content(CueCard.jsonize(a,c))};
CueCard.ControlPane.prototype._setOutputJSON=function(a){switch(this._toolsTabBody.find("input:checked")[0].value){case "replace":this._options.queryEditor.content(CueCard.jsonize(a,this.getJsonizingSettings()));break;case "output":this._options.outputPane.setJSONContent(a,this.getJsonizingSettings());break}};
CueCard.ControlPane.prototype.getQueryEnvelopeSetting=function(a){switch(a){case "extended":return this._envelopeTabBody.find("input[name='"+this._envelopeExtendedID+"']")[0].checked?1:0;case "as_of_time":a=this._envelopeTabBody.find("input[name='"+this._envelopeAsOfTimeID+"']")[0].value;if(a.length>0)return a;break}return null};
CueCard.ControlPane.prototype.getQueryEnvelope=function(a,c){a=a||{};if(this.getSetting("extended")==1)a.extended=1;var b=this._envelopeTabBody.find("input[name='"+this._envelopeAsOfTimeID+"']")[0].value;if(b.length>0)a.as_of_time=b;b=this._envelopeTabBody.find("input[name='"+this._envelopeUsePermissionOfID+"']")[0].value;if(b.length>0)a.use_permission_of=b;var d=this._envelopeTabBody.find("select");b=function(g){return d[g].options[d[g].selectedIndex].value};var f=b(0);if(f.length>0)a.lang=f;f=b(1);
if(f.length>0)a.escape=f=="false"?false:f;b=b(2);if(b.length>0)a.uniqueness_failure=b;if(!c){b=this._envelopeTabBody.find("input[name='"+this._envelopePageID+"']")[0].value;if(b.length>0)try{a.page=parseInt(b)}catch(e){}switch(this._envelopeTabBody.find("input[type='radio'][name='"+this._envelopeCursorID+"']:checked")[0].value){case "true":a.cursor=true;break;case "custom":a.cursor=this._envelopeTabBody.find("input[type='text'][name='"+this._envelopeCursorID+"']")[0].value;break}}this.getCustomEnvelope(a);
return a};CueCard.ControlPane.prototype.getCustomEnvelope=function(a){a=a||{};for(var c=this._customEnvelopeTabBody.find("table")[0],b=1;b<c.rows.length;b++){var d=c.rows[b],f=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;if(f.length>0){try{d=JSON.parse(d)}catch(e){}a[f]=d}}return a};
CueCard.ControlPane.prototype.getSetting=function(a){var c=this._settingsTabBody.find("input");switch(a){case "cleanup":a=c[0].checked;$.cookie("cc_cp_clean",a?"1":"0",{expires:365});return a;case "alignJSONPropertyValues":a=c[1].checked;$.cookie("cc_cp_align",a?"1":"0",{expires:365});return a;case "liveQuery":a=c[2].checked;$.cookie("cc_cp_live",a?"1":"0",{expires:365});return a;case "multilineErrorMessages":a=c[3].checked;$.cookie("cc_cp_multi",a?"1":"0",{expires:365});return a;case "extended":a=
this._envelopeTabBody.find("input[name='"+this._envelopeExtendedID+"']")[0].checked?1:0;$.cookie("cc_cp_extended",a,{expires:365});return a}return false};CueCard.ControlPane.prototype.getJsonizingSettings=function(a){a=a||{};a.indentCount=2;a.alignFieldValues=this.getSetting("alignJSONPropertyValues");return a};
CueCard.ControlPane.prototype.getVariables=function(){for(var a={},c=this._variablesTabBody.find("table")[0],b=1;b<c.rows.length;b++){var d=c.rows[b],f=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;try{d=JSON.parse(d)}catch(e){}a[f]=d}return a};CueCard.CodeGeneration={serializers:{}};
CueCard.CodeGeneration.generate=function(a,c,b){var d="",f={_variables:{},createVariable:function(l){if(l in this._variables)return l+this._variables[l]++;else{this._variables[l]=1;return l}}},e=f.createVariable("q"),g=f.createVariable("o"),h=new CueCard.SerializingContext(null);h.setProperty("indentString","indentString"in b?b.indentString:"  ");h.setProperty("indentLevel","indentLevel"in b?b.indentLevel:0);h.setProperty("stream",{append:function(l){d+=l}});c.prepareRootContext(h,b);var i=new CueCard.IndentWriter(h),
j=c.generateQueryCall(h,i,f,a,b.variables,e,g);h.setProperty("start",function(){return j});h.setProperty("stop",function(){});CueCard.CodeGeneration._processNode(a,c,h,i,f);return d};
CueCard.CodeGeneration._deriveElementName=function(a,c){if(a==null){var b=c.getProperty("path");if(b!=null)if(b.charAt(0)=="!"){b=b.substr(Math.max(b.indexOf(":")+1,1)).split("/");return b[Math.max(0,b.length-2)]}else{b=b.substr(b.indexOf(":")+1).split("/");return b[b.length-1]}}else{b=a.split("/");return b[b.length-1]}return"entry"};CueCard.CodeGeneration._isImagePath=function(a){if(a.charAt(0)=="!")return false;a=a.substr(a.indexOf(":")+1);return a=="/common/topic/image"||a=="image"};
CueCard.CodeGeneration._isImageNode=function(a){if(a==null||typeof a!="object")return false;if(a instanceof Array)if(a.length==1&&typeof a[0]=="object")a=a[0];else return false;for(var c in a)if(c!="id"&&c!="guid"&&!CueCard.QueryNode.isMqlKeyword(c))return false;return true};
CueCard.CodeGeneration._processNode=function(a,c,b,d,f){if(a==null){var e=b.getProperty("start")(true,false);c.outputSimpleFieldValue(e,b,d);b.getProperty("stop")(true,false)}else if(typeof a=="object")if(a instanceof Array)if(a.length==0){e=CueCard.CodeGeneration._deriveElementName(null,b);var g=f.createVariable(e),h=f.createVariable(e.charAt(0));e=b.getProperty("start")(false,false);c.openNodeArray(b,d,f,e,g,h,"values");c.outputSimpleFieldValue(g,b,d);c.closeNodeArray(b,d,f,e,g,h,"values");b.getProperty("stop")(false,
false)}else{if(!(a.length>1||typeof a[0]!="object"||"__identifier__"in a)){g=new CueCard.SerializingContext(b);g.setProperty("in-array",true);arguments.callee(a[0],c,g,d,f)}}else if(a.optional!="forbidden"){g=null;e=0;for(h in a)if(a.hasOwnProperty(h)&&h!="*"&&!CueCard.QueryNode.isMqlKeyword(h)){e++;var i=a[h];if(h.charAt(0)!="!"){var j=h.substr(h.indexOf(":")+1);if(j=="type"||j=="/type/object/type")if(i!=null&&typeof i=="string")g=i}}CueCard.CodeGeneration._processTypedObjectNode(a,g,e,c,b,d,f)}};
CueCard.CodeGeneration._processTypedObjectNode=function(a,c,b,d,f,e,g){function h(){var t=CueCard.CodeGeneration._deriveElementName(c,f);j=g.createVariable(t);if(f.getProperty("in-array"))l=g.createVariable(t.charAt(0))}var i=null,j=null,l=null,n,m,o="optional"in a&&a.optional===true;if(f.getProperty("in-array")){var p=b>0&&!("*"in a);n=function(){if(i==null){i=f.getProperty("start")(false,o);h();d.openNodeArray(f,e,g,i,j,l,p?"fields":"object")}return j};m=function(){if(i!=null){d.closeNodeArray(f,
e,g,i,j,l,p?"fields":"object");f.getProperty("stop")(false,o)}}}else{n=function(){if(i==null){i=f.getProperty("start")(false,o);h();d.openNode(f,e,g,i,j)}return j};m=function(){if(i!=null){d.closeNode(f,e,g,i,j);f.getProperty("stop")(false,o)}}}if(b==0||"*"in a)d.generateEmptyObjectNode(f,e,g,n());else{for(var q in a)if(a.hasOwnProperty(q)&&q!="*"&&!CueCard.QueryNode.isMqlKeyword(q)){b=a[q];if(CueCard.CodeGeneration._isImagePath(q)&&CueCard.CodeGeneration._isImageNode(b))d.generateImageField(f,e,
g,q,b,n);else{var s=d.createFieldContext(f,e,g,q,n);s.setProperty("path",q);CueCard.CodeGeneration._processNode(b,d,s,e,g)}}if("*"in a){b=a["*"];s=d.openWildcardField(f,e,g,n,b);CueCard.CodeGeneration._processNode(b,d,s,e,g);d.closeWildcardField(f,e,g,n,b)}}m()};
CueCard.CodeGeneration.serializers["acre-template"]={prepareRootContext:function(){},generateQueryCall:function(a,c,b,d,f,e,g){c.appendIndent();c.append("<acre:script>");c.appendLineBreak();c.indent();c.appendIndent();c.append("var "+e+" = ");CueCard.jsonize(d,{context:a,variables:f,resolveVariables:false});c.append(";");c.appendLineBreak();c.appendIndent();c.appendLineBreak();c.appendIndent();c.append("var "+g+" = acre.freebase.mqlread("+e+");");c.appendLineBreak();c.unindent();c.appendIndent();
c.append("</acre:script>");c.appendLineBreak();return g+".result"},outputSimpleFieldValue:function(a,c,b){b.append("${"+a+"}")},openNodeArray:function(a,c,b,d,f,e,g){c.appendLineBreak();c.appendIndent();c.append('<ul acre:if="'+d+'.length != 0">');c.appendLineBreak();c.indent();c.appendIndent();c.append('<li acre:for="'+e+", "+f+" in "+d+'">');g=="fields"&&c.append("<table>");if(g=="fields"||g=="object"){c.appendLineBreak();c.indent()}},closeNodeArray:function(a,c,b,d,f,e,g){if(g=="fields"||g=="object"){c.unindent();
c.appendIndent()}g=="fields"&&c.append("</table>");c.append("</li>");c.appendLineBreak();c.unindent();c.appendIndent();c.append("</ul>");c.appendLineBreak();c.appendIndent();c.append('<div acre:else=""><ins>[no element]</ins></div>');c.appendLineBreak();c.appendLineBreak()},openNode:function(a,c,b,d,f){c.appendIndent();c.append("<acre:script>var "+f+" = "+d+";</acre:script>");c.appendLineBreak();c.appendIndent();c.append("<table>");c.appendLineBreak();c.indent()},closeNode:function(a,c){c.unindent();
c.appendIndent();c.append("</table>");c.appendLineBreak()},createFieldContext:function(a,c,b,d,f){a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",function(e,g){var h=f();c.appendIndent();c.append("<tr><th>"+d+":</th>");c.appendLineBreak();c.indent();c.appendIndent();c.append("<td"+(g?" acre:if=\"'"+d+"' in "+h+" && "+h+"['"+d+"'] != null\"":"")+">");if(!e){c.appendLineBreak();c.indent()}return h+"['"+d+"']"});a.setProperty("stop",function(e,g){if(!e){c.unindent();
c.appendIndent()}c.append("</td>");c.appendLineBreak();if(g){c.appendIndent();c.append('<td acre:else=""><ins>[no value]</ins></td>');c.appendLineBreak()}c.unindent();c.appendIndent();c.append("</tr>");c.appendLineBreak()});return a},generateImageField:function(a,c,b,d,f,e){e=e();a=e+"['"+d+"']";c.appendIndent();c.append("<tr><th>"+d+":</th>");c.appendLineBreak();c.indent();c.appendIndent();c.append("<td acre:if=\"'"+d+"' in "+e+" && "+a+' != null">');c.appendLineBreak();c.indent();d=f instanceof
Array;c.appendIndent();if(d){f=f[0];d=b.createVariable("image");b=b.createVariable("i");c.append('<img acre:for="'+b+", "+d+" in "+a+'" src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in f?"/guid/${"+d+".guid.substr(1)}":"${"+d+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>')}else c.append('<img src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in f?"/guid/${"+a+".guid.substr(1)}":"${"+a+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>');
c.appendLineBreak();c.unindent();c.appendIndent();c.append('<td acre:else=""><ins>[no image]</ins></td>');c.appendLineBreak();c.unindent();c.appendIndent();c.append("</tr>");c.appendLineBreak()},openWildcardField:function(a,c,b,d){d=d();var f=b.createVariable("field"),e=b.createVariable("value");c.appendIndent();c.append('<tr acre:for="'+f+", "+e+" in "+d+'"><td>${'+f+"}:</td>");c.appendLineBreak();c.indent();a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",
function(g){c.appendIndent();c.append("<td>");if(!g){c.appendLineBreak();c.indent()}return e});a.setProperty("stop",function(g){if(!g){c.unindent();c.appendIndent()}c.append("</td>");c.appendLineBreak()});return a},closeWildcardField:function(a,c){c.unindent();c.appendIndent();c.append("</tr>");c.appendLineBreak()},generateEmptyObjectNode:function(a,c,b,d){a=b.createVariable("field");b=b.createVariable("value");c.appendIndent();c.append("<table>");c.appendLineBreak();c.indent();c.appendIndent();c.append('<tr acre:for="'+
a+", "+b+" in "+d+'"><th>${'+a+"}:</th>");c.appendLineBreak();c.indent();c.appendIndent();c.append('<td acre:if="'+b+' instanceof Array">${'+b+".join(', ')}</td>");c.appendLineBreak();c.appendIndent();c.append('<td acre:else="">${'+b+"}</td>");c.appendLineBreak();c.unindent();c.appendIndent();c.append("</tr>");c.appendLineBreak();c.unindent();c.appendIndent();c.append("</table>");c.appendLineBreak()}};CueCard.ExampleDialog=function(a){this._options=a||{};this._constructUI()};
CueCard.ExampleDialog._dialog=null;CueCard.ExampleDialog.prototype.dispose=function(){};
CueCard.ExampleDialog.prototype._constructUI=function(){if(CueCard.ExampleDialog._dialog==null){CueCard.ExampleDialog._dialog=$('<div id="cuecard-examples-dialog" title="Examples"><div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-0">Techniques</div><div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-1">Examples</div><div class="cuecard-examples-dialog-columnHeader cuecard-examples-dialog-column-2">Query</div><div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-0"></div><div class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-1"></div><textarea class="cuecard-examples-dialog-columnBody cuecard-examples-dialog-column-2 cuecard-examples-query" readonly="true" wrap="off" /></div>').appendTo(document.body);var a=
CueCard.ExampleDialog._dialog.find("textarea")[0],c=CueCard.ExampleDialog._dialog.find(".cuecard-examples-dialog-columnBody"),b=function(){var i=$("#cuecard-examples-dialog")[0],j=i.offsetHeight-35;c.css("top","30px").css("height",j+"px");j=i.offsetWidth-20-10-200;i=Math.round(j*0.5);j=Math.round(j*0.5);$(".cuecard-examples-dialog-column-0").css("left","10px").css("width","200px");$(".cuecard-examples-dialog-column-1").css("left","215px").css("width",i+"px");$(".cuecard-examples-dialog-column-2").css("left",
210+i+10+"px").css("width",j+"px")},d={all:[]},f=function(){CueCard.ExampleDialog._dialog.find(".cuecard-examples-example").removeClass("cuecard-examples-example-selected")},e=function(i,j){$('<a href="javascript:{}" class="cuecard-examples-example" id="cuecard-example-'+i+'">'+j.name+"</a>").click(function(){f();$(this).addClass("cuecard-examples-example-selected");a.value=CueCard.jsonize(CueCard.Examples[i].query,{indentCount:2})}).appendTo(c[1]);for(var l=0;l<j.techniques.length;l++){var n=j.techniques[l];
if(n in d)d[n].push(i);else d[n]=[i]}};CueCard.Examples.sort(function(i,j){return i.name.localeCompare(j.name)});for(var g=0;g<CueCard.Examples.length;g++)e(g,CueCard.Examples[g]);e=function(i){$('<a href="javascript:{}" class="cuecard-examples-technique'+(i=="all"?" cuecard-examples-technique-selected":"")+'">'+i+" ("+(i=="all"?CueCard.Examples.length:d[i].length)+")</a>").click(function(){CueCard.ExampleDialog._dialog.find(".cuecard-examples-technique").removeClass("cuecard-examples-technique-selected");
$(this).addClass("cuecard-examples-technique-selected");if(i=="all")CueCard.ExampleDialog._dialog.find(".cuecard-examples-example").show();else{CueCard.ExampleDialog._dialog.find(".cuecard-examples-example").hide();for(var j=d[i],l=0;l<j.length;l++)$("#cuecard-example-"+j[l]).show()}f();a.value=""}).appendTo(c[0])};for(g=0;g<CueCard.ExampleTechniques.length;g++)e(CueCard.ExampleTechniques[g]);CueCard.ExampleDialog._dialog.dialog({autoOpen:false,modal:true,resizable:true,position:"center",minWidth:800,
minHeight:300,resize:b,open:b})}var h=this;CueCard.ExampleDialog._dialog.dialog("option","width",$(window).width()-150).dialog("option","height",$(window).height()-200).dialog("option","buttons",{"Paste & Run":function(){$(this).dialog("close");h._options.onDone(CueCard.ExampleDialog._dialog.find("textarea")[0].value)},Cancel:function(){$(this).dialog("close")}});CueCard.ExampleDialog._dialog.dialog("open")};
CueCard.ExampleTechniques=["all","basic","sorting","text search","range constraint","date query","multiple constraints on same property","limiting number of results","geographic location","compound value type (CVT)","schema inspection","attribution","adding data"];
CueCard.Examples=[{name:"Vietnamese restaurants in Aspen, Colorado",query:[{"/business/business_location/address":{citytown:"Aspen",state_province_region:"Colorado"},cuisine:"Vietnamese",name:null,id:null,type:"/dining/restaurant"}],techniques:["basic","geographic location"]},{name:"Properties of /music/artist",query:[{id:"/music/artist",properties:[{}],type:"/type/type"}],techniques:["schema inspection"]},{name:"All types created by the user jamie",query:[{creator:"/user/jamie",name:null,id:null,
type:"/type/type"}],techniques:["attribution"]},{name:"Cloud classifications sorted by name",query:[{clouds:[],name:null,id:null,sort:"name",type:"/meteorology/cloud_classification"}],techniques:["basic","sorting"]},{name:"U.S. states containing cities whose names start with 'Blue' or 'Red'",query:[{"a:contains":[{name:null,id:null,"name~=":"^Red",type:"/location/citytown"}],"b:contains":[{name:null,id:null,"name~=":"^Blue",type:"/location/citytown"}],"b:type":"/location/us_state",name:null,id:null,
type:"/location/location"}],techniques:["text search","multiple constraints on same property"]},{name:"2 of The Police's albums and their tracks",query:{album:[{id:null,limit:2,name:null,track:[]}],id:null,name:"The Police",type:"/music/artist"},techniques:["basic","limiting number of results"]},{name:"25 Songs with the word 'love' in their titles, with release date, album and artist",query:[{album:{artist:[],name:null,id:null,release_date:null},limit:25,name:null,"name~=":"Love*",type:"/music/track"}],
techniques:["text search","limiting number of results","date query"]},{name:"Films starring both Joe Pesci and Robert de Niro, showing their full cast",query:[{"a:starring":[{actor:"Joe Pesci"}],"b:starring":[{actor:"Robert de Niro"}],name:null,id:null,starring:[{actor:null}],type:"/film/film"}],techniques:["multiple constraints on same property","compound value type (CVT)"]},{name:"32 actors born in the 1960s, with two films of each actor",query:[{"/people/person/date_of_birth":null,"/people/person/date_of_birth<":"1970",
"/people/person/date_of_birth>=":"1960",film:[{film:null,id:null,limit:2}],limit:35,name:null,id:null,type:"/film/actor"}],techniques:["multiple constraints on same property","date query","limiting number of results","range constraint"]},{name:"Directors who have directed both Parker Posey and any actor named Robert (in possibly different films)",query:[{"a:film":[{name:null,id:null,starring:{actor:"Parker Posey"}}],"b:film":[{name:null,id:null,starring:{actor:null,"actor~=":"Robert*"}}],name:null,
id:null,type:"/film/director"}],techniques:["multiple constraints on same property","text search","compound value type (CVT)"]},{name:"Music artists with albums containing a track called 'One Tree Hill'",query:[{album:[{name:null,id:null,track:[{length:null,name:"One Tree Hill"}]}],name:null,id:null,type:"/music/artist"}],techniques:["compound value type (CVT)","basic"]},{name:"Everything about 'Jimi Hendrix'",query:{"*":null,name:"Jimi Hendrix",type:"/music/artist"},techniques:["basic"]},{name:"Kevin Bacon's films, with cast, producers, music, etc.",
query:[{film:[{film:{imdb_id:[],music:[],name:null,id:null,produced_by:[],starring:[{actor:[{}]}],type:[]}}],name:"Kevin Bacon",type:"/film/actor"}],techniques:["basic","compound value type (CVT)"]},{name:"When 'Star Wars Episode IV' was added to the database, and by whom",query:[{creator:null,id:"/wikipedia/en/Star_Wars_Episode_IV",name:null,timestamp:null,type:"/film/film"}],techniques:["attribution"]},{name:"Tracks on Synchronicity longer than 300 seconds",query:[{artist:"The Police",name:"Synchronicity",
track:[{length:null,"length>":300,name:null}],type:"/music/album"}],techniques:["range constraint"]},{name:"Properties of a particular type (/government/politician)",query:{id:"/government/politician",properties:[],type:"/type/type"},techniques:["schema inspection"]},{name:"Properties of a particular property (/type/object/name)",query:{"*":null,id:"/type/object/name",type:"/type/property"},techniques:["schema inspection"]},{name:"Types in a particular domain (/music)",query:{id:"/music",type:"/type/domain",
types:[]},techniques:["schema inspection"]},{name:"Creating a new topic given a name and a type",query:{create:"unless_exists",name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,guid:null},techniques:["adding data"]},{name:"Setting a basic unique property to a topic",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,basic_property:{value:42,connect:"update"}},techniques:["adding data"]},{name:"Connecting one topic to another",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",
id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"insert"}},techniques:["adding data"]},{name:"Deleting a link between two topics",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"delete"}},techniques:["adding data"]}];
CueCard.Languages=[{name:"Afrikaans",id:"/lang/af"},{name:"Akkadian",id:"/lang/kk"},{name:"Albanian",id:"/lang/sq"},{name:"Amharic",id:"/lang/am"},{name:"Arabic",id:"/lang/ar"},{name:"Armenian",id:"/lang/hy"},{name:"Artificial",id:"/lang/art"},{name:"Asturian",id:"/lang/ast"},{name:"Australian languages",id:"/lang/aus"},{name:"Azerbaijani",id:"/lang/az"},{name:"Balinese",id:"/lang/ban"},{name:"Bambara",id:"/lang/bm"},{name:"Bantu",id:"/lang/bnt"},{name:"Basque",id:"/lang/eu"},{name:"Batak",id:"/lang/btk"},
{name:"Belarusian",id:"/lang/be"},{name:"Bengali",id:"/lang/bn"},{name:"Bhojpuri",id:"/lang/bho"},{name:"Bosnian",id:"/lang/bs"},{name:"Breton",id:"/lang/br"},{name:"Bulgarian",id:"/lang/bg"},{name:"Buriat",id:"/lang/bua"},{name:"Catalan",id:"/lang/ca"},{name:"Cebuano",id:"/lang/ceb"},{name:"Cherokee",id:"/lang/chr"},{name:"Chichewa",id:"/lang/ny"},{name:"Chinese",id:"/lang/zh"},{name:"Cornish",id:"/lang/kw"},{name:"Corsican",id:"/lang/co"},{name:"Cree",id:"/lang/cr"},{name:"Creoles",id:"/lang/cpf"},
{name:"Croatian",id:"/lang/hr"},{name:"Czech",id:"/lang/cs"},{name:"Danish",id:"/lang/da"},{name:"Duala",id:"/lang/dua"},{name:"Dutch",id:"/lang/nl"},{name:"English",id:"/lang/en"},{name:"Esperanto",id:"/lang/eo"},{name:"Estonian",id:"/lang/et"},{name:"Faroese",id:"/lang/fo"},{name:"Filipino",id:"/lang/fil"},{name:"Finnish",id:"/lang/fi"},{name:"French",id:"/lang/fr"},{name:"Frisian",id:"/lang/fy"},{name:"Friulian",id:"/lang/fur"},{name:"Fulah",id:"/lang/ff"},{name:"Ga",id:"/lang/gaa"},{name:"Gaelic",
id:"/lang/gd"},{name:"Gallegan",id:"/lang/gl"},{name:"Georgian",id:"/lang/ka"},{name:"German",id:"/lang/de"},{name:"Germanic",id:"/lang/gem"},{name:"Greek",id:"/lang/el"},{name:"Guarani",id:"/lang/gn"},{name:"Haitian",id:"/lang/ht"},{name:"Hausa",id:"/lang/ha"},{name:"Hawaiian",id:"/lang/haw"},{name:"Hebrew",id:"/lang/he"},{name:"Hindi",id:"/lang/hi"},{name:"Hungarian",id:"/lang/hu"},{name:"Icelandic",id:"/lang/is"},{name:"Indonesian",id:"/lang/id"},{name:"Inuktitut",id:"/lang/ku"},{name:"Inuktitut",
id:"/lang/iu"},{name:"Irish",id:"/lang/ga"},{name:"Italian",id:"/lang/it"},{name:"Japanese",id:"/lang/ja"},{name:"Judeo-Arabic",id:"/lang/jrb"},{name:"Kalaallisut",id:"/lang/kl"},{name:"Khmer",id:"/lang/km"},{name:"Kinyarwanda",id:"/lang/rw"},{name:"Klingon",id:"/lang/tlh"},{name:"Kongo",id:"/lang/kg"},{name:"Korean",id:"/lang/ko"},{name:"Ladino",id:"/lang/lad"},{name:"Latin",id:"/lang/la"},{name:"Latvian",id:"/lang/lv"},{name:"Limburgan",id:"/lang/li"},{name:"Lingala",id:"/lang/ln"},{name:"Lithuanian",
id:"/lang/lt"},{name:"Low German",id:"/lang/nds"},{name:"Luxembourgish",id:"/lang/lb"},{name:"Macedonian",id:"/lang/mk"},{name:"Malagasy",id:"/lang/mg"},{name:"Malay",id:"/lang/ms"},{name:"Malayalam",id:"/lang/ml"},{name:"Maltese",id:"/lang/mt"},{name:"Mandingo",id:"/lang/man"},{name:"Manx",id:"/lang/gv"},{name:"Maori",id:"/lang/mi"},{name:"Marathi",id:"/lang/mr"},{name:"Mohawk",id:"/lang/moh"},{name:"Moldavian",id:"/lang/mo"},{name:"Mongolian",id:"/lang/mn"},{name:"Nahuatl",id:"/lang/nah"},{name:"Navajo",
id:"/lang/nv"},{name:"Neapolitan",id:"/lang/nap"},{name:"Nepali",id:"/lang/ne"},{name:"Norse,",id:"/lang/non"},{name:"Northern Sami",id:"/lang/se"},{name:"Norwegian",id:"/lang/no"},{name:"Norwegian Nynorsk",id:"/lang/nn"},{name:"Occitan",id:"/lang/oc"},{name:"Panjabi",id:"/lang/pa"},{name:"Papiamento",id:"/lang/pap"},{name:"Persian",id:"/lang/fa"},{name:"Polish",id:"/lang/pl"},{name:"Portuguese",id:"/lang/pt"},{name:"Pushto",id:"/lang/ps"},{name:"Quechua",id:"/lang/qu"},{name:"Raeto-Romance",id:"/lang/rm"},
{name:"Romanian",id:"/lang/ro"},{name:"Romany",id:"/lang/rom"},{name:"Russian",id:"/lang/ru"},{name:"Sakha",id:"/lang/sah"},{name:"Sanskrit",id:"/lang/sa"},{name:"Sardinian",id:"/lang/sc"},{name:"Scots",id:"/lang/sco"},{name:"Serbian",id:"/lang/sr"},{name:"Shona",id:"/lang/sn"},{name:"Sicilian",id:"/lang/scn"},{name:"Slovak",id:"/lang/sk"},{name:"Slovenian",id:"/lang/sl"},{name:"Songhai",id:"/lang/son"},{name:"Spanish",id:"/lang/es"},{name:"Sundanese",id:"/lang/su"},{name:"Swahili",id:"/lang/sw"},
{name:"Swedish",id:"/lang/sv"},{name:"Syriac",id:"/lang/syr"},{name:"Tagalog",id:"/lang/tl"},{name:"Tahitian",id:"/lang/ty"},{name:"Tajik",id:"/lang/tg"},{name:"Tamashek",id:"/lang/tmh"},{name:"Tamil",id:"/lang/ta"},{name:"Telugu",id:"/lang/te"},{name:"Thai",id:"/lang/th"},{name:"Tibetan",id:"/lang/bo"},{name:"Tonga",id:"/lang/to"},{name:"Turkish",id:"/lang/tr"},{name:"Turkmen",id:"/lang/tk"},{name:"Tuvinian",id:"/lang/tyv"},{name:"Ukrainian",id:"/lang/uk"},{name:"Urdu",id:"/lang/ur"},{name:"Uzbek",
id:"/lang/uz"},{name:"Vietnamese",id:"/lang/vi"},{name:"Welsh",id:"/lang/cy"},{name:"Wolof",id:"/lang/wo"},{name:"Xhosa",id:"/lang/xh"},{name:"Yiddish",id:"/lang/yi"},{name:"Yoruba",id:"/lang/yo"},{name:"Zulu",id:"/lang/zu"}];
CueCard.XMetawebCosts={tu:{meaning:"time/user",subsystem:"graphd"},ts:{meaning:"time/system",subsystem:"graphd"},tr:{meaning:"time/real",subsystem:"graphd"},te:{meaning:"time/overall",subsystem:"graphd"},pr:{meaning:"page reclaims",subsystem:"graphd"},pf:{meaning:"page faults",subsystem:"graphd"},dw:{meaning:"primitive data writes",subsystem:"graphd"},dr:{meaning:"primitive data reads",subsystem:"graphd"},"in":{meaning:"index size reads",subsystem:"graphd"},ir:{meaning:"index element reads",subsystem:"graphd"},
iw:{meaning:"index element write",subsystem:"graphd"},va:{meaning:"value allocation",subsystem:"graphd"},dt:{meaning:"total time spent in the session",subsystem:"client/me"},mr:{meaning:"number of mql requests (independent of caches)",subsystem:"client/me"},ch:{meaning:"cache/hit (memcache, not Squid)",subsystem:"client/me",important:true},cm:{meaning:"cache/miss (memcache, not Squid)",subsystem:"client/me"},cr:{meaning:"cache/read (memcache, not Squid)",subsystem:"client/me"},cs:{meaning:"cache skip (browser shift+reload skips memcache)",
subsystem:"client/me"},lh:{meaning:"lojson-cache/hit",subsystem:"client/me"},lm:{meaning:"lojson-cache/miss",subsystem:"client/me"},lr:{meaning:"lojson-cache/read",subsystem:"client/me"},nreqs:{meaning:"graph requests",subsystem:"client/me",important:true},tf:{meaning:"time/formatted",subsystem:"client/me"},tg:{meaning:"time/graph",subsystem:"client/me",important:true},rt:{meaning:"relevance/time",subsystem:"client/me"},cc:{meaning:"cpu time (utime + stime)",subsystem:"client/me"},mcu:{meaning:"mql user time",
subsystem:"client/me"},mcs:{meaning:"mql system time",subsystem:"client/me"},tm:{meaning:"mql real time",subsystem:"client/me",important:true},utime:{meaning:"time in user mode (float)",subsystem:"client/me"},stime:{meaning:"time in system mode (float)",subsystem:"client/me"},maxrss:{meaning:"maximum resident set size",subsystem:"client/me"},ixrss:{meaning:"shared memory size",subsystem:"client/me"},idrss:{meaning:"unshared memory size",subsystem:"client/me"},isrss:{meaning:"unshared stack size",
subsystem:"client/me"},minflt:{meaning:"page faults not requiring I/O",subsystem:"client/me"},majflt:{meaning:"page faults requiring I/O",subsystem:"client/me"},nswap:{meaning:"number of swap outs",subsystem:"client/me"},inblock:{meaning:"block input operations",subsystem:"client/me"},oublock:{meaning:"block output operations",subsystem:"client/me"},msgsnd:{meaning:"messages sent",subsystem:"client/me"},msgrcv:{meaning:"messages received",subsystem:"client/me"},nsignals:{meaning:"signals received",
subsystem:"client/me"},nvcsw:{meaning:"voluntary context switches",subsystem:"client/me"},nivcsw:{meaning:"involuntary context switches",subsystem:"client/me"},br:{meaning:"number of blob requests",subsystem:"client/me"},bctn:{meaning:"cdb thumbnail time - from blobclient POV",subsystem:"client/me"},rt:{meaning:"relevance/time (FIX: same name, different semantics?)",subsystem:"gix"},pt:{meaning:"postgres time",subsystem:"gix"},qt:{meaning:"actual postgres query time",subsystem:"gix"},ct:{meaning:"postgres connect time",
subsystem:"gix"},mt:{meaning:"MQL time",subsystem:"gix"},tt:{meaning:"total time",subsystem:"other"},mt:{meaning:"total MQL time: mql_output + mql_filter",subsystem:"other"},mft:{meaning:"MQL filter time (total time, ie. not per invocation)",subsystem:"other"},mfc:{meaning:"number of mql_filter invocations",subsystem:"other"},sh:{meaning:"squid/hit",subsystem:"cache"},st:{meaning:"squid/total time",subsystem:"cache"},so:{meaning:"squid/origin server time",subsystem:"cache"}};
