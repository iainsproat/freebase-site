
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
(function(e){var h="undefined"!=typeof window.innerWidth?function(){return{w:window.innerWidth,h:window.innerHeight}}:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?function(){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}:function(){return{w:document.getElementsByTagName("body")[0].clientWidth,h:document.getElementsByTagName("body")[0].clientHeight}};window.kbs=
function(f){e(".kbs.current",f).removeClass("current");var a=e(".domain-section:first",f),c=e(".domain-section:last",f),d=this.scroll_to=function(b){var a=e(document).scrollTop();e(document).height();var c=h().h,c=a+c,f=b.offset().top,b=f+b.height();f<a?e(document).scrollTop(f):b>c&&e(document).scrollTop(a+(b-c))},g=this.get_current=function(){return e(".kbs.current:first",f)},i=this.set_next=function(b,a,c){b=b||g();a.length&&(b.removeClass("current"),a.addClass("current"),c||d(a))},q=this.next_domain=
function(b){var a=g(),c=m(a);c&&(c=c.find(".kbs:first"),i(a,c,b))},m=this._next_domain=function(b){if(!b||!b.length)return e(".domain-section:first",f);b=b.closest(".domain-section");return!b.length||b[0]===c[0]?a:b.next(".domain-section")},r=this.prev_domain=function(){var b=g(),a=n(b);a&&(a=a.find(".kbs:first"),i(b,a))},n=this._prev_domain=function(b){if(!b||!b.length)return e(".domain-section:last",f);var k=b.closest(".domain-section");return b.closest(".property-section").length||b.closest(".type-section").length?
k:!k.length||k[0]===a[0]?c:k.prev(".domain-section")},s=this.next_type=function(){var b=g(),a=o(b);a&&(a=a.find(".kbs:first"),i(b,a))},o=this._next_type=function(b){if(!b||!b.length)return e(".type-section:first",f);var a=b.closest(".domain-section"),b=b.closest(".type-section"),b=b.length?b.next(".type-section"):a.find(".type-section:first");if(!b||!b.length){var c=m(a);if(c)for(;c.get(0)!==a.get(0);){b=c.find(".type-section:first");if(b.length)break;c=m(c)}}return b},j=this.prev_type=function(){var b=
g(),a=l(b);a&&(a=a.find(".kbs:first"),i(b,a))},l=this._prev_type=function(b){if(!b||!b.length)return e(".type-section:last",f);var a=b.closest(".domain-section"),c=b.closest(".type-section");if(b.closest(".property-section").length)return c;var d;c.length&&(d=c.prev(".type-section"));if(!d||!d.length)if(b=n(a))for(;b.get(0)!==a.get(0);){d=b.find(".type-section:last");if(d.length)break;b=n(b)}return d},u=this.next_prop=function(){var b=g(),a=t(b);a&&(a=a.find(".kbs:first"),i(b,a))},t=this._next_prop=
function(b){if(!b||!b.length)return e(".property-section:first",f);var a=b.closest(".domain-section"),c=b.closest(".type-section"),d=b.closest(".property-section"),a=d.length?d.next(".property-section"):c.length?c.find(".property-section:first"):a.find(".property-section:first");if(!a||!a.length)if(b=o(b))for(;b.get(0)!==c.get(0);){a=b.find(".property-section:first");if(a.length)break;null==c.get(0)&&(c=b);b=o(b)}return a},w=this.prev_prop=function(){var b=g(),a=v(b);a&&(a=a.find(".kbs:first"),i(b,
a))},v=this._prev_prop=function(b){if(!b||!b.length)return e(".property-section:last",f);var a=b.closest(".domain-section"),c=b.closest(".type-section"),d=b.closest(".property-section");if(b.closest(".data-section").length)return d;var g;d.length&&(g=d.prev(".property-section"));if(!g||!g.length)if(j=c.length?l(c):l(a))for(;j.get(0)!==c.get(0);){g=j.find(".property-section:last");if(g.length)break;null==c.get(0)&&(c=j);j=l(j)}return g};this.next=function(){var b=g();if(b&&b.length){var a=this._next(b);
if(a){i(b,a);return}}b=e(".kbs:visible:first",f);i(b,b)};this._next=function(b){if(!b||!b.length)return e(".domain-section:first .kbs:first",f);var d=b.closest(".domain-section"),g=b.closest(".type-section"),i=b.closest(".property-section");if(b.closest(".data-section").length){b=b.next(".kbs");if(b.length)return b;b=i.next(".property-section").find(".kbs:first");if(b.length)return b;b=g.next(".type-section").find(".kbs:first")}else if(i.length){b=i.find(".data-section:first .kbs:first");if(b.length)return b;
b=i.next(".property-section").find(".kbs:first");if(b.length)return b;b=g.next(".type-section").find(".kbs:first")}else if(g.length){b=g.find(".property-section:first .kbs:first");if(b.length)return b;b=g.next(".type-section").find(".kbs:first")}else b=d.find(".type-section:first .kbs:first");return b.length?b:d.get(0)===c.get(0)?a.find(".kbs:first"):d.next(".domain-section").find(".kbs:first")};this.prev=function(){var a=g(),c=this._prev(a);c&&i(a,c)};this._prev=function(b){if(!b||!b.length)return b=
e(".data-section:last .kbs:last",f),b.length||(b=e(".property-section:last .kbs:first",f)),b.length||(b=e(".type-section:last .kbs:first",f)),b.length||(b=e(".domain-section:last .kbs:first",f)),b;var d=b.closest(".domain-section"),g=b.closest(".type-section"),i=b.closest(".property-section");return b.closest(".data-section").length?(b=b.prev(".kbs"),b.length?b:i.find(".kbs:first")):i.length?(b=i.prev(".property-section").find(".kbs:last"),b.length?b:g.find(".kbs:first")):g.length?(b=g.prev(".type-section").find(".kbs:last"),
b.length?b:d.find(".kbs:first")):d.get(0)===a.get(0)?c.find(".kbs:last"):d.prev(".domain-section").find(".kbs:last")};this.edit=function(){this.get_current().trigger("edit")};var p=this;e(document).unbind(".kbs").bind("keydown.kbs",function(a){var c=a.target;if(c==document.body||c==document||c==window||c==e("html")[0])c=a.keyCode,68===c?a.shiftKey?r():q():84===c?a.shiftKey?j():s():80===c?a.shiftKey?w():u():74===c?p.next():75===c?p.prev():69===c&&p.edit()})}})(jQuery);
(function(e,h){var f=window.propbox={init:function(a,c){c=e.extend({lang:"/lang/en"},c);if(!c.base_ajax_url)throw Error("base_ajax_url required in propbox options");if(!c.base_static_url)throw Error("base_static_url required in propbox options");if(!c.id)throw Error("topic id required in propbox options");if(!c.lang)throw Error("lang required in propbox options");f.options=c;f.kbs=new h(a);e(".kbs",a).live("click",function(){var a=f.kbs.get_current();f.kbs.set_next(a,e(this),!0)}).live("edit",function(){var a=
e(this).find(".headmenu:first").data("submenu");a&&e("li:first a:first",a).click()});f.init_menus(a);e.tablesorter&&e(".data-table").addClass("table-sortable").tablesorter()},init_menus:function(a,c){a=e(a||document);c&&e(".nicemenu",a).nicemenu();var d;d=a&&a.is(".hover-row")?a:e(".hover-row",a);d.hover(f.row_menu_hoverover,f.row_menu_hoverout);d.dblclick(function(){var a=e(".nicemenu .default-action",this);a.length||(a=e(".nicemenu:first .submenu:first a:first",this));var c=a.attr("href");c&&("#"==
c||0==c.indexOf("javascript:void(0)"))&&e(a).click()});e(".nicemenu .headmenu",a).add(e(".nicemenu .default-action",a)).click("click",function(){if(f.kbs){var a=f.kbs.get_current();a&&f.kbs.set_next(a,e(this).parents(".kbs:first"),!0)}return!1})},row_menu_hoverover:function(){e(this).addClass("row-hover")},row_menu_hoverout:function(){e(this).removeClass("row-hover")},get_script:function(a,c){var d=f.get_script.cache;d||(d=f.get_script.cache={});var g=d[a];g?1===g.state?g.callbacks.push(c):4===g.state&&
c():(g=d[a]={state:0,callbacks:[c]},e.ajax({url:f.options.base_static_url+a,dataType:"script",cache:!0,beforeSend:function(){g.state=1},success:function(){g.state=4;e.each(g.callbacks,function(a,c){c()})},error:function(){g.state=-1}}))},prop_edit:function(a,c){var d=e(a).parents(".property-section");d.length||(d=e(a).parents(".submenu").data("headmenu").parents(".property-section"));d=d.find(".data-section .data-row:first:visible .nicemenu:first .headmenu");d.length?d.data("submenu").find("a:first").click():
f.prop_add(a,c);return!1},prop_add:function(a,c){var d=e(a).parents(".property-section");d.length||(d=e(a).parents(".submenu").data("headmenu").parents(".property-section"));f.get_script("/propbox-edit.mf.js",function(){f.edit.prop_add_begin(d,c)});return!1},value_edit:function(a){var c=e(a).parents(".submenu").data("headmenu").parents(".data-row:first"),d=c.parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.value_edit_begin(d,c)});return!1},value_delete:function(a){var c=
e(a).parents(".submenu").data("headmenu").parents(".data-row:first"),d=c.parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.value_delete_begin(d,c)});return!1},remove_type:function(a){var a=e(a),c=a.parents(".type-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.remove_type_begin(a,c)});return!1},add_type:function(a,c,d){var a=e(a),g=a.parents(".type-section"),i=f.options.incompatible_types;i?i.search(f.options.id,c,d,{compatible:function(){f.add_type_submit(a,
g)},incompatible:i.overlay_incompatible_callback({onConfirm:function(){f.add_type_submit(a,g)}})}):f.add_type_submit(a,g);return!1},add_type_submit:function(a,c){f.get_script("/propbox-edit.mf.js",function(){f.edit.add_type_submit(a,c)})},add_has_no_value:function(a){var c=e(a).parents(".submenu").data("headmenu").parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.add_has_no_value(c)});return!1},add_has_value:function(a){var c=e(a).parents(".submenu").data("headmenu").parents(".property-section");
f.get_script("/propbox-edit.mf.js",function(){f.edit.add_has_value(c)});return!1},add_is_reviewed:function(a){var c=e(a).parents(".submenu").data("headmenu").parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.add_is_reviewed(c)});return!1},remove_has_no_value:function(a){var c=e(a).parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.remove_has_no_value(c)});return!1},remove_has_value:function(a){var c=e(a).parents(".property-section");f.get_script("/propbox-edit.mf.js",
function(){f.edit.remove_has_value(c)});return!1},more:function(a,c,d,g){var i=e(a).parents(".property-section");f.get_script("/propbox-edit.mf.js",function(){f.edit.more(i,c,d,function(a){e.tablesorter&&a.find(".data-table").toggleClass("table-sortable",!0).tablesorter();g&&g(a)})})},more_and_sort:function(a,c,d,g){e(a).parents(".property-section");f.more(a,d,g,function(a){var h=a.find(".data-table");h.length?h.trigger("sorton",[[[c,0]]]):f.sort_values(e(":first-child",a),c,d,g)})},sort_values:function(a){var a=
e(a).parents(".property-section"),c=a.hasClass("column-header-desc"),d=a.find(".data-list"),g=d.find("li.data-row");g.sort(function(a,d){var f=e(a).find(".property-value").text(),g=e(d).find(".property-value").text();return f.toLowerCase()<g.toLowerCase()?c?1:-1:c?-1:1});d.empty().html(g);a.toggleClass("column-header-desc",!c).toggleClass("column-header-asc",c);f.init_menus(a,!0)}}})(jQuery,window.kbs);
(function(e,h,f){h.schema={init_modal_help:function(a){e(".modal-help-toggle",a).click(function(){var a=e(this),d=a.parents().find(".modal-help"),f=a.parents().find(".modal-content");d.is(":hidden")?(d.height(f.height()-5).slideDown(),a.html("[ - ] Hide Help")):(d.slideUp(),a.html("[ + ] Show Help"))})}};e(function(){f.init_menus()})})(jQuery,window.freebase,window.propbox);
(function(e,h){var f=h.schema.type={init:function(){e("#included-types-table .tbody-header, #incoming-properties-table .tbody-header").each(function(){var a=e(this);a.hasClass("expanded")||a.data("ajax",!0);a.click(f.toggle)})},toggle:function(){var a=e(this);a.data("ajax")&&a.attr("data-url")?a.is(".loading")||(a.addClass("loading"),e.ajax({url:a.attr("data-url"),dataType:"json",success:function(c){var d=e("<table>").append(c.result.html),c=d.find("tbody:first"),d=d.find("thead:first");d.length&&
c.prepend(d.find(">tr"));a.parents("thead:first").after(c);propbox.init_menus(c,!0);f._toggle(a)},complete:function(){a.removeClass("loading");a.removeData("ajax")}})):f._toggle(a)},_toggle:function(a){var c=a.parents("thead.expandable:first").next("tbody:first");a.is(".expanded")?(c.hide(),a.removeClass("expanded"),e(".tbody-header-title",a).removeClass("expanded")):(c.show(),a.addClass("expanded"),e(".tbody-header-title",a).addClass("expanded"))},reorder_property:function(a,c){var d=e(this);h.get_script(h.h.static_url("type-edit.mf.js"),
function(){f.edit.reorder_property_begin(d,c)});return!1},add_property:function(a,c){var d=e(this).parents("table:first");h.get_script(h.h.static_url("type-edit.mf.js"),function(){f.edit.add_property_begin(d,c)});return!1},edit_property:function(a,c){var d=e(this).parents(".submenu").data("headmenu").parents(".data-row:first");h.get_script(h.h.static_url("type-edit.mf.js"),function(){f.edit.edit_property_begin(d,c)});return!1},add_included_type:function(a,c){var d=e(this).parents("table:first");h.get_script(h.h.static_url("type-edit.mf.js"),
function(){f.edit.add_included_type_begin(d,c)});return!1},delete_included_type:function(a,c,d){a.stopPropagation();var g=e(this).parents("tr:first");h.get_script(h.h.static_url("type-edit.mf.js"),function(){f.edit.delete_included_type_begin(g,c,d)});return!1},reverse_property:function(a,c,d){var g=e(this);h.get_script(h.h.static_url("type-edit.mf.js"),function(){f.edit.reverse_property_begin(g,c,d)});return!1},add_instance:function(a,c){var d=e(this).parents("table:first");h.get_script(h.h.static_url("type-edit.mf.js"),
function(){f.edit.add_instance_begin(d,c)});return!1},delete_instance:function(a,c,d){var g=e(this).parents(".submenu").data("headmenu").parents(".data-row:first");h.get_script(h.h.static_url("type-edit.mf.js"),function(){f.edit.delete_instance_begin(g,c,d)});return!1}};e(f.init)})(jQuery,window.freebase);
